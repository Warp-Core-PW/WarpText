(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?module.exports=t():typeof define==="function"&&define.amd?define(t):e.CodeMirror=t()})(this,function(){"use strict";var e=navigator.userAgent;var t=navigator.platform;var v=/gecko\/\d/i.test(e);var r=/MSIE \d/.test(e);var n=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(e);var i=/Edge\/(\d+)/.exec(e);var k=r||n||i;var C=k&&(r?document.documentMode||6:+(i||n)[1]);var g=!i&&/WebKit\//.test(e);var o=g&&/Qt\/\d+\.\d+/.test(e);var a=!i&&/Chrome\//.test(e);var m=/Opera\//.test(e);var s=/Apple Computer/.test(navigator.vendor);var l=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(e);var u=/PhantomJS/.test(e);var c=!i&&/AppleWebKit/.test(e)&&/Mobile\/\w+/.test(e);var f=/Android/.test(e);var h=c||f||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(e);var y=c||/Mac/.test(t);var d=/\bCrOS\b/.test(e);var p=/win/i.test(t);var b=m&&e.match(/Version\/(\d*\.\d*)/);if(b){b=Number(b[1])}if(b&&b>=15){m=false;g=true}var w=y&&(o||m&&(b==null||b<12.11));var x=v||k&&C>=9;function S(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}var L=function(e,t){var r=e.className;var n=S(t).exec(r);if(n){var i=r.slice(n.index+n[0].length);e.className=r.slice(0,n.index)+(i?n[1]+i:"")}};function A(e){for(var t=e.childNodes.length;t>0;--t){e.removeChild(e.firstChild)}return e}function M(e,t){return A(e).appendChild(t)}function T(e,t,r,n){var i=document.createElement(e);if(r){i.className=r}if(n){i.style.cssText=n}if(typeof t=="string"){i.appendChild(document.createTextNode(t))}else if(t){for(var o=0;o<t.length;++o){i.appendChild(t[o])}}return i}function O(e,t,r,n){var i=T(e,t,r,n);i.setAttribute("role","presentation");return i}var E;if(document.createRange){E=function(e,t,r,n){var i=document.createRange();i.setEnd(n||e,r);i.setStart(e,t);return i}}else{E=function(e,t,r){var n=document.body.createTextRange();try{n.moveToElementText(e.parentNode)}catch(e){return n}n.collapse(true);n.moveEnd("character",r);n.moveStart("character",t);return n}}function N(e,t){if(t.nodeType==3){t=t.parentNode}if(e.contains){return e.contains(t)}do{if(t.nodeType==11){t=t.host}if(t==e){return true}}while(t=t.parentNode)}function I(){var t;try{t=document.activeElement}catch(e){t=document.body||null}while(t&&t.shadowRoot&&t.shadowRoot.activeElement){t=t.shadowRoot.activeElement}return t}function P(e,t){var r=e.className;if(!S(t).test(r)){e.className+=(r?" ":"")+t}}function R(e,t){var r=e.split(" ");for(var n=0;n<r.length;n++){if(r[n]&&!S(r[n]).test(t)){t+=" "+r[n]}}return t}var B=function(e){e.select()};if(c){B=function(e){e.selectionStart=0;e.selectionEnd=e.value.length}}else if(k){B=function(e){try{e.select()}catch(e){}}}function D(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function H(e,t,r){if(!t){t={}}for(var n in e){if(e.hasOwnProperty(n)&&(r!==false||!t.hasOwnProperty(n))){t[n]=e[n]}}return t}function _(e,t,r,n,i){if(t==null){t=e.search(/[^\s\u00a0]/);if(t==-1){t=e.length}}for(var o=n||0,a=i||0;;){var s=e.indexOf("\t",o);if(s<0||s>=t){return a+(t-o)}a+=s-o;a+=r-a%r;o=s+1}}var W=function(){this.id=null};W.prototype.set=function(e,t){clearTimeout(this.id);this.id=setTimeout(t,e)};function F(e,t){for(var r=0;r<e.length;++r){if(e[r]==t){return r}}return-1}var z=30;var j={toString:function(){return"CodeMirror.Pass"}};var K={scroll:false};var U={origin:"*mouse"};var V={origin:"+move"};function G(e,t,r){for(var n=0,i=0;;){var o=e.indexOf("\t",n);if(o==-1){o=e.length}var a=o-n;if(o==e.length||i+a>=t){return n+Math.min(a,t-i)}i+=o-n;i+=r-i%r;n=o+1;if(i>=t){return n}}}var q=[""];function Y(e){while(q.length<=e){q.push(X(q)+" ")}return q[e]}function X(e){return e[e.length-1]}function J(e,t){var r=[];for(var n=0;n<e.length;n++){r[n]=t(e[n],n)}return r}function Z(e,t,r){var n=0,i=r(t);while(n<e.length&&r(e[n])<=i){n++}e.splice(n,0,t)}function $(){}function Q(e,t){var r;if(Object.create){r=Object.create(e)}else{$.prototype=e;r=new $}if(t){H(t,r)}return r}var ee=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function te(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||ee.test(e))}function re(e,t){if(!t){return te(e)}if(t.source.indexOf("\\w")>-1&&te(e)){return true}return t.test(e)}function ne(e){for(var t in e){if(e.hasOwnProperty(t)&&e[t]){return false}}return true}var ie=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function oe(e){return e.charCodeAt(0)>=768&&ie.test(e)}function ae(e,t,r){while((r<0?t>0:t<e.length)&&oe(e.charAt(t))){t+=r}return t}function se(e,t,r){for(;;){if(Math.abs(t-r)<=1){return e(t)?t:r}var n=Math.floor((t+r)/2);if(e(n)){r=n}else{t=n}}}function le(e,t,r){var n=this;this.input=r;n.scrollbarFiller=T("div",null,"CodeMirror-scrollbar-filler");n.scrollbarFiller.setAttribute("cm-not-content","true");n.gutterFiller=T("div",null,"CodeMirror-gutter-filler");n.gutterFiller.setAttribute("cm-not-content","true");n.lineDiv=O("div",null,"CodeMirror-code");n.selectionDiv=T("div",null,null,"position: relative; z-index: 1");n.cursorDiv=T("div",null,"CodeMirror-cursors");n.measure=T("div",null,"CodeMirror-measure");n.lineMeasure=T("div",null,"CodeMirror-measure");n.lineSpace=O("div",[n.measure,n.lineMeasure,n.selectionDiv,n.cursorDiv,n.lineDiv],null,"position: relative; outline: none");var i=O("div",[n.lineSpace],"CodeMirror-lines");n.mover=T("div",[i],null,"position: relative");n.sizer=T("div",[n.mover],"CodeMirror-sizer");n.sizerWidth=null;n.heightForcer=T("div",null,null,"position: absolute; height: "+z+"px; width: 1px;");n.gutters=T("div",null,"CodeMirror-gutters");n.lineGutter=null;n.scroller=T("div",[n.sizer,n.heightForcer,n.gutters],"CodeMirror-scroll");n.scroller.setAttribute("tabIndex","-1");n.wrapper=T("div",[n.scrollbarFiller,n.gutterFiller,n.scroller],"CodeMirror");if(k&&C<8){n.gutters.style.zIndex=-1;n.scroller.style.paddingRight=0}if(!g&&!(v&&h)){n.scroller.draggable=true}if(e){if(e.appendChild){e.appendChild(n.wrapper)}else{e(n.wrapper)}}n.viewFrom=n.viewTo=t.first;n.reportedViewFrom=n.reportedViewTo=t.first;n.view=[];n.renderedView=null;n.externalMeasured=null;n.viewOffset=0;n.lastWrapHeight=n.lastWrapWidth=0;n.updateLineNumbers=null;n.nativeBarWidth=n.barHeight=n.barWidth=0;n.scrollbarsClipped=false;n.lineNumWidth=n.lineNumInnerWidth=n.lineNumChars=null;n.alignWidgets=false;n.cachedCharWidth=n.cachedTextHeight=n.cachedPaddingH=null;n.maxLine=null;n.maxLineLength=0;n.maxLineChanged=false;n.wheelDX=n.wheelDY=n.wheelStartX=n.wheelStartY=null;n.shift=false;n.selForContextMenu=null;n.activeTouch=null;r.init(n)}function ue(e,t){t-=e.first;if(t<0||t>=e.size){throw new Error("There is no line "+(t+e.first)+" in the document.")}var r=e;while(!r.lines){for(var n=0;;++n){var i=r.children[n],o=i.chunkSize();if(t<o){r=i;break}t-=o}}return r.lines[t]}function ce(e,r,n){var i=[],o=r.line;e.iter(r.line,n.line+1,function(e){var t=e.text;if(o==n.line){t=t.slice(0,n.ch)}if(o==r.line){t=t.slice(r.ch)}i.push(t);++o});return i}function fe(e,t,r){var n=[];e.iter(t,r,function(e){n.push(e.text)});return n}function he(e,t){var r=t-e.height;if(r){for(var n=e;n;n=n.parent){n.height+=r}}}function de(e){if(e.parent==null){return null}var t=e.parent,r=F(t.lines,e);for(var n=t.parent;n;t=n,n=n.parent){for(var i=0;;++i){if(n.children[i]==t){break}r+=n.children[i].chunkSize()}}return r+t.first}function pe(e,t){var r=e.first;e:do{for(var n=0;n<e.children.length;++n){var i=e.children[n],o=i.height;if(t<o){e=i;continue e}t-=o;r+=i.chunkSize()}return r}while(!e.lines);var a=0;for(;a<e.lines.length;++a){var s=e.lines[a],l=s.height;if(t<l){break}t-=l}return r+a}function ve(e,t){return t>=e.first&&t<e.first+e.size}function ge(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function me(e,t,r){if(r===void 0)r=null;if(!(this instanceof me)){return new me(e,t,r)}this.line=e;this.ch=t;this.sticky=r}function ye(e,t){return e.line-t.line||e.ch-t.ch}function be(e,t){return e.sticky==t.sticky&&ye(e,t)==0}function we(e){return me(e.line,e.ch)}function ke(e,t){return ye(e,t)<0?t:e}function Ce(e,t){return ye(e,t)<0?e:t}function xe(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function Se(e,t){if(t.line<e.first){return me(e.first,0)}var r=e.first+e.size-1;if(t.line>r){return me(r,ue(e,r).text.length)}return Le(t,ue(e,t.line).text.length)}function Le(e,t){var r=e.ch;if(r==null||r>t){return me(e.line,t)}else if(r<0){return me(e.line,0)}else{return e}}function Ae(e,t){var r=[];for(var n=0;n<t.length;n++){r[n]=Se(e,t[n])}return r}var Me=false;var Te=false;function Oe(){Me=true}function Ee(){Te=true}function Ne(e,t,r){this.marker=e;this.from=t;this.to=r}function Ie(e,t){if(e){for(var r=0;r<e.length;++r){var n=e[r];if(n.marker==t){return n}}}}function Pe(e,t){var r;for(var n=0;n<e.length;++n){if(e[n]!=t){(r||(r=[])).push(e[n])}}return r}function Re(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t];t.marker.attachLine(e)}function Be(e,t,r){var n;if(e){for(var i=0;i<e.length;++i){var o=e[i],a=o.marker;var s=o.from==null||(a.inclusiveLeft?o.from<=t:o.from<t);if(s||o.from==t&&a.type=="bookmark"&&(!r||!o.marker.insertLeft)){var l=o.to==null||(a.inclusiveRight?o.to>=t:o.to>t);(n||(n=[])).push(new Ne(a,o.from,l?null:o.to))}}}return n}function De(e,t,r){var n;if(e){for(var i=0;i<e.length;++i){var o=e[i],a=o.marker;var s=o.to==null||(a.inclusiveRight?o.to>=t:o.to>t);if(s||o.from==t&&a.type=="bookmark"&&(!r||o.marker.insertLeft)){var l=o.from==null||(a.inclusiveLeft?o.from<=t:o.from<t);(n||(n=[])).push(new Ne(a,l?null:o.from-t,o.to==null?null:o.to-t))}}}return n}function He(e,t){if(t.full){return null}var r=ve(e,t.from.line)&&ue(e,t.from.line).markedSpans;var n=ve(e,t.to.line)&&ue(e,t.to.line).markedSpans;if(!r&&!n){return null}var i=t.from.ch,o=t.to.ch,a=ye(t.from,t.to)==0;var s=Be(r,i,a);var l=De(n,o,a);var u=t.text.length==1,c=X(t.text).length+(u?i:0);if(s){for(var f=0;f<s.length;++f){var h=s[f];if(h.to==null){var d=Ie(l,h.marker);if(!d){h.to=i}else if(u){h.to=d.to==null?null:d.to+c}}}}if(l){for(var p=0;p<l.length;++p){var v=l[p];if(v.to!=null){v.to+=c}if(v.from==null){var g=Ie(s,v.marker);if(!g){v.from=c;if(u){(s||(s=[])).push(v)}}}else{v.from+=c;if(u){(s||(s=[])).push(v)}}}}if(s){s=_e(s)}if(l&&l!=s){l=_e(l)}var m=[s];if(!u){var y=t.text.length-2,b;if(y>0&&s){for(var w=0;w<s.length;++w){if(s[w].to==null){(b||(b=[])).push(new Ne(s[w].marker,null,null))}}}for(var k=0;k<y;++k){m.push(b)}m.push(l)}return m}function _e(e){for(var t=0;t<e.length;++t){var r=e[t];if(r.from!=null&&r.from==r.to&&r.marker.clearWhenEmpty!==false){e.splice(t--,1)}}if(!e.length){return null}return e}function We(e,t,r){var n=null;e.iter(t.line,r.line+1,function(e){if(e.markedSpans){for(var t=0;t<e.markedSpans.length;++t){var r=e.markedSpans[t].marker;if(r.readOnly&&(!n||F(n,r)==-1)){(n||(n=[])).push(r)}}}});if(!n){return null}var i=[{from:t,to:r}];for(var o=0;o<n.length;++o){var a=n[o],s=a.find(0);for(var l=0;l<i.length;++l){var u=i[l];if(ye(u.to,s.from)<0||ye(u.from,s.to)>0){continue}var c=[l,1],f=ye(u.from,s.from),h=ye(u.to,s.to);if(f<0||!a.inclusiveLeft&&!f){c.push({from:u.from,to:s.from})}if(h>0||!a.inclusiveRight&&!h){c.push({from:s.to,to:u.to})}i.splice.apply(i,c);l+=c.length-3}}return i}function Fe(e){var t=e.markedSpans;if(!t){return}for(var r=0;r<t.length;++r){t[r].marker.detachLine(e)}e.markedSpans=null}function ze(e,t){if(!t){return}for(var r=0;r<t.length;++r){t[r].marker.attachLine(e)}e.markedSpans=t}function je(e){return e.inclusiveLeft?-1:0}function Ke(e){return e.inclusiveRight?1:0}function Ue(e,t){var r=e.lines.length-t.lines.length;if(r!=0){return r}var n=e.find(),i=t.find();var o=ye(n.from,i.from)||je(e)-je(t);if(o){return-o}var a=ye(n.to,i.to)||Ke(e)-Ke(t);if(a){return a}return t.id-e.id}function Ve(e,t){var r=Te&&e.markedSpans,n;if(r){for(var i=void 0,o=0;o<r.length;++o){i=r[o];if(i.marker.collapsed&&(t?i.from:i.to)==null&&(!n||Ue(n,i.marker)<0)){n=i.marker}}}return n}function Ge(e){return Ve(e,true)}function qe(e){return Ve(e,false)}function Ye(e,t,r,n,i){var o=ue(e,t);var a=Te&&o.markedSpans;if(a){for(var s=0;s<a.length;++s){var l=a[s];if(!l.marker.collapsed){continue}var u=l.marker.find(0);var c=ye(u.from,r)||je(l.marker)-je(i);var f=ye(u.to,n)||Ke(l.marker)-Ke(i);if(c>=0&&f<=0||c<=0&&f>=0){continue}if(c<=0&&(l.marker.inclusiveRight&&i.inclusiveLeft?ye(u.to,r)>=0:ye(u.to,r)>0)||c>=0&&(l.marker.inclusiveRight&&i.inclusiveLeft?ye(u.from,n)<=0:ye(u.from,n)<0)){return true}}}}function Xe(e){var t;while(t=Ge(e)){e=t.find(-1,true).line}return e}function Je(e){var t;while(t=qe(e)){e=t.find(1,true).line}return e}function Ze(e){var t,r;while(t=qe(e)){e=t.find(1,true).line;(r||(r=[])).push(e)}return r}function $e(e,t){var r=ue(e,t),n=Xe(r);if(r==n){return t}return de(n)}function Qe(e,t){if(t>e.lastLine()){return t}var r=ue(e,t),n;if(!et(e,r)){return t}while(n=qe(r)){r=n.find(1,true).line}return de(r)+1}function et(e,t){var r=Te&&t.markedSpans;if(r){for(var n=void 0,i=0;i<r.length;++i){n=r[i];if(!n.marker.collapsed){continue}if(n.from==null){return true}if(n.marker.widgetNode){continue}if(n.from==0&&n.marker.inclusiveLeft&&tt(e,t,n)){return true}}}}function tt(e,t,r){if(r.to==null){var n=r.marker.find(1,true);return tt(e,n.line,Ie(n.line.markedSpans,r.marker))}if(r.marker.inclusiveRight&&r.to==t.text.length){return true}for(var i=void 0,o=0;o<t.markedSpans.length;++o){i=t.markedSpans[o];if(i.marker.collapsed&&!i.marker.widgetNode&&i.from==r.to&&(i.to==null||i.to!=r.from)&&(i.marker.inclusiveLeft||r.marker.inclusiveRight)&&tt(e,t,i)){return true}}}function rt(e){e=Xe(e);var t=0,r=e.parent;for(var n=0;n<r.lines.length;++n){var i=r.lines[n];if(i==e){break}else{t+=i.height}}for(var o=r.parent;o;r=o,o=r.parent){for(var a=0;a<o.children.length;++a){var s=o.children[a];if(s==r){break}else{t+=s.height}}}return t}function nt(e){if(e.height==0){return 0}var t=e.text.length,r,n=e;while(r=Ge(n)){var i=r.find(0,true);n=i.from.line;t+=i.from.ch-i.to.ch}n=e;while(r=qe(n)){var o=r.find(0,true);t-=n.text.length-o.from.ch;n=o.to.line;t+=n.text.length-o.to.ch}return t}function it(e){var r=e.display,t=e.doc;r.maxLine=ue(t,t.first);r.maxLineLength=nt(r.maxLine);r.maxLineChanged=true;t.iter(function(e){var t=nt(e);if(t>r.maxLineLength){r.maxLineLength=t;r.maxLine=e}})}function ot(e,t,r,n){if(!e){return n(t,r,"ltr")}var i=false;for(var o=0;o<e.length;++o){var a=e[o];if(a.from<r&&a.to>t||t==r&&a.to==t){n(Math.max(a.from,t),Math.min(a.to,r),a.level==1?"rtl":"ltr");i=true}}if(!i){n(t,r,"ltr")}}var at=null;function st(e,t,r){var n;at=null;for(var i=0;i<e.length;++i){var o=e[i];if(o.from<t&&o.to>t){return i}if(o.to==t){if(o.from!=o.to&&r=="before"){n=i}else{at=i}}if(o.from==t){if(o.from!=o.to&&r!="before"){n=i}else{at=i}}}return n!=null?n:at}var lt=function(){var t="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN";var r="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function H(e){if(e<=247){return t.charAt(e)}else if(1424<=e&&e<=1524){return"R"}else if(1536<=e&&e<=1785){return r.charAt(e-1536)}else if(1774<=e&&e<=2220){return"r"}else if(8192<=e&&e<=8203){return"w"}else if(e==8204){return"b"}else{return"L"}}var _=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;var W=/[stwN]/,F=/[LRr]/,z=/[Lb1n]/,j=/[1n]/;function K(e,t,r){this.level=e;this.from=t;this.to=r}return function(e,t){var r=t=="ltr"?"L":"R";if(e.length==0||t=="ltr"&&!_.test(e)){return false}var n=e.length,i=[];for(var o=0;o<n;++o){i.push(H(e.charCodeAt(o)))}for(var a=0,s=r;a<n;++a){var l=i[a];if(l=="m"){i[a]=s}else{s=l}}for(var u=0,c=r;u<n;++u){var f=i[u];if(f=="1"&&c=="r"){i[u]="n"}else if(F.test(f)){c=f;if(f=="r"){i[u]="R"}}}for(var h=1,d=i[0];h<n-1;++h){var p=i[h];if(p=="+"&&d=="1"&&i[h+1]=="1"){i[h]="1"}else if(p==","&&d==i[h+1]&&(d=="1"||d=="n")){i[h]=d}d=p}for(var v=0;v<n;++v){var g=i[v];if(g==","){i[v]="N"}else if(g=="%"){var m=void 0;for(m=v+1;m<n&&i[m]=="%";++m){}var y=v&&i[v-1]=="!"||m<n&&i[m]=="1"?"1":"N";for(var b=v;b<m;++b){i[b]=y}v=m-1}}for(var w=0,k=r;w<n;++w){var C=i[w];if(k=="L"&&C=="1"){i[w]="L"}else if(F.test(C)){k=C}}for(var x=0;x<n;++x){if(W.test(i[x])){var S=void 0;for(S=x+1;S<n&&W.test(i[S]);++S){}var L=(x?i[x-1]:r)=="L";var A=(S<n?i[S]:r)=="L";var M=L==A?L?"L":"R":r;for(var T=x;T<S;++T){i[T]=M}x=S-1}}var O=[],E;for(var N=0;N<n;){if(z.test(i[N])){var I=N;for(++N;N<n&&z.test(i[N]);++N){}O.push(new K(0,I,N))}else{var P=N,R=O.length;for(++N;N<n&&i[N]!="L";++N){}for(var B=P;B<N;){if(j.test(i[B])){if(P<B){O.splice(R,0,new K(1,P,B))}var D=B;for(++B;B<N&&j.test(i[B]);++B){}O.splice(R,0,new K(2,D,B));P=B}else{++B}}if(P<N){O.splice(R,0,new K(1,P,N))}}}if(O[0].level==1&&(E=e.match(/^\s+/))){O[0].from=E[0].length;O.unshift(new K(0,0,E[0].length))}if(X(O).level==1&&(E=e.match(/\s+$/))){X(O).to-=E[0].length;O.push(new K(0,n-E[0].length,n))}return t=="rtl"?O.reverse():O}}();function ut(e,t){var r=e.order;if(r==null){r=e.order=lt(e.text,t)}return r}function ct(e,t,r){var n=ae(e.text,t+r,r);return n<0||n>e.text.length?null:n}function ft(e,t,r){var n=ct(e,t.ch,r);return n==null?null:new me(t.line,n,r<0?"after":"before")}function ht(e,t,r,n,i){if(e){var o=ut(r,t.doc.direction);if(o){var a=i<0?X(o):o[0];var s=i<0==(a.level==1);var l=s?"after":"before";var u;if(a.level>0){var c=on(t,r);u=i<0?r.text.length-1:0;var f=an(t,c,u).top;u=se(function(e){return an(t,c,e).top==f},i<0==(a.level==1)?a.from:a.to-1,u);if(l=="before"){u=ct(r,u,1)}}else{u=i<0?a.to:a.from}return new me(n,u,l)}}return new me(n,i<0?r.text.length:0,i<0?"before":"after")}function dt(t,r,s,e){var l=ut(r,t.doc.direction);if(!l){return ft(r,s,e)}if(s.ch>=r.text.length){s.ch=r.text.length;s.sticky="before"}else if(s.ch<=0){s.ch=0;s.sticky="after"}var n=st(l,s.ch,s.sticky),i=l[n];if(t.doc.direction=="ltr"&&i.level%2==0&&(e>0?i.to>s.ch:i.from<s.ch)){return ft(r,s,e)}var u=function(e,t){return ct(r,e instanceof me?e.ch:e,t)};var o;var a=function(e){if(!t.options.lineWrapping){return{begin:0,end:r.text.length}}o=o||on(t,r);return Ln(t,r,o,e)};var c=a(s.sticky=="before"?u(s,-1):s.ch);if(t.doc.direction=="rtl"||i.level==1){var f=i.level==1==e<0;var h=u(s,f?1:-1);if(h!=null&&(!f?h>=i.from&&h>=c.begin:h<=i.to&&h<=c.end)){var d=f?"before":"after";return new me(s.line,h,d)}}var p=function(e,t,r){var n=function(e,t){return t?new me(s.line,u(e,1),"before"):new me(s.line,e,"after")};for(;e>=0&&e<l.length;e+=t){var i=l[e];var o=t>0==(i.level!=1);var a=o?r.begin:u(r.end,-1);if(i.from<=a&&a<i.to){return n(a,o)}a=o?i.from:u(i.to,-1);if(r.begin<=a&&a<r.end){return n(a,o)}}};var v=p(n+e,e,c);if(v){return v}var g=e>0?c.end:u(c.begin,-1);if(g!=null&&!(e>0&&g==r.text.length)){v=p(e>0?0:l.length-1,e,a(g));if(v){return v}}return null}var pt=[];var vt=function(e,t,r){if(e.addEventListener){e.addEventListener(t,r,false)}else if(e.attachEvent){e.attachEvent("on"+t,r)}else{var n=e._handlers||(e._handlers={});n[t]=(n[t]||pt).concat(r)}};function gt(e,t){return e._handlers&&e._handlers[t]||pt}function mt(e,t,r){if(e.removeEventListener){e.removeEventListener(t,r,false)}else if(e.detachEvent){e.detachEvent("on"+t,r)}else{var n=e._handlers,i=n&&n[t];if(i){var o=F(i,r);if(o>-1){n[t]=i.slice(0,o).concat(i.slice(o+1))}}}}function yt(e,t){var r=gt(e,t);if(!r.length){return}var n=Array.prototype.slice.call(arguments,2);for(var i=0;i<r.length;++i){r[i].apply(null,n)}}function bt(e,t,r){if(typeof t=="string"){t={type:t,preventDefault:function(){this.defaultPrevented=true}}}yt(e,r||t.type,e,t);return Lt(t)||t.codemirrorIgnore}function wt(e){var t=e._handlers&&e._handlers.cursorActivity;if(!t){return}var r=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]);for(var n=0;n<t.length;++n){if(F(r,t[n])==-1){r.push(t[n])}}}function kt(e,t){return gt(e,t).length>0}function Ct(e){e.prototype.on=function(e,t){vt(this,e,t)};e.prototype.off=function(e,t){mt(this,e,t)}}function xt(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}function St(e){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}}function Lt(e){return e.defaultPrevented!=null?e.defaultPrevented:e.returnValue==false}function At(e){xt(e);St(e)}function Mt(e){return e.target||e.srcElement}function Tt(e){var t=e.which;if(t==null){if(e.button&1){t=1}else if(e.button&2){t=3}else if(e.button&4){t=2}}if(y&&e.ctrlKey&&t==1){t=3}return t}var Ot=function(){if(k&&C<9){return false}var e=T("div");return"draggable"in e||"dragDrop"in e}();var Et;function Nt(e){if(Et==null){var t=T("span","​");M(e,T("span",[t,document.createTextNode("x")]));if(e.firstChild.offsetHeight!=0){Et=t.offsetWidth<=1&&t.offsetHeight>2&&!(k&&C<8)}}var r=Et?T("span","​"):T("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");r.setAttribute("cm-text","");return r}var It;function Pt(e){if(It!=null){return It}var t=M(e,document.createTextNode("AخA"));var r=E(t,0,1).getBoundingClientRect();var n=E(t,1,2).getBoundingClientRect();A(e);if(!r||r.left==r.right){return false}return It=n.right-r.right<3}var Rt="\n\nb".split(/\n/).length!=3?function(e){var t=0,r=[],n=e.length;while(t<=n){var i=e.indexOf("\n",t);if(i==-1){i=e.length}var o=e.slice(t,e.charAt(i-1)=="\r"?i-1:i);var a=o.indexOf("\r");if(a!=-1){r.push(o.slice(0,a));t+=a+1}else{r.push(o);t=i+1}}return r}:function(e){return e.split(/\r\n?|\n/)};var Bt=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(e){return false}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(e){}if(!t||t.parentElement()!=e){return false}return t.compareEndPoints("StartToEnd",t)!=0};var Dt=function(){var e=T("div");if("oncopy"in e){return true}e.setAttribute("oncopy","return;");return typeof e.oncopy=="function"}();var Ht=null;function _t(e){if(Ht!=null){return Ht}var t=M(e,T("span","x"));var r=t.getBoundingClientRect();var n=E(t,0,1).getBoundingClientRect();return Ht=Math.abs(r.left-n.left)>1}var Wt={};var Ft={};function zt(e,t){if(arguments.length>2){t.dependencies=Array.prototype.slice.call(arguments,2)}Wt[e]=t}function jt(e,t){Ft[e]=t}function Kt(e){if(typeof e=="string"&&Ft.hasOwnProperty(e)){e=Ft[e]}else if(e&&typeof e.name=="string"&&Ft.hasOwnProperty(e.name)){var t=Ft[e.name];if(typeof t=="string"){t={name:t}}e=Q(t,e);e.name=t.name}else if(typeof e=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e)){return Kt("application/xml")}else if(typeof e=="string"&&/^[\w\-]+\/[\w\-]+\+json$/.test(e)){return Kt("application/json")}if(typeof e=="string"){return{name:e}}else{return e||{name:"null"}}}function Ut(e,t){t=Kt(t);var r=Wt[t.name];if(!r){return Ut(e,"text/plain")}var n=r(e,t);if(Vt.hasOwnProperty(t.name)){var i=Vt[t.name];for(var o in i){if(!i.hasOwnProperty(o)){continue}if(n.hasOwnProperty(o)){n["_"+o]=n[o]}n[o]=i[o]}}n.name=t.name;if(t.helperType){n.helperType=t.helperType}if(t.modeProps){for(var a in t.modeProps){n[a]=t.modeProps[a]}}return n}var Vt={};function Gt(e,t){var r=Vt.hasOwnProperty(e)?Vt[e]:Vt[e]={};H(t,r)}function qt(e,t){if(t===true){return t}if(e.copyState){return e.copyState(t)}var r={};for(var n in t){var i=t[n];if(i instanceof Array){i=i.concat([])}r[n]=i}return r}function Yt(e,t){var r;while(e.innerMode){r=e.innerMode(t);if(!r||r.mode==e){break}t=r.state;e=r.mode}return r||{mode:e,state:t}}function Xt(e,t,r){return e.startState?e.startState(t,r):true}var Jt=function(e,t,r){this.pos=this.start=0;this.string=e;this.tabSize=t||8;this.lastColumnPos=this.lastColumnValue=0;this.lineStart=0;this.lineOracle=r};Jt.prototype.eol=function(){return this.pos>=this.string.length};Jt.prototype.sol=function(){return this.pos==this.lineStart};Jt.prototype.peek=function(){return this.string.charAt(this.pos)||undefined};Jt.prototype.next=function(){if(this.pos<this.string.length){return this.string.charAt(this.pos++)}};Jt.prototype.eat=function(e){var t=this.string.charAt(this.pos);var r;if(typeof e=="string"){r=t==e}else{r=t&&(e.test?e.test(t):e(t))}if(r){++this.pos;return t}};Jt.prototype.eatWhile=function(e){var t=this.pos;while(this.eat(e)){}return this.pos>t};Jt.prototype.eatSpace=function(){var e=this;var t=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos))){++e.pos}return this.pos>t};Jt.prototype.skipToEnd=function(){this.pos=this.string.length};Jt.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1){this.pos=t;return true}};Jt.prototype.backUp=function(e){this.pos-=e};Jt.prototype.column=function(){if(this.lastColumnPos<this.start){this.lastColumnValue=_(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue);this.lastColumnPos=this.start}return this.lastColumnValue-(this.lineStart?_(this.string,this.lineStart,this.tabSize):0)};Jt.prototype.indentation=function(){return _(this.string,null,this.tabSize)-(this.lineStart?_(this.string,this.lineStart,this.tabSize):0)};Jt.prototype.match=function(e,t,r){if(typeof e=="string"){var n=function(e){return r?e.toLowerCase():e};var i=this.string.substr(this.pos,e.length);if(n(i)==n(e)){if(t!==false){this.pos+=e.length}return true}}else{var o=this.string.slice(this.pos).match(e);if(o&&o.index>0){return null}if(o&&t!==false){this.pos+=o[0].length}return o}};Jt.prototype.current=function(){return this.string.slice(this.start,this.pos)};Jt.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}};Jt.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)};var Zt=function(e,t){this.state=e;this.lookAhead=t};var $t=function(e,t,r,n){this.state=t;this.doc=e;this.line=r;this.maxLookAhead=n||0};$t.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);if(t!=null&&e>this.maxLookAhead){this.maxLookAhead=e}return t};$t.prototype.nextLine=function(){this.line++;if(this.maxLookAhead>0){this.maxLookAhead--}};$t.fromSaved=function(e,t,r){if(t instanceof Zt){return new $t(e,qt(e.mode,t.state),r,t.lookAhead)}else{return new $t(e,qt(e.mode,t),r)}};$t.prototype.save=function(e){var t=e!==false?qt(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new Zt(t,this.maxLookAhead):t};function Qt(t,r,n,e){var l=[t.state.modeGen],i={};lr(t,r.text,t.doc.mode,n,function(e,t){return l.push(e,t)},i,e);var o=n.state;var a=function(e){var o=t.state.overlays[e],a=1,s=0;n.state=true;lr(t,r.text,o.mode,n,function(e,t){var r=a;while(s<e){var n=l[a];if(n>e){l.splice(a,1,e,l[a+1],n)}a+=2;s=Math.min(e,n)}if(!t){return}if(o.opaque){l.splice(r,a-r,e,"overlay "+t);a=r+2}else{for(;r<a;r+=2){var i=l[r+1];l[r+1]=(i?i+" ":"")+"overlay "+t}}},i)};for(var s=0;s<t.state.overlays.length;++s)a(s);n.state=o;return{styles:l,classes:i.bgClass||i.textClass?i:null}}function er(e,t,r){if(!t.styles||t.styles[0]!=e.state.modeGen){var n=tr(e,de(t));var i=t.text.length>e.options.maxHighlightLength&&qt(e.doc.mode,n.state);var o=Qt(e,t,n);if(i){n.state=i}t.stateAfter=n.save(!i);t.styles=o.styles;if(o.classes){t.styleClasses=o.classes}else if(t.styleClasses){t.styleClasses=null}if(r===e.doc.highlightFrontier){e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier)}}return t.styles}function tr(r,n,e){var t=r.doc,i=r.display;if(!t.mode.startState){return new $t(t,true,n)}var o=ur(r,n,e);var a=o>t.first&&ue(t,o-1).stateAfter;var s=a?$t.fromSaved(t,a,o):new $t(t,Xt(t.mode),o);t.iter(o,n,function(e){rr(r,e.text,s);var t=s.line;e.stateAfter=t==n-1||t%5==0||t>=i.viewFrom&&t<i.viewTo?s.save():null;s.nextLine()});if(e){t.modeFrontier=s.line}return s}function rr(e,t,r,n){var i=e.doc.mode;var o=new Jt(t,e.options.tabSize,r);o.start=o.pos=n||0;if(t==""){nr(i,r.state)}while(!o.eol()){ir(i,o,r.state);o.start=o.pos}}function nr(e,t){if(e.blankLine){return e.blankLine(t)}if(!e.innerMode){return}var r=Yt(e,t);if(r.mode.blankLine){return r.mode.blankLine(r.state)}}function ir(e,t,r,n){for(var i=0;i<10;i++){if(n){n[0]=Yt(e,r).mode}var o=e.token(t,r);if(t.pos>t.start){return o}}throw new Error("Mode "+e.name+" failed to advance stream.")}var or=function(e,t,r){this.start=e.start;this.end=e.pos;this.string=e.current();this.type=t||null;this.state=r};function ar(e,t,r,n){var i=e.doc,o=i.mode,a;t=Se(i,t);var s=ue(i,t.line),l=tr(e,t.line,r);var u=new Jt(s.text,e.options.tabSize,l),c;if(n){c=[]}while((n||u.pos<t.ch)&&!u.eol()){u.start=u.pos;a=ir(o,u,l.state);if(n){c.push(new or(u,a,qt(i.mode,l.state)))}}return n?c:new or(u,a,l.state)}function sr(e,t){if(e){for(;;){var r=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!r){break}e=e.slice(0,r.index)+e.slice(r.index+r[0].length);var n=r[1]?"bgClass":"textClass";if(t[n]==null){t[n]=r[2]}else if(!new RegExp("(?:^|s)"+r[2]+"(?:$|s)").test(t[n])){t[n]+=" "+r[2]}}}return e}function lr(e,t,r,n,i,o,a){var s=r.flattenSpans;if(s==null){s=e.options.flattenSpans}var l=0,u=null;var c=new Jt(t,e.options.tabSize,n),f;var h=e.options.addModeClass&&[null];if(t==""){sr(nr(r,n.state),o)}while(!c.eol()){if(c.pos>e.options.maxHighlightLength){s=false;if(a){rr(e,t,n,c.pos)}c.pos=t.length;f=null}else{f=sr(ir(r,c,n.state,h),o)}if(h){var d=h[0].name;if(d){f="m-"+(f?d+" "+f:d)}}if(!s||u!=f){while(l<c.start){l=Math.min(c.start,l+5e3);i(l,u)}u=f}c.start=c.pos}while(l<c.pos){var p=Math.min(c.pos,l+5e3);i(p,u);l=p}}function ur(e,t,r){var n,i,o=e.doc;var a=r?-1:t-(e.doc.mode.innerMode?1e3:100);for(var s=t;s>a;--s){if(s<=o.first){return o.first}var l=ue(o,s-1),u=l.stateAfter;if(u&&(!r||s+(u instanceof Zt?u.lookAhead:0)<=o.modeFrontier)){return s}var c=_(l.text,null,e.options.tabSize);if(i==null||n>c){i=s-1;n=c}}return i}function cr(e,t){e.modeFrontier=Math.min(e.modeFrontier,t);if(e.highlightFrontier<t-10){return}var r=e.first;for(var n=t-1;n>r;n--){var i=ue(e,n).stateAfter;if(i&&(!(i instanceof Zt)||n+i.lookAhead<t)){r=n+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,r)}var fr=function(e,t,r){this.text=e;ze(this,t);this.height=r?r(this):1};fr.prototype.lineNo=function(){return de(this)};Ct(fr);function hr(e,t,r,n){e.text=t;if(e.stateAfter){e.stateAfter=null}if(e.styles){e.styles=null}if(e.order!=null){e.order=null}Fe(e);ze(e,r);var i=n?n(e):1;if(i!=e.height){he(e,i)}}function dr(e){e.parent=null;Fe(e)}var pr={};var vr={};function gr(e,t){if(!e||/^\s*$/.test(e)){return null}var r=t.addModeClass?vr:pr;return r[e]||(r[e]=e.replace(/\S+/g,"cm-$&"))}function mr(e,t){var r=O("span",null,null,g?"padding-right: .1px":null);var n={pre:O("pre",[r],"CodeMirror-line"),content:r,col:0,pos:0,cm:e,trailingSpace:false,splitSpaces:(k||g)&&e.getOption("lineWrapping")};t.measure={};for(var i=0;i<=(t.rest?t.rest.length:0);i++){var o=i?t.rest[i-1]:t.line,a=void 0;n.pos=0;n.addToken=br;if(Pt(e.display.measure)&&(a=ut(o,e.doc.direction))){n.addToken=kr(n.addToken,a)}n.map=[];var s=t!=e.display.externalMeasured&&de(o);xr(o,n,er(e,o,s));if(o.styleClasses){if(o.styleClasses.bgClass){n.bgClass=R(o.styleClasses.bgClass,n.bgClass||"")}if(o.styleClasses.textClass){n.textClass=R(o.styleClasses.textClass,n.textClass||"")}}if(n.map.length==0){n.map.push(0,0,n.content.appendChild(Nt(e.display.measure)))}if(i==0){t.measure.map=n.map;t.measure.cache={}}else{(t.measure.maps||(t.measure.maps=[])).push(n.map);(t.measure.caches||(t.measure.caches=[])).push({})}}if(g){var l=n.content.lastChild;if(/\bcm-tab\b/.test(l.className)||l.querySelector&&l.querySelector(".cm-tab")){n.content.className="cm-tab-wrap-hack"}}yt(e,"renderLine",e,t.line,n.pre);if(n.pre.className){n.textClass=R(n.pre.className,n.textClass||"")}return n}function yr(e){var t=T("span","•","cm-invalidchar");t.title="\\u"+e.charCodeAt(0).toString(16);t.setAttribute("aria-label",t.title);return t}function br(e,t,r,n,i,o,a){if(!t){return}var s=e.splitSpaces?wr(t,e.trailingSpace):t;var l=e.cm.state.specialChars,u=false;var c;if(!l.test(t)){e.col+=t.length;c=document.createTextNode(s);e.map.push(e.pos,e.pos+t.length,c);if(k&&C<9){u=true}e.pos+=t.length}else{c=document.createDocumentFragment();var f=0;while(true){l.lastIndex=f;var h=l.exec(t);var d=h?h.index-f:t.length-f;if(d){var p=document.createTextNode(s.slice(f,f+d));if(k&&C<9){c.appendChild(T("span",[p]))}else{c.appendChild(p)}e.map.push(e.pos,e.pos+d,p);e.col+=d;e.pos+=d}if(!h){break}f+=d+1;var v=void 0;if(h[0]=="\t"){var g=e.cm.options.tabSize,m=g-e.col%g;v=c.appendChild(T("span",Y(m),"cm-tab"));v.setAttribute("role","presentation");v.setAttribute("cm-text","\t");e.col+=m}else if(h[0]=="\r"||h[0]=="\n"){v=c.appendChild(T("span",h[0]=="\r"?"␍":"␤","cm-invalidchar"));v.setAttribute("cm-text",h[0]);e.col+=1}else{v=e.cm.options.specialCharPlaceholder(h[0]);v.setAttribute("cm-text",h[0]);if(k&&C<9){c.appendChild(T("span",[v]))}else{c.appendChild(v)}e.col+=1}e.map.push(e.pos,e.pos+1,v);e.pos++}}e.trailingSpace=s.charCodeAt(t.length-1)==32;if(r||n||i||u||a){var y=r||"";if(n){y+=n}if(i){y+=i}var b=T("span",[c],y,a);if(o){b.title=o}return e.content.appendChild(b)}e.content.appendChild(c)}function wr(e,t){if(e.length>1&&!/  /.test(e)){return e}var r=t,n="";for(var i=0;i<e.length;i++){var o=e.charAt(i);if(o==" "&&r&&(i==e.length-1||e.charCodeAt(i+1)==32)){o=" "}n+=o;r=o==" "}return n}function kr(f,h){return function(e,t,r,n,i,o,a){r=r?r+" cm-force-border":"cm-force-border";var s=e.pos,l=s+t.length;for(;;){var u=void 0;for(var c=0;c<h.length;c++){u=h[c];if(u.to>s&&u.from<=s){break}}if(u.to>=l){return f(e,t,r,n,i,o,a)}f(e,t.slice(0,u.to-s),r,n,null,o,a);n=null;t=t.slice(u.to-s);s=u.to}}}function Cr(e,t,r,n){var i=!n&&r.widgetNode;if(i){e.map.push(e.pos,e.pos+t,i)}if(!n&&e.cm.display.input.needsContentAttribute){if(!i){i=e.content.appendChild(document.createElement("span"))}i.setAttribute("cm-marker",r.id)}if(i){e.cm.display.input.setUneditable(i);e.content.appendChild(i)}e.pos+=t;e.trailingSpace=false}function xr(e,t,r){var n=e.markedSpans,i=e.text,o=0;if(!n){for(var a=1;a<r.length;a+=2){t.addToken(t,i.slice(o,o=r[a]),gr(r[a+1],t.cm.options))}return}var s=i.length,l=0,u=1,c="",f,h;var d=0,p,v,g,m,y;for(;;){if(d==l){p=v=g=m=h="";y=null;d=Infinity;var b=[],w=void 0;for(var k=0;k<n.length;++k){var C=n[k],x=C.marker;if(x.type=="bookmark"&&C.from==l&&x.widgetNode){b.push(x)}else if(C.from<=l&&(C.to==null||C.to>l||x.collapsed&&C.to==l&&C.from==l)){if(C.to!=null&&C.to!=l&&d>C.to){d=C.to;v=""}if(x.className){p+=" "+x.className}if(x.css){h=(h?h+";":"")+x.css}if(x.startStyle&&C.from==l){g+=" "+x.startStyle}if(x.endStyle&&C.to==d){(w||(w=[])).push(x.endStyle,C.to)}if(x.title&&!m){m=x.title}if(x.collapsed&&(!y||Ue(y.marker,x)<0)){y=C}}else if(C.from>l&&d>C.from){d=C.from}}if(w){for(var S=0;S<w.length;S+=2){if(w[S+1]==d){v+=" "+w[S]}}}if(!y||y.from==l){for(var L=0;L<b.length;++L){Cr(t,0,b[L])}}if(y&&(y.from||0)==l){Cr(t,(y.to==null?s+1:y.to)-l,y.marker,y.from==null);if(y.to==null){return}if(y.to==l){y=false}}}if(l>=s){break}var A=Math.min(s,d);while(true){if(c){var M=l+c.length;if(!y){var T=M>A?c.slice(0,A-l):c;t.addToken(t,T,f?f+p:p,g,l+T.length==d?v:"",m,h)}if(M>=A){c=c.slice(A-l);l=A;break}l=M;g=""}c=i.slice(o,o=r[u++]);f=gr(r[u++],t.cm.options)}}}function Sr(e,t,r){this.line=t;this.rest=Ze(t);this.size=this.rest?de(X(this.rest))-r+1:1;this.node=this.text=null;this.hidden=et(e,t)}function Lr(e,t,r){var n=[],i;for(var o=t;o<r;o=i){var a=new Sr(e.doc,ue(e.doc,o),o);i=o+a.size;n.push(a)}return n}var Ar=null;function Mr(e){if(Ar){Ar.ops.push(e)}else{e.ownsGroup=Ar={ops:[e],delayedCallbacks:[]}}}function Tr(e){var t=e.delayedCallbacks,r=0;do{for(;r<t.length;r++){t[r].call(null)}for(var n=0;n<e.ops.length;n++){var i=e.ops[n];if(i.cursorActivityHandlers){while(i.cursorActivityCalled<i.cursorActivityHandlers.length){i.cursorActivityHandlers[i.cursorActivityCalled++].call(null,i.cm)}}}}while(r<t.length)}function Or(e,t){var r=e.ownsGroup;if(!r){return}try{Tr(r)}finally{Ar=null;t(r)}}var Er=null;function Nr(e,t){var r=gt(e,t);if(!r.length){return}var n=Array.prototype.slice.call(arguments,2),i;if(Ar){i=Ar.delayedCallbacks}else if(Er){i=Er}else{i=Er=[];setTimeout(Ir,0)}var o=function(e){i.push(function(){return r[e].apply(null,n)})};for(var a=0;a<r.length;++a)o(a)}function Ir(){var e=Er;Er=null;for(var t=0;t<e.length;++t){e[t]()}}function Pr(e,t,r,n){for(var i=0;i<t.changes.length;i++){var o=t.changes[i];if(o=="text"){Hr(e,t)}else if(o=="gutter"){Wr(e,t,r,n)}else if(o=="class"){_r(e,t)}else if(o=="widget"){Fr(e,t,n)}}t.changes=null}function Rr(e){if(e.node==e.text){e.node=T("div",null,null,"position: relative");if(e.text.parentNode){e.text.parentNode.replaceChild(e.node,e.text)}e.node.appendChild(e.text);if(k&&C<8){e.node.style.zIndex=2}}return e.node}function Br(e,t){var r=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(r){r+=" CodeMirror-linebackground"}if(t.background){if(r){t.background.className=r}else{t.background.parentNode.removeChild(t.background);t.background=null}}else if(r){var n=Rr(t);t.background=n.insertBefore(T("div",null,r),n.firstChild);e.display.input.setUneditable(t.background)}}function Dr(e,t){var r=e.display.externalMeasured;if(r&&r.line==t.line){e.display.externalMeasured=null;t.measure=r.measure;return r.built}return mr(e,t)}function Hr(e,t){var r=t.text.className;var n=Dr(e,t);if(t.text==t.node){t.node=n.pre}t.text.parentNode.replaceChild(n.pre,t.text);t.text=n.pre;if(n.bgClass!=t.bgClass||n.textClass!=t.textClass){t.bgClass=n.bgClass;t.textClass=n.textClass;_r(e,t)}else if(r){t.text.className=r}}function _r(e,t){Br(e,t);if(t.line.wrapClass){Rr(t).className=t.line.wrapClass}else if(t.node!=t.text){t.node.className=""}var r=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=r||""}function Wr(e,t,r,n){if(t.gutter){t.node.removeChild(t.gutter);t.gutter=null}if(t.gutterBackground){t.node.removeChild(t.gutterBackground);t.gutterBackground=null}if(t.line.gutterClass){var i=Rr(t);t.gutterBackground=T("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px; width: "+n.gutterTotalWidth+"px");e.display.input.setUneditable(t.gutterBackground);i.insertBefore(t.gutterBackground,t.text)}var o=t.line.gutterMarkers;if(e.options.lineNumbers||o){var a=Rr(t);var s=t.gutter=T("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px");e.display.input.setUneditable(s);a.insertBefore(s,t.text);if(t.line.gutterClass){s.className+=" "+t.line.gutterClass}if(e.options.lineNumbers&&(!o||!o["CodeMirror-linenumbers"])){t.lineNumber=s.appendChild(T("div",ge(e.options,r),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+n.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))}if(o){for(var l=0;l<e.options.gutters.length;++l){var u=e.options.gutters[l],c=o.hasOwnProperty(u)&&o[u];if(c){s.appendChild(T("div",[c],"CodeMirror-gutter-elt","left: "+n.gutterLeft[u]+"px; width: "+n.gutterWidth[u]+"px"))}}}}}function Fr(e,t,r){if(t.alignable){t.alignable=null}for(var n=t.node.firstChild,i=void 0;n;n=i){i=n.nextSibling;if(n.className=="CodeMirror-linewidget"){t.node.removeChild(n)}}jr(e,t,r)}function zr(e,t,r,n){var i=Dr(e,t);t.text=t.node=i.pre;if(i.bgClass){t.bgClass=i.bgClass}if(i.textClass){t.textClass=i.textClass}_r(e,t);Wr(e,t,r,n);jr(e,t,n);return t.node}function jr(e,t,r){Kr(e,t.line,t,r,true);if(t.rest){for(var n=0;n<t.rest.length;n++){Kr(e,t.rest[n],t,r,false)}}}function Kr(e,t,r,n,i){if(!t.widgets){return}var o=Rr(r);for(var a=0,s=t.widgets;a<s.length;++a){var l=s[a],u=T("div",[l.node],"CodeMirror-linewidget");if(!l.handleMouseEvents){u.setAttribute("cm-ignore-events","true")}Ur(l,u,r,n);e.display.input.setUneditable(u);if(i&&l.above){o.insertBefore(u,r.gutter||r.text)}else{o.appendChild(u)}Nr(l,"redraw")}}function Ur(e,t,r,n){if(e.noHScroll){(r.alignable||(r.alignable=[])).push(t);var i=n.wrapperWidth;t.style.left=n.fixedPos+"px";if(!e.coverGutter){i-=n.gutterTotalWidth;t.style.paddingLeft=n.gutterTotalWidth+"px"}t.style.width=i+"px"}if(e.coverGutter){t.style.zIndex=5;t.style.position="relative";if(!e.noHScroll){t.style.marginLeft=-n.gutterTotalWidth+"px"}}}function Vr(e){if(e.height!=null){return e.height}var t=e.doc.cm;if(!t){return 0}if(!N(document.body,e.node)){var r="position: relative;";if(e.coverGutter){r+="margin-left: -"+t.display.gutters.offsetWidth+"px;"}if(e.noHScroll){r+="width: "+t.display.wrapper.clientWidth+"px;"}M(t.display.measure,T("div",[e.node],null,r))}return e.height=e.node.parentNode.offsetHeight}function Gr(e,t){for(var r=Mt(t);r!=e.wrapper;r=r.parentNode){if(!r||r.nodeType==1&&r.getAttribute("cm-ignore-events")=="true"||r.parentNode==e.sizer&&r!=e.mover){return true}}}function qr(e){return e.lineSpace.offsetTop}function Yr(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function Xr(e){if(e.cachedPaddingH){return e.cachedPaddingH}var t=M(e.measure,T("pre","x"));var r=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle;var n={left:parseInt(r.paddingLeft),right:parseInt(r.paddingRight)};if(!isNaN(n.left)&&!isNaN(n.right)){e.cachedPaddingH=n}return n}function Jr(e){return z-e.display.nativeBarWidth}function Zr(e){return e.display.scroller.clientWidth-Jr(e)-e.display.barWidth}function $r(e){return e.display.scroller.clientHeight-Jr(e)-e.display.barHeight}function Qr(e,t,r){var n=e.options.lineWrapping;var i=n&&Zr(e);if(!t.measure.heights||n&&t.measure.width!=i){var o=t.measure.heights=[];if(n){t.measure.width=i;var a=t.text.firstChild.getClientRects();for(var s=0;s<a.length-1;s++){var l=a[s],u=a[s+1];if(Math.abs(l.bottom-u.bottom)>2){o.push((l.bottom+u.top)/2-r.top)}}}o.push(r.bottom-r.top)}}function en(e,t,r){if(e.line==t){return{map:e.measure.map,cache:e.measure.cache}}for(var n=0;n<e.rest.length;n++){if(e.rest[n]==t){return{map:e.measure.maps[n],cache:e.measure.caches[n]}}}for(var i=0;i<e.rest.length;i++){if(de(e.rest[i])>r){return{map:e.measure.maps[i],cache:e.measure.caches[i],before:true}}}}function tn(e,t){t=Xe(t);var r=de(t);var n=e.display.externalMeasured=new Sr(e.doc,t,r);n.lineN=r;var i=n.built=mr(e,n);n.text=i.pre;M(e.display.lineMeasure,i.pre);return n}function rn(e,t,r,n){return an(e,on(e,t),r,n)}function nn(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo){return e.display.view[Bn(e,t)]}var r=e.display.externalMeasured;if(r&&t>=r.lineN&&t<r.lineN+r.size){return r}}function on(e,t){var r=de(t);var n=nn(e,r);if(n&&!n.text){n=null}else if(n&&n.changes){Pr(e,n,r,En(e));e.curOp.forceUpdate=true}if(!n){n=tn(e,t)}var i=en(n,t,r);return{line:t,view:n,rect:null,map:i.map,cache:i.cache,before:i.before,hasHeights:false}}function an(e,t,r,n,i){if(t.before){r=-1}var o=r+(n||""),a;if(t.cache.hasOwnProperty(o)){a=t.cache[o]}else{if(!t.rect){t.rect=t.view.text.getBoundingClientRect()}if(!t.hasHeights){Qr(e,t.view,t.rect);t.hasHeights=true}a=cn(e,t,r,n);if(!a.bogus){t.cache[o]=a}}return{left:a.left,right:a.right,top:i?a.rtop:a.top,bottom:i?a.rbottom:a.bottom}}var sn={left:0,right:0,top:0,bottom:0};function ln(e,t,r){var n,i,o,a,s,l;for(var u=0;u<e.length;u+=3){s=e[u];l=e[u+1];if(t<s){i=0;o=1;a="left"}else if(t<l){i=t-s;o=i+1}else if(u==e.length-3||t==l&&e[u+3]>t){o=l-s;i=o-1;if(t>=l){a="right"}}if(i!=null){n=e[u+2];if(s==l&&r==(n.insertLeft?"left":"right")){a=r}if(r=="left"&&i==0){while(u&&e[u-2]==e[u-3]&&e[u-1].insertLeft){n=e[(u-=3)+2];a="left"}}if(r=="right"&&i==l-s){while(u<e.length-3&&e[u+3]==e[u+4]&&!e[u+5].insertLeft){n=e[(u+=3)+2];a="right"}}break}}return{node:n,start:i,end:o,collapse:a,coverStart:s,coverEnd:l}}function un(e,t){var r=sn;if(t=="left"){for(var n=0;n<e.length;n++){if((r=e[n]).left!=r.right){break}}}else{for(var i=e.length-1;i>=0;i--){if((r=e[i]).left!=r.right){break}}}return r}function cn(e,t,r,n){var i=ln(t.map,r,n);var o=i.node,a=i.start,s=i.end,l=i.collapse;var u;if(o.nodeType==3){for(var c=0;c<4;c++){while(a&&oe(t.line.text.charAt(i.coverStart+a))){--a}while(i.coverStart+s<i.coverEnd&&oe(t.line.text.charAt(i.coverStart+s))){++s}if(k&&C<9&&a==0&&s==i.coverEnd-i.coverStart){u=o.parentNode.getBoundingClientRect()}else{u=un(E(o,a,s).getClientRects(),n)}if(u.left||u.right||a==0){break}s=a;a=a-1;l="right"}if(k&&C<11){u=fn(e.display.measure,u)}}else{if(a>0){l=n="right"}var f;if(e.options.lineWrapping&&(f=o.getClientRects()).length>1){u=f[n=="right"?f.length-1:0]}else{u=o.getBoundingClientRect()}}if(k&&C<9&&!a&&(!u||!u.left&&!u.right)){var h=o.parentNode.getClientRects()[0];if(h){u={left:h.left,right:h.left+On(e.display),top:h.top,bottom:h.bottom}}else{u=sn}}var d=u.top-t.rect.top,p=u.bottom-t.rect.top;var v=(d+p)/2;var g=t.view.measure.heights;var m=0;for(;m<g.length-1;m++){if(v<g[m]){break}}var y=m?g[m-1]:0,b=g[m];var w={left:(l=="right"?u.right:u.left)-t.rect.left,right:(l=="left"?u.left:u.right)-t.rect.left,top:y,bottom:b};if(!u.left&&!u.right){w.bogus=true}if(!e.options.singleCursorHeightPerLine){w.rtop=d;w.rbottom=p}return w}function fn(e,t){if(!window.screen||screen.logicalXDPI==null||screen.logicalXDPI==screen.deviceXDPI||!_t(e)){return t}var r=screen.logicalXDPI/screen.deviceXDPI;var n=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*r,right:t.right*r,top:t.top*n,bottom:t.bottom*n}}function hn(e){if(e.measure){e.measure.cache={};e.measure.heights=null;if(e.rest){for(var t=0;t<e.rest.length;t++){e.measure.caches[t]={}}}}}function dn(e){e.display.externalMeasure=null;A(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++){hn(e.display.view[t])}}function pn(e){dn(e);e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null;if(!e.options.lineWrapping){e.display.maxLineChanged=true}e.display.lineNumChars=null}function vn(){if(a&&f){return-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft))}return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function gn(){if(a&&f){return-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop))}return window.pageYOffset||(document.documentElement||document.body).scrollTop}function mn(e,t,r,n,i){if(!i&&t.widgets){for(var o=0;o<t.widgets.length;++o){if(t.widgets[o].above){var a=Vr(t.widgets[o]);r.top+=a;r.bottom+=a}}}if(n=="line"){return r}if(!n){n="local"}var s=rt(t);if(n=="local"){s+=qr(e.display)}else{s-=e.display.viewOffset}if(n=="page"||n=="window"){var l=e.display.lineSpace.getBoundingClientRect();s+=l.top+(n=="window"?0:gn());var u=l.left+(n=="window"?0:vn());r.left+=u;r.right+=u}r.top+=s;r.bottom+=s;return r}function yn(e,t,r){if(r=="div"){return t}var n=t.left,i=t.top;if(r=="page"){n-=vn();i-=gn()}else if(r=="local"||!r){var o=e.display.sizer.getBoundingClientRect();n+=o.left;i+=o.top}var a=e.display.lineSpace.getBoundingClientRect();return{left:n-a.left,top:i-a.top}}function bn(e,t,r,n,i){if(!n){n=ue(e.doc,t.line)}return mn(e,n,rn(e,n,t.ch,i),r)}function wn(n,e,i,o,a,s){o=o||ue(n.doc,e.line);if(!a){a=on(n,o)}function l(e,t){var r=an(n,a,e,t?"right":"left",s);if(t){r.left=r.right}else{r.right=r.left}return mn(n,o,r,i)}var u=ut(o,n.doc.direction),t=e.ch,r=e.sticky;if(t>=o.text.length){t=o.text.length;r="before"}else if(t<=0){t=0;r="after"}if(!u){return l(r=="before"?t-1:t,r=="before")}function c(e,t,r){var n=u[t],i=n.level%2!=0;return l(r?e-1:e,i!=r)}var f=st(u,t,r);var h=at;var d=c(t,f,r=="before");if(h!=null){d.other=c(t,h,r!="before")}return d}function kn(e,t){var r=0;t=Se(e.doc,t);if(!e.options.lineWrapping){r=On(e.display)*t.ch}var n=ue(e.doc,t.line);var i=rt(n)+qr(e.display);return{left:r,right:r,top:i,bottom:i+n.height}}function Cn(e,t,r,n,i){var o=me(e,t,r);o.xRel=i;if(n){o.outside=true}return o}function xn(e,t,r){var n=e.doc;r+=e.display.viewOffset;if(r<0){return Cn(n.first,0,null,true,-1)}var i=pe(n,r),o=n.first+n.size-1;if(i>o){return Cn(n.first+n.size-1,ue(n,o).text.length,null,true,1)}if(t<0){t=0}var a=ue(n,i);for(;;){var s=An(e,a,i,t,r);var l=qe(a);var u=l&&l.find(0,true);if(l&&(s.ch>u.from.ch||s.ch==u.from.ch&&s.xRel>0)){i=de(a=u.to.line)}else{return s}}}function Sn(t,r,n,i){var o=function(e){return mn(t,r,an(t,n,e),"line")};var e=r.text.length;var a=se(function(e){return o(e-1).bottom<=i},e,0);e=se(function(e){return o(e).top>i},a,e);return{begin:a,end:e}}function Ln(e,t,r,n){var i=mn(e,t,an(e,r,n),"line").top;return Sn(e,t,r,i)}function An(r,n,e,i,o){o-=rt(n);var t=0,a=n.text.length;var s=on(r,n);var l;var u=ut(n,r.doc.direction);if(u){if(r.options.lineWrapping){var c;c=Sn(r,n,s,o),t=c.begin,a=c.end}l=new me(e,Math.floor(t+(a-t)/2));var f=wn(r,l,"line",n,s).left;var h=f<i?1:-1;var d,p=f-i,v;var g=Math.ceil((a-t)/4);e:do{d=p;v=l;var m=0;for(;m<g;++m){var y=l;l=dt(r,n,l,h);if(l==null||l.ch<t||a<=(l.sticky=="before"?l.ch-1:l.ch)){l=y;break e}}p=wn(r,l,"line",n,s).left-i;if(g>1){var b=Math.abs(p-d)/g;g=Math.min(g,Math.ceil(Math.abs(p)/b));h=p<0?1:-1}}while(p!=0&&(g>1||h<0!=p<0&&Math.abs(p)<=Math.abs(d)));if(Math.abs(p)>Math.abs(d)){if(p<0==d<0){throw new Error("Broke out of infinite loop in coordsCharInner")}l=v}}else{var w=se(function(e){var t=mn(r,n,an(r,s,e),"line");if(t.top>o){a=Math.min(e,a);return true}else if(t.bottom<=o){return false}else if(t.left>i){return true}else if(t.right<i){return false}else{return i-t.left<t.right-i}},t,a);w=ae(n.text,w,1);l=new me(e,w,w==a?"before":"after")}var k=wn(r,l,"line",n,s);if(o<k.top||k.bottom<o){l.outside=true}l.xRel=i<k.left?-1:i>k.right?1:0;return l}var Mn;function Tn(e){if(e.cachedTextHeight!=null){return e.cachedTextHeight}if(Mn==null){Mn=T("pre");for(var t=0;t<49;++t){Mn.appendChild(document.createTextNode("x"));Mn.appendChild(T("br"))}Mn.appendChild(document.createTextNode("x"))}M(e.measure,Mn);var r=Mn.offsetHeight/50;if(r>3){e.cachedTextHeight=r}A(e.measure);return r||1}function On(e){if(e.cachedCharWidth!=null){return e.cachedCharWidth}var t=T("span","xxxxxxxxxx");var r=T("pre",[t]);M(e.measure,r);var n=t.getBoundingClientRect(),i=(n.right-n.left)/10;if(i>2){e.cachedCharWidth=i}return i||10}function En(e){var t=e.display,r={},n={};var i=t.gutters.clientLeft;for(var o=t.gutters.firstChild,a=0;o;o=o.nextSibling,++a){r[e.options.gutters[a]]=o.offsetLeft+o.clientLeft+i;n[e.options.gutters[a]]=o.clientWidth}return{fixedPos:Nn(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:r,gutterWidth:n,wrapperWidth:t.wrapper.clientWidth}}function Nn(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function In(n){var i=Tn(n.display),o=n.options.lineWrapping;var a=o&&Math.max(5,n.display.scroller.clientWidth/On(n.display)-3);return function(e){if(et(n.doc,e)){return 0}var t=0;if(e.widgets){for(var r=0;r<e.widgets.length;r++){if(e.widgets[r].height){t+=e.widgets[r].height}}}if(o){return t+(Math.ceil(e.text.length/a)||1)*i}else{return t+i}}}function Pn(e){var t=e.doc,r=In(e);t.iter(function(e){var t=r(e);if(t!=e.height){he(e,t)}})}function Rn(e,t,r,n){var i=e.display;if(!r&&Mt(t).getAttribute("cm-not-content")=="true"){return null}var o,a,s=i.lineSpace.getBoundingClientRect();try{o=t.clientX-s.left;a=t.clientY-s.top}catch(t){return null}var l=xn(e,o,a),u;if(n&&l.xRel==1&&(u=ue(e.doc,l.line).text).length==l.ch){var c=_(u,u.length,e.options.tabSize)-u.length;l=me(l.line,Math.max(0,Math.round((o-Xr(e.display).left)/On(e.display))-c))}return l}function Bn(e,t){if(t>=e.display.viewTo){return null}t-=e.display.viewFrom;if(t<0){return null}var r=e.display.view;for(var n=0;n<r.length;n++){t-=r[n].size;if(t<0){return n}}}function Dn(e){e.display.input.showSelection(e.display.input.prepareSelection())}function Hn(e,t){var r=e.doc,n={};var i=n.cursors=document.createDocumentFragment();var o=n.selection=document.createDocumentFragment();for(var a=0;a<r.sel.ranges.length;a++){if(t===false&&a==r.sel.primIndex){continue}var s=r.sel.ranges[a];if(s.from().line>=e.display.viewTo||s.to().line<e.display.viewFrom){continue}var l=s.empty();if(l||e.options.showCursorWhenSelecting){_n(e,s.head,i)}if(!l){Fn(e,s,o)}}return n}function _n(e,t,r){var n=wn(e,t,"div",null,null,!e.options.singleCursorHeightPerLine);var i=r.appendChild(T("div"," ","CodeMirror-cursor"));i.style.left=n.left+"px";i.style.top=n.top+"px";i.style.height=Math.max(0,n.bottom-n.top)*e.options.cursorHeight+"px";if(n.other){var o=r.appendChild(T("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));o.style.display="";o.style.left=n.other.left+"px";o.style.top=n.other.top+"px";o.style.height=(n.other.bottom-n.other.top)*.85+"px"}}function Wn(e,t){return e.top-t.top||e.left-t.left}function Fn(i,e,t){var r=i.display,o=i.doc;var a=document.createDocumentFragment();var n=Xr(i.display),v=n.left;var g=Math.max(r.sizerWidth,Zr(i)-r.sizer.offsetLeft)-n.right;function m(e,t,r,n){if(t<0){t=0}t=Math.round(t);n=Math.round(n);a.appendChild(T("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(r==null?g-e:r)+"px;\n                             height: "+(n-t)+"px"))}function s(r,u,c){var n=ue(o,r);var f=n.text.length;var h,d;function p(e,t){return bn(i,me(r,e),"div",n,t)}ot(ut(n,o.direction),u||0,c==null?f:c,function(e,t,r){var n,i;if(r=="ltr"){n=p(e,"left");i=p(t-1,"right");var o=u==null&&e==0?v:n.left;var a=c==null&&t==f?g:i.right;if(i.top-n.top<=3){m(o,i.top,a-o,i.bottom)}else{m(o,n.top,null,n.bottom);if(n.bottom<i.top){m(v,n.bottom,null,i.top)}m(v,i.top,i.right,i.bottom)}}else{n=p(e,"right");i=p(t-1,"left");var s=u==null&&e==0?g:n.right;var l=c==null&&t==f?v:i.left;if(i.top-n.top<=3){m(l,i.top,s-l,i.bottom)}else{m(v,n.top,s-v,n.bottom);if(n.bottom<i.top){m(v,n.bottom,null,i.top)}m(l,i.top,null,i.bottom)}}if(!h||Wn(n,h)<0){h=n}if(Wn(i,h)<0){h=i}if(!d||Wn(n,d)<0){d=n}if(Wn(i,d)<0){d=i}});return{start:h,end:d}}var l=e.from(),u=e.to();if(l.line==u.line){s(l.line,l.ch,u.ch)}else{var c=ue(o,l.line),f=ue(o,u.line);var h=Xe(c)==Xe(f);var d=s(l.line,l.ch,h?c.text.length+1:null).end;var p=s(u.line,h?0:null,u.ch).start;if(h){if(d.top<p.top-2){m(d.right,d.top,null,d.bottom);m(v,p.top,p.left,p.bottom)}else{m(d.right,d.top,p.left-d.right,d.bottom)}}if(d.bottom<p.top){m(v,d.bottom,null,p.top)}}t.appendChild(a)}function zn(e){if(!e.state.focused){return}var t=e.display;clearInterval(t.blinker);var r=true;t.cursorDiv.style.visibility="";if(e.options.cursorBlinkRate>0){t.blinker=setInterval(function(){return t.cursorDiv.style.visibility=(r=!r)?"":"hidden"},e.options.cursorBlinkRate)}else if(e.options.cursorBlinkRate<0){t.cursorDiv.style.visibility="hidden"}}function jn(e){if(!e.state.focused){e.display.input.focus();Un(e)}}function Kn(e){e.state.delayingBlurEvent=true;setTimeout(function(){if(e.state.delayingBlurEvent){e.state.delayingBlurEvent=false;Vn(e)}},100)}function Un(e,t){if(e.state.delayingBlurEvent){e.state.delayingBlurEvent=false}if(e.options.readOnly=="nocursor"){return}if(!e.state.focused){yt(e,"focus",e,t);e.state.focused=true;P(e.display.wrapper,"CodeMirror-focused");if(!e.curOp&&e.display.selForContextMenu!=e.doc.sel){e.display.input.reset();if(g){setTimeout(function(){return e.display.input.reset(true)},20)}}e.display.input.receivedFocus()}zn(e)}function Vn(e,t){if(e.state.delayingBlurEvent){return}if(e.state.focused){yt(e,"blur",e,t);e.state.focused=false;L(e.display.wrapper,"CodeMirror-focused")}clearInterval(e.display.blinker);setTimeout(function(){if(!e.state.focused){e.display.shift=false}},150)}function Gn(e){var t=e.display;var r=t.lineDiv.offsetTop;for(var n=0;n<t.view.length;n++){var i=t.view[n],o=void 0;if(i.hidden){continue}if(k&&C<8){var a=i.node.offsetTop+i.node.offsetHeight;o=a-r;r=a}else{var s=i.node.getBoundingClientRect();o=s.bottom-s.top}var l=i.line.height-o;if(o<2){o=Tn(t)}if(l>.005||l<-.005){he(i.line,o);qn(i.line);if(i.rest){for(var u=0;u<i.rest.length;u++){qn(i.rest[u])}}}}}function qn(e){if(e.widgets){for(var t=0;t<e.widgets.length;++t){e.widgets[t].height=e.widgets[t].node.parentNode.offsetHeight}}}function Yn(e,t,r){var n=r&&r.top!=null?Math.max(0,r.top):e.scroller.scrollTop;n=Math.floor(n-qr(e));var i=r&&r.bottom!=null?r.bottom:n+e.wrapper.clientHeight;var o=pe(t,n),a=pe(t,i);if(r&&r.ensure){var s=r.ensure.from.line,l=r.ensure.to.line;if(s<o){o=s;a=pe(t,rt(ue(t,s))+e.wrapper.clientHeight)}else if(Math.min(l,t.lastLine())>=a){o=pe(t,rt(ue(t,l))-e.wrapper.clientHeight);a=l}}return{from:o,to:Math.max(a,o+1)}}function Xn(e){var t=e.display,r=t.view;if(!t.alignWidgets&&(!t.gutters.firstChild||!e.options.fixedGutter)){return}var n=Nn(t)-t.scroller.scrollLeft+e.doc.scrollLeft;var i=t.gutters.offsetWidth,o=n+"px";for(var a=0;a<r.length;a++){if(!r[a].hidden){if(e.options.fixedGutter){if(r[a].gutter){r[a].gutter.style.left=o}if(r[a].gutterBackground){r[a].gutterBackground.style.left=o}}var s=r[a].alignable;if(s){for(var l=0;l<s.length;l++){s[l].style.left=o}}}}if(e.options.fixedGutter){t.gutters.style.left=n+i+"px"}}function Jn(e){if(!e.options.lineNumbers){return false}var t=e.doc,r=ge(e.options,t.first+t.size-1),n=e.display;if(r.length!=n.lineNumChars){var i=n.measure.appendChild(T("div",[T("div",r)],"CodeMirror-linenumber CodeMirror-gutter-elt"));var o=i.firstChild.offsetWidth,a=i.offsetWidth-o;n.lineGutter.style.width="";n.lineNumInnerWidth=Math.max(o,n.lineGutter.offsetWidth-a)+1;n.lineNumWidth=n.lineNumInnerWidth+a;n.lineNumChars=n.lineNumInnerWidth?r.length:-1;n.lineGutter.style.width=n.lineNumWidth+"px";Gi(e);return true}return false}function Zn(e,t){if(bt(e,"scrollCursorIntoView")){return}var r=e.display,n=r.sizer.getBoundingClientRect(),i=null;if(t.top+n.top<0){i=true}else if(t.bottom+n.top>(window.innerHeight||document.documentElement.clientHeight)){i=false}if(i!=null&&!u){var o=T("div","​",null,"position: absolute;\n                         top: "+(t.top-r.viewOffset-qr(e.display))+"px;\n                         height: "+(t.bottom-t.top+Jr(e)+r.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(o);o.scrollIntoView(i);e.display.lineSpace.removeChild(o)}}function $n(e,t,r,n){if(n==null){n=0}var i;if(!e.options.lineWrapping&&t==r){t=t.ch?me(t.line,t.sticky=="before"?t.ch-1:t.ch,"after"):t;r=t.sticky=="before"?me(t.line,t.ch+1,"before"):t}for(var o=0;o<5;o++){var a=false;var s=wn(e,t);var l=!r||r==t?s:wn(e,r);i={left:Math.min(s.left,l.left),top:Math.min(s.top,l.top)-n,right:Math.max(s.left,l.left),bottom:Math.max(s.bottom,l.bottom)+n};var u=ei(e,i);var c=e.doc.scrollTop,f=e.doc.scrollLeft;if(u.scrollTop!=null){si(e,u.scrollTop);if(Math.abs(e.doc.scrollTop-c)>1){a=true}}if(u.scrollLeft!=null){ui(e,u.scrollLeft);if(Math.abs(e.doc.scrollLeft-f)>1){a=true}}if(!a){break}}return i}function Qn(e,t){var r=ei(e,t);if(r.scrollTop!=null){si(e,r.scrollTop)}if(r.scrollLeft!=null){ui(e,r.scrollLeft)}}function ei(e,t){var r=e.display,n=Tn(e.display);if(t.top<0){t.top=0}var i=e.curOp&&e.curOp.scrollTop!=null?e.curOp.scrollTop:r.scroller.scrollTop;var o=$r(e),a={};if(t.bottom-t.top>o){t.bottom=t.top+o}var s=e.doc.height+Yr(r);var l=t.top<n,u=t.bottom>s-n;if(t.top<i){a.scrollTop=l?0:t.top}else if(t.bottom>i+o){var c=Math.min(t.top,(u?s:t.bottom)-o);if(c!=i){a.scrollTop=c}}var f=e.curOp&&e.curOp.scrollLeft!=null?e.curOp.scrollLeft:r.scroller.scrollLeft;var h=Zr(e)-(e.options.fixedGutter?r.gutters.offsetWidth:0);var d=t.right-t.left>h;if(d){t.right=t.left+h}if(t.left<10){a.scrollLeft=0}else if(t.left<f){a.scrollLeft=Math.max(0,t.left-(d?0:10))}else if(t.right>h+f-3){a.scrollLeft=t.right+(d?0:10)-h}return a}function ti(e,t){if(t==null){return}oi(e);e.curOp.scrollTop=(e.curOp.scrollTop==null?e.doc.scrollTop:e.curOp.scrollTop)+t}function ri(e){oi(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function ni(e,t,r){if(t!=null||r!=null){oi(e)}if(t!=null){e.curOp.scrollLeft=t}if(r!=null){e.curOp.scrollTop=r}}function ii(e,t){oi(e);e.curOp.scrollToPos=t}function oi(e){var t=e.curOp.scrollToPos;if(t){e.curOp.scrollToPos=null;var r=kn(e,t.from),n=kn(e,t.to);ai(e,r,n,t.margin)}}function ai(e,t,r,n){var i=ei(e,{left:Math.min(t.left,r.left),top:Math.min(t.top,r.top)-n,right:Math.max(t.right,r.right),bottom:Math.max(t.bottom,r.bottom)+n});ni(e,i.scrollLeft,i.scrollTop)}function si(e,t){if(Math.abs(e.doc.scrollTop-t)<2){return}if(!v){Ui(e,{top:t})}li(e,t,true);if(v){Ui(e)}Di(e,100)}function li(e,t,r){t=Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t);if(e.display.scroller.scrollTop==t&&!r){return}e.doc.scrollTop=t;e.display.scrollbars.setScrollTop(t);if(e.display.scroller.scrollTop!=t){e.display.scroller.scrollTop=t}}function ui(e,t,r,n){t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth);if((r?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!n){return}e.doc.scrollLeft=t;Xn(e);if(e.display.scroller.scrollLeft!=t){e.display.scroller.scrollLeft=t}e.display.scrollbars.setScrollLeft(t)}function ci(e){var t=e.display,r=t.gutters.offsetWidth;var n=Math.round(e.doc.height+Yr(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?r:0,docHeight:n,scrollHeight:n+Jr(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:r}}var fi=function(e,t,r){this.cm=r;var n=this.vert=T("div",[T("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar");var i=this.horiz=T("div",[T("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");e(n);e(i);vt(n,"scroll",function(){if(n.clientHeight){t(n.scrollTop,"vertical")}});vt(i,"scroll",function(){if(i.clientWidth){t(i.scrollLeft,"horizontal")}});this.checkedZeroWidth=false;if(k&&C<8){this.horiz.style.minHeight=this.vert.style.minWidth="18px"}};fi.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1;var r=e.scrollHeight>e.clientHeight+1;var n=e.nativeBarWidth;if(r){this.vert.style.display="block";this.vert.style.bottom=t?n+"px":"0";var i=e.viewHeight-(t?n:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+i)+"px"}else{this.vert.style.display="";this.vert.firstChild.style.height="0"}if(t){this.horiz.style.display="block";this.horiz.style.right=r?n+"px":"0";this.horiz.style.left=e.barLeft+"px";var o=e.viewWidth-e.barLeft-(r?n:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+o)+"px"}else{this.horiz.style.display="";this.horiz.firstChild.style.width="0"}if(!this.checkedZeroWidth&&e.clientHeight>0){if(n==0){this.zeroWidthHack()}this.checkedZeroWidth=true}return{right:r?n:0,bottom:t?n:0}};fi.prototype.setScrollLeft=function(e){if(this.horiz.scrollLeft!=e){this.horiz.scrollLeft=e}if(this.disableHoriz){this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")}};fi.prototype.setScrollTop=function(e){if(this.vert.scrollTop!=e){this.vert.scrollTop=e}if(this.disableVert){this.enableZeroWidthBar(this.vert,this.disableVert,"vert")}};fi.prototype.zeroWidthHack=function(){var e=y&&!l?"12px":"18px";this.horiz.style.height=this.vert.style.width=e;this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none";this.disableHoriz=new W;this.disableVert=new W};fi.prototype.enableZeroWidthBar=function(r,n,i){r.style.pointerEvents="auto";function o(){var e=r.getBoundingClientRect();var t=i=="vert"?document.elementFromPoint(e.right-1,(e.top+e.bottom)/2):document.elementFromPoint((e.right+e.left)/2,e.bottom-1);if(t!=r){r.style.pointerEvents="none"}else{n.set(1e3,o)}}n.set(1e3,o)};fi.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz);e.removeChild(this.vert)};var hi=function(){};hi.prototype.update=function(){return{bottom:0,right:0}};hi.prototype.setScrollLeft=function(){};hi.prototype.setScrollTop=function(){};hi.prototype.clear=function(){};function di(e,t){if(!t){t=ci(e)}var r=e.display.barWidth,n=e.display.barHeight;pi(e,t);for(var i=0;i<4&&r!=e.display.barWidth||n!=e.display.barHeight;i++){if(r!=e.display.barWidth&&e.options.lineWrapping){Gn(e)}pi(e,ci(e));r=e.display.barWidth;n=e.display.barHeight}}function pi(e,t){var r=e.display;var n=r.scrollbars.update(t);r.sizer.style.paddingRight=(r.barWidth=n.right)+"px";r.sizer.style.paddingBottom=(r.barHeight=n.bottom)+"px";r.heightForcer.style.borderBottom=n.bottom+"px solid transparent";if(n.right&&n.bottom){r.scrollbarFiller.style.display="block";r.scrollbarFiller.style.height=n.bottom+"px";r.scrollbarFiller.style.width=n.right+"px"}else{r.scrollbarFiller.style.display=""}if(n.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter){r.gutterFiller.style.display="block";r.gutterFiller.style.height=n.bottom+"px";r.gutterFiller.style.width=t.gutterWidth+"px"}else{r.gutterFiller.style.display=""}}var vi={native:fi,null:hi};function gi(r){if(r.display.scrollbars){r.display.scrollbars.clear();if(r.display.scrollbars.addClass){L(r.display.wrapper,r.display.scrollbars.addClass)}}r.display.scrollbars=new vi[r.options.scrollbarStyle](function(e){r.display.wrapper.insertBefore(e,r.display.scrollbarFiller);vt(e,"mousedown",function(){if(r.state.focused){setTimeout(function(){return r.display.input.focus()},0)}});e.setAttribute("cm-not-content","true")},function(e,t){if(t=="horizontal"){ui(r,e)}else{si(r,e)}},r);if(r.display.scrollbars.addClass){P(r.display.wrapper,r.display.scrollbars.addClass)}}var mi=0;function yi(e){e.curOp={cm:e,viewChanged:false,startHeight:e.doc.height,forceUpdate:false,updateInput:null,typing:false,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:false,updateMaxLine:false,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:false,id:++mi};Mr(e.curOp)}function bi(e){var t=e.curOp;Or(t,function(e){for(var t=0;t<e.ops.length;t++){e.ops[t].cm.curOp=null}wi(e)})}function wi(e){var t=e.ops;for(var r=0;r<t.length;r++){ki(t[r])}for(var n=0;n<t.length;n++){Ci(t[n])}for(var i=0;i<t.length;i++){xi(t[i])}for(var o=0;o<t.length;o++){Si(t[o])}for(var a=0;a<t.length;a++){Li(t[a])}}function ki(e){var t=e.cm,r=t.display;Wi(t);if(e.updateMaxLine){it(t)}e.mustUpdate=e.viewChanged||e.forceUpdate||e.scrollTop!=null||e.scrollToPos&&(e.scrollToPos.from.line<r.viewFrom||e.scrollToPos.to.line>=r.viewTo)||r.maxLineChanged&&t.options.lineWrapping;e.update=e.mustUpdate&&new _i(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function Ci(e){e.updatedDisplay=e.mustUpdate&&ji(e.cm,e.update)}function xi(e){var t=e.cm,r=t.display;if(e.updatedDisplay){Gn(t)}e.barMeasure=ci(t);if(r.maxLineChanged&&!t.options.lineWrapping){e.adjustWidthTo=rn(t,r.maxLine,r.maxLine.text.length).left+3;t.display.sizerWidth=e.adjustWidthTo;e.barMeasure.scrollWidth=Math.max(r.scroller.clientWidth,r.sizer.offsetLeft+e.adjustWidthTo+Jr(t)+t.display.barWidth);e.maxScrollLeft=Math.max(0,r.sizer.offsetLeft+e.adjustWidthTo-Zr(t))}if(e.updatedDisplay||e.selectionChanged){e.preparedSelection=r.input.prepareSelection(e.focus)}}function Si(e){var t=e.cm;if(e.adjustWidthTo!=null){t.display.sizer.style.minWidth=e.adjustWidthTo+"px";if(e.maxScrollLeft<t.doc.scrollLeft){ui(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),true)}t.display.maxLineChanged=false}var r=e.focus&&e.focus==I()&&(!document.hasFocus||document.hasFocus());if(e.preparedSelection){t.display.input.showSelection(e.preparedSelection,r)}if(e.updatedDisplay||e.startHeight!=t.doc.height){di(t,e.barMeasure)}if(e.updatedDisplay){qi(t,e.barMeasure)}if(e.selectionChanged){zn(t)}if(t.state.focused&&e.updateInput){t.display.input.reset(e.typing)}if(r){jn(e.cm)}}function Li(e){var t=e.cm,r=t.display,n=t.doc;if(e.updatedDisplay){Ki(t,e.update)}if(r.wheelStartX!=null&&(e.scrollTop!=null||e.scrollLeft!=null||e.scrollToPos)){r.wheelStartX=r.wheelStartY=null}if(e.scrollTop!=null){li(t,e.scrollTop,e.forceScroll)}if(e.scrollLeft!=null){ui(t,e.scrollLeft,true,true)}if(e.scrollToPos){var i=$n(t,Se(n,e.scrollToPos.from),Se(n,e.scrollToPos.to),e.scrollToPos.margin);Zn(t,i)}var o=e.maybeHiddenMarkers,a=e.maybeUnhiddenMarkers;if(o){for(var s=0;s<o.length;++s){if(!o[s].lines.length){yt(o[s],"hide")}}}if(a){for(var l=0;l<a.length;++l){if(a[l].lines.length){yt(a[l],"unhide")}}}if(r.wrapper.offsetHeight){n.scrollTop=t.display.scroller.scrollTop}if(e.changeObjs){yt(t,"changes",t,e.changeObjs)}if(e.update){e.update.finish()}}function Ai(e,t){if(e.curOp){return t()}yi(e);try{return t()}finally{bi(e)}}function Mi(e,t){return function(){if(e.curOp){return t.apply(e,arguments)}yi(e);try{return t.apply(e,arguments)}finally{bi(e)}}}function Ti(e){return function(){if(this.curOp){return e.apply(this,arguments)}yi(this);try{return e.apply(this,arguments)}finally{bi(this)}}}function Oi(t){return function(){var e=this.cm;if(!e||e.curOp){return t.apply(this,arguments)}yi(e);try{return t.apply(this,arguments)}finally{bi(e)}}}function Ei(e,t,r,n){if(t==null){t=e.doc.first}if(r==null){r=e.doc.first+e.doc.size}if(!n){n=0}var i=e.display;if(n&&r<i.viewTo&&(i.updateLineNumbers==null||i.updateLineNumbers>t)){i.updateLineNumbers=t}e.curOp.viewChanged=true;if(t>=i.viewTo){if(Te&&$e(e.doc,t)<i.viewTo){Ii(e)}}else if(r<=i.viewFrom){if(Te&&Qe(e.doc,r+n)>i.viewFrom){Ii(e)}else{i.viewFrom+=n;i.viewTo+=n}}else if(t<=i.viewFrom&&r>=i.viewTo){Ii(e)}else if(t<=i.viewFrom){var o=Pi(e,r,r+n,1);if(o){i.view=i.view.slice(o.index);i.viewFrom=o.lineN;i.viewTo+=n}else{Ii(e)}}else if(r>=i.viewTo){var a=Pi(e,t,t,-1);if(a){i.view=i.view.slice(0,a.index);i.viewTo=a.lineN}else{Ii(e)}}else{var s=Pi(e,t,t,-1);var l=Pi(e,r,r+n,1);if(s&&l){i.view=i.view.slice(0,s.index).concat(Lr(e,s.lineN,l.lineN)).concat(i.view.slice(l.index));i.viewTo+=n}else{Ii(e)}}var u=i.externalMeasured;if(u){if(r<u.lineN){u.lineN+=n}else if(t<u.lineN+u.size){i.externalMeasured=null}}}function Ni(e,t,r){e.curOp.viewChanged=true;var n=e.display,i=e.display.externalMeasured;if(i&&t>=i.lineN&&t<i.lineN+i.size){n.externalMeasured=null}if(t<n.viewFrom||t>=n.viewTo){return}var o=n.view[Bn(e,t)];if(o.node==null){return}var a=o.changes||(o.changes=[]);if(F(a,r)==-1){a.push(r)}}function Ii(e){e.display.viewFrom=e.display.viewTo=e.doc.first;e.display.view=[];e.display.viewOffset=0}function Pi(e,t,r,n){var i=Bn(e,t),o,a=e.display.view;if(!Te||r==e.doc.first+e.doc.size){return{index:i,lineN:r}}var s=e.display.viewFrom;for(var l=0;l<i;l++){s+=a[l].size}if(s!=t){if(n>0){if(i==a.length-1){return null}o=s+a[i].size-t;i++}else{o=s-t}t+=o;r+=o}while($e(e.doc,r)!=r){if(i==(n<0?0:a.length-1)){return null}r+=n*a[i-(n<0?1:0)].size;i+=n}return{index:i,lineN:r}}function Ri(e,t,r){var n=e.display,i=n.view;if(i.length==0||t>=n.viewTo||r<=n.viewFrom){n.view=Lr(e,t,r);n.viewFrom=t}else{if(n.viewFrom>t){n.view=Lr(e,t,n.viewFrom).concat(n.view)}else if(n.viewFrom<t){n.view=n.view.slice(Bn(e,t))}n.viewFrom=t;if(n.viewTo<r){n.view=n.view.concat(Lr(e,n.viewTo,r))}else if(n.viewTo>r){n.view=n.view.slice(0,Bn(e,r))}}n.viewTo=r}function Bi(e){var t=e.display.view,r=0;for(var n=0;n<t.length;n++){var i=t[n];if(!i.hidden&&(!i.node||i.changes)){++r}}return r}function Di(e,t){if(e.doc.highlightFrontier<e.display.viewTo){e.state.highlight.set(t,D(Hi,e))}}function Hi(l){var u=l.doc;if(u.highlightFrontier>=l.display.viewTo){return}var c=+new Date+l.options.workTime;var f=tr(l,u.highlightFrontier);var h=[];u.iter(f.line,Math.min(u.first+u.size,l.display.viewTo+500),function(e){if(f.line>=l.display.viewFrom){var t=e.styles;var r=e.text.length>l.options.maxHighlightLength?qt(u.mode,f.state):null;var n=Qt(l,e,f,true);if(r){f.state=r}e.styles=n.styles;var i=e.styleClasses,o=n.classes;if(o){e.styleClasses=o}else if(i){e.styleClasses=null}var a=!t||t.length!=e.styles.length||i!=o&&(!i||!o||i.bgClass!=o.bgClass||i.textClass!=o.textClass);for(var s=0;!a&&s<t.length;++s){a=t[s]!=e.styles[s]}if(a){h.push(f.line)}e.stateAfter=f.save();f.nextLine()}else{if(e.text.length<=l.options.maxHighlightLength){rr(l,e.text,f)}e.stateAfter=f.line%5==0?f.save():null;f.nextLine()}if(+new Date>c){Di(l,l.options.workDelay);return true}});u.highlightFrontier=f.line;u.modeFrontier=Math.max(u.modeFrontier,f.line);if(h.length){Ai(l,function(){for(var e=0;e<h.length;e++){Ni(l,h[e],"text")}})}}var _i=function(e,t,r){var n=e.display;this.viewport=t;this.visible=Yn(n,e.doc,t);this.editorIsHidden=!n.wrapper.offsetWidth;this.wrapperHeight=n.wrapper.clientHeight;this.wrapperWidth=n.wrapper.clientWidth;this.oldDisplayWidth=Zr(e);this.force=r;this.dims=En(e);this.events=[]};_i.prototype.signal=function(e,t){if(kt(e,t)){this.events.push(arguments)}};_i.prototype.finish=function(){var e=this;for(var t=0;t<this.events.length;t++){yt.apply(null,e.events[t])}};function Wi(e){var t=e.display;if(!t.scrollbarsClipped&&t.scroller.offsetWidth){t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth;t.heightForcer.style.height=Jr(e)+"px";t.sizer.style.marginBottom=-t.nativeBarWidth+"px";t.sizer.style.borderRightWidth=Jr(e)+"px";t.scrollbarsClipped=true}}function Fi(e){if(e.hasFocus()){return null}var t=I();if(!t||!N(e.display.lineDiv,t)){return null}var r={activeElt:t};if(window.getSelection){var n=window.getSelection();if(n.anchorNode&&n.extend&&N(e.display.lineDiv,n.anchorNode)){r.anchorNode=n.anchorNode;r.anchorOffset=n.anchorOffset;r.focusNode=n.focusNode;r.focusOffset=n.focusOffset}}return r}function zi(e){if(!e||!e.activeElt||e.activeElt==I()){return}e.activeElt.focus();if(e.anchorNode&&N(document.body,e.anchorNode)&&N(document.body,e.focusNode)){var t=window.getSelection(),r=document.createRange();r.setEnd(e.anchorNode,e.anchorOffset);r.collapse(false);t.removeAllRanges();t.addRange(r);t.extend(e.focusNode,e.focusOffset)}}function ji(e,t){var r=e.display,n=e.doc;if(t.editorIsHidden){Ii(e);return false}if(!t.force&&t.visible.from>=r.viewFrom&&t.visible.to<=r.viewTo&&(r.updateLineNumbers==null||r.updateLineNumbers>=r.viewTo)&&r.renderedView==r.view&&Bi(e)==0){return false}if(Jn(e)){Ii(e);t.dims=En(e)}var i=n.first+n.size;var o=Math.max(t.visible.from-e.options.viewportMargin,n.first);var a=Math.min(i,t.visible.to+e.options.viewportMargin);if(r.viewFrom<o&&o-r.viewFrom<20){o=Math.max(n.first,r.viewFrom)}if(r.viewTo>a&&r.viewTo-a<20){a=Math.min(i,r.viewTo)}if(Te){o=$e(e.doc,o);a=Qe(e.doc,a)}var s=o!=r.viewFrom||a!=r.viewTo||r.lastWrapHeight!=t.wrapperHeight||r.lastWrapWidth!=t.wrapperWidth;Ri(e,o,a);r.viewOffset=rt(ue(e.doc,r.viewFrom));e.display.mover.style.top=r.viewOffset+"px";var l=Bi(e);if(!s&&l==0&&!t.force&&r.renderedView==r.view&&(r.updateLineNumbers==null||r.updateLineNumbers>=r.viewTo)){return false}var u=Fi(e);if(l>4){r.lineDiv.style.display="none"}Vi(e,r.updateLineNumbers,t.dims);if(l>4){r.lineDiv.style.display=""}r.renderedView=r.view;zi(u);A(r.cursorDiv);A(r.selectionDiv);r.gutters.style.height=r.sizer.style.minHeight=0;if(s){r.lastWrapHeight=t.wrapperHeight;r.lastWrapWidth=t.wrapperWidth;Di(e,400)}r.updateLineNumbers=null;return true}function Ki(e,t){var r=t.viewport;for(var n=true;;n=false){if(!n||!e.options.lineWrapping||t.oldDisplayWidth==Zr(e)){if(r&&r.top!=null){r={top:Math.min(e.doc.height+Yr(e.display)-$r(e),r.top)}}t.visible=Yn(e.display,e.doc,r);if(t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo){break}}if(!ji(e,t)){break}Gn(e);var i=ci(e);Dn(e);di(e,i);qi(e,i);t.force=false}t.signal(e,"update",e);if(e.display.viewFrom!=e.display.reportedViewFrom||e.display.viewTo!=e.display.reportedViewTo){t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo);e.display.reportedViewFrom=e.display.viewFrom;e.display.reportedViewTo=e.display.viewTo}}function Ui(e,t){var r=new _i(e,t);if(ji(e,r)){Gn(e);Ki(e,r);var n=ci(e);Dn(e);di(e,n);qi(e,n);r.finish()}}function Vi(r,e,t){var n=r.display,i=r.options.lineNumbers;var o=n.lineDiv,a=o.firstChild;function s(e){var t=e.nextSibling;if(g&&y&&r.display.currentWheelTarget==e){e.style.display="none"}else{e.parentNode.removeChild(e)}return t}var l=n.view,u=n.viewFrom;for(var c=0;c<l.length;c++){var f=l[c];if(f.hidden){}else if(!f.node||f.node.parentNode!=o){var h=zr(r,f,u,t);o.insertBefore(h,a)}else{while(a!=f.node){a=s(a)}var d=i&&e!=null&&e<=u&&f.lineNumber;if(f.changes){if(F(f.changes,"gutter")>-1){d=false}Pr(r,f,u,t)}if(d){A(f.lineNumber);f.lineNumber.appendChild(document.createTextNode(ge(r.options,u)))}a=f.node.nextSibling}u+=f.size}while(a){a=s(a)}}function Gi(e){var t=e.display.gutters.offsetWidth;e.display.sizer.style.marginLeft=t+"px"}function qi(e,t){e.display.sizer.style.minHeight=t.docHeight+"px";e.display.heightForcer.style.top=t.docHeight+"px";e.display.gutters.style.height=t.docHeight+e.display.barHeight+Jr(e)+"px"}function Yi(e){var t=e.display.gutters,r=e.options.gutters;A(t);var n=0;for(;n<r.length;++n){var i=r[n];var o=t.appendChild(T("div",null,"CodeMirror-gutter "+i));if(i=="CodeMirror-linenumbers"){e.display.lineGutter=o;o.style.width=(e.display.lineNumWidth||1)+"px"}}t.style.display=n?"":"none";Gi(e)}function Xi(e){var t=F(e.gutters,"CodeMirror-linenumbers");if(t==-1&&e.lineNumbers){e.gutters=e.gutters.concat(["CodeMirror-linenumbers"])}else if(t>-1&&!e.lineNumbers){e.gutters=e.gutters.slice(0);e.gutters.splice(t,1)}}var Ji=0;var Zi=null;if(k){Zi=-.53}else if(v){Zi=15}else if(a){Zi=-.7}else if(s){Zi=-1/3}function $i(e){var t=e.wheelDeltaX,r=e.wheelDeltaY;if(t==null&&e.detail&&e.axis==e.HORIZONTAL_AXIS){t=e.detail}if(r==null&&e.detail&&e.axis==e.VERTICAL_AXIS){r=e.detail}else if(r==null){r=e.wheelDelta}return{x:t,y:r}}function Qi(e){var t=$i(e);t.x*=Zi;t.y*=Zi;return t}function eo(e,t){var r=$i(t),n=r.x,i=r.y;var o=e.display,a=o.scroller;var s=a.scrollWidth>a.clientWidth;var l=a.scrollHeight>a.clientHeight;if(!(n&&s||i&&l)){return}if(i&&y&&g){e:for(var u=t.target,c=o.view;u!=a;u=u.parentNode){for(var f=0;f<c.length;f++){if(c[f].node==u){e.display.currentWheelTarget=u;break e}}}}if(n&&!v&&!m&&Zi!=null){if(i&&l){si(e,Math.max(0,a.scrollTop+i*Zi))}ui(e,Math.max(0,a.scrollLeft+n*Zi));if(!i||i&&l){xt(t)}o.wheelStartX=null;return}if(i&&Zi!=null){var h=i*Zi;var d=e.doc.scrollTop,p=d+o.wrapper.clientHeight;if(h<0){d=Math.max(0,d+h-50)}else{p=Math.min(e.doc.height,p+h+50)}Ui(e,{top:d,bottom:p})}if(Ji<20){if(o.wheelStartX==null){o.wheelStartX=a.scrollLeft;o.wheelStartY=a.scrollTop;o.wheelDX=n;o.wheelDY=i;setTimeout(function(){if(o.wheelStartX==null){return}var e=a.scrollLeft-o.wheelStartX;var t=a.scrollTop-o.wheelStartY;var r=t&&o.wheelDY&&t/o.wheelDY||e&&o.wheelDX&&e/o.wheelDX;o.wheelStartX=o.wheelStartY=null;if(!r){return}Zi=(Zi*Ji+r)/(Ji+1);++Ji},200)}else{o.wheelDX+=n;o.wheelDY+=i}}}var to=function(e,t){this.ranges=e;this.primIndex=t};to.prototype.primary=function(){return this.ranges[this.primIndex]};to.prototype.equals=function(e){var t=this;if(e==this){return true}if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length){return false}for(var r=0;r<this.ranges.length;r++){var n=t.ranges[r],i=e.ranges[r];if(!be(n.anchor,i.anchor)||!be(n.head,i.head)){return false}}return true};to.prototype.deepCopy=function(){var e=this;var t=[];for(var r=0;r<this.ranges.length;r++){t[r]=new ro(we(e.ranges[r].anchor),we(e.ranges[r].head))}return new to(t,this.primIndex)};to.prototype.somethingSelected=function(){var e=this;for(var t=0;t<this.ranges.length;t++){if(!e.ranges[t].empty()){return true}}return false};to.prototype.contains=function(e,t){var r=this;if(!t){t=e}for(var n=0;n<this.ranges.length;n++){var i=r.ranges[n];if(ye(t,i.from())>=0&&ye(e,i.to())<=0){return n}}return-1};var ro=function(e,t){this.anchor=e;this.head=t};ro.prototype.from=function(){return Ce(this.anchor,this.head)};ro.prototype.to=function(){return ke(this.anchor,this.head)};ro.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};function no(e,t){var r=e[t];e.sort(function(e,t){return ye(e.from(),t.from())});t=F(e,r);for(var n=1;n<e.length;n++){var i=e[n],o=e[n-1];if(ye(o.to(),i.from())>=0){var a=Ce(o.from(),i.from()),s=ke(o.to(),i.to());var l=o.empty()?i.from()==i.head:o.from()==o.head;if(n<=t){--t}e.splice(--n,2,new ro(l?s:a,l?a:s))}}return new to(e,t)}function io(e,t){return new to([new ro(e,t||e)],0)}function oo(e){if(!e.text){return e.to}return me(e.from.line+e.text.length-1,X(e.text).length+(e.text.length==1?e.from.ch:0))}function ao(e,t){if(ye(e,t.from)<0){return e}if(ye(e,t.to)<=0){return oo(t)}var r=e.line+t.text.length-(t.to.line-t.from.line)-1,n=e.ch;if(e.line==t.to.line){n+=oo(t).ch-t.to.ch}return me(r,n)}function so(e,t){var r=[];for(var n=0;n<e.sel.ranges.length;n++){var i=e.sel.ranges[n];r.push(new ro(ao(i.anchor,t),ao(i.head,t)))}return no(r,e.sel.primIndex)}function lo(e,t,r){if(e.line==t.line){return me(r.line,e.ch-t.ch+r.ch)}else{return me(r.line+(e.line-t.line),e.ch)}}function uo(e,t,r){var n=[];var i=me(e.first,0),o=i;for(var a=0;a<t.length;a++){var s=t[a];var l=lo(s.from,i,o);var u=lo(oo(s),i,o);i=s.to;o=u;if(r=="around"){var c=e.sel.ranges[a],f=ye(c.head,c.anchor)<0;n[a]=new ro(f?u:l,f?l:u)}else{n[a]=new ro(l,l)}}return new to(n,e.sel.primIndex)}function co(e){e.doc.mode=Ut(e.options,e.doc.modeOption);fo(e)}function fo(e){e.doc.iter(function(e){if(e.stateAfter){e.stateAfter=null}if(e.styles){e.styles=null}});e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first;Di(e,100);e.state.modeGen++;if(e.curOp){Ei(e)}}function ho(e,t){return t.from.ch==0&&t.to.ch==0&&X(t.text)==""&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function po(e,n,t,i){function o(e){return t?t[e]:null}function r(e,t,r){hr(e,t,r,i);Nr(e,"change",e,n)}function a(e,t){var r=[];for(var n=e;n<t;++n){r.push(new fr(u[n],o(n),i))}return r}var s=n.from,l=n.to,u=n.text;var c=ue(e,s.line),f=ue(e,l.line);var h=X(u),d=o(u.length-1),p=l.line-s.line;if(n.full){e.insert(0,a(0,u.length));e.remove(u.length,e.size-u.length)}else if(ho(e,n)){var v=a(0,u.length-1);r(f,f.text,d);if(p){e.remove(s.line,p)}if(v.length){e.insert(s.line,v)}}else if(c==f){if(u.length==1){r(c,c.text.slice(0,s.ch)+h+c.text.slice(l.ch),d)}else{var g=a(1,u.length-1);g.push(new fr(h+c.text.slice(l.ch),d,i));r(c,c.text.slice(0,s.ch)+u[0],o(0));e.insert(s.line+1,g)}}else if(u.length==1){r(c,c.text.slice(0,s.ch)+u[0]+f.text.slice(l.ch),o(0));e.remove(s.line+1,p)}else{r(c,c.text.slice(0,s.ch)+u[0],o(0));r(f,h+f.text.slice(l.ch),d);var m=a(1,u.length-1);if(p>1){e.remove(s.line+1,p-1)}e.insert(s.line+1,m)}Nr(e,"change",e,n)}function vo(e,a,s){function l(e,t,r){if(e.linked){for(var n=0;n<e.linked.length;++n){var i=e.linked[n];if(i.doc==t){continue}var o=r&&i.sharedHist;if(s&&!o){continue}a(i.doc,o);l(i.doc,e,o)}}}l(e,null,true)}function go(e,t){if(t.cm){throw new Error("This document is already in use.")}e.doc=t;t.cm=e;Pn(e);co(e);mo(e);if(!e.options.lineWrapping){it(e)}e.options.mode=t.modeOption;Ei(e)}function mo(e){(e.doc.direction=="rtl"?P:L)(e.display.lineDiv,"CodeMirror-rtl")}function yo(e){Ai(e,function(){mo(e);Ei(e)})}function bo(e){this.done=[];this.undone=[];this.undoDepth=Infinity;this.lastModTime=this.lastSelTime=0;this.lastOp=this.lastSelOp=null;this.lastOrigin=this.lastSelOrigin=null;this.generation=this.maxGeneration=e||1}function wo(e,t){var r={from:we(t.from),to:oo(t),text:ce(e,t.from,t.to)};Mo(e,r,t.from.line,t.to.line+1);vo(e,function(e){return Mo(e,r,t.from.line,t.to.line+1)},true);return r}function ko(e){while(e.length){var t=X(e);if(t.ranges){e.pop()}else{break}}}function Co(e,t){if(t){ko(e.done);return X(e.done)}else if(e.done.length&&!X(e.done).ranges){return X(e.done)}else if(e.done.length>1&&!e.done[e.done.length-2].ranges){e.done.pop();return X(e.done)}}function xo(e,t,r,n){var i=e.history;i.undone.length=0;var o=+new Date,a;var s;if((i.lastOp==n||i.lastOrigin==t.origin&&t.origin&&(t.origin.charAt(0)=="+"&&e.cm&&i.lastModTime>o-e.cm.options.historyEventDelay||t.origin.charAt(0)=="*"))&&(a=Co(i,i.lastOp==n))){s=X(a.changes);if(ye(t.from,t.to)==0&&ye(t.from,s.to)==0){s.to=oo(t)}else{a.changes.push(wo(e,t))}}else{var l=X(i.done);if(!l||!l.ranges){Ao(e.sel,i.done)}a={changes:[wo(e,t)],generation:i.generation};i.done.push(a);while(i.done.length>i.undoDepth){i.done.shift();if(!i.done[0].ranges){i.done.shift()}}}i.done.push(r);i.generation=++i.maxGeneration;i.lastModTime=i.lastSelTime=o;i.lastOp=i.lastSelOp=n;i.lastOrigin=i.lastSelOrigin=t.origin;if(!s){yt(e,"historyAdded")}}function So(e,t,r,n){var i=t.charAt(0);return i=="*"||i=="+"&&r.ranges.length==n.ranges.length&&r.somethingSelected()==n.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function Lo(e,t,r,n){var i=e.history,o=n&&n.origin;if(r==i.lastSelOp||o&&i.lastSelOrigin==o&&(i.lastModTime==i.lastSelTime&&i.lastOrigin==o||So(e,o,X(i.done),t))){i.done[i.done.length-1]=t}else{Ao(t,i.done)}i.lastSelTime=+new Date;i.lastSelOrigin=o;i.lastSelOp=r;if(n&&n.clearRedo!==false){ko(i.undone)}}function Ao(e,t){var r=X(t);if(!(r&&r.ranges&&r.equals(e))){t.push(e)}}function Mo(t,r,e,n){var i=r["spans_"+t.id],o=0;t.iter(Math.max(t.first,e),Math.min(t.first+t.size,n),function(e){if(e.markedSpans){(i||(i=r["spans_"+t.id]={}))[o]=e.markedSpans}++o})}function To(e){if(!e){return null}var t;for(var r=0;r<e.length;++r){if(e[r].marker.explicitlyCleared){if(!t){t=e.slice(0,r)}}else if(t){t.push(e[r])}}return!t?e:t.length?t:null}function Oo(e,t){var r=t["spans_"+e.id];if(!r){return null}var n=[];for(var i=0;i<t.text.length;++i){n.push(To(r[i]))}return n}function Eo(e,t){var r=Oo(e,t);var n=He(e,t);if(!r){return n}if(!n){return r}for(var i=0;i<r.length;++i){var o=r[i],a=n[i];if(o&&a){e:for(var s=0;s<a.length;++s){var l=a[s];for(var u=0;u<o.length;++u){if(o[u].marker==l.marker){continue e}}o.push(l)}}else if(a){r[i]=a}}return r}function No(e,t,r){var n=[];for(var i=0;i<e.length;++i){var o=e[i];if(o.ranges){n.push(r?to.prototype.deepCopy.call(o):o);continue}var a=o.changes,s=[];n.push({changes:s});for(var l=0;l<a.length;++l){var u=a[l],c=void 0;s.push({from:u.from,to:u.to,text:u.text});if(t){for(var f in u){if(c=f.match(/^spans_(\d+)$/)){if(F(t,Number(c[1]))>-1){X(s)[f]=u[f];delete u[f]}}}}}}return n}function Io(e,t,r,n){if(n){var i=e.anchor;if(r){var o=ye(t,i)<0;if(o!=ye(r,i)<0){i=t;t=r}else if(o!=ye(t,r)<0){t=r}}return new ro(i,t)}else{return new ro(r||t,t)}}function Po(e,t,r,n,i){if(i==null){i=e.cm&&(e.cm.display.shift||e.extend)}Wo(e,new to([Io(e.sel.primary(),t,r,i)],0),n)}function Ro(e,t,r){var n=[];var i=e.cm&&(e.cm.display.shift||e.extend);for(var o=0;o<e.sel.ranges.length;o++){n[o]=Io(e.sel.ranges[o],t[o],null,i)}var a=no(n,e.sel.primIndex);Wo(e,a,r)}function Bo(e,t,r,n){var i=e.sel.ranges.slice(0);i[t]=r;Wo(e,no(i,e.sel.primIndex),n)}function Do(e,t,r,n){Wo(e,io(t,r),n)}function Ho(n,e,t){var r={ranges:e.ranges,update:function(e){var t=this;this.ranges=[];for(var r=0;r<e.length;r++){t.ranges[r]=new ro(Se(n,e[r].anchor),Se(n,e[r].head))}},origin:t&&t.origin};yt(n,"beforeSelectionChange",n,r);if(n.cm){yt(n.cm,"beforeSelectionChange",n.cm,r)}if(r.ranges!=e.ranges){return no(r.ranges,r.ranges.length-1)}else{return e}}function _o(e,t,r){var n=e.history.done,i=X(n);if(i&&i.ranges){n[n.length-1]=t;Fo(e,t,r)}else{Wo(e,t,r)}}function Wo(e,t,r){Fo(e,t,r);Lo(e,e.sel,e.cm?e.cm.curOp.id:NaN,r)}function Fo(e,t,r){if(kt(e,"beforeSelectionChange")||e.cm&&kt(e.cm,"beforeSelectionChange")){t=Ho(e,t,r)}var n=r&&r.bias||(ye(t.primary().head,e.sel.primary().head)<0?-1:1);zo(e,Ko(e,t,n,true));if(!(r&&r.scroll===false)&&e.cm){ri(e.cm)}}function zo(e,t){if(t.equals(e.sel)){return}e.sel=t;if(e.cm){e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=true;wt(e.cm)}Nr(e,"cursorActivity",e)}function jo(e){zo(e,Ko(e,e.sel,null,false))}function Ko(e,t,r,n){var i;for(var o=0;o<t.ranges.length;o++){var a=t.ranges[o];var s=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o];var l=Vo(e,a.anchor,s&&s.anchor,r,n);var u=Vo(e,a.head,s&&s.head,r,n);if(i||l!=a.anchor||u!=a.head){if(!i){i=t.ranges.slice(0,o)}i[o]=new ro(l,u)}}return i?no(i,t.primIndex):t}function Uo(e,t,r,n,i){var o=ue(e,t.line);if(o.markedSpans){for(var a=0;a<o.markedSpans.length;++a){var s=o.markedSpans[a],l=s.marker;if((s.from==null||(l.inclusiveLeft?s.from<=t.ch:s.from<t.ch))&&(s.to==null||(l.inclusiveRight?s.to>=t.ch:s.to>t.ch))){if(i){yt(l,"beforeCursorEnter");if(l.explicitlyCleared){if(!o.markedSpans){break}else{--a;continue}}}if(!l.atomic){continue}if(r){var u=l.find(n<0?1:-1),c=void 0;if(n<0?l.inclusiveRight:l.inclusiveLeft){u=Go(e,u,-n,u&&u.line==t.line?o:null)}if(u&&u.line==t.line&&(c=ye(u,r))&&(n<0?c<0:c>0)){return Uo(e,u,t,n,i)}}var f=l.find(n<0?-1:1);if(n<0?l.inclusiveLeft:l.inclusiveRight){f=Go(e,f,n,f.line==t.line?o:null)}return f?Uo(e,f,t,n,i):null}}}return t}function Vo(e,t,r,n,i){var o=n||1;var a=Uo(e,t,r,o,i)||!i&&Uo(e,t,r,o,true)||Uo(e,t,r,-o,i)||!i&&Uo(e,t,r,-o,true);if(!a){e.cantEdit=true;return me(e.first,0)}return a}function Go(e,t,r,n){if(r<0&&t.ch==0){if(t.line>e.first){return Se(e,me(t.line-1))}else{return null}}else if(r>0&&t.ch==(n||ue(e,t.line)).text.length){if(t.line<e.first+e.size-1){return me(t.line+1,0)}else{return null}}else{return new me(t.line,t.ch+r)}}function qo(e){e.setSelection(me(e.firstLine(),0),me(e.lastLine()),K)}function Yo(i,e,t){var o={canceled:false,from:e.from,to:e.to,text:e.text,origin:e.origin,cancel:function(){return o.canceled=true}};if(t){o.update=function(e,t,r,n){if(e){o.from=Se(i,e)}if(t){o.to=Se(i,t)}if(r){o.text=r}if(n!==undefined){o.origin=n}}}yt(i,"beforeChange",i,o);if(i.cm){yt(i.cm,"beforeChange",i.cm,o)}if(o.canceled){return null}return{from:o.from,to:o.to,text:o.text,origin:o.origin}}function Xo(e,t,r){if(e.cm){if(!e.cm.curOp){return Mi(e.cm,Xo)(e,t,r)}if(e.cm.state.suppressEdits){return}}if(kt(e,"beforeChange")||e.cm&&kt(e.cm,"beforeChange")){t=Yo(e,t,true);if(!t){return}}var n=Me&&!r&&We(e,t.from,t.to);if(n){for(var i=n.length-1;i>=0;--i){Jo(e,{from:n[i].from,to:n[i].to,text:i?[""]:t.text,origin:t.origin})}}else{Jo(e,t)}}function Jo(e,r){if(r.text.length==1&&r.text[0]==""&&ye(r.from,r.to)==0){return}var t=so(e,r);xo(e,r,t,e.cm?e.cm.curOp.id:NaN);Qo(e,r,t,He(e,r));var n=[];vo(e,function(e,t){if(!t&&F(n,e.history)==-1){ia(e.history,r);n.push(e.history)}Qo(e,r,null,He(e,r))})}function Zo(i,o,e){if(i.cm&&i.cm.state.suppressEdits&&!e){return}var t=i.history,a,r=i.sel;var s=o=="undo"?t.done:t.undone,n=o=="undo"?t.undone:t.done;var l=0;for(;l<s.length;l++){a=s[l];if(e?a.ranges&&!a.equals(i.sel):!a.ranges){break}}if(l==s.length){return}t.lastOrigin=t.lastSelOrigin=null;for(;;){a=s.pop();if(a.ranges){Ao(a,n);if(e&&!a.equals(i.sel)){Wo(i,a,{clearRedo:false});return}r=a}else{break}}var u=[];Ao(r,n);n.push({changes:u,generation:t.generation});t.generation=a.generation||++t.maxGeneration;var c=kt(i,"beforeChange")||i.cm&&kt(i.cm,"beforeChange");var f=function(e){var r=a.changes[e];r.origin=o;if(c&&!Yo(i,r,false)){s.length=0;return{}}u.push(wo(i,r));var t=e?so(i,r):X(s);Qo(i,r,t,Eo(i,r));if(!e&&i.cm){i.cm.scrollIntoView({from:r.from,to:oo(r)})}var n=[];vo(i,function(e,t){if(!t&&F(n,e.history)==-1){ia(e.history,r);n.push(e.history)}Qo(e,r,null,Eo(e,r))})};for(var h=a.changes.length-1;h>=0;--h){var d=f(h);if(d)return d.v}}function $o(e,t){if(t==0){return}e.first+=t;e.sel=new to(J(e.sel.ranges,function(e){return new ro(me(e.anchor.line+t,e.anchor.ch),me(e.head.line+t,e.head.ch))}),e.sel.primIndex);if(e.cm){Ei(e.cm,e.first,e.first-t,t);for(var r=e.cm.display,n=r.viewFrom;n<r.viewTo;n++){Ni(e.cm,n,"gutter")}}}function Qo(e,t,r,n){if(e.cm&&!e.cm.curOp){return Mi(e.cm,Qo)(e,t,r,n)}if(t.to.line<e.first){$o(e,t.text.length-1-(t.to.line-t.from.line));return}if(t.from.line>e.lastLine()){return}if(t.from.line<e.first){var i=t.text.length-1-(e.first-t.from.line);$o(e,i);t={from:me(e.first,0),to:me(t.to.line+i,t.to.ch),text:[X(t.text)],origin:t.origin}}var o=e.lastLine();if(t.to.line>o){t={from:t.from,to:me(o,ue(e,o).text.length),text:[t.text[0]],origin:t.origin}}t.removed=ce(e,t.from,t.to);if(!r){r=so(e,t)}if(e.cm){ea(e.cm,t,n)}else{po(e,t,n)}Fo(e,r,K)}function ea(e,t,r){var n=e.doc,i=e.display,o=t.from,a=t.to;var s=false,l=o.line;if(!e.options.lineWrapping){l=de(Xe(ue(n,o.line)));n.iter(l,a.line+1,function(e){if(e==i.maxLine){s=true;return true}})}if(n.sel.contains(t.from,t.to)>-1){wt(e)}po(n,t,r,In(e));if(!e.options.lineWrapping){n.iter(l,o.line+t.text.length,function(e){var t=nt(e);if(t>i.maxLineLength){i.maxLine=e;i.maxLineLength=t;i.maxLineChanged=true;s=false}});if(s){e.curOp.updateMaxLine=true}}cr(n,o.line);Di(e,400);var u=t.text.length-(a.line-o.line)-1;if(t.full){Ei(e)}else if(o.line==a.line&&t.text.length==1&&!ho(e.doc,t)){Ni(e,o.line,"text")}else{Ei(e,o.line,a.line+1,u)}var c=kt(e,"changes"),f=kt(e,"change");if(f||c){var h={from:o,to:a,text:t.text,removed:t.removed,origin:t.origin};if(f){Nr(e,"change",e,h)}if(c){(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(h)}}e.display.selForContextMenu=null}function ta(e,t,r,n,i){if(!n){n=r}if(ye(n,r)<0){var o=n;n=r;r=o}if(typeof t=="string"){t=e.splitLines(t)}Xo(e,{from:r,to:n,text:t,origin:i})}function ra(e,t,r,n){if(r<e.line){e.line+=n}else if(t<e.line){e.line=t;e.ch=0}}function na(e,t,r,n){for(var i=0;i<e.length;++i){var o=e[i],a=true;if(o.ranges){if(!o.copied){o=e[i]=o.deepCopy();o.copied=true}for(var s=0;s<o.ranges.length;s++){ra(o.ranges[s].anchor,t,r,n);ra(o.ranges[s].head,t,r,n)}continue}for(var l=0;l<o.changes.length;++l){var u=o.changes[l];if(r<u.from.line){u.from=me(u.from.line+n,u.from.ch);u.to=me(u.to.line+n,u.to.ch)}else if(t<=u.to.line){a=false;break}}if(!a){e.splice(0,i+1);i=0}}}function ia(e,t){var r=t.from.line,n=t.to.line,i=t.text.length-(n-r)-1;na(e.done,r,n,i);na(e.undone,r,n,i)}function oa(e,t,r,n){var i=t,o=t;if(typeof t=="number"){o=ue(e,xe(e,t))}else{i=de(t)}if(i==null){return null}if(n(o,i)&&e.cm){Ni(e.cm,i,r)}return o}function aa(e){var t=this;this.lines=e;this.parent=null;var r=0;for(var n=0;n<e.length;++n){e[n].parent=t;r+=e[n].height}this.height=r}aa.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){var r=this;for(var n=e,i=e+t;n<i;++n){var o=r.lines[n];r.height-=o.height;dr(o);Nr(o,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,r){var n=this;this.height+=r;this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var i=0;i<t.length;++i){t[i].parent=n}},iterN:function(e,t,r){var n=this;for(var i=e+t;e<i;++e){if(r(n.lines[e])){return true}}}};function sa(e){var t=this;this.children=e;var r=0,n=0;for(var i=0;i<e.length;++i){var o=e[i];r+=o.chunkSize();n+=o.height;o.parent=t}this.size=r;this.height=n;this.parent=null}sa.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){var r=this;this.size-=t;for(var n=0;n<this.children.length;++n){var i=r.children[n],o=i.chunkSize();if(e<o){var a=Math.min(t,o-e),s=i.height;i.removeInner(e,a);r.height-=s-i.height;if(o==a){r.children.splice(n--,1);i.parent=null}if((t-=a)==0){break}e=0}else{e-=o}}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof aa))){var l=[];this.collapse(l);this.children=[new aa(l)];this.children[0].parent=this}},collapse:function(e){var t=this;for(var r=0;r<this.children.length;++r){t.children[r].collapse(e)}},insertInner:function(e,t,r){var n=this;this.size+=t.length;this.height+=r;for(var i=0;i<this.children.length;++i){var o=n.children[i],a=o.chunkSize();if(e<=a){o.insertInner(e,t,r);if(o.lines&&o.lines.length>50){var s=o.lines.length%25+25;for(var l=s;l<o.lines.length;){var u=new aa(o.lines.slice(l,l+=25));o.height-=u.height;n.children.splice(++i,0,u);u.parent=n}o.lines=o.lines.slice(0,s);n.maybeSpill()}break}e-=a}},maybeSpill:function(){if(this.children.length<=10){return}var e=this;do{var t=e.children.splice(e.children.length-5,5);var r=new sa(t);if(!e.parent){var n=new sa(e.children);n.parent=e;e.children=[n,r];e=n}else{e.size-=r.size;e.height-=r.height;var i=F(e.parent.children,e);e.parent.children.splice(i+1,0,r)}r.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()},iterN:function(e,t,r){var n=this;for(var i=0;i<this.children.length;++i){var o=n.children[i],a=o.chunkSize();if(e<a){var s=Math.min(t,a-e);if(o.iterN(e,s,r)){return true}if((t-=s)==0){break}e=0}else{e-=a}}}};var la=function(e,t,r){var n=this;if(r){for(var i in r){if(r.hasOwnProperty(i)){n[i]=r[i]}}}this.doc=e;this.node=t};la.prototype.clear=function(){var e=this;var t=this.doc.cm,r=this.line.widgets,n=this.line,i=de(n);if(i==null||!r){return}for(var o=0;o<r.length;++o){if(r[o]==e){r.splice(o--,1)}}if(!r.length){n.widgets=null}var a=Vr(this);he(n,Math.max(0,n.height-a));if(t){Ai(t,function(){ua(t,n,-a);Ni(t,i,"widget")});Nr(t,"lineWidgetCleared",t,this,i)}};la.prototype.changed=function(){var e=this;var t=this.height,r=this.doc.cm,n=this.line;this.height=null;var i=Vr(this)-t;if(!i){return}he(n,n.height+i);if(r){Ai(r,function(){r.curOp.forceUpdate=true;ua(r,n,i);Nr(r,"lineWidgetChanged",r,e,de(n))})}};Ct(la);function ua(e,t,r){if(rt(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)){ti(e,r)}}function ca(n,e,t,r){var i=new la(n,t,r);var o=n.cm;if(o&&i.noHScroll){o.display.alignWidgets=true}oa(n,e,"widget",function(e){var t=e.widgets||(e.widgets=[]);if(i.insertAt==null){t.push(i)}else{t.splice(Math.min(t.length-1,Math.max(0,i.insertAt)),0,i)}i.line=e;if(o&&!et(n,e)){var r=rt(e)<n.scrollTop;he(e,e.height+Vr(i));if(r){ti(o,i.height)}o.curOp.forceUpdate=true}return true});Nr(o,"lineWidgetAdded",o,i,typeof e=="number"?e:de(e));return i}var fa=0;var ha=function(e,t){this.lines=[];this.type=t;this.doc=e;this.id=++fa};ha.prototype.clear=function(){var e=this;if(this.explicitlyCleared){return}var t=this.doc.cm,r=t&&!t.curOp;if(r){yi(t)}if(kt(this,"clear")){var n=this.find();if(n){Nr(this,"clear",n.from,n.to)}}var i=null,o=null;for(var a=0;a<this.lines.length;++a){var s=e.lines[a];var l=Ie(s.markedSpans,e);if(t&&!e.collapsed){Ni(t,de(s),"text")}else if(t){if(l.to!=null){o=de(s)}if(l.from!=null){i=de(s)}}s.markedSpans=Pe(s.markedSpans,l);if(l.from==null&&e.collapsed&&!et(e.doc,s)&&t){he(s,Tn(t.display))}}if(t&&this.collapsed&&!t.options.lineWrapping){for(var u=0;u<this.lines.length;++u){var c=Xe(e.lines[u]),f=nt(c);if(f>t.display.maxLineLength){t.display.maxLine=c;t.display.maxLineLength=f;t.display.maxLineChanged=true}}}if(i!=null&&t&&this.collapsed){Ei(t,i,o+1)}this.lines.length=0;this.explicitlyCleared=true;if(this.atomic&&this.doc.cantEdit){this.doc.cantEdit=false;if(t){jo(t.doc)}}if(t){Nr(t,"markerCleared",t,this,i,o)}if(r){bi(t)}if(this.parent){this.parent.clear()}};ha.prototype.find=function(e,t){var r=this;if(e==null&&this.type=="bookmark"){e=1}var n,i;for(var o=0;o<this.lines.length;++o){var a=r.lines[o];var s=Ie(a.markedSpans,r);if(s.from!=null){n=me(t?a:de(a),s.from);if(e==-1){return n}}if(s.to!=null){i=me(t?a:de(a),s.to);if(e==1){return i}}}return n&&{from:n,to:i}};ha.prototype.changed=function(){var o=this;var a=this.find(-1,true),s=this,l=this.doc.cm;if(!a||!l){return}Ai(l,function(){var e=a.line,t=de(a.line);var r=nn(l,t);if(r){hn(r);l.curOp.selectionChanged=l.curOp.forceUpdate=true}l.curOp.updateMaxLine=true;if(!et(s.doc,e)&&s.height!=null){var n=s.height;s.height=null;var i=Vr(s)-n;if(i){he(e,e.height+i)}}Nr(l,"markerChanged",l,o)})};ha.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;if(!t.maybeHiddenMarkers||F(t.maybeHiddenMarkers,this)==-1){(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}}this.lines.push(e)};ha.prototype.detachLine=function(e){this.lines.splice(F(this.lines,e),1);if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}};Ct(ha);function da(t,r,n,e,i){if(e&&e.shared){return va(t,r,n,e,i)}if(t.cm&&!t.cm.curOp){return Mi(t.cm,da)(t,r,n,e,i)}var o=new ha(t,i),a=ye(r,n);if(e){H(e,o,false)}if(a>0||a==0&&o.clearWhenEmpty!==false){return o}if(o.replacedWith){o.collapsed=true;o.widgetNode=O("span",[o.replacedWith],"CodeMirror-widget");if(!e.handleMouseEvents){o.widgetNode.setAttribute("cm-ignore-events","true")}if(e.insertLeft){o.widgetNode.insertLeft=true}}if(o.collapsed){if(Ye(t,r.line,r,n,o)||r.line!=n.line&&Ye(t,n.line,r,n,o)){throw new Error("Inserting collapsed marker partially overlapping an existing one")}Ee()}if(o.addToHistory){xo(t,{from:r,to:n,origin:"markText"},t.sel,NaN)}var s=r.line,l=t.cm,u;t.iter(s,n.line+1,function(e){if(l&&o.collapsed&&!l.options.lineWrapping&&Xe(e)==l.display.maxLine){u=true}if(o.collapsed&&s!=r.line){he(e,0)}Re(e,new Ne(o,s==r.line?r.ch:null,s==n.line?n.ch:null));++s});if(o.collapsed){t.iter(r.line,n.line+1,function(e){if(et(t,e)){he(e,0)}})}if(o.clearOnEnter){vt(o,"beforeCursorEnter",function(){return o.clear()})}if(o.readOnly){Oe();if(t.history.done.length||t.history.undone.length){t.clearHistory()}}if(o.collapsed){o.id=++fa;o.atomic=true}if(l){if(u){l.curOp.updateMaxLine=true}if(o.collapsed){Ei(l,r.line,n.line+1)}else if(o.className||o.title||o.startStyle||o.endStyle||o.css){for(var c=r.line;c<=n.line;c++){Ni(l,c,"text")}}if(o.atomic){jo(l.doc)}Nr(l,"markerAdded",l,o)}return o}var pa=function(e,t){var r=this;this.markers=e;this.primary=t;for(var n=0;n<e.length;++n){e[n].parent=r}};pa.prototype.clear=function(){var e=this;if(this.explicitlyCleared){return}this.explicitlyCleared=true;for(var t=0;t<this.markers.length;++t){e.markers[t].clear()}Nr(this,"clear")};pa.prototype.find=function(e,t){return this.primary.find(e,t)};Ct(pa);function va(e,r,n,i,o){i=H(i);i.shared=false;var a=[da(e,r,n,i,o)],s=a[0];var l=i.widgetNode;vo(e,function(e){if(l){i.widgetNode=l.cloneNode(true)}a.push(da(e,Se(e,r),Se(e,n),i,o));for(var t=0;t<e.linked.length;++t){if(e.linked[t].isParent){return}}s=X(a)});return new pa(a,s)}function ga(e){return e.findMarks(me(e.first,0),e.clipPos(me(e.lastLine())),function(e){return e.parent})}function ma(e,t){for(var r=0;r<t.length;r++){var n=t[r],i=n.find();var o=e.clipPos(i.from),a=e.clipPos(i.to);if(ye(o,a)){var s=da(e,o,a,n.primary,n.primary.type);n.markers.push(s);s.parent=n}}}function ya(o){var e=function(e){var t=o[e],r=[t.primary.doc];vo(t.primary.doc,function(e){return r.push(e)});for(var n=0;n<t.markers.length;n++){var i=t.markers[n];if(F(r,i.doc)==-1){i.parent=null;t.markers.splice(n--,1)}}};for(var t=0;t<o.length;t++)e(t)}var ba=0;var wa=function(e,t,r,n,i){if(!(this instanceof wa)){return new wa(e,t,r,n,i)}if(r==null){r=0}sa.call(this,[new aa([new fr("",null)])]);this.first=r;this.scrollTop=this.scrollLeft=0;this.cantEdit=false;this.cleanGeneration=1;this.modeFrontier=this.highlightFrontier=r;var o=me(r,0);this.sel=io(o);this.history=new bo(null);this.id=++ba;this.modeOption=t;this.lineSep=n;this.direction=i=="rtl"?"rtl":"ltr";this.extend=false;if(typeof e=="string"){e=this.splitLines(e)}po(this,{from:o,to:o,text:e});Wo(this,io(o),K)};wa.prototype=Q(sa.prototype,{constructor:wa,iter:function(e,t,r){if(r){this.iterN(e-this.first,t-e,r)}else{this.iterN(this.first,this.first+this.size,e)}},insert:function(e,t){var r=0;for(var n=0;n<t.length;++n){r+=t[n].height}this.insertInner(e-this.first,t,r)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=fe(this,this.first,this.first+this.size);if(e===false){return t}return t.join(e||this.lineSeparator())},setValue:Oi(function(e){var t=me(this.first,0),r=this.first+this.size-1;Xo(this,{from:t,to:me(r,ue(this,r).text.length),text:this.splitLines(e),origin:"setValue",full:true},true);if(this.cm){ni(this.cm,0,0)}Wo(this,io(t),K)}),replaceRange:function(e,t,r,n){t=Se(this,t);r=r?Se(this,r):t;ta(this,e,t,r,n)},getRange:function(e,t,r){var n=ce(this,Se(this,e),Se(this,t));if(r===false){return n}return n.join(r||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(ve(this,e)){return ue(this,e)}},getLineNumber:function(e){return de(e)},getLineHandleVisualStart:function(e){if(typeof e=="number"){e=ue(this,e)}return Xe(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return Se(this,e)},getCursor:function(e){var t=this.sel.primary(),r;if(e==null||e=="head"){r=t.head}else if(e=="anchor"){r=t.anchor}else if(e=="end"||e=="to"||e===false){r=t.to()}else{r=t.from()}return r},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Oi(function(e,t,r){Do(this,Se(this,typeof e=="number"?me(e,t||0):e),null,r)}),setSelection:Oi(function(e,t,r){Do(this,Se(this,e),Se(this,t||e),r)}),extendSelection:Oi(function(e,t,r){Po(this,Se(this,e),t&&Se(this,t),r)}),extendSelections:Oi(function(e,t){Ro(this,Ae(this,e),t)}),extendSelectionsBy:Oi(function(e,t){var r=J(this.sel.ranges,e);Ro(this,Ae(this,r),t)}),setSelections:Oi(function(e,t,r){var n=this;if(!e.length){return}var i=[];for(var o=0;o<e.length;o++){i[o]=new ro(Se(n,e[o].anchor),Se(n,e[o].head))}if(t==null){t=Math.min(e.length-1,this.sel.primIndex)}Wo(this,no(i,t),r)}),addSelection:Oi(function(e,t,r){var n=this.sel.ranges.slice(0);n.push(new ro(Se(this,e),Se(this,t||e)));Wo(this,no(n,n.length-1),r)}),getSelection:function(e){var t=this;var r=this.sel.ranges,n;for(var i=0;i<r.length;i++){var o=ce(t,r[i].from(),r[i].to());n=n?n.concat(o):o}if(e===false){return n}else{return n.join(e||this.lineSeparator())}},getSelections:function(e){var t=this;var r=[],n=this.sel.ranges;for(var i=0;i<n.length;i++){var o=ce(t,n[i].from(),n[i].to());if(e!==false){o=o.join(e||t.lineSeparator())}r[i]=o}return r},replaceSelection:function(e,t,r){var n=[];for(var i=0;i<this.sel.ranges.length;i++){n[i]=e}this.replaceSelections(n,t,r||"+input")},replaceSelections:Oi(function(e,t,r){var n=this;var i=[],o=this.sel;for(var a=0;a<o.ranges.length;a++){var s=o.ranges[a];i[a]={from:s.from(),to:s.to(),text:n.splitLines(e[a]),origin:r}}var l=t&&t!="end"&&uo(this,i,t);for(var u=i.length-1;u>=0;u--){Xo(n,i[u])}if(l){_o(this,l)}else if(this.cm){ri(this.cm)}}),undo:Oi(function(){Zo(this,"undo")}),redo:Oi(function(){Zo(this,"redo")}),undoSelection:Oi(function(){Zo(this,"undo",true)}),redoSelection:Oi(function(){Zo(this,"redo",true)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){var e=this.history,t=0,r=0;for(var n=0;n<e.done.length;n++){if(!e.done[n].ranges){++t}}for(var i=0;i<e.undone.length;i++){if(!e.undone[i].ranges){++r}}return{undo:t,redo:r}},clearHistory:function(){this.history=new bo(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(true)},changeGeneration:function(e){if(e){this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null}return this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:No(this.history.done),undone:No(this.history.undone)}},setHistory:function(e){var t=this.history=new bo(this.history.maxGeneration);t.done=No(e.done.slice(0),null,true);t.undone=No(e.undone.slice(0),null,true)},setGutterMarker:Oi(function(e,r,n){return oa(this,e,"gutter",function(e){var t=e.gutterMarkers||(e.gutterMarkers={});t[r]=n;if(!n&&ne(t)){e.gutterMarkers=null}return true})}),clearGutter:Oi(function(t){var r=this;this.iter(function(e){if(e.gutterMarkers&&e.gutterMarkers[t]){oa(r,e,"gutter",function(){e.gutterMarkers[t]=null;if(ne(e.gutterMarkers)){e.gutterMarkers=null}return true})}})}),lineInfo:function(e){var t;if(typeof e=="number"){if(!ve(this,e)){return null}t=e;e=ue(this,e);if(!e){return null}}else{t=de(e);if(t==null){return null}}return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:Oi(function(e,r,n){return oa(this,e,r=="gutter"?"gutter":"class",function(e){var t=r=="text"?"textClass":r=="background"?"bgClass":r=="gutter"?"gutterClass":"wrapClass";if(!e[t]){e[t]=n}else if(S(n).test(e[t])){return false}else{e[t]+=" "+n}return true})}),removeLineClass:Oi(function(e,o,a){return oa(this,e,o=="gutter"?"gutter":"class",function(e){var t=o=="text"?"textClass":o=="background"?"bgClass":o=="gutter"?"gutterClass":"wrapClass";var r=e[t];if(!r){return false}else if(a==null){e[t]=null}else{var n=r.match(S(a));if(!n){return false}var i=n.index+n[0].length;e[t]=r.slice(0,n.index)+(!n.index||i==r.length?"":" ")+r.slice(i)||null}return true})}),addLineWidget:Oi(function(e,t,r){return ca(this,e,t,r)}),removeLineWidget:function(e){e.clear()},markText:function(e,t,r){return da(this,Se(this,e),Se(this,t),r,r&&r.type||"range")},setBookmark:function(e,t){var r={replacedWith:t&&(t.nodeType==null?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:false,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};e=Se(this,e);return da(this,e,e,r,"bookmark")},findMarksAt:function(e){e=Se(this,e);var t=[],r=ue(this,e.line).markedSpans;if(r){for(var n=0;n<r.length;++n){var i=r[n];if((i.from==null||i.from<=e.ch)&&(i.to==null||i.to>=e.ch)){t.push(i.marker.parent||i.marker)}}}return t},findMarks:function(i,o,a){i=Se(this,i);o=Se(this,o);var s=[],l=i.line;this.iter(i.line,o.line+1,function(e){var t=e.markedSpans;if(t){for(var r=0;r<t.length;r++){var n=t[r];if(!(n.to!=null&&l==i.line&&i.ch>=n.to||n.from==null&&l!=i.line||n.from!=null&&l==o.line&&n.from>=o.ch)&&(!a||a(n.marker))){s.push(n.marker.parent||n.marker)}}}++l});return s},getAllMarks:function(){var n=[];this.iter(function(e){var t=e.markedSpans;if(t){for(var r=0;r<t.length;++r){if(t[r].from!=null){n.push(t[r].marker)}}}});return n},posFromIndex:function(r){var n,i=this.first,o=this.lineSeparator().length;this.iter(function(e){var t=e.text.length+o;if(t>r){n=r;return true}r-=t;++i});return Se(this,me(i,n))},indexFromPos:function(e){e=Se(this,e);var t=e.ch;if(e.line<this.first||e.ch<0){return 0}var r=this.lineSeparator().length;this.iter(this.first,e.line,function(e){t+=e.text.length+r});return t},copy:function(e){var t=new wa(fe(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);t.scrollTop=this.scrollTop;t.scrollLeft=this.scrollLeft;t.sel=this.sel;t.extend=false;if(e){t.history.undoDepth=this.history.undoDepth;t.setHistory(this.getHistory())}return t},linkedDoc:function(e){if(!e){e={}}var t=this.first,r=this.first+this.size;if(e.from!=null&&e.from>t){t=e.from}if(e.to!=null&&e.to<r){r=e.to}var n=new wa(fe(this,t,r),e.mode||this.modeOption,t,this.lineSep,this.direction);if(e.sharedHist){n.history=this.history}(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist});n.linked=[{doc:this,isParent:true,sharedHist:e.sharedHist}];ma(n,ga(this));return n},unlinkDoc:function(e){var t=this;if(e instanceof Os){e=e.doc}if(this.linked){for(var r=0;r<this.linked.length;++r){var n=t.linked[r];if(n.doc!=e){continue}t.linked.splice(r,1);e.unlinkDoc(t);ya(ga(t));break}}if(e.history==this.history){var i=[e.id];vo(e,function(e){return i.push(e.id)},true);e.history=new bo(null);e.history.done=No(this.history.done,i);e.history.undone=No(this.history.undone,i)}},iterLinkedDocs:function(e){vo(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){if(this.lineSep){return e.split(this.lineSep)}return Rt(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:Oi(function(e){if(e!="rtl"){e="ltr"}if(e==this.direction){return}this.direction=e;this.iter(function(e){return e.order=null});if(this.cm){yo(this.cm)}})});wa.prototype.eachLine=wa.prototype.iter;var ka=0;function Ca(e){var i=this;La(i);if(bt(i,e)||Gr(i.display,e)){return}xt(e);if(k){ka=+new Date}var o=Rn(i,e,true),t=e.dataTransfer.files;if(!o||i.isReadOnly()){return}if(t&&t.length&&window.FileReader&&window.File){var a=t.length,s=Array(a),l=0;var r=function(e,r){if(i.options.allowDropFileTypes&&F(i.options.allowDropFileTypes,e.type)==-1){return}var n=new FileReader;n.onload=Mi(i,function(){var e=n.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(e)){e=""}s[r]=e;if(++l==a){o=Se(i.doc,o);var t={from:o,to:o,text:i.doc.splitLines(s.join(i.doc.lineSeparator())),origin:"paste"};Xo(i.doc,t);_o(i.doc,io(o,oo(t)))}});n.readAsText(e)};for(var n=0;n<a;++n){r(t[n],n)}}else{if(i.state.draggingText&&i.doc.sel.contains(o)>-1){i.state.draggingText(e);setTimeout(function(){return i.display.input.focus()},20);return}try{var u=e.dataTransfer.getData("Text");if(u){var c;if(i.state.draggingText&&!i.state.draggingText.copy){c=i.listSelections()}Fo(i.doc,io(o,o));if(c){for(var f=0;f<c.length;++f){ta(i.doc,"",c[f].anchor,c[f].head,"drag")}}i.replaceSelection(u,"around","paste");i.display.input.focus()}}catch(e){}}}function xa(e,t){if(k&&(!e.state.draggingText||+new Date-ka<100)){At(t);return}if(bt(e,t)||Gr(e.display,t)){return}t.dataTransfer.setData("Text",e.getSelection());t.dataTransfer.effectAllowed="copyMove";if(t.dataTransfer.setDragImage&&!s){var r=T("img",null,null,"position: fixed; left: 0; top: 0;");r.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";if(m){r.width=r.height=1;e.display.wrapper.appendChild(r);r._top=r.offsetTop}t.dataTransfer.setDragImage(r,0,0);if(m){r.parentNode.removeChild(r)}}}function Sa(e,t){var r=Rn(e,t);if(!r){return}var n=document.createDocumentFragment();_n(e,r,n);if(!e.display.dragCursor){e.display.dragCursor=T("div",null,"CodeMirror-cursors CodeMirror-dragcursors");e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)}M(e.display.dragCursor,n)}function La(e){if(e.display.dragCursor){e.display.lineSpace.removeChild(e.display.dragCursor);e.display.dragCursor=null}}function Aa(e){if(!document.getElementsByClassName){return}var t=document.getElementsByClassName("CodeMirror");for(var r=0;r<t.length;r++){var n=t[r].CodeMirror;if(n){e(n)}}}var Ma=false;function Ta(){if(Ma){return}Oa();Ma=true}function Oa(){var e;vt(window,"resize",function(){if(e==null){e=setTimeout(function(){e=null;Aa(Ea)},100)}});vt(window,"blur",function(){return Aa(Vn)})}function Ea(e){var t=e.display;if(t.lastWrapHeight==t.wrapper.clientHeight&&t.lastWrapWidth==t.wrapper.clientWidth){return}t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null;t.scrollbarsClipped=false;e.setSize()}var Na={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};for(var Ia=0;Ia<10;Ia++){Na[Ia+48]=Na[Ia+96]=String(Ia)}for(var Pa=65;Pa<=90;Pa++){Na[Pa]=String.fromCharCode(Pa)}for(var Ra=1;Ra<=12;Ra++){Na[Ra+111]=Na[Ra+63235]="F"+Ra}var Ba={};Ba.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"};Ba.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"};Ba.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"};Ba.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]};Ba["default"]=y?Ba.macDefault:Ba.pcDefault;function Da(e){var t=e.split(/-(?!$)/);e=t[t.length-1];var r,n,i,o;for(var a=0;a<t.length-1;a++){var s=t[a];if(/^(cmd|meta|m)$/i.test(s)){o=true}else if(/^a(lt)?$/i.test(s)){r=true}else if(/^(c|ctrl|control)$/i.test(s)){n=true}else if(/^s(hift)?$/i.test(s)){i=true}else{throw new Error("Unrecognized modifier name: "+s)}}if(r){e="Alt-"+e}if(n){e="Ctrl-"+e}if(o){e="Cmd-"+e}if(i){e="Shift-"+e}return e}function Ha(e){var t={};for(var r in e){if(e.hasOwnProperty(r)){var n=e[r];if(/^(name|fallthrough|(de|at)tach)$/.test(r)){continue}if(n=="..."){delete e[r];continue}var i=J(r.split(" "),Da);for(var o=0;o<i.length;o++){var a=void 0,s=void 0;if(o==i.length-1){s=i.join(" ");a=n}else{s=i.slice(0,o+1).join(" ");a="..."}var l=t[s];if(!l){t[s]=a}else if(l!=a){throw new Error("Inconsistent bindings for "+s)}}delete e[r]}}for(var u in t){e[u]=t[u]}return e}function _a(e,t,r,n){t=ja(t);var i=t.call?t.call(e,n):t[e];if(i===false){return"nothing"}if(i==="..."){return"multi"}if(i!=null&&r(i)){return"handled"}if(t.fallthrough){if(Object.prototype.toString.call(t.fallthrough)!="[object Array]"){return _a(e,t.fallthrough,r,n)}for(var o=0;o<t.fallthrough.length;o++){var a=_a(e,t.fallthrough[o],r,n);if(a){return a}}}}function Wa(e){var t=typeof e=="string"?e:Na[e.keyCode];return t=="Ctrl"||t=="Alt"||t=="Shift"||t=="Mod"}function Fa(e,t,r){var n=e;if(t.altKey&&n!="Alt"){e="Alt-"+e}if((w?t.metaKey:t.ctrlKey)&&n!="Ctrl"){e="Ctrl-"+e}if((w?t.ctrlKey:t.metaKey)&&n!="Cmd"){e="Cmd-"+e}if(!r&&t.shiftKey&&n!="Shift"){e="Shift-"+e}return e}function za(e,t){if(m&&e.keyCode==34&&e["char"]){return false}var r=Na[e.keyCode];if(r==null||e.altGraphKey){return false}return Fa(r,e,t)}function ja(e){return typeof e=="string"?Ba[e]:e}function Ka(t,e){var r=t.doc.sel.ranges,n=[];for(var i=0;i<r.length;i++){var o=e(r[i]);while(n.length&&ye(o.from,X(n).to)<=0){var a=n.pop();if(ye(a.from,o.from)<0){o.from=a.from;break}}n.push(o)}Ai(t,function(){for(var e=n.length-1;e>=0;e--){ta(t.doc,"",n[e].from,n[e].to,"+delete")}ri(t)})}var Ua={selectAll:qo,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),K)},killLine:function(r){return Ka(r,function(e){if(e.empty()){var t=ue(r.doc,e.head.line).text.length;if(e.head.ch==t&&e.head.line<r.lastLine()){return{from:e.head,to:me(e.head.line+1,0)}}else{return{from:e.head,to:me(e.head.line,t)}}}else{return{from:e.from(),to:e.to()}}})},deleteLine:function(t){return Ka(t,function(e){return{from:me(e.from().line,0),to:Se(t.doc,me(e.to().line+1,0))}})},delLineLeft:function(e){return Ka(e,function(e){return{from:me(e.from().line,0),to:e.from()}})},delWrappedLineLeft:function(n){return Ka(n,function(e){var t=n.charCoords(e.head,"div").top+5;var r=n.coordsChar({left:0,top:t},"div");return{from:r,to:e.from()}})},delWrappedLineRight:function(n){return Ka(n,function(e){var t=n.charCoords(e.head,"div").top+5;var r=n.coordsChar({left:n.display.lineDiv.offsetWidth+100,top:t},"div");return{from:e.from(),to:r}})},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(me(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(me(e.lastLine()))},goLineStart:function(t){return t.extendSelectionsBy(function(e){return Va(t,e.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(t){return t.extendSelectionsBy(function(e){return qa(t,e.head)},{origin:"+move",bias:1})},goLineEnd:function(t){return t.extendSelectionsBy(function(e){return Ga(t,e.head.line)},{origin:"+move",bias:-1})},goLineRight:function(r){return r.extendSelectionsBy(function(e){var t=r.cursorCoords(e.head,"div").top+5;return r.coordsChar({left:r.display.lineDiv.offsetWidth+100,top:t},"div")},V)},goLineLeft:function(r){return r.extendSelectionsBy(function(e){var t=r.cursorCoords(e.head,"div").top+5;return r.coordsChar({left:0,top:t},"div")},V)},goLineLeftSmart:function(n){return n.extendSelectionsBy(function(e){var t=n.cursorCoords(e.head,"div").top+5;var r=n.coordsChar({left:0,top:t},"div");if(r.ch<n.getLine(r.line).search(/\S/)){return qa(n,e.head)}return r},V)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"char")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("\t")},insertSoftTab:function(e){var t=[],r=e.listSelections(),n=e.options.tabSize;for(var i=0;i<r.length;i++){var o=r[i].from();var a=_(e.getLine(o.line),o.ch,n);t.push(Y(n-a%n))}e.replaceSelections(t)},defaultTab:function(e){if(e.somethingSelected()){e.indentSelection("add")}else{e.execCommand("insertTab")}},transposeChars:function(a){return Ai(a,function(){var e=a.listSelections(),t=[];for(var r=0;r<e.length;r++){if(!e[r].empty()){continue}var n=e[r].head,i=ue(a.doc,n.line).text;if(i){if(n.ch==i.length){n=new me(n.line,n.ch-1)}if(n.ch>0){n=new me(n.line,n.ch+1);a.replaceRange(i.charAt(n.ch-1)+i.charAt(n.ch-2),me(n.line,n.ch-2),n,"+transpose")}else if(n.line>a.doc.first){var o=ue(a.doc,n.line-1).text;if(o){n=new me(n.line,1);a.replaceRange(i.charAt(0)+a.doc.lineSeparator()+o.charAt(o.length-1),me(n.line-1,o.length-1),n,"+transpose")}}}t.push(new ro(n,n))}a.setSelections(t)})},newlineAndIndent:function(n){return Ai(n,function(){var e=n.listSelections();for(var t=e.length-1;t>=0;t--){n.replaceRange(n.doc.lineSeparator(),e[t].anchor,e[t].head,"+input")}e=n.listSelections();for(var r=0;r<e.length;r++){n.indentLine(e[r].from().line,null,true)}ri(n)})},openLine:function(e){return e.replaceSelection("\n","start")},toggleOverwrite:function(e){return e.toggleOverwrite()}};function Va(e,t){var r=ue(e.doc,t);var n=Xe(r);if(n!=r){t=de(n)}return ht(true,e,n,t,1)}function Ga(e,t){var r=ue(e.doc,t);var n=Je(r);if(n!=r){t=de(n)}return ht(true,e,r,t,-1)}function qa(e,t){var r=Va(e,t.line);var n=ue(e.doc,r.line);var i=ut(n,e.doc.direction);if(!i||i[0].level==0){var o=Math.max(0,n.text.search(/\S/));var a=t.line==r.line&&t.ch<=o&&t.ch;return me(r.line,a?0:o,r.sticky)}return r}function Ya(e,t,r){if(typeof t=="string"){t=Ua[t];if(!t){return false}}e.display.input.ensurePolled();var n=e.display.shift,i=false;try{if(e.isReadOnly()){e.state.suppressEdits=true}if(r){e.display.shift=false}i=t(e)!=j}finally{e.display.shift=n;e.state.suppressEdits=false}return i}function Xa(e,t,r){for(var n=0;n<e.state.keyMaps.length;n++){var i=_a(t,e.state.keyMaps[n],r,e);if(i){return i}}return e.options.extraKeys&&_a(t,e.options.extraKeys,r,e)||_a(t,e.options.keyMap,r,e)}var Ja=new W;function Za(e,t,r,n){var i=e.state.keySeq;if(i){if(Wa(t)){return"handled"}Ja.set(50,function(){if(e.state.keySeq==i){e.state.keySeq=null;e.display.input.reset()}});t=i+" "+t}var o=Xa(e,t,n);if(o=="multi"){e.state.keySeq=t}if(o=="handled"){Nr(e,"keyHandled",e,t,r)}if(o=="handled"||o=="multi"){xt(r);zn(e)}if(i&&!o&&/\'$/.test(t)){xt(r);return true}return!!o}function $a(t,e){var r=za(e,true);if(!r){return false}if(e.shiftKey&&!t.state.keySeq){return Za(t,"Shift-"+r,e,function(e){return Ya(t,e,true)})||Za(t,r,e,function(e){if(typeof e=="string"?/^go[A-Z]/.test(e):e.motion){return Ya(t,e)}})}else{return Za(t,r,e,function(e){return Ya(t,e)})}}function Qa(t,e,r){return Za(t,"'"+r+"'",e,function(e){return Ya(t,e,true)})}var es=null;function ts(e){var t=this;t.curOp.focus=I();if(bt(t,e)){return}if(k&&C<11&&e.keyCode==27){e.returnValue=false}var r=e.keyCode;t.display.shift=r==16||e.shiftKey;var n=$a(t,e);if(m){es=n?r:null;if(!n&&r==88&&!Dt&&(y?e.metaKey:e.ctrlKey)){t.replaceSelection("",null,"cut")}}if(r==18&&!/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)){rs(t)}}function rs(e){var t=e.display.lineDiv;P(t,"CodeMirror-crosshair");function r(e){if(e.keyCode==18||!e.altKey){L(t,"CodeMirror-crosshair");mt(document,"keyup",r);mt(document,"mouseover",r)}}vt(document,"keyup",r);vt(document,"mouseover",r)}function ns(e){if(e.keyCode==16){this.doc.sel.shift=false}bt(this,e)}function is(e){var t=this;if(Gr(t.display,e)||bt(t,e)||e.ctrlKey&&!e.altKey||y&&e.metaKey){return}var r=e.keyCode,n=e.charCode;if(m&&r==es){es=null;xt(e);return}if(m&&(!e.which||e.which<10)&&$a(t,e)){return}var i=String.fromCharCode(n==null?r:n);if(i=="\b"){return}if(Qa(t,e,i)){return}t.display.input.onKeyPress(e)}var os=400;var as=function(e,t,r){this.time=e;this.pos=t;this.button=r};as.prototype.compare=function(e,t,r){return this.time+os>e&&ye(t,this.pos)==0&&r==this.button};var ss;var ls;function us(e,t){var r=+new Date;if(ls&&ls.compare(r,e,t)){ss=ls=null;return"triple"}else if(ss&&ss.compare(r,e,t)){ls=new as(r,e,t);ss=null;return"double"}else{ss=new as(r,e,t);ls=null;return"single"}}function cs(e){var t=this,r=t.display;if(bt(t,e)||r.activeTouch&&r.input.supportsTouch()){return}r.input.ensurePolled();r.shift=e.shiftKey;if(Gr(r,e)){if(!g){r.scroller.draggable=false;setTimeout(function(){return r.scroller.draggable=true},100)}return}if(ys(t,e)){return}var n=Rn(t,e),i=Tt(e),o=n?us(n,i):"single";window.focus();if(i==1&&t.state.selectingText){t.state.selectingText(e)}if(n&&fs(t,i,n,o,e)){return}if(i==1){if(n){ds(t,n,o,e)}else if(Mt(e)==r.scroller){xt(e)}}else if(i==2){if(n){Po(t.doc,n)}setTimeout(function(){return r.input.focus()},20)}else if(i==3){if(x){bs(t,e)}else{Kn(t)}}}function fs(r,e,n,t,i){var o="Click";if(t=="double"){o="Double"+o}else if(t=="triple"){o="Triple"+o}o=(e==1?"Left":e==2?"Middle":"Right")+o;return Za(r,Fa(o,i),i,function(e){if(typeof e=="string"){e=Ua[e]}if(!e){return false}var t=false;try{if(r.isReadOnly()){r.state.suppressEdits=true}t=e(r,n)!=j}finally{r.state.suppressEdits=false}return t})}function hs(e,t,r){var n=e.getOption("configureMouse");var i=n?n(e,t,r):{};if(i.unit==null){var o=d?r.shiftKey&&r.metaKey:r.altKey;i.unit=o?"rectangle":t=="single"?"char":t=="double"?"word":"line"}if(i.extend==null||e.doc.extend){i.extend=e.doc.extend||r.shiftKey}if(i.addNew==null){i.addNew=y?r.metaKey:r.ctrlKey}if(i.moveOnDrag==null){i.moveOnDrag=!(y?r.altKey:r.ctrlKey)}return i}function ds(e,t,r,n){if(k){setTimeout(D(jn,e),0)}else{e.curOp.focus=I()}var i=hs(e,r,n);var o=e.doc.sel,a;if(e.options.dragDrop&&Ot&&!e.isReadOnly()&&r=="single"&&(a=o.contains(t))>-1&&(ye((a=o.ranges[a]).from(),t)<0||t.xRel>0)&&(ye(a.to(),t)>0||t.xRel<0)){ps(e,n,t,i)}else{gs(e,n,t,i)}}function ps(t,r,n,i){var o=t.display,a=false;var s=Mi(t,function(e){if(g){o.scroller.draggable=false}t.state.draggingText=false;mt(document,"mouseup",s);mt(document,"mousemove",l);mt(o.scroller,"dragstart",u);mt(o.scroller,"drop",s);if(!a){xt(e);if(!i.addNew){Po(t.doc,n,null,null,i.extend)}if(g||k&&C==9){setTimeout(function(){document.body.focus();o.input.focus()},20)}else{o.input.focus()}}});var l=function(e){a=a||Math.abs(r.clientX-e.clientX)+Math.abs(r.clientY-e.clientY)>=10};var u=function(){return a=true};if(g){o.scroller.draggable=true}t.state.draggingText=s;s.copy=!i.moveOnDrag;if(o.scroller.dragDrop){o.scroller.dragDrop()}vt(document,"mouseup",s);vt(document,"mousemove",l);vt(o.scroller,"dragstart",u);vt(o.scroller,"drop",s);Kn(t);setTimeout(function(){return o.input.focus()},20)}function vs(e,t,r){if(r=="char"){return new ro(t,t)}if(r=="word"){return e.findWordAt(t)}if(r=="line"){return new ro(me(t.line,0),Se(e.doc,me(t.line+1,0)))}var n=r(e,t);return new ro(n.from,n.to)}function gs(g,e,m,y){var o=g.display,b=g.doc;xt(e);var w,k,C=b.sel,t=C.ranges;if(y.addNew&&!y.extend){k=b.sel.contains(m);if(k>-1){w=t[k]}else{w=new ro(m,m)}}else{w=b.sel.primary();k=b.sel.primIndex}if(y.unit=="rectangle"){if(!y.addNew){w=new ro(m,m)}m=Rn(g,e,true,true);k=-1}else{var r=vs(g,m,y.unit);if(y.extend){w=Io(w,r.anchor,r.head,y.extend)}else{w=r}}if(!y.addNew){k=0;Wo(b,new to([w],0),U);C=b.sel}else if(k==-1){k=t.length;Wo(b,no(t.concat([w]),k),{scroll:false,origin:"*mouse"})}else if(t.length>1&&t[k].empty()&&y.unit=="char"&&!y.extend){Wo(b,no(t.slice(0,k).concat(t.slice(k+1)),0),{scroll:false,origin:"*mouse"});C=b.sel}else{Bo(b,k,w,U)}var x=m;function a(e){if(ye(x,e)==0){return}x=e;if(y.unit=="rectangle"){var t=[],r=g.options.tabSize;var n=_(ue(b,m.line).text,m.ch,r);var i=_(ue(b,e.line).text,e.ch,r);var o=Math.min(n,i),a=Math.max(n,i);for(var s=Math.min(m.line,e.line),l=Math.min(g.lastLine(),Math.max(m.line,e.line));s<=l;s++){var u=ue(b,s).text,c=G(u,o,r);if(o==a){t.push(new ro(me(s,c),me(s,c)))}else if(u.length>c){t.push(new ro(me(s,c),me(s,G(u,a,r))))}}if(!t.length){t.push(new ro(m,m))}Wo(b,no(C.ranges.slice(0,k).concat(t),k),{origin:"*mouse",scroll:false});g.scrollIntoView(e)}else{var f=w;var h=vs(g,e,y.unit);var d=f.anchor,p;if(ye(h.anchor,d)>0){p=h.head;d=Ce(f.from(),h.anchor)}else{p=h.anchor;d=ke(f.to(),h.head)}var v=C.ranges.slice(0);v[k]=new ro(Se(b,d),p);Wo(b,no(v,k),U)}}var s=o.wrapper.getBoundingClientRect();var l=0;function u(e){var t=++l;var r=Rn(g,e,true,y.unit=="rectangle");if(!r){return}if(ye(r,x)!=0){g.curOp.focus=I();a(r);var n=Yn(o,b);if(r.line>=n.to||r.line<n.from){setTimeout(Mi(g,function(){if(l==t){u(e)}}),150)}}else{var i=e.clientY<s.top?-20:e.clientY>s.bottom?20:0;if(i){setTimeout(Mi(g,function(){if(l!=t){return}o.scroller.scrollTop+=i;u(e)}),50)}}}function n(e){g.state.selectingText=false;l=Infinity;xt(e);o.input.focus();mt(document,"mousemove",i);mt(document,"mouseup",c);b.history.lastSelOrigin=null}var i=Mi(g,function(e){if(!Tt(e)){n(e)}else{u(e)}});var c=Mi(g,n);g.state.selectingText=c;vt(document,"mousemove",i);vt(document,"mouseup",c)}function ms(e,t,r,n){var i,o;try{i=t.clientX;o=t.clientY}catch(t){return false}if(i>=Math.floor(e.display.gutters.getBoundingClientRect().right)){return false}if(n){xt(t)}var a=e.display;var s=a.lineDiv.getBoundingClientRect();if(o>s.bottom||!kt(e,r)){return Lt(t)}o-=s.top-a.viewOffset;for(var l=0;l<e.options.gutters.length;++l){var u=a.gutters.childNodes[l];if(u&&u.getBoundingClientRect().right>=i){var c=pe(e.doc,o);var f=e.options.gutters[l];yt(e,r,e,c,f,t);return Lt(t)}}}function ys(e,t){return ms(e,t,"gutterClick",true)}function bs(e,t){if(Gr(e.display,t)||ws(e,t)){return}if(bt(e,t,"contextmenu")){return}e.display.input.onContextMenu(t)}function ws(e,t){if(!kt(e,"gutterContextMenu")){return false}return ms(e,t,"gutterContextMenu",false)}function ks(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-");pn(e)}var Cs={toString:function(){return"CodeMirror.Init"}};var xs={};var Ss={};function Ls(i){var o=i.optionHandlers;function e(e,t,n,r){i.defaults[e]=t;if(n){o[e]=r?function(e,t,r){if(r!=Cs){n(e,t,r)}}:n}}i.defineOption=e;i.Init=Cs;e("value","",function(e,t){return e.setValue(t)},true);e("mode",null,function(e,t){e.doc.modeOption=t;co(e)},true);e("indentUnit",2,co,true);e("indentWithTabs",false);e("smartIndent",true);e("tabSize",4,function(e){fo(e);pn(e);Ei(e)},true);e("lineSeparator",null,function(e,n){e.doc.lineSep=n;if(!n){return}var i=[],o=e.doc.first;e.doc.iter(function(e){for(var t=0;;){var r=e.text.indexOf(n,t);if(r==-1){break}t=r+n.length;i.push(me(o,r))}o++});for(var t=i.length-1;t>=0;t--){ta(e.doc,n,i[t],me(i[t].line,i[t].ch+n.length))}});e("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(e,t,r){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g");if(r!=Cs){e.refresh()}});e("specialCharPlaceholder",yr,function(e){return e.refresh()},true);e("electricChars",true);e("inputStyle",h?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},true);e("spellcheck",false,function(e,t){return e.getInputField().spellcheck=t},true);e("rtlMoveVisually",!p);e("wholeLineUpdateBefore",true);e("theme","default",function(e){ks(e);As(e)},true);e("keyMap","default",function(e,t,r){var n=ja(t);var i=r!=Cs&&ja(r);if(i&&i.detach){i.detach(e,n)}if(n.attach){n.attach(e,i||null)}});e("extraKeys",null);e("configureMouse",null);e("lineWrapping",false,Ts,true);e("gutters",[],function(e){Xi(e.options);As(e)},true);e("fixedGutter",true,function(e,t){e.display.gutters.style.left=t?Nn(e.display)+"px":"0";e.refresh()},true);e("coverGutterNextToScrollbar",false,function(e){return di(e)},true);e("scrollbarStyle","native",function(e){gi(e);di(e);e.display.scrollbars.setScrollTop(e.doc.scrollTop);e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)},true);e("lineNumbers",false,function(e){Xi(e.options);As(e)},true);e("firstLineNumber",1,As,true);e("lineNumberFormatter",function(e){return e},As,true);e("showCursorWhenSelecting",false,Dn,true);e("resetSelectionOnContextMenu",true);e("lineWiseCopyCut",true);e("pasteLinesPerSelection",true);e("readOnly",false,function(e,t){if(t=="nocursor"){Vn(e);e.display.input.blur()}e.display.input.readOnlyChanged(t)});e("disableInput",false,function(e,t){if(!t){e.display.input.reset()}},true);e("dragDrop",true,Ms);e("allowDropFileTypes",null);e("cursorBlinkRate",530);e("cursorScrollMargin",0);e("cursorHeight",1,Dn,true);e("singleCursorHeightPerLine",true,Dn,true);e("workTime",100);e("workDelay",100);e("flattenSpans",true,fo,true);e("addModeClass",false,fo,true);e("pollInterval",100);e("undoDepth",200,function(e,t){return e.doc.history.undoDepth=t});e("historyEventDelay",1250);e("viewportMargin",10,function(e){return e.refresh()},true);e("maxHighlightLength",1e4,fo,true);e("moveInputWithCursor",true,function(e,t){if(!t){e.display.input.resetPosition()}});e("tabindex",null,function(e,t){return e.display.input.getField().tabIndex=t||""});e("autofocus",null);e("direction","ltr",function(e,t){return e.doc.setDirection(t)},true)}function As(e){Yi(e);Ei(e);Xn(e)}function Ms(e,t,r){var n=r&&r!=Cs;if(!t!=!n){var i=e.display.dragFunctions;var o=t?vt:mt;o(e.display.scroller,"dragstart",i.start);o(e.display.scroller,"dragenter",i.enter);o(e.display.scroller,"dragover",i.over);o(e.display.scroller,"dragleave",i.leave);o(e.display.scroller,"drop",i.drop)}}function Ts(e){if(e.options.lineWrapping){P(e.display.wrapper,"CodeMirror-wrap");e.display.sizer.style.minWidth="";e.display.sizerWidth=null}else{L(e.display.wrapper,"CodeMirror-wrap");it(e)}Pn(e);Ei(e);pn(e);setTimeout(function(){return di(e)},100)}function Os(e,t){var r=this;if(!(this instanceof Os)){return new Os(e,t)}this.options=t=t?H(t):{};H(xs,t,false);Xi(t);var n=t.value;if(typeof n=="string"){n=new wa(n,t.mode,null,t.lineSeparator,t.direction)}this.doc=n;var i=new Os.inputStyles[t.inputStyle](this);var o=this.display=new le(e,n,i);o.wrapper.CodeMirror=this;Yi(this);ks(this);if(t.lineWrapping){this.display.wrapper.className+=" CodeMirror-wrap"}gi(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:false,delayingBlurEvent:false,focused:false,suppressEdits:false,pasteIncoming:false,cutIncoming:false,selectingText:false,draggingText:false,highlight:new W,keySeq:null,specialChars:null};if(t.autofocus&&!h){o.input.focus()}if(k&&C<11){setTimeout(function(){return r.display.input.reset(true)},20)}Es(this);Ta();yi(this);this.curOp.forceUpdate=true;go(this,n);if(t.autofocus&&!h||this.hasFocus()){setTimeout(D(Un,this),20)}else{Vn(this)}for(var a in Ss){if(Ss.hasOwnProperty(a)){Ss[a](r,t[a],Cs)}}Jn(this);if(t.finishInit){t.finishInit(this)}for(var s=0;s<Ns.length;++s){Ns[s](r)}bi(this);if(g&&t.lineWrapping&&getComputedStyle(o.lineDiv).textRendering=="optimizelegibility"){o.lineDiv.style.textRendering="auto"}}Os.defaults=xs;Os.optionHandlers=Ss;function Es(i){var o=i.display;vt(o.scroller,"mousedown",Mi(i,cs));if(k&&C<11){vt(o.scroller,"dblclick",Mi(i,function(e){if(bt(i,e)){return}var t=Rn(i,e);if(!t||ys(i,e)||Gr(i.display,e)){return}xt(e);var r=i.findWordAt(t);Po(i.doc,r.anchor,r.head)}))}else{vt(o.scroller,"dblclick",function(e){return bt(i,e)||xt(e)})}if(!x){vt(o.scroller,"contextmenu",function(e){return bs(i,e)})}var r,n={end:0};function a(){if(o.activeTouch){r=setTimeout(function(){return o.activeTouch=null},1e3);n=o.activeTouch;n.end=+new Date}}function s(e){if(e.touches.length!=1){return false}var t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}function l(e,t){if(t.left==null){return true}var r=t.left-e.left,n=t.top-e.top;return r*r+n*n>20*20}vt(o.scroller,"touchstart",function(e){if(!bt(i,e)&&!s(e)){o.input.ensurePolled();clearTimeout(r);var t=+new Date;o.activeTouch={start:t,moved:false,prev:t-n.end<=300?n:null};if(e.touches.length==1){o.activeTouch.left=e.touches[0].pageX;o.activeTouch.top=e.touches[0].pageY}}});vt(o.scroller,"touchmove",function(){if(o.activeTouch){o.activeTouch.moved=true}});vt(o.scroller,"touchend",function(e){var t=o.activeTouch;if(t&&!Gr(o,e)&&t.left!=null&&!t.moved&&new Date-t.start<300){var r=i.coordsChar(o.activeTouch,"page"),n;if(!t.prev||l(t,t.prev)){n=new ro(r,r)}else if(!t.prev.prev||l(t,t.prev.prev)){n=i.findWordAt(r)}else{n=new ro(me(r.line,0),Se(i.doc,me(r.line+1,0)))}i.setSelection(n.anchor,n.head);i.focus();xt(e)}a()});vt(o.scroller,"touchcancel",a);vt(o.scroller,"scroll",function(){if(o.scroller.clientHeight){si(i,o.scroller.scrollTop);ui(i,o.scroller.scrollLeft,true);yt(i,"scroll",i)}});vt(o.scroller,"mousewheel",function(e){return eo(i,e)});vt(o.scroller,"DOMMouseScroll",function(e){return eo(i,e)});vt(o.wrapper,"scroll",function(){return o.wrapper.scrollTop=o.wrapper.scrollLeft=0});o.dragFunctions={enter:function(e){if(!bt(i,e)){At(e)}},over:function(e){if(!bt(i,e)){Sa(i,e);At(e)}},start:function(e){return xa(i,e)},drop:Mi(i,Ca),leave:function(e){if(!bt(i,e)){La(i)}}};var e=o.input.getField();vt(e,"keyup",function(e){return ns.call(i,e)});vt(e,"keydown",Mi(i,ts));vt(e,"keypress",Mi(i,is));vt(e,"focus",function(e){return Un(i,e)});vt(e,"blur",function(e){return Vn(i,e)})}var Ns=[];Os.defineInitHook=function(e){return Ns.push(e)};function Is(e,t,r,n){var i=e.doc,o;if(r==null){r="add"}if(r=="smart"){if(!i.mode.indent){r="prev"}else{o=tr(e,t).state}}var a=e.options.tabSize;var s=ue(i,t),l=_(s.text,null,a);if(s.stateAfter){s.stateAfter=null}var u=s.text.match(/^\s*/)[0],c;if(!n&&!/\S/.test(s.text)){c=0;r="not"}else if(r=="smart"){c=i.mode.indent(o,s.text.slice(u.length),s.text);if(c==j||c>150){if(!n){return}r="prev"}}if(r=="prev"){if(t>i.first){c=_(ue(i,t-1).text,null,a)}else{c=0}}else if(r=="add"){c=l+e.options.indentUnit}else if(r=="subtract"){c=l-e.options.indentUnit}else if(typeof r=="number"){c=l+r}c=Math.max(0,c);var f="",h=0;if(e.options.indentWithTabs){for(var d=Math.floor(c/a);d;--d){h+=a;f+="\t"}}if(h<c){f+=Y(c-h)}if(f!=u){ta(i,f,me(t,0),me(t,u.length),"+input");s.stateAfter=null;return true}else{for(var p=0;p<i.sel.ranges.length;p++){var v=i.sel.ranges[p];if(v.head.line==t&&v.head.ch<u.length){var g=me(t,u.length);Bo(i,p,new ro(g,g));break}}}}var Ps=null;function Rs(e){Ps=e}function Bs(e,t,r,n,i){var o=e.doc;e.display.shift=false;if(!n){n=o.sel}var a=e.state.pasteIncoming||i=="paste";var s=Rt(t),l=null;if(a&&n.ranges.length>1){if(Ps&&Ps.text.join("\n")==t){if(n.ranges.length%Ps.text.length==0){l=[];for(var u=0;u<Ps.text.length;u++){l.push(o.splitLines(Ps.text[u]))}}}else if(s.length==n.ranges.length&&e.options.pasteLinesPerSelection){l=J(s,function(e){return[e]})}}var c;for(var f=n.ranges.length-1;f>=0;f--){var h=n.ranges[f];var d=h.from(),p=h.to();if(h.empty()){if(r&&r>0){d=me(d.line,d.ch-r)}else if(e.state.overwrite&&!a){p=me(p.line,Math.min(ue(o,p.line).text.length,p.ch+X(s).length))}else if(Ps&&Ps.lineWise&&Ps.text.join("\n")==t){d=p=me(d.line,0)}}c=e.curOp.updateInput;var v={from:d,to:p,text:l?l[f%l.length]:s,origin:i||(a?"paste":e.state.cutIncoming?"cut":"+input")};Xo(e.doc,v);Nr(e,"inputRead",e,v)}if(t&&!a){Hs(e,t)}ri(e);e.curOp.updateInput=c;e.curOp.typing=true;e.state.pasteIncoming=e.state.cutIncoming=false}function Ds(e,t){var r=e.clipboardData&&e.clipboardData.getData("Text");if(r){e.preventDefault();if(!t.isReadOnly()&&!t.options.disableInput){Ai(t,function(){return Bs(t,r,0,null,"paste")})}return true}}function Hs(e,t){if(!e.options.electricChars||!e.options.smartIndent){return}var r=e.doc.sel;for(var n=r.ranges.length-1;n>=0;n--){var i=r.ranges[n];if(i.head.ch>100||n&&r.ranges[n-1].head.line==i.head.line){continue}var o=e.getModeAt(i.head);var a=false;if(o.electricChars){for(var s=0;s<o.electricChars.length;s++){if(t.indexOf(o.electricChars.charAt(s))>-1){a=Is(e,i.head.line,"smart");break}}}else if(o.electricInput){if(o.electricInput.test(ue(e.doc,i.head.line).text.slice(0,i.head.ch))){a=Is(e,i.head.line,"smart")}}if(a){Nr(e,"electricInput",e,i.head.line)}}}function _s(e){var t=[],r=[];for(var n=0;n<e.doc.sel.ranges.length;n++){var i=e.doc.sel.ranges[n].head.line;var o={anchor:me(i,0),head:me(i+1,0)};r.push(o);t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:r}}function Ws(e,t){e.setAttribute("autocorrect","off");e.setAttribute("autocapitalize","off");e.setAttribute("spellcheck",!!t)}function Fs(){var e=T("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none");var t=T("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");if(g){e.style.width="1000px"}else{e.setAttribute("wrap","off")}if(c){e.style.border="1px solid black"}Ws(e);return t}var zs=function(i){var o=i.optionHandlers;var c=i.helpers={};i.prototype={constructor:i,focus:function(){window.focus();this.display.input.focus()},setOption:function(e,t){var r=this.options,n=r[e];if(r[e]==t&&e!="mode"){return}r[e]=t;if(o.hasOwnProperty(e)){Mi(this,o[e])(this,t,n)}yt(this,"optionChange",this,e)},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](ja(e))},removeKeyMap:function(e){var t=this.state.keyMaps;for(var r=0;r<t.length;++r){if(t[r]==e||t[r].name==e){t.splice(r,1);return true}}},addOverlay:Ti(function(e,t){var r=e.token?e:i.getMode(this.options,e);if(r.startState){throw new Error("Overlays may not be stateful.")}Z(this.state.overlays,{mode:r,modeSpec:e,opaque:t&&t.opaque,priority:t&&t.priority||0},function(e){return e.priority});this.state.modeGen++;Ei(this)}),removeOverlay:Ti(function(e){var t=this;var r=this.state.overlays;for(var n=0;n<r.length;++n){var i=r[n].modeSpec;if(i==e||typeof e=="string"&&i.name==e){r.splice(n,1);t.state.modeGen++;Ei(t);return}}}),indentLine:Ti(function(e,t,r){if(typeof t!="string"&&typeof t!="number"){if(t==null){t=this.options.smartIndent?"smart":"prev"}else{t=t?"add":"subtract"}}if(ve(this.doc,e)){Is(this,e,t,r)}}),indentSelection:Ti(function(e){var t=this;var r=this.doc.sel.ranges,n=-1;for(var i=0;i<r.length;i++){var o=r[i];if(!o.empty()){var a=o.from(),s=o.to();var l=Math.max(n,a.line);n=Math.min(t.lastLine(),s.line-(s.ch?0:1))+1;for(var u=l;u<n;++u){Is(t,u,e)}var c=t.doc.sel.ranges;if(a.ch==0&&r.length==c.length&&c[i].from().ch>0){Bo(t.doc,i,new ro(a,c[i].to()),K)}}else if(o.head.line>n){Is(t,o.head.line,e,true);n=o.head.line;if(i==t.doc.sel.primIndex){ri(t)}}}}),getTokenAt:function(e,t){return ar(this,e,t)},getLineTokens:function(e,t){return ar(this,me(e),t,true)},getTokenTypeAt:function(e){e=Se(this.doc,e);var t=er(this,ue(this.doc,e.line));var r=0,n=(t.length-1)/2,i=e.ch;var o;if(i==0){o=t[2]}else{for(;;){var a=r+n>>1;if((a?t[a*2-1]:0)>=i){n=a}else if(t[a*2+1]<i){r=a+1}else{o=t[a*2+2];break}}}var s=o?o.indexOf("overlay "):-1;return s<0?o:s==0?null:o.slice(0,s-1)},getModeAt:function(e){var t=this.doc.mode;if(!t.innerMode){return t}return i.innerMode(t,this.getTokenAt(e).state).mode},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var r=this;var n=[];if(!c.hasOwnProperty(t)){return n}var i=c[t],o=this.getModeAt(e);if(typeof o[t]=="string"){if(i[o[t]]){n.push(i[o[t]])}}else if(o[t]){for(var a=0;a<o[t].length;a++){var s=i[o[t][a]];if(s){n.push(s)}}}else if(o.helperType&&i[o.helperType]){n.push(i[o.helperType])}else if(i[o.name]){n.push(i[o.name])}for(var l=0;l<i._global.length;l++){var u=i._global[l];if(u.pred(o,r)&&F(n,u.val)==-1){n.push(u.val)}}return n},getStateAfter:function(e,t){var r=this.doc;e=xe(r,e==null?r.first+r.size-1:e);return tr(this,e+1,t).state},cursorCoords:function(e,t){var r,n=this.doc.sel.primary();if(e==null){r=n.head}else if(typeof e=="object"){r=Se(this.doc,e)}else{r=e?n.from():n.to()}return wn(this,r,t||"page")},charCoords:function(e,t){return bn(this,Se(this.doc,e),t||"page")},coordsChar:function(e,t){e=yn(this,e,t||"page");return xn(this,e.left,e.top)},lineAtHeight:function(e,t){e=yn(this,{top:e,left:0},t||"page").top;return pe(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,r){var n=false,i;if(typeof e=="number"){var o=this.doc.first+this.doc.size-1;if(e<this.doc.first){e=this.doc.first}else if(e>o){e=o;n=true}i=ue(this.doc,e)}else{i=e}return mn(this,i,{top:0,left:0},t||"page",r||n).top+(n?this.doc.height-rt(i):0)},defaultTextHeight:function(){return Tn(this.display)},defaultCharWidth:function(){return On(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,r,n,i){var o=this.display;e=wn(this,Se(this.doc,e));var a=e.bottom,s=e.left;t.style.position="absolute";t.setAttribute("cm-ignore-events","true");this.display.input.setUneditable(t);o.sizer.appendChild(t);if(n=="over"){a=e.top}else if(n=="above"||n=="near"){var l=Math.max(o.wrapper.clientHeight,this.doc.height),u=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);if((n=="above"||e.bottom+t.offsetHeight>l)&&e.top>t.offsetHeight){a=e.top-t.offsetHeight}else if(e.bottom+t.offsetHeight<=l){a=e.bottom}if(s+t.offsetWidth>u){s=u-t.offsetWidth}}t.style.top=a+"px";t.style.left=t.style.right="";if(i=="right"){s=o.sizer.clientWidth-t.offsetWidth;t.style.right="0px"}else{if(i=="left"){s=0}else if(i=="middle"){s=(o.sizer.clientWidth-t.offsetWidth)/2}t.style.left=s+"px"}if(r){Qn(this,{left:s,top:a,right:s+t.offsetWidth,bottom:a+t.offsetHeight})}},triggerOnKeyDown:Ti(ts),triggerOnKeyPress:Ti(is),triggerOnKeyUp:ns,triggerOnMouseDown:Ti(cs),execCommand:function(e){if(Ua.hasOwnProperty(e)){return Ua[e].call(null,this)}},triggerElectric:Ti(function(e){Hs(this,e)}),findPosH:function(e,t,r,n){var i=this;var o=1;if(t<0){o=-1;t=-t}var a=Se(this.doc,e);for(var s=0;s<t;++s){a=js(i.doc,a,o,r,n);if(a.hitSide){break}}return a},moveH:Ti(function(t,r){var n=this;this.extendSelectionsBy(function(e){if(n.display.shift||n.doc.extend||e.empty()){return js(n.doc,e.head,t,r,n.options.rtlMoveVisually)}else{return t<0?e.from():e.to()}},V)}),deleteH:Ti(function(r,n){var e=this.doc.sel,i=this.doc;if(e.somethingSelected()){i.replaceSelection("",null,"+delete")}else{Ka(this,function(e){var t=js(i,e.head,r,n,false);return r<0?{from:t,to:e.head}:{from:e.head,to:t}})}}),findPosV:function(e,t,r,n){var i=this;var o=1,a=n;if(t<0){o=-1;t=-t}var s=Se(this.doc,e);for(var l=0;l<t;++l){var u=wn(i,s,"div");if(a==null){a=u.left}else{u.left=a}s=Ks(i,u,o,r);if(s.hitSide){break}}return s},moveV:Ti(function(n,i){var o=this;var a=this.doc,s=[];var l=!this.display.shift&&!a.extend&&a.sel.somethingSelected();a.extendSelectionsBy(function(e){if(l){return n<0?e.from():e.to()}var t=wn(o,e.head,"div");if(e.goalColumn!=null){t.left=e.goalColumn}s.push(t.left);var r=Ks(o,t,n,i);if(i=="page"&&e==a.sel.primary()){ti(o,bn(o,r,"div").top-t.top)}return r},V);if(s.length){for(var e=0;e<a.sel.ranges.length;e++){a.sel.ranges[e].goalColumn=s[e]}}}),findWordAt:function(e){var t=this.doc,r=ue(t,e.line).text;var n=e.ch,i=e.ch;if(r){var o=this.getHelper(e,"wordChars");if((e.sticky=="before"||i==r.length)&&n){--n}else{++i}var a=r.charAt(n);var s=re(a,o)?function(e){return re(e,o)}:/\s/.test(a)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!re(e)};while(n>0&&s(r.charAt(n-1))){--n}while(i<r.length&&s(r.charAt(i))){++i}}return new ro(me(e.line,n),me(e.line,i))},toggleOverwrite:function(e){if(e!=null&&e==this.state.overwrite){return}if(this.state.overwrite=!this.state.overwrite){P(this.display.cursorDiv,"CodeMirror-overwrite")}else{L(this.display.cursorDiv,"CodeMirror-overwrite")}yt(this,"overwriteToggle",this,this.state.overwrite)},hasFocus:function(){return this.display.input.getField()==I()},isReadOnly:function(){return!!(this.options.readOnly||this.doc.cantEdit)},scrollTo:Ti(function(e,t){ni(this,e,t)}),getScrollInfo:function(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-Jr(this)-this.display.barHeight,width:e.scrollWidth-Jr(this)-this.display.barWidth,clientHeight:$r(this),clientWidth:Zr(this)}},scrollIntoView:Ti(function(e,t){if(e==null){e={from:this.doc.sel.primary().head,to:null};if(t==null){t=this.options.cursorScrollMargin}}else if(typeof e=="number"){e={from:me(e,0),to:null}}else if(e.from==null){e={from:e,to:null}}if(!e.to){e.to=e.from}e.margin=t||0;if(e.from.line!=null){ii(this,e)}else{ai(this,e.from,e.to,e.margin)}}),setSize:Ti(function(e,t){var r=this;var n=function(e){return typeof e=="number"||/^\d+$/.test(String(e))?e+"px":e};if(e!=null){this.display.wrapper.style.width=n(e)}if(t!=null){this.display.wrapper.style.height=n(t)}if(this.options.lineWrapping){dn(this)}var i=this.display.viewFrom;this.doc.iter(i,this.display.viewTo,function(e){if(e.widgets){for(var t=0;t<e.widgets.length;t++){if(e.widgets[t].noHScroll){Ni(r,i,"widget");break}}}++i});this.curOp.forceUpdate=true;yt(this,"refresh",this)}),operation:function(e){return Ai(this,e)},startOperation:function(){return yi(this)},endOperation:function(){return bi(this)},refresh:Ti(function(){var e=this.display.cachedTextHeight;Ei(this);this.curOp.forceUpdate=true;pn(this);ni(this,this.doc.scrollLeft,this.doc.scrollTop);Gi(this);if(e==null||Math.abs(e-Tn(this.display))>.5){Pn(this)}yt(this,"refresh",this)}),swapDoc:Ti(function(e){var t=this.doc;t.cm=null;go(this,e);pn(this);this.display.input.reset();ni(this,e.scrollLeft,e.scrollTop);this.curOp.forceScroll=true;Nr(this,"swapDoc",this,t);return t}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};Ct(i);i.registerHelper=function(e,t,r){if(!c.hasOwnProperty(e)){c[e]=i[e]={_global:[]}}c[e][t]=r};i.registerGlobalHelper=function(e,t,r,n){i.registerHelper(e,t,n);c[e]._global.push({pred:r,val:n})}};function js(r,n,i,e,o){var t=n;var a=i;var s=ue(r,n.line);function l(){var e=n.line+i;if(e<r.first||e>=r.first+r.size){return false}n=new me(e,n.ch,n.sticky);return s=ue(r,e)}function u(e){var t;if(o){t=dt(r.cm,s,n,i)}else{t=ft(s,n,i)}if(t==null){if(!e&&l()){n=ht(o,r.cm,s,n.line,i)}else{return false}}else{n=t}return true}if(e=="char"){u()}else if(e=="column"){u(true)}else if(e=="word"||e=="group"){var c=null,f=e=="group";var h=r.cm&&r.cm.getHelper(n,"wordChars");for(var d=true;;d=false){if(i<0&&!u(!d)){break}var p=s.text.charAt(n.ch)||"\n";var v=re(p,h)?"w":f&&p=="\n"?"n":!f||/\s/.test(p)?null:"p";if(f&&!d&&!v){v="s"}if(c&&c!=v){if(i<0){i=1;u();n.sticky="after"}break}if(v){c=v}if(i>0&&!u(!d)){break}}}var g=Vo(r,n,t,a,true);if(be(t,g)){g.hitSide=true}return g}function Ks(e,t,r,n){var i=e.doc,o=t.left,a;if(n=="page"){var s=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);var l=Math.max(s-.5*Tn(e.display),3);a=(r>0?t.bottom:t.top)+r*l}else if(n=="line"){a=r>0?t.bottom+3:t.top-3}var u;for(;;){u=xn(e,o,a);if(!u.outside){break}if(r<0?a<=0:a>=i.height){u.hitSide=true;break}a+=r*5}return u}var Us=function(e){this.cm=e;this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new W;this.composing=null;this.gracePeriod=false;this.readDOMTimeout=null};Us.prototype.init=function(e){var t=this;var a=this,s=a.cm;var l=a.div=e.lineDiv;Ws(l,s.options.spellcheck);vt(l,"paste",function(e){if(bt(s,e)||Ds(e,s)){return}if(C<=11){setTimeout(Mi(s,function(){return t.updateFromDOM()}),20)}});vt(l,"compositionstart",function(e){t.composing={data:e.data,done:false}});vt(l,"compositionupdate",function(e){if(!t.composing){t.composing={data:e.data,done:false}}});vt(l,"compositionend",function(e){if(t.composing){if(e.data!=t.composing.data){t.readFromDOMSoon()}t.composing.done=true}});vt(l,"touchstart",function(){return a.forceCompositionEnd()});vt(l,"input",function(){if(!t.composing){t.readFromDOMSoon()}});function r(e){if(bt(s,e)){return}if(s.somethingSelected()){Rs({lineWise:false,text:s.getSelections()});if(e.type=="cut"){s.replaceSelection("",null,"cut")}}else if(!s.options.lineWiseCopyCut){return}else{var t=_s(s);Rs({lineWise:true,text:t.text});if(e.type=="cut"){s.operation(function(){s.setSelections(t.ranges,0,K);s.replaceSelection("",null,"cut")})}}if(e.clipboardData){e.clipboardData.clearData();var r=Ps.text.join("\n");e.clipboardData.setData("Text",r);if(e.clipboardData.getData("Text")==r){e.preventDefault();return}}var n=Fs(),i=n.firstChild;s.display.lineSpace.insertBefore(n,s.display.lineSpace.firstChild);i.value=Ps.text.join("\n");var o=document.activeElement;B(i);setTimeout(function(){s.display.lineSpace.removeChild(n);o.focus();if(o==l){a.showPrimarySelection()}},50)}vt(l,"copy",r);vt(l,"cut",r)};Us.prototype.prepareSelection=function(){var e=Hn(this.cm,false);e.focus=this.cm.state.focused;return e};Us.prototype.showSelection=function(e,t){if(!e||!this.cm.display.view.length){return}if(e.focus||t){this.showPrimarySelection()}this.showMultipleSelections(e)};Us.prototype.showPrimarySelection=function(){var e=window.getSelection(),t=this.cm,r=t.doc.sel.primary();var n=r.from(),i=r.to();if(t.display.viewTo==t.display.viewFrom||n.line>=t.display.viewTo||i.line<t.display.viewFrom){e.removeAllRanges();return}var o=Xs(t,e.anchorNode,e.anchorOffset);var a=Xs(t,e.focusNode,e.focusOffset);if(o&&!o.bad&&a&&!a.bad&&ye(Ce(o,a),n)==0&&ye(ke(o,a),i)==0){return}var s=t.display.view;var l=n.line>=t.display.viewFrom&&Vs(t,n)||{node:s[0].measure.map[2],offset:0};var u=i.line<t.display.viewTo&&Vs(t,i);if(!u){var c=s[s.length-1].measure;var f=c.maps?c.maps[c.maps.length-1]:c.map;u={node:f[f.length-1],offset:f[f.length-2]-f[f.length-3]}}if(!l||!u){e.removeAllRanges();return}var h=e.rangeCount&&e.getRangeAt(0),d;try{d=E(l.node,l.offset,u.offset,u.node)}catch(e){}if(d){if(!v&&t.state.focused){e.collapse(l.node,l.offset);if(!d.collapsed){e.removeAllRanges();e.addRange(d)}}else{e.removeAllRanges();e.addRange(d)}if(h&&e.anchorNode==null){e.addRange(h)}else if(v){this.startGracePeriod()}}this.rememberSelection()};Us.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod);this.gracePeriod=setTimeout(function(){e.gracePeriod=false;if(e.selectionChanged()){e.cm.operation(function(){return e.cm.curOp.selectionChanged=true})}},20)};Us.prototype.showMultipleSelections=function(e){M(this.cm.display.cursorDiv,e.cursors);M(this.cm.display.selectionDiv,e.selection)};Us.prototype.rememberSelection=function(){var e=window.getSelection();this.lastAnchorNode=e.anchorNode;this.lastAnchorOffset=e.anchorOffset;this.lastFocusNode=e.focusNode;this.lastFocusOffset=e.focusOffset};Us.prototype.selectionInEditor=function(){var e=window.getSelection();if(!e.rangeCount){return false}var t=e.getRangeAt(0).commonAncestorContainer;return N(this.div,t)};Us.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"){if(!this.selectionInEditor()){this.showSelection(this.prepareSelection(),true)}this.div.focus()}};Us.prototype.blur=function(){this.div.blur()};Us.prototype.getField=function(){return this.div};Us.prototype.supportsTouch=function(){return true};Us.prototype.receivedFocus=function(){var e=this;if(this.selectionInEditor()){this.pollSelection()}else{Ai(this.cm,function(){return e.cm.curOp.selectionChanged=true})}function t(){if(e.cm.state.focused){e.pollSelection();e.polling.set(e.cm.options.pollInterval,t)}}this.polling.set(this.cm.options.pollInterval,t)};Us.prototype.selectionChanged=function(){var e=window.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset};Us.prototype.pollSelection=function(){if(this.readDOMTimeout!=null||this.gracePeriod||!this.selectionChanged()){return}var e=window.getSelection(),t=this.cm;if(f&&a&&this.cm.options.gutters.length&&Gs(e.anchorNode)){this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs});this.blur();this.focus();return}if(this.composing){return}this.rememberSelection();var r=Xs(t,e.anchorNode,e.anchorOffset);var n=Xs(t,e.focusNode,e.focusOffset);if(r&&n){Ai(t,function(){Wo(t.doc,io(r,n),K);if(r.bad||n.bad){t.curOp.selectionChanged=true}})}};Us.prototype.pollContent=function(){if(this.readDOMTimeout!=null){clearTimeout(this.readDOMTimeout);this.readDOMTimeout=null}var e=this.cm,t=e.display,r=e.doc.sel.primary();var n=r.from(),i=r.to();if(n.ch==0&&n.line>e.firstLine()){n=me(n.line-1,ue(e.doc,n.line-1).length)}if(i.ch==ue(e.doc,i.line).text.length&&i.line<e.lastLine()){i=me(i.line+1,0)}if(n.line<t.viewFrom||i.line>t.viewTo-1){return false}var o,a,s;if(n.line==t.viewFrom||(o=Bn(e,n.line))==0){a=de(t.view[0].line);s=t.view[0].node}else{a=de(t.view[o].line);s=t.view[o-1].node.nextSibling}var l=Bn(e,i.line);var u,c;if(l==t.view.length-1){u=t.viewTo-1;c=t.lineDiv.lastChild}else{u=de(t.view[l+1].line)-1;c=t.view[l+1].node.previousSibling}if(!s){return false}var f=e.doc.splitLines(Ys(e,s,c,a,u));var h=ce(e.doc,me(a,0),me(u,ue(e.doc,u).text.length));while(f.length>1&&h.length>1){if(X(f)==X(h)){f.pop();h.pop();u--}else if(f[0]==h[0]){f.shift();h.shift();a++}else{break}}var d=0,p=0;var v=f[0],g=h[0],m=Math.min(v.length,g.length);while(d<m&&v.charCodeAt(d)==g.charCodeAt(d)){++d}var y=X(f),b=X(h);var w=Math.min(y.length-(f.length==1?d:0),b.length-(h.length==1?d:0));while(p<w&&y.charCodeAt(y.length-p-1)==b.charCodeAt(b.length-p-1)){++p}if(f.length==1&&h.length==1&&a==n.line){while(d&&d>n.ch&&y.charCodeAt(y.length-p-1)==b.charCodeAt(b.length-p-1)){d--;p++}}f[f.length-1]=y.slice(0,y.length-p).replace(/^\u200b+/,"");f[0]=f[0].slice(d).replace(/\u200b+$/,"");var k=me(a,d);var C=me(u,h.length?X(h).length-p:0);if(f.length>1||f[0]||ye(k,C)){ta(e.doc,f,k,C,"+input");return true}};Us.prototype.ensurePolled=function(){this.forceCompositionEnd()};Us.prototype.reset=function(){this.forceCompositionEnd()};Us.prototype.forceCompositionEnd=function(){if(!this.composing){return}clearTimeout(this.readDOMTimeout);this.composing=null;this.updateFromDOM();this.div.blur();this.div.focus()};Us.prototype.readFromDOMSoon=function(){var e=this;if(this.readDOMTimeout!=null){return}this.readDOMTimeout=setTimeout(function(){e.readDOMTimeout=null;if(e.composing){if(e.composing.done){e.composing=null}else{return}}e.updateFromDOM()},80)};Us.prototype.updateFromDOM=function(){var e=this;if(this.cm.isReadOnly()||!this.pollContent()){Ai(this.cm,function(){return Ei(e.cm)})}};Us.prototype.setUneditable=function(e){e.contentEditable="false"};Us.prototype.onKeyPress=function(e){if(e.charCode==0){return}e.preventDefault();if(!this.cm.isReadOnly()){Mi(this.cm,Bs)(this.cm,String.fromCharCode(e.charCode==null?e.keyCode:e.charCode),0)}};Us.prototype.readOnlyChanged=function(e){this.div.contentEditable=String(e!="nocursor")};Us.prototype.onContextMenu=function(){};Us.prototype.resetPosition=function(){};Us.prototype.needsContentAttribute=true;function Vs(e,t){var r=nn(e,t.line);if(!r||r.hidden){return null}var n=ue(e.doc,t.line);var i=en(r,n,t.line);var o=ut(n,e.doc.direction),a="left";if(o){var s=st(o,t.ch);a=s%2?"right":"left"}var l=ln(i.map,t.ch,a);l.offset=l.collapse=="right"?l.end:l.start;return l}function Gs(e){for(var t=e;t;t=t.parentNode){if(/CodeMirror-gutter-wrapper/.test(t.className)){return true}}return false}function qs(e,t){if(t){e.bad=true}return e}function Ys(s,e,t,l,u){var r="",c=false,f=s.doc.lineSeparator();function h(t){return function(e){return e.id==t}}function d(){if(c){r+=f;c=false}}function p(e){if(e){d();r+=e}}function v(e){if(e.nodeType==1){var t=e.getAttribute("cm-text");if(t!=null){p(t||e.textContent.replace(/\u200b/g,""));return}var r=e.getAttribute("cm-marker"),n;if(r){var i=s.findMarks(me(l,0),me(u+1,0),h(+r));if(i.length&&(n=i[0].find(0))){p(ce(s.doc,n.from,n.to).join(f))}return}if(e.getAttribute("contenteditable")=="false"){return}var o=/^(pre|div|p)$/i.test(e.nodeName);if(o){d()}for(var a=0;a<e.childNodes.length;a++){v(e.childNodes[a])}if(o){c=true}}else if(e.nodeType==3){p(e.nodeValue)}}for(;;){v(e);if(e==t){break}e=e.nextSibling}return r}function Xs(e,t,r){var n;if(t==e.display.lineDiv){n=e.display.lineDiv.childNodes[r];if(!n){return qs(e.clipPos(me(e.display.viewTo-1)),true)}t=null;r=0}else{for(n=t;;n=n.parentNode){if(!n||n==e.display.lineDiv){return null}if(n.parentNode&&n.parentNode==e.display.lineDiv){break}}}for(var i=0;i<e.display.view.length;i++){var o=e.display.view[i];if(o.node==n){return Js(o,t,r)}}}function Js(u,e,t){var r=u.text.firstChild,n=false;if(!e||!N(r,e)){return qs(me(de(u.line),0),true)}if(e==r){n=true;e=r.childNodes[t];t=0;if(!e){var i=u.rest?X(u.rest):u.line;return qs(me(de(i),i.text.length),n)}}var o=e.nodeType==3?e:null,a=e;if(!o&&e.childNodes.length==1&&e.firstChild.nodeType==3){o=e.firstChild;if(t){t=o.nodeValue.length}}while(a.parentNode!=r){a=a.parentNode}var c=u.measure,f=c.maps;function s(e,t,r){for(var n=-1;n<(f?f.length:0);n++){var i=n<0?c.map:f[n];for(var o=0;o<i.length;o+=3){var a=i[o+2];if(a==e||a==t){var s=de(n<0?u.line:u.rest[n]);var l=i[o]+r;if(r<0||a!=e){l=i[o+(r?1:0)]}return me(s,l)}}}}var l=s(o,a,t);if(l){return qs(l,n)}for(var h=a.nextSibling,d=o?o.nodeValue.length-t:0;h;h=h.nextSibling){l=s(h,h.firstChild,0);if(l){return qs(me(l.line,l.ch-d),n)}else{d+=h.textContent.length}}for(var p=a.previousSibling,v=t;p;p=p.previousSibling){l=s(p,p.firstChild,-1);if(l){return qs(me(l.line,l.ch+v),n)}else{v+=p.textContent.length}}}var Zs=function(e){this.cm=e;this.prevInput="";this.pollingFast=false;this.polling=new W;this.hasSelection=false;this.composing=null};Zs.prototype.init=function(t){var e=this;var r=this,n=this.cm;var i=this.wrapper=Fs();var o=this.textarea=i.firstChild;t.wrapper.insertBefore(i,t.wrapper.firstChild);if(c){o.style.width="0px"}vt(o,"input",function(){if(k&&C>=9&&e.hasSelection){e.hasSelection=null}r.poll()});vt(o,"paste",function(e){if(bt(n,e)||Ds(e,n)){return}n.state.pasteIncoming=true;r.fastPoll()});function a(e){if(bt(n,e)){return}if(n.somethingSelected()){Rs({lineWise:false,text:n.getSelections()})}else if(!n.options.lineWiseCopyCut){return}else{var t=_s(n);Rs({lineWise:true,text:t.text});if(e.type=="cut"){n.setSelections(t.ranges,null,K)}else{r.prevInput="";o.value=t.text.join("\n");B(o)}}if(e.type=="cut"){n.state.cutIncoming=true}}vt(o,"cut",a);vt(o,"copy",a);vt(t.scroller,"paste",function(e){if(Gr(t,e)||bt(n,e)){return}n.state.pasteIncoming=true;r.focus()});vt(t.lineSpace,"selectstart",function(e){if(!Gr(t,e)){xt(e)}});vt(o,"compositionstart",function(){var e=n.getCursor("from");if(r.composing){r.composing.range.clear()}r.composing={start:e,range:n.markText(e,n.getCursor("to"),{className:"CodeMirror-composing"})}});vt(o,"compositionend",function(){if(r.composing){r.poll();r.composing.range.clear();r.composing=null}})};Zs.prototype.prepareSelection=function(){var e=this.cm,t=e.display,r=e.doc;var n=Hn(e);if(e.options.moveInputWithCursor){var i=wn(e,r.sel.primary().head,"div");var o=t.wrapper.getBoundingClientRect(),a=t.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,i.top+a.top-o.top));n.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,i.left+a.left-o.left))}return n};Zs.prototype.showSelection=function(e){var t=this.cm,r=t.display;M(r.cursorDiv,e.cursors);M(r.selectionDiv,e.selection);if(e.teTop!=null){this.wrapper.style.top=e.teTop+"px";this.wrapper.style.left=e.teLeft+"px"}};Zs.prototype.reset=function(e){if(this.contextMenuPending||this.composing){return}var t=this.cm;if(t.somethingSelected()){this.prevInput="";var r=t.getSelection();this.textarea.value=r;if(t.state.focused){B(this.textarea)}if(k&&C>=9){this.hasSelection=r}}else if(!e){this.prevInput=this.textarea.value="";if(k&&C>=9){this.hasSelection=null}}};Zs.prototype.getField=function(){return this.textarea};Zs.prototype.supportsTouch=function(){return false};Zs.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"&&(!h||I()!=this.textarea)){try{this.textarea.focus()}catch(e){}}};Zs.prototype.blur=function(){this.textarea.blur()};Zs.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0};Zs.prototype.receivedFocus=function(){this.slowPoll()};Zs.prototype.slowPoll=function(){var e=this;if(this.pollingFast){return}this.polling.set(this.cm.options.pollInterval,function(){e.poll();if(e.cm.state.focused){e.slowPoll()}})};Zs.prototype.fastPoll=function(){var t=false,r=this;r.pollingFast=true;function n(){var e=r.poll();if(!e&&!t){t=true;r.polling.set(60,n)}else{r.pollingFast=false;r.slowPoll()}}r.polling.set(20,n)};Zs.prototype.poll=function(){var e=this;var t=this.cm,r=this.textarea,n=this.prevInput;if(this.contextMenuPending||!t.state.focused||Bt(r)&&!n&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq){return false}var i=r.value;if(i==n&&!t.somethingSelected()){return false}if(k&&C>=9&&this.hasSelection===i||y&&/[\uf700-\uf7ff]/.test(i)){t.display.input.reset();return false}if(t.doc.sel==t.display.selForContextMenu){var o=i.charCodeAt(0);if(o==8203&&!n){n="​"}if(o==8666){this.reset();return this.cm.execCommand("undo")}}var a=0,s=Math.min(n.length,i.length);while(a<s&&n.charCodeAt(a)==i.charCodeAt(a)){++a}Ai(t,function(){Bs(t,i.slice(a),n.length-a,null,e.composing?"*compose":null);if(i.length>1e3||i.indexOf("\n")>-1){r.value=e.prevInput=""}else{e.prevInput=i}if(e.composing){e.composing.range.clear();e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"})}});return true};Zs.prototype.ensurePolled=function(){if(this.pollingFast&&this.poll()){this.pollingFast=false}};Zs.prototype.onKeyPress=function(){if(k&&C>=9){this.hasSelection=null}this.fastPoll()};Zs.prototype.onContextMenu=function(e){var r=this,n=r.cm,i=n.display,o=r.textarea;var t=Rn(n,e),a=i.scroller.scrollTop;if(!t||m){return}var s=n.options.resetSelectionOnContextMenu;if(s&&n.doc.sel.contains(t)==-1){Mi(n,Wo)(n.doc,io(t),K)}var l=o.style.cssText,u=r.wrapper.style.cssText;r.wrapper.style.cssText="position: absolute";var c=r.wrapper.getBoundingClientRect();o.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-c.top-5)+"px; left: "+(e.clientX-c.left-5)+"px;\n      z-index: 1000; background: "+(k?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";var f;if(g){f=window.scrollY}i.input.focus();if(g){window.scrollTo(null,f)}i.input.reset();if(!n.somethingSelected()){o.value=r.prevInput=" "}r.contextMenuPending=true;i.selForContextMenu=n.doc.sel;clearTimeout(i.detectingSelectAll);function h(){if(o.selectionStart!=null){var e=n.somethingSelected();var t="​"+(e?o.value:"");o.value="⇚";o.value=t;r.prevInput=e?"":"​";o.selectionStart=1;o.selectionEnd=t.length;i.selForContextMenu=n.doc.sel}}function d(){r.contextMenuPending=false;r.wrapper.style.cssText=u;o.style.cssText=l;if(k&&C<9){i.scrollbars.setScrollTop(i.scroller.scrollTop=a)}if(o.selectionStart!=null){if(!k||k&&C<9){h()}var e=0,t=function(){if(i.selForContextMenu==n.doc.sel&&o.selectionStart==0&&o.selectionEnd>0&&r.prevInput=="​"){Mi(n,qo)(n)}else if(e++<10){i.detectingSelectAll=setTimeout(t,500)}else{i.selForContextMenu=null;i.input.reset()}};i.detectingSelectAll=setTimeout(t,200)}}if(k&&C>=9){h()}if(x){At(e);var p=function(){mt(window,"mouseup",p);setTimeout(d,20)};vt(window,"mouseup",p)}else{setTimeout(d,50)}};Zs.prototype.readOnlyChanged=function(e){if(!e){this.reset()}this.textarea.disabled=e=="nocursor"};Zs.prototype.setUneditable=function(){};Zs.prototype.needsContentAttribute=false;function $s(t,e){e=e?H(e):{};e.value=t.value;if(!e.tabindex&&t.tabIndex){e.tabindex=t.tabIndex}if(!e.placeholder&&t.placeholder){e.placeholder=t.placeholder}if(e.autofocus==null){var r=I();e.autofocus=r==t||t.getAttribute("autofocus")!=null&&r==document.body}function n(){t.value=s.getValue()}var i;if(t.form){vt(t.form,"submit",n);if(!e.leaveSubmitMethodAlone){var o=t.form;i=o.submit;try{var a=o.submit=function(){n();o.submit=i;o.submit();o.submit=a}}catch(e){}}}e.finishInit=function(e){e.save=n;e.getTextArea=function(){return t};e.toTextArea=function(){e.toTextArea=isNaN;n();t.parentNode.removeChild(e.getWrapperElement());t.style.display="";if(t.form){mt(t.form,"submit",n);if(typeof t.form.submit=="function"){t.form.submit=i}}}};t.style.display="none";var s=Os(function(e){return t.parentNode.insertBefore(e,t.nextSibling)},e);return s}function Qs(e){e.off=mt;e.on=vt;e.wheelEventPixels=Qi;e.Doc=wa;e.splitLines=Rt;e.countColumn=_;e.findColumn=G;e.isWordChar=te;e.Pass=j;e.signal=yt;e.Line=fr;e.changeEnd=oo;e.scrollbarModel=vi;e.Pos=me;e.cmpPos=ye;e.modes=Wt;e.mimeModes=Ft;e.resolveMode=Kt;e.getMode=Ut;e.modeExtensions=Vt;e.extendMode=Gt;e.copyState=qt;e.startState=Xt;e.innerMode=Yt;e.commands=Ua;e.keyMap=Ba;e.keyName=za;e.isModifierKey=Wa;e.lookupKey=_a;e.normalizeKeyMap=Ha;e.StringStream=Jt;e.SharedTextMarker=pa;e.TextMarker=ha;e.LineWidget=la;e.e_preventDefault=xt;e.e_stopPropagation=St;e.e_stop=At;e.addClass=P;e.contains=N;e.rmClass=L;e.keyNames=Na}Ls(Os);zs(Os);var el="iter insert remove copy getEditor constructor".split(" ");for(var tl in wa.prototype){if(wa.prototype.hasOwnProperty(tl)&&F(el,tl)<0){Os.prototype[tl]=function(e){return function(){return e.apply(this.doc,arguments)}}(wa.prototype[tl])}}Ct(wa);Os.inputStyles={textarea:Zs,contenteditable:Us};Os.defineMode=function(e){if(!Os.defaults.mode&&e!="null"){Os.defaults.mode=e}zt.apply(this,arguments)};Os.defineMIME=jt;Os.defineMode("null",function(){return{token:function(e){return e.skipToEnd()}}});Os.defineMIME("text/plain","null");Os.defineExtension=function(e,t){Os.prototype[e]=t};Os.defineDocExtension=function(e,t){wa.prototype[e]=t};Os.fromTextArea=$s;Qs(Os);Os.version="5.29.1";return Os});(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(A){"use strict";var M="CodeMirror-hint";var T="CodeMirror-hint-active";A.showHint=function(e,t,r){if(!t)return e.showHint(r);if(r&&r.async)t.async=true;var n={hint:t};if(r)for(var i in r)n[i]=r[i];return e.showHint(n)};A.defineExtension("showHint",function(e){e=s(this,this.getCursor("start"),e);var t=this.listSelections();if(t.length>1)return;if(this.somethingSelected()){if(!e.hint.supportsSelection)return;for(var r=0;r<t.length;r++)if(t[r].head.line!=t[r].anchor.line)return}if(this.state.completionActive)this.state.completionActive.close();var n=this.state.completionActive=new i(this,e);if(!n.options.hint)return;A.signal(this,"startCompletion",this);n.update(true)});function i(e,t){this.cm=e;this.options=t;this.widget=null;this.debounce=0;this.tick=0;this.startPos=this.cm.getCursor("start");this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var r=this;e.on("cursorActivity",this.activityFunc=function(){r.cursorActivity()})}var n=window.requestAnimationFrame||function(e){return setTimeout(e,1e3/60)};var o=window.cancelAnimationFrame||clearTimeout;i.prototype={close:function(){if(!this.active())return;this.cm.state.completionActive=null;this.tick=null;this.cm.off("cursorActivity",this.activityFunc);if(this.widget&&this.data)A.signal(this.data,"close");if(this.widget)this.widget.close();A.signal(this.cm,"endCompletion",this.cm)},active:function(){return this.cm.state.completionActive==this},pick:function(e,t){var r=e.list[t];if(r.hint)r.hint(this.cm,e,r);else this.cm.replaceRange(O(r),r.from||e.from,r.to||e.to,"complete");A.signal(e,"pick",r);this.close()},cursorActivity:function(){if(this.debounce){o(this.debounce);this.debounce=0}var e=this.cm.getCursor(),t=this.cm.getLine(e.line);if(e.line!=this.startPos.line||t.length-e.ch!=this.startLen-this.startPos.ch||e.ch<this.startPos.ch||this.cm.somethingSelected()||e.ch&&this.options.closeCharacters.test(t.charAt(e.ch-1))){this.close()}else{var r=this;this.debounce=n(function(){r.update()});if(this.widget)this.widget.disable()}},update:function(t){if(this.tick==null)return;var r=this,n=++this.tick;c(this.options.hint,this.cm,this.options,function(e){if(r.tick==n)r.finishUpdate(e,t)})},finishUpdate:function(e,t){if(this.data)A.signal(this.data,"update");var r=this.widget&&this.widget.picked||t&&this.options.completeSingle;if(this.widget)this.widget.close();if(e&&this.data&&a(this.data,e))return;this.data=e;if(e&&e.list.length){if(r&&e.list.length==1){this.pick(e,0)}else{this.widget=new l(this,e);A.signal(e,"shown")}}}};function a(e,t){var r=A.cmpPos(t.from,e.from);return r>0&&e.to.ch-e.from.ch!=t.to.ch-t.from.ch}function s(e,t,r){var n=e.options.hintOptions;var i={};for(var o in f)i[o]=f[o];if(n)for(var o in n)if(n[o]!==undefined)i[o]=n[o];if(r)for(var o in r)if(r[o]!==undefined)i[o]=r[o];if(i.hint.resolve)i.hint=i.hint.resolve(e,t);return i}function O(e){if(typeof e=="string")return e;else return e.text}function E(e,n){var i={Up:function(){n.moveFocus(-1)},Down:function(){n.moveFocus(1)},PageUp:function(){n.moveFocus(-n.menuSize()+1,true)},PageDown:function(){n.moveFocus(n.menuSize()-1,true)},Home:function(){n.setFocus(0)},End:function(){n.setFocus(n.length-1)},Enter:n.pick,Tab:n.pick,Esc:n.close};var t=e.options.customKeys;var o=t?{}:i;function r(e,t){var r;if(typeof t!="string")r=function(e){return t(e,n)};else if(i.hasOwnProperty(t))r=i[t];else r=t;o[e]=r}if(t)for(var a in t)if(t.hasOwnProperty(a))r(a,t[a]);var s=e.options.extraKeys;if(s)for(var a in s)if(s.hasOwnProperty(a))r(a,s[a]);return o}function N(e,t){while(t&&t!=e){if(t.nodeName.toUpperCase()==="LI"&&t.parentNode==e)return t;t=t.parentNode}}function l(i,e){this.completion=i;this.data=e;this.picked=false;var r=this,o=i.cm;var a=this.hints=document.createElement("ul");a.className="CodeMirror-hints";this.selectedHint=e.selectedHint||0;var t=e.list;for(var n=0;n<t.length;++n){var s=a.appendChild(document.createElement("li")),l=t[n];var u=M+(n!=this.selectedHint?"":" "+T);if(l.className!=null)u=l.className+" "+u;s.className=u;if(l.render)l.render(s,e,l);else s.appendChild(document.createTextNode(l.displayText||O(l)));s.hintId=n}var c=o.cursorCoords(i.options.alignWithWord?e.from:null);var f=c.left,h=c.bottom,d=true;a.style.left=f+"px";a.style.top=h+"px";var p=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth);var v=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(i.options.container||document.body).appendChild(a);var g=a.getBoundingClientRect(),m=g.bottom-v;var y=a.scrollHeight>a.clientHeight+1;var b=o.getScrollInfo();if(m>0){var w=g.bottom-g.top,k=c.top-(c.bottom-g.top);if(k-w>0){a.style.top=(h=c.top-w)+"px";d=false}else if(w>v){a.style.height=v-5+"px";a.style.top=(h=c.bottom-g.top)+"px";var C=o.getCursor();if(e.from.ch!=C.ch){c=o.cursorCoords(C);a.style.left=(f=c.left)+"px";g=a.getBoundingClientRect()}}}var x=g.right-p;if(x>0){if(g.right-g.left>p){a.style.width=p-5+"px";x-=g.right-g.left-p}a.style.left=(f=c.left-x)+"px"}if(y)for(var S=a.firstChild;S;S=S.nextSibling)S.style.paddingRight=o.display.nativeBarWidth+"px";o.addKeyMap(this.keyMap=E(i,{moveFocus:function(e,t){r.changeActive(r.selectedHint+e,t)},setFocus:function(e){r.changeActive(e)},menuSize:function(){return r.screenAmount()},length:t.length,close:function(){i.close()},pick:function(){r.pick()},data:e}));if(i.options.closeOnUnfocus){var L;o.on("blur",this.onBlur=function(){L=setTimeout(function(){i.close()},100)});o.on("focus",this.onFocus=function(){clearTimeout(L)})}o.on("scroll",this.onScroll=function(){var e=o.getScrollInfo(),t=o.getWrapperElement().getBoundingClientRect();var r=h+b.top-e.top;var n=r-(window.pageYOffset||(document.documentElement||document.body).scrollTop);if(!d)n+=a.offsetHeight;if(n<=t.top||n>=t.bottom)return i.close();a.style.top=r+"px";a.style.left=f+b.left-e.left+"px"});A.on(a,"dblclick",function(e){var t=N(a,e.target||e.srcElement);if(t&&t.hintId!=null){r.changeActive(t.hintId);r.pick()}});A.on(a,"click",function(e){var t=N(a,e.target||e.srcElement);if(t&&t.hintId!=null){r.changeActive(t.hintId);if(i.options.completeOnSingleClick)r.pick()}});A.on(a,"mousedown",function(){setTimeout(function(){o.focus()},20)});A.signal(e,"select",t[this.selectedHint],a.childNodes[this.selectedHint]);return true}l.prototype={close:function(){if(this.completion.widget!=this)return;this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var e=this.completion.cm;if(this.completion.options.closeOnUnfocus){e.off("blur",this.onBlur);e.off("focus",this.onFocus)}e.off("scroll",this.onScroll)},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var e=this;this.keyMap={Enter:function(){e.picked=true}};this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(e,t){if(e>=this.data.list.length)e=t?this.data.list.length-1:0;else if(e<0)e=t?0:this.data.list.length-1;if(this.selectedHint==e)return;var r=this.hints.childNodes[this.selectedHint];r.className=r.className.replace(" "+T,"");r=this.hints.childNodes[this.selectedHint=e];r.className+=" "+T;if(r.offsetTop<this.hints.scrollTop)this.hints.scrollTop=r.offsetTop-3;else if(r.offsetTop+r.offsetHeight>this.hints.scrollTop+this.hints.clientHeight)this.hints.scrollTop=r.offsetTop+r.offsetHeight-this.hints.clientHeight+3;A.signal(this.data,"select",this.data.list[this.selectedHint],r)},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}};function u(e,t){if(!e.somethingSelected())return t;var r=[];for(var n=0;n<t.length;n++)if(t[n].supportsSelection)r.push(t[n]);return r}function c(e,t,r,n){if(e.async){e(t,n,r)}else{var i=e(t,r);if(i&&i.then)i.then(n);else n(i)}}function e(e,t){var a=e.getHelpers(t,"hint"),r;if(a.length){var n=function(e,r,n){var i=u(e,a);function o(t){if(t==i.length)return r(null);c(i[t],e,n,function(e){if(e&&e.list.length>0)r(e);else o(t+1)})}o(0)};n.async=true;n.supportsSelection=true;return n}else if(r=e.getHelper(e.getCursor(),"hintWords")){return function(e){return A.hint.fromList(e,{words:r})}}else if(A.hint.anyword){return function(e,t){return A.hint.anyword(e,t)}}else{return function(){}}}A.registerHelper("hint","auto",{resolve:e});A.registerHelper("hint","fromList",function(e,t){var r=e.getCursor(),n=e.getTokenAt(r);var i=A.Pos(r.line,n.end);if(n.string&&/\w/.test(n.string[n.string.length-1])){var o=n.string,a=A.Pos(r.line,n.start)}else{var o="",a=i}var s=[];for(var l=0;l<t.words.length;l++){var u=t.words[l];if(u.slice(0,o.length)==o)s.push(u)}if(s.length)return{list:s,from:a,to:i}});A.commands.autocomplete=A.showHint;var f={hint:A.hint.auto,completeSingle:true,alignWithWord:true,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:true,completeOnSingleClick:true,container:null,customKeys:null,extraKeys:null};A.defineOption("hintOptions",null)});(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(s){"use strict";function n(e,t,r){this.orientation=t;this.scroll=r;this.screen=this.total=this.size=1;this.pos=0;this.node=document.createElement("div");this.node.className=e+"-"+t;this.inner=this.node.appendChild(document.createElement("div"));var a=this;s.on(this.inner,"mousedown",function(e){if(e.which!=1)return;s.e_preventDefault(e);var t=a.orientation=="horizontal"?"pageX":"pageY";var r=e[t],n=a.pos;function i(){s.off(document,"mousemove",o);s.off(document,"mouseup",i)}function o(e){if(e.which!=1)return i();a.moveTo(n+(e[t]-r)*(a.total/a.size))}s.on(document,"mousemove",o);s.on(document,"mouseup",i)});s.on(this.node,"click",function(e){s.e_preventDefault(e);var t=a.inner.getBoundingClientRect(),r;if(a.orientation=="horizontal")r=e.clientX<t.left?-1:e.clientX>t.right?1:0;else r=e.clientY<t.top?-1:e.clientY>t.bottom?1:0;a.moveTo(a.pos+r*a.screen)});function n(e){var t=s.wheelEventPixels(e)[a.orientation=="horizontal"?"x":"y"];var r=a.pos;a.moveTo(a.pos+t);if(a.pos!=r)s.e_preventDefault(e)}s.on(this.node,"mousewheel",n);s.on(this.node,"DOMMouseScroll",n)}n.prototype.setPos=function(e,t){if(e<0)e=0;if(e>this.total-this.screen)e=this.total-this.screen;if(!t&&e==this.pos)return false;this.pos=e;this.inner.style[this.orientation=="horizontal"?"left":"top"]=e*(this.size/this.total)+"px";return true};n.prototype.moveTo=function(e){if(this.setPos(e))this.scroll(e,this.orientation)};var o=10;n.prototype.update=function(e,t,r){var n=this.screen!=t||this.total!=e||this.size!=r;if(n){this.screen=t;this.total=e;this.size=r}var i=this.screen*(this.size/this.total);if(i<o){this.size-=o-i;i=o}this.inner.style[this.orientation=="horizontal"?"width":"height"]=i+"px";this.setPos(this.pos,n)};function r(e,t,r){this.addClass=e;this.horiz=new n(e,"horizontal",r);t(this.horiz.node);this.vert=new n(e,"vertical",r);t(this.vert.node);this.width=null}r.prototype.update=function(e){if(this.width==null){var t=window.getComputedStyle?window.getComputedStyle(this.horiz.node):this.horiz.node.currentStyle;if(t)this.width=parseInt(t.height)}var r=this.width||0;var n=e.scrollWidth>e.clientWidth+1;var i=e.scrollHeight>e.clientHeight+1;this.vert.node.style.display=i?"block":"none";this.horiz.node.style.display=n?"block":"none";if(i){this.vert.update(e.scrollHeight,e.clientHeight,e.viewHeight-(n?r:0));this.vert.node.style.bottom=n?r+"px":"0"}if(n){this.horiz.update(e.scrollWidth,e.clientWidth,e.viewWidth-(i?r:0)-e.barLeft);this.horiz.node.style.right=i?r+"px":"0";this.horiz.node.style.left=e.barLeft+"px"}return{right:i?r:0,bottom:n?r:0}};r.prototype.setScrollTop=function(e){this.vert.setPos(e)};r.prototype.setScrollLeft=function(e){this.horiz.setPos(e)};r.prototype.clear=function(){var e=this.horiz.node.parentNode;e.removeChild(this.horiz.node);e.removeChild(this.vert.node)};s.scrollbarModel.simple=function(e,t){return new r("CodeMirror-simplescroll",e,t)};s.scrollbarModel.overlay=function(e,t){return new r("CodeMirror-overlayscroll",e,t)}});(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";e.defineExtension("annotateScrollbar",function(e){if(typeof e=="string")e={className:e};return new t(this,e)});e.defineOption("scrollButtonHeight",0);function t(e,t){this.cm=e;this.options=t;this.buttonHeight=t.scrollButtonHeight||e.getOption("scrollButtonHeight");this.annotations=[];this.doRedraw=this.doUpdate=null;this.div=e.getWrapperElement().appendChild(document.createElement("div"));this.div.style.cssText="position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none";this.computeScale();function r(e){clearTimeout(n.doRedraw);n.doRedraw=setTimeout(function(){n.redraw()},e)}var n=this;e.on("refresh",this.resizeHandler=function(){clearTimeout(n.doUpdate);n.doUpdate=setTimeout(function(){if(n.computeScale())r(20)},100)});e.on("markerAdded",this.resizeHandler);e.on("markerCleared",this.resizeHandler);if(t.listenForChanges!==false)e.on("change",this.changeHandler=function(){r(250)})}t.prototype.computeScale=function(){var e=this.cm;var t=(e.getWrapperElement().clientHeight-e.display.barHeight-this.buttonHeight*2)/e.getScrollerElement().scrollHeight;if(t!=this.hScale){this.hScale=t;return true}};t.prototype.update=function(e){this.annotations=e;this.redraw()};t.prototype.redraw=function(e){if(e!==false)this.computeScale();var n=this.cm,t=this.hScale;var r=document.createDocumentFragment(),i=this.annotations;var o=n.getOption("lineWrapping");var a=o&&n.defaultTextHeight()*1.5;var s=null,l=null;function u(e,t){if(s!=e.line){s=e.line;l=n.getLineHandle(s)}if(l.widgets&&l.widgets.length||o&&l.height>a)return n.charCoords(e,"local")[t?"top":"bottom"];var r=n.heightAtLine(l,"local");return r+(t?0:l.height)}var c=n.lastLine();if(n.display.barWidth)for(var f=0,h;f<i.length;f++){var d=i[f];if(d.to.line>c)continue;var p=h||u(d.from,true)*t;var v=u(d.to,false)*t;while(f<i.length-1){if(i[f+1].to.line>c)break;h=u(i[f+1].from,true)*t;if(h>v+.9)break;d=i[++f];v=u(d.to,false)*t}if(v==p)continue;var g=Math.max(v-p,3);var m=r.appendChild(document.createElement("div"));m.style.cssText="position: absolute; right: 0px; width: "+Math.max(n.display.barWidth-1,2)+"px; top: "+(p+this.buttonHeight)+"px; height: "+g+"px";m.className=this.options.className;if(d.id){m.setAttribute("annotation-id",d.id)}}this.div.textContent="";this.div.appendChild(r)};t.prototype.clear=function(){this.cm.off("refresh",this.resizeHandler);this.cm.off("markerAdded",this.resizeHandler);this.cm.off("markerCleared",this.resizeHandler);if(this.changeHandler)this.cm.off("change",this.changeHandler);this.div.parentNode.removeChild(this.div)}});(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"),require("./searchcursor"),require("../scroll/annotatescrollbar"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","./searchcursor","../scroll/annotatescrollbar"],e);else e(CodeMirror)})(function(u){"use strict";u.defineExtension("showMatchesOnScrollbar",function(e,t,r){if(typeof r=="string")r={className:r};if(!r)r={};return new n(this,e,t,r)});function n(e,t,r,n){this.cm=e;this.options=n;var i={listenForChanges:false};for(var o in n)i[o]=n[o];if(!i.className)i.className="CodeMirror-search-match";this.annotation=e.annotateScrollbar(i);this.query=t;this.caseFold=r;this.gap={from:e.firstLine(),to:e.lastLine()+1};this.matches=[];this.update=null;this.findMatches();this.annotation.update(this.matches);var a=this;e.on("change",this.changeHandler=function(e,t){a.onChange(t)})}var i=1e3;n.prototype.findMatches=function(){if(!this.gap)return;for(var e=0;e<this.matches.length;e++){var t=this.matches[e];if(t.from.line>=this.gap.to)break;if(t.to.line>=this.gap.from)this.matches.splice(e--,1)}var r=this.cm.getSearchCursor(this.query,u.Pos(this.gap.from,0),this.caseFold);var n=this.options&&this.options.maxMatches||i;while(r.findNext()){var t={from:r.from(),to:r.to()};if(t.from.line>=this.gap.to)break;this.matches.splice(e++,0,t);if(this.matches.length>n)break}this.gap=null};function c(e,t,r){if(e<=t)return e;return Math.max(t,e+r)}n.prototype.onChange=function(e){var t=e.from.line;var r=u.changeEnd(e).line;var n=r-e.to.line;if(this.gap){this.gap.from=Math.min(c(this.gap.from,t,n),e.from.line);this.gap.to=Math.max(c(this.gap.to,t,n),e.from.line)}else{this.gap={from:e.from.line,to:r+1}}if(n)for(var i=0;i<this.matches.length;i++){var o=this.matches[i];var a=c(o.from.line,t,n);if(a!=o.from.line)o.from=u.Pos(a,o.from.ch);var s=c(o.to.line,t,n);if(s!=o.to.line)o.to=u.Pos(s,o.to.ch)}clearTimeout(this.update);var l=this;this.update=setTimeout(function(){l.updateAfterChange()},250)};n.prototype.updateAfterChange=function(){this.findMatches();this.annotation.update(this.matches)};n.prototype.clear=function(){this.cm.off("change",this.changeHandler);this.annotation.clear()}});(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(m){var r={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"};var y=m.Pos;m.defineOption("autoCloseBrackets",false,function(e,t,r){if(r&&r!=m.Init){e.removeKeyMap(n);e.state.closeBrackets=null}if(t){e.state.closeBrackets=t;e.addKeyMap(n)}});function b(e,t){if(t=="pairs"&&typeof e=="string")return e;if(typeof e=="object"&&e[t]!=null)return e[t];return r[t]}var e=r.pairs+"`";var n={Backspace:o,Enter:a};for(var t=0;t<e.length;t++)n["'"+e.charAt(t)+"'"]=i(e.charAt(t));function i(t){return function(e){return s(e,t)}}function w(e){var t=e.state.closeBrackets;if(!t||t.override)return t;var r=e.getModeAt(e.getCursor());return r.closeBrackets||t}function o(e){var t=w(e);if(!t||e.getOption("disableInput"))return m.Pass;var r=b(t,"pairs");var n=e.listSelections();for(var i=0;i<n.length;i++){if(!n[i].empty())return m.Pass;var o=l(e,n[i].head);if(!o||r.indexOf(o)%2!=0)return m.Pass}for(var i=n.length-1;i>=0;i--){var a=n[i].head;e.replaceRange("",y(a.line,a.ch-1),y(a.line,a.ch+1),"+delete")}}function a(r){var e=w(r);var t=e&&b(e,"explode");if(!t||r.getOption("disableInput"))return m.Pass;var n=r.listSelections();for(var i=0;i<n.length;i++){if(!n[i].empty())return m.Pass;var o=l(r,n[i].head);if(!o||t.indexOf(o)%2!=0)return m.Pass}r.operation(function(){r.replaceSelection("\n\n",null);r.execCommand("goCharLeft");n=r.listSelections();for(var e=0;e<n.length;e++){var t=n[e].head.line;r.indentLine(t,null,true);r.indentLine(t+1,null,true)}})}function k(e){var t=m.cmpPos(e.anchor,e.head)>0;return{anchor:new y(e.anchor.line,e.anchor.ch+(t?-1:1)),head:new y(e.head.line,e.head.ch+(t?1:-1))}}function s(r,e){var t=w(r);if(!t||r.getOption("disableInput"))return m.Pass;var n=b(t,"pairs");var i=n.indexOf(e);if(i==-1)return m.Pass;var o=b(t,"triples");var a=n.charAt(i+1)==e;var s=r.listSelections();var l=i%2==0;var u;for(var c=0;c<s.length;c++){var f=s[c],h=f.head,d;var p=r.getRange(h,y(h.line,h.ch+1));if(l&&!f.empty()){d="surround"}else if((a||!l)&&p==e){if(a&&S(r,h))d="both";else if(o.indexOf(e)>=0&&r.getRange(h,y(h.line,h.ch+3))==e+e+e)d="skipThree";else d="skip"}else if(a&&h.ch>1&&o.indexOf(e)>=0&&r.getRange(y(h.line,h.ch-2),h)==e+e&&(h.ch<=2||r.getRange(y(h.line,h.ch-3),y(h.line,h.ch-2))!=e)){d="addFour"}else if(a){if(!m.isWordChar(p)&&x(r,h,e))d="both";else return m.Pass}else if(l&&(r.getLine(h.line).length==h.ch||C(p,n)||/\s/.test(p))){d="both"}else{return m.Pass}if(!u)u=d;else if(u!=d)return m.Pass}var v=i%2?n.charAt(i-1):e;var g=i%2?e:n.charAt(i+1);r.operation(function(){if(u=="skip"){r.execCommand("goCharRight")}else if(u=="skipThree"){for(var e=0;e<3;e++)r.execCommand("goCharRight")}else if(u=="surround"){var t=r.getSelections();for(var e=0;e<t.length;e++)t[e]=v+t[e]+g;r.replaceSelections(t,"around");t=r.listSelections().slice();for(var e=0;e<t.length;e++)t[e]=k(t[e]);r.setSelections(t)}else if(u=="both"){r.replaceSelection(v+g,null);r.triggerElectric(v+g);r.execCommand("goCharLeft")}else if(u=="addFour"){r.replaceSelection(v+v+v+v,"before");r.execCommand("goCharRight")}})}function C(e,t){var r=t.lastIndexOf(e);return r>-1&&r%2==1}function l(e,t){var r=e.getRange(y(t.line,t.ch-1),y(t.line,t.ch+1));return r.length==2?r:null}function x(e,t,r){var n=e.getLine(t.line);var i=e.getTokenAt(t);if(/\bstring2?\b/.test(i.type)||S(e,t))return false;var o=new m.StringStream(n.slice(0,t.ch)+r+n.slice(t.ch),4);o.pos=o.start=i.start;for(;;){var a=e.getMode().token(o,i.state);if(o.pos>=t.ch+1)return/\bstring2?\b/.test(a);o.start=o.pos}}function S(e,t){var r=e.getTokenAt(y(t.line,t.ch+1));return/\bstring/.test(r.type)&&r.start==t.ch}});(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(n){var c=/MSIE \d/.test(navigator.userAgent)&&(document.documentMode==null||document.documentMode<8);var g=n.Pos;var m={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function f(e,t,r){var n=e.getLineHandle(t.line),i=t.ch-1;var o=r&&r.afterCursor;if(o==null)o=/(^| )cm-fat-cursor($| )/.test(e.getWrapperElement().className);var a=!o&&i>=0&&m[n.text.charAt(i)]||m[n.text.charAt(++i)];if(!a)return null;var s=a.charAt(1)==">"?1:-1;if(r&&r.strict&&s>0!=(i==t.ch))return null;var l=e.getTokenTypeAt(g(t.line,i+1));var u=h(e,g(t.line,i+(s>0?1:0)),s,l||null,r);if(u==null)return null;return{from:g(t.line,i),to:u&&u.pos,match:u&&u.ch==a.charAt(0),forward:s>0}}function h(e,t,r,n,i){var o=i&&i.maxScanLineLength||1e4;var a=i&&i.maxScanLines||1e3;var s=[];var l=i&&i.bracketRegex?i.bracketRegex:/[(){}[\]]/;var u=r>0?Math.min(t.line+a,e.lastLine()+1):Math.max(e.firstLine()-1,t.line-a);for(var c=t.line;c!=u;c+=r){var f=e.getLine(c);if(!f)continue;var h=r>0?0:f.length-1,d=r>0?f.length:-1;if(f.length>o)continue;if(c==t.line)h=t.ch-(r<0?1:0);for(;h!=d;h+=r){var p=f.charAt(h);if(l.test(p)&&(n===undefined||e.getTokenTypeAt(g(c,h+1))==n)){var v=m[p];if(v.charAt(1)==">"==r>0)s.push(p);else if(!s.length)return{pos:g(c,h),ch:p};else s.pop()}}}return c-r==(r>0?e.lastLine():e.firstLine())?false:null}function t(e,t,r){var n=e.state.matchBrackets.maxHighlightLineLength||1e3;var i=[],o=e.listSelections();for(var a=0;a<o.length;a++){var s=o[a].empty()&&f(e,o[a].head,r);if(s&&e.getLine(s.from.line).length<=n){var l=s.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";i.push(e.markText(s.from,g(s.from.line,s.from.ch+1),{className:l}));if(s.to&&e.getLine(s.to.line).length<=n)i.push(e.markText(s.to,g(s.to.line,s.to.ch+1),{className:l}))}}if(i.length){if(c&&e.state.focused)e.focus();var u=function(){e.operation(function(){for(var e=0;e<i.length;e++)i[e].clear()})};if(t)setTimeout(u,800);else return u}}var i=null;function o(e){e.operation(function(){if(i){i();i=null}i=t(e,false,e.state.matchBrackets)})}n.defineOption("matchBrackets",false,function(e,t,r){if(r&&r!=n.Init){e.off("cursorActivity",o);if(i){i();i=null}}if(t){e.state.matchBrackets=typeof t=="object"?t:{};e.on("cursorActivity",o)}});n.defineExtension("matchBrackets",function(){t(this,true)});n.defineExtension("findMatchingBracket",function(e,t,r){if(r||typeof t=="boolean"){if(!r){t=t?{strict:true}:null}else{r.strict=t;t=r}}return f(this,e,t)});n.defineExtension("scanForBracket",function(e,t,r,n){return h(this,e,t,r,n)})});(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],e);else e(CodeMirror)})(function(l){"use strict";function n(r,e){if(typeof r=="string")r=new RegExp(r.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),e?"gi":"g");else if(!r.global)r=new RegExp(r.source,r.ignoreCase?"gi":"g");return{token:function(e){r.lastIndex=e.pos;var t=r.exec(e.string);if(t&&t.index==e.pos){e.pos+=t[0].length||1;return"searching"}else if(t){e.pos=t.index}else{e.skipToEnd()}}}}function t(){this.posFrom=this.posTo=this.lastQuery=this.query=null;this.overlay=null}function u(e){return e.state.search||(e.state.search=new t)}function i(e){return typeof e=="string"&&e==e.toLowerCase()}function c(e,t,r){return e.getSearchCursor(t,r,{caseFold:i(t),multiline:true})}function f(e,t,r,n,i){e.openDialog(t,n,{value:r,selectValueOnOpen:true,closeOnEnter:false,onClose:function(){y(e)},onKeyDown:i})}function h(e,t,r,n,i){if(e.openDialog)e.openDialog(t,i,{value:n,selectValueOnOpen:true});else i(prompt(r,n))}function d(e,t,r,n){if(e.openConfirm)e.openConfirm(t,n);else if(confirm(r))n[0]()}function p(e){return e.replace(/\\(.)/g,function(e,t){if(t=="n")return"\n";if(t=="r")return"\r";return t})}function o(e){var t=e.match(/^\/(.*)\/([a-z]*)$/);if(t){try{e=new RegExp(t[1],t[2].indexOf("i")==-1?"":"i")}catch(e){}}else{e=p(e)}if(typeof e=="string"?e=="":e.test(""))e=/x^/;return e}var v='<span class="CodeMirror-search-label">Search:</span> <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>';function g(e,t,r){t.queryText=r;t.query=o(r);e.removeOverlay(t.overlay,i(t.query));t.overlay=n(t.query,i(t.query));e.addOverlay(t.overlay);if(e.showMatchesOnScrollbar){if(t.annotate){t.annotate.clear();t.annotate=null}t.annotate=e.showMatchesOnScrollbar(t.query,i(t.query))}}function r(o,t,e,r){var n=u(o);if(n.query)return m(o,t);var i=o.getSelection()||n.lastQuery;if(e&&o.openDialog){var a=null;var s=function(e,t){l.e_stop(t);if(!e)return;if(e!=n.queryText){g(o,n,e);n.posFrom=n.posTo=o.getCursor()}if(a)a.style.opacity=1;m(o,t.shiftKey,function(e,t){var r;if(t.line<3&&document.querySelector&&(r=o.display.wrapper.querySelector(".CodeMirror-dialog"))&&r.getBoundingClientRect().bottom-4>o.cursorCoords(t,"window").top)(a=r).style.opacity=.4})};f(o,v,i,s,function(e,t){var r=l.keyName(e);var n=o.getOption("extraKeys"),i=n&&n[r]||l.keyMap[o.getOption("keyMap")][r];if(i=="findNext"||i=="findPrev"||i=="findPersistentNext"||i=="findPersistentPrev"){l.e_stop(e);g(o,u(o),t);o.execCommand(i)}else if(i=="find"||i=="findPersistent"){l.e_stop(e);s(t,e)}});if(r&&i){g(o,n,i);m(o,t)}}else{h(o,v,"Search for:",i,function(e){if(e&&!n.query)o.operation(function(){g(o,n,e);n.posFrom=n.posTo=o.getCursor();m(o,t)})})}}function m(r,n,i){r.operation(function(){var e=u(r);var t=c(r,e.query,n?e.posFrom:e.posTo);if(!t.find(n)){t=c(r,e.query,n?l.Pos(r.lastLine()):l.Pos(r.firstLine(),0));if(!t.find(n))return}r.setSelection(t.from(),t.to());r.scrollIntoView({from:t.from(),to:t.to()},20);e.posFrom=t.from();e.posTo=t.to();if(i)i(t.from(),t.to())})}function y(t){t.operation(function(){var e=u(t);e.lastQuery=e.query;if(!e.query)return;e.query=e.queryText=null;t.removeOverlay(e.overlay);if(e.annotate){e.annotate.clear();e.annotate=null}})}var a=' <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>';var b='<span class="CodeMirror-search-label">With:</span> <input type="text" style="width: 10em" class="CodeMirror-search-field"/>';var w='<span class="CodeMirror-search-label">Replace?</span> <button>Yes</button> <button>No</button> <button>All</button> <button>Stop</button>';function k(t,n,i){t.operation(function(){for(var e=c(t,n);e.findNext();){if(typeof n!="string"){var r=t.getRange(e.from(),e.to()).match(n);e.replace(i.replace(/\$(\d)/g,function(e,t){return r[t]}))}else e.replace(i)}})}function s(s,e){if(s.getOption("readOnly"))return;var t=s.getSelection()||u(s).lastQuery;var r='<span class="CodeMirror-search-label">'+(e?"Replace all:":"Replace:")+"</span>";h(s,r+a,r,t,function(a){if(!a)return;a=o(a);h(s,b,"Replace with:","",function(n){n=p(n);if(e){k(s,a,n)}else{y(s);var i=c(s,a,s.getCursor("from"));var o=function(){var e=i.from(),t;if(!(t=i.findNext())){i=c(s,a);if(!(t=i.findNext())||e&&i.from().line==e.line&&i.from().ch==e.ch)return}s.setSelection(i.from(),i.to());s.scrollIntoView({from:i.from(),to:i.to()});d(s,w,"Replace?",[function(){r(t)},o,function(){k(s,a,n)}])};var r=function(r){i.replace(typeof a=="string"?n:n.replace(/\$(\d)/g,function(e,t){return r[t]}));o()};o()}})})}l.commands.find=function(e){y(e);r(e)};l.commands.findPersistent=function(e){y(e);r(e,false,true)};l.commands.findPersistentNext=function(e){r(e,false,true,true)};l.commands.findPersistentPrev=function(e){r(e,true,true,true)};l.commands.findNext=r;l.commands.findPrev=function(e){r(e,true)};l.commands.clearSearch=y;l.commands.replace=s;l.commands.replaceAll=function(e){s(e,true)}});(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(i){"use strict";var m=i.Pos;function t(e){var t=e.flags;return t!=null?t:(e.ignoreCase?"i":"")+(e.global?"g":"")+(e.multiline?"m":"")}function p(e){return e.global?e:new RegExp(e.source,t(e)+"g")}function v(e){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(e.source)}function g(e,t,r){t=p(t);for(var n=r.line,i=r.ch,o=e.lastLine();n<=o;n++,i=0){t.lastIndex=i;var a=e.getLine(n),s=t.exec(a);if(s)return{from:m(n,s.index),to:m(n,s.index+s[0].length),match:s}}}function o(e,t,r){if(!v(t))return g(e,t,r);t=p(t);var n,i=1;for(var o=r.line,a=e.lastLine();o<=a;){for(var s=0;s<i;s++){var l=e.getLine(o++);n=n==null?l:n+"\n"+l}i=i*2;t.lastIndex=r.ch;var u=t.exec(n);if(u){var c=n.slice(0,u.index).split("\n"),f=u[0].split("\n");var h=r.line+c.length-1,d=c[c.length-1].length;return{from:m(h,d),to:m(h+f.length-1,f.length==1?d+f[0].length:f[f.length-1].length),match:u}}}}function y(e,t){var r=0,n;for(;;){t.lastIndex=r;var i=t.exec(e);if(!i)return n;n=i;r=n.index+(n[0].length||1);if(r==e.length)return n}}function a(e,t,r){t=p(t);for(var n=r.line,i=r.ch,o=e.firstLine();n>=o;n--,i=-1){var a=e.getLine(n);if(i>-1)a=a.slice(0,i);var s=y(a,t);if(s)return{from:m(n,s.index),to:m(n,s.index+s[0].length),match:s}}}function s(e,t,r){t=p(t);var n,i=1;for(var o=r.line,a=e.firstLine();o>=a;){for(var s=0;s<i;s++){var l=e.getLine(o--);n=n==null?l.slice(0,r.ch):l+"\n"+n}i*=2;var u=y(n,t);if(u){var c=n.slice(0,u.index).split("\n"),f=u[0].split("\n");var h=o+c.length,d=c[c.length-1].length;return{from:m(h,d),to:m(h+f.length-1,f.length==1?d+f[0].length:f[f.length-1].length),match:u}}}}var b,w;if(String.prototype.normalize){b=function(e){return e.normalize("NFD").toLowerCase()};w=function(e){return e.normalize("NFD")}}else{b=function(e){return e.toLowerCase()};w=function(e){return e}}function k(e,t,r,n){if(e.length==t.length)return r;for(var i=0,o=r+Math.max(0,e.length-t.length);;){if(i==o)return i;var a=i+o>>1;var s=n(e.slice(0,a)).length;if(s==r)return a;else if(s>r)o=a;else i=a+1}}function l(e,t,r,n){if(!t.length)return null;var i=n?b:w;var o=i(t).split(/\r|\n\r?/);e:for(var a=r.line,s=r.ch,l=e.lastLine()+1-o.length;a<=l;a++,s=0){var u=e.getLine(a).slice(s),c=i(u);if(o.length==1){var f=c.indexOf(o[0]);if(f==-1)continue e;var r=k(u,c,f,i)+s;return{from:m(a,k(u,c,f,i)+s),to:m(a,k(u,c,f+o[0].length,i)+s)}}else{var h=c.length-o[0].length;if(c.slice(h)!=o[0])continue e;for(var d=1;d<o.length-1;d++)if(i(e.getLine(a+d))!=o[d])continue e;var p=e.getLine(a+o.length-1),v=i(p),g=o[o.length-1];if(p.slice(0,g.length)!=g)continue e;return{from:m(a,k(u,c,h,i)+s),to:m(a+o.length-1,k(p,v,g.length,i))}}}}function u(e,t,r,n){if(!t.length)return null;var i=n?b:w;var o=i(t).split(/\r|\n\r?/);e:for(var a=r.line,s=r.ch,l=e.firstLine()-1+o.length;a>=l;a--,s=-1){var u=e.getLine(a);if(s>-1)u=u.slice(0,s);var c=i(u);if(o.length==1){var f=c.lastIndexOf(o[0]);if(f==-1)continue e;return{from:m(a,k(u,c,f,i)),to:m(a,k(u,c,f+o[0].length,i))}}else{var h=o[o.length-1];if(c.slice(0,h.length)!=h)continue e;for(var d=1,r=a-o.length+1;d<o.length-1;d++)if(i(e.getLine(r+d))!=o[d])continue e;var p=e.getLine(a+1-o.length),v=i(p);if(v.slice(v.length-o[0].length)!=o[0])continue e;return{from:m(a+1-o.length,k(p,v,p.length-o[0].length,i)),to:m(a,k(u,c,h.length,i))}}}}function n(r,n,e,t){this.atOccurrence=false;this.doc=r;e=e?r.clipPos(e):m(0,0);this.pos={from:e,to:e};var i;if(typeof t=="object"){i=t.caseFold}else{i=t;t=null}if(typeof n=="string"){if(i==null)i=false;this.matches=function(e,t){return(e?u:l)(r,n,t,i)}}else{n=p(n);if(!t||t.multiline!==false)this.matches=function(e,t){return(e?s:o)(r,n,t)};else this.matches=function(e,t){return(e?a:g)(r,n,t)}}}n.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(e){var t=this.matches(e,this.doc.clipPos(e?this.pos.from:this.pos.to));while(t&&i.cmpPos(t.from,t.to)==0){if(e){if(t.from.ch)t.from=m(t.from.line,t.from.ch-1);else if(t.from.line==this.doc.firstLine())t=null;else t=this.matches(e,this.doc.clipPos(m(t.from.line-1)))}else{if(t.to.ch<this.doc.getLine(t.to.line).length)t.to=m(t.to.line,t.to.ch+1);else if(t.to.line==this.doc.lastLine())t=null;else t=this.matches(e,m(t.to.line+1,0))}}if(t){this.pos=t;this.atOccurrence=true;return this.pos.match||true}else{var r=m(e?this.doc.firstLine():this.doc.lastLine()+1,0);this.pos={from:r,to:r};return this.atOccurrence=false}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(e,t){if(!this.atOccurrence)return;var r=i.splitLines(e);this.doc.replaceRange(r,this.pos.from,this.pos.to,t);this.pos.to=m(this.pos.from.line+r.length-1,r[r.length-1].length+(r.length==1?this.pos.from.ch:0))}};i.defineExtension("getSearchCursor",function(e,t,r){return new n(this.doc,e,t,r)});i.defineDocExtension("getSearchCursor",function(e,t,r){return new n(this,e,t,r)});i.defineExtension("selectMatches",function(e,t){var r=[];var n=this.getSearchCursor(e,this.getCursor("from"),t);while(n.findNext()){if(i.cmpPos(n.to(),this.getCursor("to"))>0)break;r.push({anchor:n.from(),head:n.to()})}if(r.length)this.setSelections(r,0)})});(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(f){function h(e,t,r){var n=e.getWrapperElement();var i;i=n.appendChild(document.createElement("div"));if(r)i.className="CodeMirror-dialog CodeMirror-dialog-bottom";else i.className="CodeMirror-dialog CodeMirror-dialog-top";if(typeof t=="string"){i.innerHTML=t}else{i.appendChild(t)}return i}function d(e,t){if(e.state.currentNotificationClose)e.state.currentNotificationClose();e.state.currentNotificationClose=t}f.defineExtension("openDialog",function(e,t,r){if(!r)r={};d(this,null);var n=h(this,e,r.bottom);var i=false,o=this;function a(e){if(typeof e=="string"){s.value=e}else{if(i)return;i=true;n.parentNode.removeChild(n);o.focus();if(r.onClose)r.onClose(n)}}var s=n.getElementsByTagName("input")[0],l;if(s){s.focus();if(r.value){s.value=r.value;if(r.selectValueOnOpen!==false){s.select()}}if(r.onInput)f.on(s,"input",function(e){r.onInput(e,s.value,a)});if(r.onKeyUp)f.on(s,"keyup",function(e){r.onKeyUp(e,s.value,a)});f.on(s,"keydown",function(e){if(r&&r.onKeyDown&&r.onKeyDown(e,s.value,a)){return}if(e.keyCode==27||r.closeOnEnter!==false&&e.keyCode==13){s.blur();f.e_stop(e);a()}if(e.keyCode==13)t(s.value,e)});if(r.closeOnBlur!==false)f.on(s,"blur",a)}else if(l=n.getElementsByTagName("button")[0]){f.on(l,"click",function(){a();o.focus()});if(r.closeOnBlur!==false)f.on(l,"blur",a);l.focus()}return a});f.defineExtension("openConfirm",function(e,t,r){d(this,null);var n=h(this,e,r&&r.bottom);var i=n.getElementsByTagName("button");var o=false,a=this,s=1;function l(){if(o)return;o=true;n.parentNode.removeChild(n);a.focus()}i[0].focus();for(var u=0;u<i.length;++u){var c=i[u];(function(t){f.on(c,"click",function(e){f.e_preventDefault(e);l();if(t)t(a)})})(t[u]);f.on(c,"blur",function(){--s;setTimeout(function(){if(s<=0)l()},200)});f.on(c,"focus",function(){++s})}});f.defineExtension("openNotification",function(e,t){d(this,a);var r=h(this,e,t&&t.bottom);var n=false,i;var o=t&&typeof t.duration!=="undefined"?t.duration:5e3;function a(){if(n)return;n=true;clearTimeout(i);r.parentNode.removeChild(r)}f.on(r,"click",function(e){f.e_preventDefault(e);a()});if(o)i=setTimeout(a,o);return a})});(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],e);else e(CodeMirror)})(function(g){"use strict";g.runMode=function(e,t,r,n){var i=g.getMode(g.defaults,t);var o=/MSIE \d/.test(navigator.userAgent);var l=o&&(document.documentMode==null||document.documentMode<9);if(r.appendChild){var u=n&&n.tabSize||g.defaults.tabSize;var c=r,f=0;c.innerHTML="";r=function(e,t){if(e=="\n"){c.appendChild(document.createTextNode(l?"\r":e));f=0;return}var r="";for(var n=0;;){var i=e.indexOf("\t",n);if(i==-1){r+=e.slice(n);f+=e.length-n;break}else{f+=i-n;r+=e.slice(n,i);var o=u-f%u;f+=o;for(var a=0;a<o;++a)r+=" ";n=i+1}}if(t){var s=c.appendChild(document.createElement("span"));s.className="cm-"+t.replace(/ +/g," cm-");s.appendChild(document.createTextNode(r))}else{c.appendChild(document.createTextNode(r))}}}var a=g.splitLines(e),s=n&&n.state||g.startState(i);for(var h=0,d=a.length;h<d;++h){if(h)r("\n");var p=new g.StringStream(a[h]);if(!p.string&&i.blankLine)i.blankLine(s);while(!p.eol()){var v=i.token(p,s);r(p.current(),v,h,p.start,s);p.start=p.pos}}}});(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../lib/codemirror"),require("../addon/search/searchcursor"),require("../addon/dialog/dialog"),require("../addon/edit/matchbrackets.js"));else if(typeof define=="function"&&define.amd)define(["../lib/codemirror","../addon/search/searchcursor","../addon/dialog/dialog","../addon/edit/matchbrackets"],e);else e(CodeMirror)})(function(It){"use strict";var Pt=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:false}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:true}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:true,linewise:true}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:false,linewise:true}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:true}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:false}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false,bigWord:true}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,inclusive:true}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,bigWord:true,inclusive:true}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false,bigWord:true}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,inclusive:true}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,bigWord:true,inclusive:true}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:false,toJumplist:true}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:true,toJumplist:true}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:true}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:false}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:true,explicitRepeat:true}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:false,explicitRepeat:true}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:true,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:false,toFirstChar:true}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:true}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:true,toJumplist:true}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:false}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:false}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:true}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:false}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true,linewise:true}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:true}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:false}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:true,linewise:true}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:false,linewise:true}},{keys:"]p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true,matchIndent:true}},{keys:"[p",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true,matchIndent:true}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:true,toJumplist:true}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:false,toJumplist:true}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:true},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:true}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:false}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:true},isEdit:true},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:false},isEdit:true},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:true}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:false,toJumplist:true}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:true},operatorMotionArgs:{visualLine:false}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:false},operatorMotionArgs:{visualLine:true}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:true},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"expandToLine",motionArgs:{linewise:true},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:true},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:true},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:true},operatorArgs:{shouldMoveCursor:true},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false},context:"insert"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:true}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:false}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:true,linewise:true}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:false,linewise:true}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:true},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:false},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:true}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:true}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:true}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:true},{keys:"p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true}},{keys:"P",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true}},{keys:"r<character>",type:"action",action:"replace",isEdit:true},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{replace:true}},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:true},context:"visual",isEdit:true},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:false},context:"visual",isEdit:true},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:true,backtrack:false}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:false,backtrack:false}},{keys:"<C-t>",type:"action",action:"indent",actionArgs:{indentRight:true},context:"insert"},{keys:"<C-d>",type:"action",action:"indent",actionArgs:{indentRight:false},context:"insert"},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:true}},{keys:"/",type:"search",searchArgs:{forward:true,querySrc:"prompt",toJumplist:true}},{keys:"?",type:"search",searchArgs:{forward:false,querySrc:"prompt",toJumplist:true}},{keys:"*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"g*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",toJumplist:true}},{keys:"g#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",toJumplist:true}},{keys:":",type:"ex"}];var Rt=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:true},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:true},{name:"global",shortName:"g"}];var Bt=It.Pos;var e=function(){function r(e){e.setOption("disableInput",true);e.setOption("showCursorWhenSelecting",false);It.signal(e,"vim-mode-change",{mode:"normal"});e.on("cursorActivity",Lt);I(e);It.on(e.getInputField(),"paste",l(e))}function n(e){e.setOption("disableInput",false);e.off("cursorActivity",Lt);It.off(e.getInputField(),"paste",l(e));e.state.vim=null}function e(e,t){if(this==It.keyMap.vim)It.rmClass(e.getWrapperElement(),"cm-fat-cursor");if(!t||t.attach!=i)n(e)}function i(e,t){if(this==It.keyMap.vim)It.addClass(e.getWrapperElement(),"cm-fat-cursor");if(!t||t.attach!=i)r(e)}It.defineOption("vimMode",false,function(e,t,r){if(t&&e.getOption("keyMap")!="vim")e.setOption("keyMap","vim");else if(!t&&r!=It.Init&&/^vim/.test(e.getOption("keyMap")))e.setOption("keyMap","default")});function t(e,t){if(!t){return undefined}if(this[e]){return this[e]}var r=o(e);if(!r){return false}var n=It.Vim.findKey(t,r);if(typeof n=="function"){It.signal(t,"vim-keypress",r)}return n}var a={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A"};var s={Enter:"CR",Backspace:"BS",Delete:"Del",Insert:"Ins"};function o(e){if(e.charAt(0)=="'"){return e.charAt(1)}var t=e.split(/-(?!$)/);var r=t[t.length-1];if(t.length==1&&t[0].length==1){return false}else if(t.length==2&&t[0]=="Shift"&&r.length==1){return false}var n=false;for(var i=0;i<t.length;i++){var o=t[i];if(o in a){t[i]=a[o]}else{n=true}if(o in s){t[i]=s[o]}}if(!n){return false}if(C(r)){t[t.length-1]=r.toLowerCase()}return"<"+t.join("-")+">"}function l(e){var t=e.state.vim;if(!t.onPasteFn){t.onPasteFn=function(){if(!t.insertMode){e.setCursor(Q(e.getCursor(),0,1));X.enterInsertMode(e,{},t)}}}return t.onPasteFn}var u=/[\d]/;var v=[It.isWordChar,function(e){return e&&!It.isWordChar(e)&&!/\s/.test(e)}],g=[function(e){return/\S/.test(e)}];function c(e,t){var r=[];for(var n=e;n<e+t;n++){r.push(String.fromCharCode(n))}return r}var f=c(65,26);var h=c(97,26);var d=c(48,10);var p=[].concat(f,h,d,["<",">"]);var m=[].concat(f,h,d,["-",'"',".",":","/"]);function y(e,t){return t>=e.firstLine()&&t<=e.lastLine()}function b(e){return/^[a-z]$/.test(e)}function w(e){return"()[]{}".indexOf(e)!=-1}function k(e){return u.test(e)}function C(e){return/^[A-Z]$/.test(e)}function x(e){return/^\s*$/.test(e)}function S(e,t){for(var r=0;r<t.length;r++){if(t[r]==e){return true}}return false}var L={};function A(e,t,r,n,i){if(t===undefined&&!i){throw Error("defaultValue is required unless callback is provided")}if(!r){r="string"}L[e]={type:r,defaultValue:t,callback:i};if(n){for(var o=0;o<n.length;o++){L[n[o]]=L[e]}}if(t){M(e,t)}}function M(e,t,r,n){var i=L[e];n=n||{};var o=n.scope;if(!i){return new Error("Unknown option: "+e)}if(i.type=="boolean"){if(t&&t!==true){return new Error("Invalid argument: "+e+"="+t)}else if(t!==false){t=true}}if(i.callback){if(o!=="local"){i.callback(t,undefined)}if(o!=="global"&&r){i.callback(t,r)}}else{if(o!=="local"){i.value=i.type=="boolean"?!!t:t}if(o!=="global"&&r){r.state.vim.options[e]={value:t}}}}function T(e,t,r){var n=L[e];r=r||{};var i=r.scope;if(!n){return new Error("Unknown option: "+e)}if(n.callback){var o=t&&n.callback(undefined,t);if(i!=="global"&&o!==undefined){return o}if(i!=="local"){return n.callback()}return}else{var o=i!=="global"&&(t&&t.state.vim.options[e]);return(o||i!=="local"&&n||{}).value}}A("filetype",undefined,"string",["ft"],function(e,t){if(t===undefined){return}if(e===undefined){var r=t.getOption("mode");return r=="null"?"":r}else{var r=e==""?"null":e;t.setOption("mode",r)}});var O=function(){var s=100;var l=-1;var u=0;var c=0;var f=new Array(s);function e(n,e,t){var r=l%s;var i=f[r];function o(e){var t=++l%s;var r=f[t];if(r){r.clear()}f[t]=n.setBookmark(e)}if(i){var a=i.find();if(a&&!ae(a,e)){o(e)}}else{o(e)}o(t);u=l;c=l-s+1;if(c<0){c=0}}function t(e,t){l+=t;if(l>u){l=u}else if(l<c){l=c}var r=f[(s+l)%s];if(r&&!r.find()){var n=t>0?1:-1;var i;var o=e.getCursor();do{l+=n;r=f[(s+l)%s];if(r&&(i=r.find())&&!ae(o,i)){break}}while(l<u&&l>c)}return r}return{cachedCursor:undefined,add:e,move:t}};var E=function(e){if(e){return{changes:e.changes,expectCursorActivityForChange:e.expectCursorActivityForChange}}return{changes:[],expectCursorActivityForChange:false}};function N(){this.latestRegister=undefined;this.isPlaying=false;this.isRecording=false;this.replaySearchQueries=[];this.onRecordingDone=undefined;this.lastInsertModeChanges=E()}N.prototype={exitMacroRecordMode:function(){var e=P.macroModeState;if(e.onRecordingDone){e.onRecordingDone()}e.onRecordingDone=undefined;e.isRecording=false},enterMacroRecordMode:function(e,t){var r=P.registerController.getRegister(t);if(r){r.clear();this.latestRegister=t;if(e.openDialog){this.onRecordingDone=e.openDialog("(recording)["+t+"]",null,{bottom:true})}this.isRecording=true}}};function I(e){if(!e.state.vim){e.state.vim={inputState:new H,lastEditInputState:undefined,lastEditActionCommand:undefined,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},fakeCursor:null,insertMode:false,insertModeRepeat:undefined,visualMode:false,visualLine:false,visualBlock:false,lastSelection:null,lastPastedText:null,sel:{},options:{}}}return e.state.vim}var P;function R(){P={searchQuery:null,searchIsReversed:false,lastSubstituteReplacePart:undefined,jumpList:O(),macroModeState:new N,lastCharacterSearch:{increment:0,forward:true,selectedCharacter:""},registerController:new z({}),searchHistoryController:new j,exCommandHistoryController:new j};for(var e in L){var t=L[e];t.value=t.defaultValue}}var B;var D={buildKeyMap:function(){},getRegisterController:function(){return P.registerController},resetVimGlobalState_:R,getVimGlobalState_:function(){return P},maybeInitVimState_:I,suppressErrorLogging:false,InsertModeKey:Tt,map:function(e,t,r){vt.map(e,t,r)},unmap:function(e,t){vt.unmap(e,t)},setOption:M,getOption:T,defineOption:A,defineEx:function(e,t,r){if(!t){t=e}else if(e.indexOf(t)!==0){throw new Error('(Vim.defineEx) "'+t+'" is not a prefix of "'+e+'", command not registered')}pt[e]=r;vt.commandMap_[t]={name:e,shortName:t,type:"api"}},handleKey:function(e,t,r){var n=this.findKey(e,t,r);if(typeof n==="function"){return n()}},findKey:function(s,l,t){var u=I(s);function i(){var e=P.macroModeState;if(e.isRecording){if(l=="q"){e.exitMacroRecordMode();_(s);return true}if(t!="mapping"){kt(e,l)}}}function c(){if(l=="<Esc>"){_(s);if(u.visualMode){Se(s)}else if(u.insertMode){mt(s)}return true}}function e(e){var t;while(e){t=/<\w+-.+?>|<\w+>|./.exec(e);l=t[0];e=e.substring(t.index+l.length);It.Vim.handleKey(s,l,"mapping")}}function r(){if(c()){return true}var e=u.inputState.keyBuffer=u.inputState.keyBuffer+l;var t=l.length==1;var r=K.matchCommand(e,Pt,u.inputState,"insert");while(e.length>1&&r.type!="full"){var e=u.inputState.keyBuffer=e.slice(1);var n=K.matchCommand(e,Pt,u.inputState,"insert");if(n.type!="none"){r=n}}if(r.type=="none"){_(s);return false}else if(r.type=="partial"){if(B){window.clearTimeout(B)}B=window.setTimeout(function(){if(u.insertMode&&u.inputState.keyBuffer){_(s)}},T("insertModeEscKeysTimeout"));return!t}if(B){window.clearTimeout(B)}if(t){var i=s.listSelections();for(var o=0;o<i.length;o++){var a=i[o].head;s.replaceRange("",Q(a,0,-(e.length-1)),a,"+input")}P.macroModeState.lastInsertModeChanges.changes.pop()}_(s);return r.command}function n(){if(i()||c()){return true}var e=u.inputState.keyBuffer=u.inputState.keyBuffer+l;if(/^[1-9]\d*$/.test(e)){return true}var t=/^(\d*)(.*)$/.exec(e);if(!t){_(s);return false}var r=u.visualMode?"visual":"normal";var n=K.matchCommand(t[2]||t[1],Pt,u.inputState,r);if(n.type=="none"){_(s);return false}else if(n.type=="partial"){return true}u.inputState.keyBuffer="";var t=/^(\d*)(.*)$/.exec(e);if(t[1]&&t[1]!="0"){u.inputState.pushRepeatDigit(t[1])}return n.command}var o;if(u.insertMode){o=r()}else{o=n()}if(o===false){return undefined}else if(o===true){return function(){return true}}else{return function(){return s.operation(function(){s.curOp.isVimOp=true;try{if(o.type=="keyToKey"){e(o.toKeys)}else{K.processCommand(s,u,o)}}catch(e){s.state.vim=undefined;I(s);if(!It.Vim.suppressErrorLogging){console["log"](e)}throw e}return true})}}},handleEx:function(e,t){vt.processCommand(e,t)},defineMotion:V,defineAction:J,defineOperator:Y,mapCommand:bt,_mapCommand:yt,defineRegister:F,exitVisualMode:Se,exitInsertMode:mt};function H(){this.prefixRepeat=[];this.motionRepeat=[];this.operator=null;this.operatorArgs=null;this.motion=null;this.motionArgs=null;this.keyBuffer=[];this.registerName=null}H.prototype.pushRepeatDigit=function(e){if(!this.operator){this.prefixRepeat=this.prefixRepeat.concat(e)}else{this.motionRepeat=this.motionRepeat.concat(e)}};H.prototype.getRepeat=function(){var e=0;if(this.prefixRepeat.length>0||this.motionRepeat.length>0){e=1;if(this.prefixRepeat.length>0){e*=parseInt(this.prefixRepeat.join(""),10)}if(this.motionRepeat.length>0){e*=parseInt(this.motionRepeat.join(""),10)}}return e};function _(e,t){e.state.vim.inputState=new H;It.signal(e,"vim-command-done",t)}function W(e,t,r){this.clear();this.keyBuffer=[e||""];this.insertModeChanges=[];this.searchQueries=[];this.linewise=!!t;this.blockwise=!!r}W.prototype={setText:function(e,t,r){this.keyBuffer=[e||""];this.linewise=!!t;this.blockwise=!!r},pushText:function(e,t){if(t){if(!this.linewise){this.keyBuffer.push("\n")}this.linewise=true}this.keyBuffer.push(e)},pushInsertModeChanges:function(e){this.insertModeChanges.push(E(e))},pushSearchQuery:function(e){this.searchQueries.push(e)},clear:function(){this.keyBuffer=[];this.insertModeChanges=[];this.searchQueries=[];this.linewise=false},toString:function(){return this.keyBuffer.join("")}};function F(e,t){var r=P.registerController.registers;if(!e||e.length!=1){throw Error("Register name must be 1 character")}if(r[e]){throw Error("Register already defined "+e)}r[e]=t;m.push(e)}function z(e){this.registers=e;this.unnamedRegister=e['"']=new W;e["."]=new W;e[":"]=new W;e["/"]=new W}z.prototype={pushText:function(e,t,r,n,i){if(n&&r.charAt(r.length-1)!=="\n"){r+="\n"}var o=this.isValidRegister(e)?this.getRegister(e):null;if(!o){switch(t){case"yank":this.registers["0"]=new W(r,n,i);break;case"delete":case"change":if(r.indexOf("\n")==-1){this.registers["-"]=new W(r,n)}else{this.shiftNumericRegisters_();this.registers["1"]=new W(r,n)}break}this.unnamedRegister.setText(r,n,i);return}var a=C(e);if(a){o.pushText(r,n)}else{o.setText(r,n,i)}this.unnamedRegister.setText(o.toString(),n)},getRegister:function(e){if(!this.isValidRegister(e)){return this.unnamedRegister}e=e.toLowerCase();if(!this.registers[e]){this.registers[e]=new W}return this.registers[e]},isValidRegister:function(e){return e&&S(e,m)},shiftNumericRegisters_:function(){for(var e=9;e>=2;e--){this.registers[e]=this.getRegister(""+(e-1))}}};function j(){this.historyBuffer=[];this.iterator=0;this.initialPrefix=null}j.prototype={nextMatch:function(e,t){var r=this.historyBuffer;var n=t?-1:1;if(this.initialPrefix===null)this.initialPrefix=e;for(var i=this.iterator+n;t?i>=0:i<r.length;i+=n){var o=r[i];for(var a=0;a<=o.length;a++){if(this.initialPrefix==o.substring(0,a)){this.iterator=i;return o}}}if(i>=r.length){this.iterator=r.length;return this.initialPrefix}if(i<0)return e},pushInput:function(e){var t=this.historyBuffer.indexOf(e);if(t>-1)this.historyBuffer.splice(t,1);if(e.length)this.historyBuffer.push(e)},reset:function(){this.initialPrefix=null;this.iterator=this.historyBuffer.length}};var K={matchCommand:function(e,t,r,n){var i=te(e,t,n,r);if(!i.full&&!i.partial){return{type:"none"}}else if(!i.full&&i.partial){return{type:"partial"}}var o;for(var a=0;a<i.full.length;a++){var s=i.full[a];if(!o){o=s}}if(o.keys.slice(-11)=="<character>"){var l=ne(e);if(!l)return{type:"none"};r.selectedCharacter=l}return{type:"full",command:o}},processCommand:function(e,t,r){t.inputState.repeatOverride=r.repeatOverride;switch(r.type){case"motion":this.processMotion(e,t,r);break;case"operator":this.processOperator(e,t,r);break;case"operatorMotion":this.processOperatorMotion(e,t,r);break;case"action":this.processAction(e,t,r);break;case"search":this.processSearch(e,t,r);break;case"ex":case"keyToEx":this.processEx(e,t,r);break;default:break}},processMotion:function(e,t,r){t.inputState.motion=r.motion;t.inputState.motionArgs=$(r.motionArgs);this.evalInput(e,t)},processOperator:function(e,t,r){var n=t.inputState;if(n.operator){if(n.operator==r.operator){n.motion="expandToLine";n.motionArgs={linewise:true};this.evalInput(e,t);return}else{_(e)}}n.operator=r.operator;n.operatorArgs=$(r.operatorArgs);if(t.visualMode){this.evalInput(e,t)}},processOperatorMotion:function(e,t,r){var n=t.visualMode;var i=$(r.operatorMotionArgs);if(i){if(n&&i.visualLine){t.visualLine=true}}this.processOperator(e,t,r);if(!n){this.processMotion(e,t,r)}},processAction:function(e,t,r){var n=t.inputState;var i=n.getRepeat();var o=!!i;var a=$(r.actionArgs)||{};if(n.selectedCharacter){a.selectedCharacter=n.selectedCharacter}if(r.operator){this.processOperator(e,t,r)}if(r.motion){this.processMotion(e,t,r)}if(r.motion||r.operator){this.evalInput(e,t)}a.repeat=i||1;a.repeatIsExplicit=o;a.registerName=n.registerName;_(e);t.lastMotion=null;if(r.isEdit){this.recordLastEdit(t,n,r)}X[r.action](e,a,t)},processSearch:function(s,n,i){if(!s.getSearchCursor){return}var l=i.searchArgs.forward;var e=i.searchArgs.wholeWordOnly;Ue(s).setReversed(!l);var t=l?"/":"?";var o=Ue(s).getQuery();var u=s.getScrollInfo();function r(t,e,r){P.searchHistoryController.pushInput(t);P.searchHistoryController.reset();try{ot(s,t,e,r)}catch(e){et(s,"Invalid regex: "+t);_(s);return}K.processMotion(s,n,{type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:i.searchArgs.toJumplist}})}function a(e){s.scrollTo(u.left,u.top);r(e,true,true);var t=P.macroModeState;if(t.isRecording){xt(t,e)}}function c(e,t,r){var n=It.keyName(e),i,o;if(n=="Up"||n=="Down"){i=n=="Up"?true:false;o=e.target?e.target.selectionEnd:0;t=P.searchHistoryController.nextMatch(t,i)||"";r(t);if(o&&e.target)e.target.selectionEnd=e.target.selectionStart=Math.min(o,e.target.value.length)}else{if(n!="Left"&&n!="Right"&&n!="Ctrl"&&n!="Alt"&&n!="Shift")P.searchHistoryController.reset()}var a;try{a=ot(s,t,true,true)}catch(e){}if(a){s.scrollIntoView(lt(s,!l,a),30)}else{ut(s);s.scrollTo(u.left,u.top)}}function f(e,t,r){var n=It.keyName(e);if(n=="Esc"||n=="Ctrl-C"||n=="Ctrl-["||n=="Backspace"&&t==""){P.searchHistoryController.pushInput(t);P.searchHistoryController.reset();ot(s,o);ut(s);s.scrollTo(u.left,u.top);It.e_stop(e);_(s);r();s.focus()}else if(n=="Up"||n=="Down"){It.e_stop(e)}else if(n=="Ctrl-U"){It.e_stop(e);r("")}}switch(i.searchArgs.querySrc){case"prompt":var h=P.macroModeState;if(h.isPlaying){var d=h.replaySearchQueries.shift();r(d,true,false)}else{nt(s,{onClose:a,prefix:t,desc:rt,onKeyUp:c,onKeyDown:f})}break;case"wordUnderCursor":var p=Te(s,false,true,false,true);var v=true;if(!p){p=Te(s,false,true,false,false);v=false}if(!p){return}var d=s.getLine(p.start.line).substring(p.start.ch,p.end.ch);if(v&&e){d="\\b"+d+"\\b"}else{d=de(d)}P.jumpList.cachedCursor=s.getCursor();s.setCursor(p.start);r(d,true,false);break}},processEx:function(a,e,t){function r(e){P.exCommandHistoryController.pushInput(e);P.exCommandHistoryController.reset();vt.processCommand(a,e)}function n(e,t,r){var n=It.keyName(e),i,o;if(n=="Esc"||n=="Ctrl-C"||n=="Ctrl-["||n=="Backspace"&&t==""){P.exCommandHistoryController.pushInput(t);P.exCommandHistoryController.reset();It.e_stop(e);_(a);r();a.focus()}if(n=="Up"||n=="Down"){It.e_stop(e);i=n=="Up"?true:false;o=e.target?e.target.selectionEnd:0;t=P.exCommandHistoryController.nextMatch(t,i)||"";r(t);if(o&&e.target)e.target.selectionEnd=e.target.selectionStart=Math.min(o,e.target.value.length)}else if(n=="Ctrl-U"){It.e_stop(e);r("")}else{if(n!="Left"&&n!="Right"&&n!="Ctrl"&&n!="Alt"&&n!="Shift")P.exCommandHistoryController.reset()}}if(t.type=="keyToEx"){vt.processCommand(a,t.exArgs.input)}else{if(e.visualMode){nt(a,{onClose:r,prefix:":",value:"'<,'>",onKeyDown:n})}else{nt(a,{onClose:r,prefix:":",onKeyDown:n})}}},evalInput:function(e,t){var r=t.inputState;var n=r.motion;var i=r.motionArgs||{};var o=r.operator;var a=r.operatorArgs||{};var s=r.registerName;var l=t.sel;var u=oe(t.visualMode?Z(e,l.head):e.getCursor("head"));var c=oe(t.visualMode?Z(e,l.anchor):e.getCursor("anchor"));var f=oe(u);var h=oe(c);var d,p;var v;if(o){this.recordLastEdit(t,r)}if(r.repeatOverride!==undefined){v=r.repeatOverride}else{v=r.getRepeat()}if(v>0&&i.explicitRepeat){i.repeatIsExplicit=true}else if(i.noRepeat||!i.explicitRepeat&&v===0){v=1;i.repeatIsExplicit=false}if(r.selectedCharacter){i.selectedCharacter=a.selectedCharacter=r.selectedCharacter}i.repeat=v;_(e);if(n){var g=U[n](e,u,i,t);t.lastMotion=U[n];if(!g){return}if(i.toJumplist){var m=P.jumpList;var y=m.cachedCursor;if(y){Oe(e,y,g);delete m.cachedCursor}else{Oe(e,u,g)}}if(g instanceof Array){p=g[0];d=g[1]}else{d=g}if(!d){d=oe(u)}if(t.visualMode){if(!(t.visualBlock&&d.ch===Infinity)){d=Z(e,d,t.visualBlock)}if(p){p=Z(e,p,true)}p=p||h;l.anchor=p;l.head=d;ke(e);_e(e,t,"<",se(p,d)?p:d);_e(e,t,">",se(p,d)?d:p)}else if(!o){d=Z(e,d);e.setCursor(d.line,d.ch)}}if(o){if(a.lastSel){p=h;var b=a.lastSel;var w=Math.abs(b.head.line-b.anchor.line);var k=Math.abs(b.head.ch-b.anchor.ch);if(b.visualLine){d=Bt(h.line+w,h.ch)}else if(b.visualBlock){d=Bt(h.line+w,h.ch+k)}else if(b.head.line==b.anchor.line){d=Bt(h.line,h.ch+k)}else{d=Bt(h.line+w,h.ch)}t.visualMode=true;t.visualLine=b.visualLine;t.visualBlock=b.visualBlock;l=t.sel={anchor:p,head:d};ke(e)}else if(t.visualMode){a.lastSel={anchor:oe(l.anchor),head:oe(l.head),visualBlock:t.visualBlock,visualLine:t.visualLine}}var C,x,S,L;var A;if(t.visualMode){C=le(l.head,l.anchor);x=ue(l.head,l.anchor);S=t.visualLine||a.linewise;L=t.visualBlock?"block":S?"line":"char";A=Ce(e,{anchor:C,head:x},L);if(S){var M=A.ranges;if(L=="block"){for(var T=0;T<M.length;T++){M[T].head.ch=fe(e,M[T].head.line)}}else if(L=="line"){M[0].head=Bt(M[0].head.line+1,0)}}}else{C=oe(p||h);x=oe(d||f);if(se(x,C)){var O=C;C=x;x=O}S=i.linewise||a.linewise;if(S){Ae(e,C,x)}else if(i.forward){Le(e,C,x)}L="char";var E=!i.inclusive||S;A=Ce(e,{anchor:C,head:x},L,E)}e.setSelections(A.ranges,A.primary);t.lastMotion=null;a.repeat=v;a.registerName=s;a.linewise=S;var N=q[o](e,a,A.ranges,h,d);if(t.visualMode){Se(e,N!=null)}if(N){e.setCursor(N)}}},recordLastEdit:function(e,t,r){var n=P.macroModeState;if(n.isPlaying){return}e.lastEditInputState=t;e.lastEditActionCommand=r;n.lastInsertModeChanges.changes=[];n.lastInsertModeChanges.expectCursorActivityForChange=false}};var U={moveToTopLine:function(e,t,r){var n=ft(e).top+r.repeat-1;return Bt(n,Me(e.getLine(n)))},moveToMiddleLine:function(e){var t=ft(e);var r=Math.floor((t.top+t.bottom)*.5);return Bt(r,Me(e.getLine(r)))},moveToBottomLine:function(e,t,r){var n=ft(e).bottom-r.repeat+1;return Bt(n,Me(e.getLine(n)))},expandToLine:function(e,t,r){var n=t;return Bt(n.line+r.repeat-1,Infinity)},findNext:function(e,t,r){var n=Ue(e);var i=n.getQuery();if(!i){return}var o=!r.forward;o=n.isReversed()?!o:o;st(e,i);return lt(e,o,i,r.repeat)},goToMark:function(e,t,r,n){var i=ht(e,n,r.selectedCharacter);if(i){return r.linewise?{line:i.line,ch:Me(e.getLine(i.line))}:i}return null},moveToOtherHighlightedEnd:function(e,t,r,n){if(n.visualBlock&&r.sameLine){var i=n.sel;return[Z(e,Bt(i.anchor.line,i.head.ch)),Z(e,Bt(i.head.line,i.anchor.ch))]}else{return[n.sel.head,n.sel.anchor]}},jumpToMark:function(e,t,r,n){var i=t;for(var o=0;o<r.repeat;o++){var a=i;for(var s in n.marks){if(!b(s)){continue}var l=n.marks[s].find();var u=r.forward?se(l,a):se(a,l);if(u){continue}if(r.linewise&&l.line==a.line){continue}var c=ae(a,i);var f=r.forward?ce(a,l,i):ce(i,l,a);if(c||f){i=l}}}if(r.linewise){i=Bt(i.line,Me(e.getLine(i.line)))}return i},moveByCharacters:function(e,t,r){var n=t;var i=r.repeat;var o=r.forward?n.ch+i:n.ch-i;return Bt(n.line,o)},moveByLines:function(e,t,r,n){var i=t;var o=i.ch;switch(n.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:o=n.lastHPos;break;default:n.lastHPos=o}var a=r.repeat+(r.repeatOffset||0);var s=r.forward?i.line+a:i.line-a;var l=e.firstLine();var u=e.lastLine();if(s<l&&i.line==l){return this.moveToStartOfLine(e,t,r,n)}else if(s>u&&i.line==u){return this.moveToEol(e,t,r,n)}if(r.toFirstChar){o=Me(e.getLine(s));n.lastHPos=o}n.lastHSPos=e.charCoords(Bt(s,o),"div").left;return Bt(s,o)},moveByDisplayLines:function(e,t,r,n){var i=t;switch(n.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:n.lastHSPos=e.charCoords(i,"div").left}var o=r.repeat;var a=e.findPosV(i,r.forward?o:-o,"line",n.lastHSPos);if(a.hitSide){if(r.forward){var s=e.charCoords(a,"div");var l={top:s.top+8,left:n.lastHSPos};var a=e.coordsChar(l,"div")}else{var u=e.charCoords(Bt(e.firstLine(),0),"div");u.left=n.lastHSPos;a=e.coordsChar(u,"div")}}n.lastHPos=a.ch;return a},moveByPage:function(e,t,r){var n=t;var i=r.repeat;return e.findPosV(n,r.forward?i:-i,"page")},moveByParagraph:function(e,t,r){var n=r.forward?1:-1;return Fe(e,t,r.repeat,n)},moveByScroll:function(e,t,r,n){var i=e.getScrollInfo();var o=null;var a=r.repeat;if(!a){a=i.clientHeight/(2*e.defaultTextHeight())}var s=e.charCoords(t,"local");r.repeat=a;var o=U.moveByDisplayLines(e,t,r,n);if(!o){return null}var l=e.charCoords(o,"local");e.scrollTo(null,i.top+l.top-s.top);return o},moveByWords:function(e,t,r){return Be(e,t,r.repeat,!!r.forward,!!r.wordEnd,!!r.bigWord)},moveTillCharacter:function(e,t,r){var n=r.repeat;var i=De(e,n,r.forward,r.selectedCharacter);var o=r.forward?-1:1;Ee(o,r);if(!i)return null;i.ch+=o;return i},moveToCharacter:function(e,t,r){var n=r.repeat;Ee(0,r);return De(e,n,r.forward,r.selectedCharacter)||t},moveToSymbol:function(e,t,r){var n=r.repeat;return Pe(e,n,r.forward,r.selectedCharacter)||t},moveToColumn:function(e,t,r,n){var i=r.repeat;n.lastHPos=i-1;n.lastHSPos=e.charCoords(t,"div").left;return He(e,i)},moveToEol:function(e,t,r,n){var i=t;n.lastHPos=Infinity;var o=Bt(i.line+r.repeat-1,Infinity);var a=e.clipPos(o);a.ch--;n.lastHSPos=e.charCoords(a,"div").left;return o},moveToFirstNonWhiteSpaceCharacter:function(e,t){var r=t;return Bt(r.line,Me(e.getLine(r.line)))},moveToMatchedSymbol:function(e,t){var r=t;var n=r.line;var i=r.ch;var o=e.getLine(n);var a;for(;i<o.length;i++){a=o.charAt(i);if(a&&w(a)){var s=e.getTokenTypeAt(Bt(n,i+1));if(s!=="string"&&s!=="comment"){break}}}if(i<o.length){var l=e.findMatchingBracket(Bt(n,i));return l.to}else{return r}},moveToStartOfLine:function(e,t){return Bt(t.line,0)},moveToLineOrEdgeOfDocument:function(e,t,r){var n=r.forward?e.lastLine():e.firstLine();if(r.repeatIsExplicit){n=r.repeat-e.getOption("firstLineNumber")}return Bt(n,Me(e.getLine(n)))},textObjectManipulation:function(e,t,r,n){var i={"(":")",")":"(","{":"}","}":"{","[":"]","]":"["};var o={"'":true,'"':true};var a=r.selectedCharacter;if(a=="b"){a="("}else if(a=="B"){a="{"}var s=!r.textObjectInner;var l;if(i[a]){l=ze(e,t,a,s)}else if(o[a]){l=je(e,t,a,s)}else if(a==="W"){l=Te(e,s,true,true)}else if(a==="w"){l=Te(e,s,true,false)}else if(a==="p"){l=Fe(e,t,r.repeat,0,s);r.linewise=true;if(n.visualMode){if(!n.visualLine){n.visualLine=true}}else{var u=n.inputState.operatorArgs;if(u){u.linewise=true}l.end.line--}}else{return null}if(!e.state.vim.visualMode){return[l.start,l.end]}else{return we(e,l.start,l.end)}},repeatLastCharacterSearch:function(e,t,r){var n=P.lastCharacterSearch;var i=r.repeat;var o=r.forward===n.forward;var a=(n.increment?1:0)*(o?-1:1);e.moveH(-a,"char");r.inclusive=o?true:false;var s=De(e,i,o,n.selectedCharacter);if(!s){e.moveH(a,"char");return t}s.ch+=a;return s}};function V(e,t){U[e]=t}function G(e,t){var r=[];for(var n=0;n<t;n++){r.push(e)}return r}var q={change:function(e,t,r){var n,i;var o=e.state.vim;P.macroModeState.lastInsertModeChanges.inVisualBlock=o.visualBlock;if(!o.visualMode){var a=r[0].anchor,s=r[0].head;i=e.getRange(a,s);var l=o.lastEditInputState||{};if(l.motion=="moveByWords"&&!x(i)){var u=/\s+$/.exec(i);if(u&&l.motionArgs&&l.motionArgs.forward){s=Q(s,0,-u[0].length);i=i.slice(0,-u[0].length)}}var c=new Bt(a.line-1,Number.MAX_VALUE);var f=e.firstLine()==e.lastLine();if(s.line>e.lastLine()&&t.linewise&&!f){e.replaceRange("",c,s)}else{e.replaceRange("",a,s)}if(t.linewise){if(!f){e.setCursor(c);It.commands.newlineAndIndent(e)}a.ch=Number.MAX_VALUE}n=a}else{i=e.getSelection();var h=G("",r.length);e.replaceSelections(h);n=le(r[0].head,r[0].anchor)}P.registerController.pushText(t.registerName,"change",i,t.linewise,r.length>1);X.enterInsertMode(e,{head:n},e.state.vim)},delete:function(e,t,r){var n,i;var o=e.state.vim;if(!o.visualBlock){var a=r[0].anchor,s=r[0].head;if(t.linewise&&s.line!=e.firstLine()&&a.line==e.lastLine()&&a.line==s.line-1){if(a.line==e.firstLine()){a.ch=0}else{a=Bt(a.line-1,fe(e,a.line-1))}}i=e.getRange(a,s);e.replaceRange("",a,s);n=a;if(t.linewise){n=U.moveToFirstNonWhiteSpaceCharacter(e,a)}}else{i=e.getSelection();var l=G("",r.length);e.replaceSelections(l);n=r[0].anchor}P.registerController.pushText(t.registerName,"delete",i,t.linewise,o.visualBlock);return Z(e,n)},indent:function(e,t,r){var n=e.state.vim;var i=r[0].anchor.line;var o=n.visualBlock?r[r.length-1].anchor.line:r[0].head.line;var a=n.visualMode?t.repeat:1;if(t.linewise){o--}for(var s=i;s<=o;s++){for(var l=0;l<a;l++){e.indentLine(s,t.indentRight)}}return U.moveToFirstNonWhiteSpaceCharacter(e,r[0].anchor)},changeCase:function(e,t,r,n,i){var o=e.getSelections();var a=[];var s=t.toLower;for(var l=0;l<o.length;l++){var u=o[l];var c="";if(s===true){c=u.toLowerCase()}else if(s===false){c=u.toUpperCase()}else{for(var f=0;f<u.length;f++){var h=u.charAt(f);c+=C(h)?h.toLowerCase():h.toUpperCase()}}a.push(c)}e.replaceSelections(a);if(t.shouldMoveCursor){return i}else if(!e.state.vim.visualMode&&t.linewise&&r[0].anchor.line+1==r[0].head.line){return U.moveToFirstNonWhiteSpaceCharacter(e,n)}else if(t.linewise){return n}else{return le(r[0].anchor,r[0].head)}},yank:function(e,t,r,n){var i=e.state.vim;var o=e.getSelection();var a=i.visualMode?le(i.sel.anchor,i.sel.head,r[0].head,r[0].anchor):n;P.registerController.pushText(t.registerName,"yank",o,t.linewise,i.visualBlock);return a}};function Y(e,t){q[e]=t}var X={jumpListWalk:function(e,t,r){if(r.visualMode){return}var n=t.repeat;var i=t.forward;var o=P.jumpList;var a=o.move(e,i?n:-n);var s=a?a.find():undefined;s=s?s:e.getCursor();e.setCursor(s)},scroll:function(e,t,r){if(r.visualMode){return}var n=t.repeat||1;var i=e.defaultTextHeight();var o=e.getScrollInfo().top;var a=i*n;var s=t.forward?o+a:o-a;var l=oe(e.getCursor());var u=e.charCoords(l,"local");if(t.forward){if(s>u.top){l.line+=(s-u.top)/i;l.line=Math.ceil(l.line);e.setCursor(l);u=e.charCoords(l,"local");e.scrollTo(null,u.top)}else{e.scrollTo(null,s)}}else{var c=s+e.getScrollInfo().clientHeight;if(c<u.bottom){l.line-=(u.bottom-c)/i;l.line=Math.floor(l.line);e.setCursor(l);u=e.charCoords(l,"local");e.scrollTo(null,u.bottom-e.getScrollInfo().clientHeight)}else{e.scrollTo(null,s)}}},scrollToCursor:function(e,t){var r=e.getCursor().line;var n=e.charCoords(Bt(r,0),"local");var i=e.getScrollInfo().clientHeight;var o=n.top;var a=n.bottom-o;switch(t.position){case"center":o=o-i/2+a;break;case"bottom":o=o-i+a;break}e.scrollTo(null,o)},replayMacro:function(e,t,r){var n=t.selectedCharacter;var i=t.repeat;var o=P.macroModeState;if(n=="@"){n=o.latestRegister}while(i--){wt(e,r,o,n)}},enterMacroRecordMode:function(e,t){var r=P.macroModeState;var n=t.selectedCharacter;if(P.registerController.isValidRegister(n)){r.enterMacroRecordMode(e,n)}},toggleOverwrite:function(e){if(!e.state.overwrite){e.toggleOverwrite(true);e.setOption("keyMap","vim-replace");It.signal(e,"vim-mode-change",{mode:"replace"})}else{e.toggleOverwrite(false);e.setOption("keyMap","vim-insert");It.signal(e,"vim-mode-change",{mode:"insert"})}},enterInsertMode:function(e,t,r){if(e.getOption("readOnly")){return}r.insertMode=true;r.insertModeRepeat=t&&t.repeat||1;var n=t?t.insertAt:null;var i=r.sel;var o=t.head||e.getCursor("head");var a=e.listSelections().length;if(n=="eol"){o=Bt(o.line,fe(e,o.line))}else if(n=="charAfter"){o=Q(o,0,1)}else if(n=="firstNonBlank"){o=U.moveToFirstNonWhiteSpaceCharacter(e,o)}else if(n=="startOfSelectedArea"){if(!r.visualBlock){if(i.head.line<i.anchor.line){o=i.head}else{o=Bt(i.anchor.line,0)}}else{o=Bt(Math.min(i.head.line,i.anchor.line),Math.min(i.head.ch,i.anchor.ch));a=Math.abs(i.head.line-i.anchor.line)+1}}else if(n=="endOfSelectedArea"){if(!r.visualBlock){if(i.head.line>=i.anchor.line){o=Q(i.head,0,1)}else{o=Bt(i.anchor.line,0)}}else{o=Bt(Math.min(i.head.line,i.anchor.line),Math.max(i.head.ch+1,i.anchor.ch));a=Math.abs(i.head.line-i.anchor.line)+1}}else if(n=="inplace"){if(r.visualMode){return}}e.setOption("disableInput",false);if(t&&t.replace){e.toggleOverwrite(true);e.setOption("keyMap","vim-replace");It.signal(e,"vim-mode-change",{mode:"replace"})}else{e.toggleOverwrite(false);e.setOption("keyMap","vim-insert");It.signal(e,"vim-mode-change",{mode:"insert"})}if(!P.macroModeState.isPlaying){e.on("change",St);It.on(e.getInputField(),"keydown",Ot)}if(r.visualMode){Se(e)}ge(e,o,a)},toggleVisualMode:function(e,t,r){var n=t.repeat;var i=e.getCursor();var o;if(!r.visualMode){r.visualMode=true;r.visualLine=!!t.linewise;r.visualBlock=!!t.blockwise;o=Z(e,Bt(i.line,i.ch+n-1),true);r.sel={anchor:i,head:o};It.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""});ke(e);_e(e,r,"<",le(i,o));_e(e,r,">",ue(i,o))}else if(r.visualLine^t.linewise||r.visualBlock^t.blockwise){r.visualLine=!!t.linewise;r.visualBlock=!!t.blockwise;It.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""});ke(e)}else{Se(e)}},reselectLastSelection:function(e,t,r){var n=r.lastSelection;if(r.visualMode){be(e,r)}if(n){var i=n.anchorMark.find();var o=n.headMark.find();if(!i||!o){return}r.sel={anchor:i,head:o};r.visualMode=true;r.visualLine=n.visualLine;r.visualBlock=n.visualBlock;ke(e);_e(e,r,"<",le(i,o));_e(e,r,">",ue(i,o));It.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""})}},joinLines:function(e,t,r){var n,i;if(r.visualMode){n=e.getCursor("anchor");i=e.getCursor("head");if(se(i,n)){var o=i;i=n;n=o}i.ch=fe(e,i.line)-1}else{var a=Math.max(t.repeat,2);n=e.getCursor();i=Z(e,Bt(n.line+a-1,Infinity))}var s=0;for(var l=n.line;l<i.line;l++){s=fe(e,n.line);var o=Bt(n.line+1,fe(e,n.line+1));var u=e.getRange(n,o);u=u.replace(/\n\s*/g," ");e.replaceRange(u,n,o)}var c=Bt(n.line,s);if(r.visualMode){Se(e,false)}e.setCursor(c)},newLineAndEnterInsertMode:function(e,t,r){r.insertMode=true;var n=oe(e.getCursor());if(n.line===e.firstLine()&&!t.after){e.replaceRange("\n",Bt(e.firstLine(),0));e.setCursor(e.firstLine(),0)}else{n.line=t.after?n.line:n.line-1;n.ch=fe(e,n.line);e.setCursor(n);var i=It.commands.newlineAndIndentContinueComment||It.commands.newlineAndIndent;i(e)}this.enterInsertMode(e,{repeat:t.repeat},r)},paste:function(n,e,t){var r=oe(n.getCursor());var i=P.registerController.getRegister(e.registerName);var o=i.toString();if(!o){return}if(e.matchIndent){var a=n.getOption("tabSize");var s=function(e){var t=e.split("\t").length-1;var r=e.split(" ").length-1;return t*a+r*1};var l=n.getLine(n.getCursor().line);var u=s(l.match(/^\s*/)[0]);var c=o.replace(/\n$/,"");var f=o!==c;var h=s(o.match(/^\s*/)[0]);var o=c.replace(/^\s*/gm,function(e){var t=u+(s(e)-h);if(t<0){return""}else if(n.getOption("indentWithTabs")){var r=Math.floor(t/a);return Array(r+1).join("\t")}else{return Array(t+1).join(" ")}});o+=f?"\n":""}if(e.repeat>1){var o=Array(e.repeat+1).join(o)}var d=i.linewise;var p=i.blockwise;if(d){if(t.visualMode){o=t.visualLine?o.slice(0,-1):"\n"+o.slice(0,o.length-1)+"\n"}else if(e.after){o="\n"+o.slice(0,o.length-1);r.ch=fe(n,r.line)}else{r.ch=0}}else{if(p){o=o.split("\n");for(var v=0;v<o.length;v++){o[v]=o[v]==""?" ":o[v]}}r.ch+=e.after?1:0}var g;var m;if(t.visualMode){t.lastPastedText=o;var y;var b=ye(n,t);var w=b[0];var k=b[1];var C=n.getSelection();var x=n.listSelections();var S=new Array(x.length).join("1").split("1");if(t.lastSelection){y=t.lastSelection.headMark.find()}P.registerController.unnamedRegister.setText(C);if(p){n.replaceSelections(S);k=Bt(w.line+o.length-1,w.ch);n.setCursor(w);ve(n,k);n.replaceSelections(o);g=w}else if(t.visualBlock){n.replaceSelections(S);n.setCursor(w);n.replaceRange(o,w,w);g=w}else{n.replaceRange(o,w,k);g=n.posFromIndex(n.indexFromPos(w)+o.length-1)}if(y){t.lastSelection.headMark=n.setBookmark(y)}if(d){g.ch=0}}else{if(p){n.setCursor(r);for(var v=0;v<o.length;v++){var L=r.line+v;if(L>n.lastLine()){n.replaceRange("\n",Bt(L,0))}var A=fe(n,L);if(A<r.ch){pe(n,L,r.ch)}}n.setCursor(r);ve(n,Bt(r.line+o.length-1,r.ch));n.replaceSelections(o);g=r}else{n.replaceRange(o,r);if(d&&e.after){g=Bt(r.line+1,Me(n.getLine(r.line+1)))}else if(d&&!e.after){g=Bt(r.line,Me(n.getLine(r.line)))}else if(!d&&e.after){m=n.indexFromPos(r);g=n.posFromIndex(m+o.length-1)}else{m=n.indexFromPos(r);g=n.posFromIndex(m+o.length)}}}if(t.visualMode){Se(n,false)}n.setCursor(g)},undo:function(e,t){e.operation(function(){ie(e,It.commands.undo,t.repeat)();e.setCursor(e.getCursor("anchor"))})},redo:function(e,t){ie(e,It.commands.redo,t.repeat)()},setRegister:function(e,t,r){r.inputState.registerName=t.selectedCharacter},setMark:function(e,t,r){var n=t.selectedCharacter;_e(e,r,n,e.getCursor())},replace:function(e,t,r){var n=t.selectedCharacter;var i=e.getCursor();var o;var a;var s=e.listSelections();if(r.visualMode){i=e.getCursor("start");a=e.getCursor("end")}else{var l=e.getLine(i.line);o=i.ch+t.repeat;if(o>l.length){o=l.length}a=Bt(i.line,o)}if(n=="\n"){if(!r.visualMode)e.replaceRange("",i,a);(It.commands.newlineAndIndentContinueComment||It.commands.newlineAndIndent)(e)}else{var u=e.getRange(i,a);u=u.replace(/[^\n]/g,n);if(r.visualBlock){var c=new Array(e.getOption("tabSize")+1).join(" ");u=e.getSelection();u=u.replace(/\t/g,c).replace(/[^\n]/g,n).split("\n");e.replaceSelections(u)}else{e.replaceRange(u,i,a)}if(r.visualMode){i=se(s[0].anchor,s[0].head)?s[0].anchor:s[0].head;e.setCursor(i);Se(e,false)}else{e.setCursor(Q(a,0,-1))}}},incrementNumberToken:function(e,t){var r=e.getCursor();var n=e.getLine(r.line);var i=/-?\d+/g;var o;var a;var s;var l;var u;while((o=i.exec(n))!==null){u=o[0];a=o.index;s=a+u.length;if(r.ch<s)break}if(!t.backtrack&&s<=r.ch)return;if(u){var c=t.increase?1:-1;var f=parseInt(u)+c*t.repeat;var h=Bt(r.line,a);var d=Bt(r.line,s);l=f.toString();e.replaceRange(l,h,d)}else{return}e.setCursor(Bt(r.line,a+l.length-1))},repeatLastEdit:function(e,t,r){var n=r.lastEditInputState;if(!n){return}var i=t.repeat;if(i&&t.repeatIsExplicit){r.lastEditInputState.repeatOverride=i}else{i=r.lastEditInputState.repeatOverride||i}Et(e,r,i,false)},indent:function(e,t){e.indentLine(e.getCursor().line,t.indentRight)},exitInsertMode:mt};function J(e,t){X[e]=t}function Z(e,t,r){var n=Math.min(Math.max(e.firstLine(),t.line),e.lastLine());var i=fe(e,n)-1;i=r?i+1:i;var o=Math.min(Math.max(0,t.ch),i);return Bt(n,o)}function $(e){var t={};for(var r in e){if(e.hasOwnProperty(r)){t[r]=e[r]}}return t}function Q(e,t,r){if(typeof t==="object"){r=t.ch;t=t.line}return Bt(e.line+t,e.ch+r)}function ee(e,t){return{line:t.line-e.line,ch:t.line-e.line}}function te(e,t,r,n){var i,o=[],a=[];for(var s=0;s<t.length;s++){var l=t[s];if(r=="insert"&&l.context!="insert"||l.context&&l.context!=r||n.operator&&l.type=="action"||!(i=re(e,l.keys))){continue}if(i=="partial"){o.push(l)}if(i=="full"){a.push(l)}}return{partial:o.length&&o,full:a.length&&a}}function re(e,t){if(t.slice(-11)=="<character>"){var r=t.length-11;var n=e.slice(0,r);var i=t.slice(0,r);return n==i&&e.length>r?"full":i.indexOf(n)==0?"partial":false}else{return e==t?"full":t.indexOf(e)==0?"partial":false}}function ne(e){var t=/^.*(<[^>]+>)$/.exec(e);var r=t?t[1]:e.slice(-1);if(r.length>1){switch(r){case"<CR>":r="\n";break;case"<Space>":r=" ";break;default:r="";break}}return r}function ie(t,r,n){return function(){for(var e=0;e<n;e++){r(t)}}}function oe(e){return Bt(e.line,e.ch)}function ae(e,t){return e.ch==t.ch&&e.line==t.line}function se(e,t){if(e.line<t.line){return true}if(e.line==t.line&&e.ch<t.ch){return true}return false}function le(e,t){if(arguments.length>2){t=le.apply(undefined,Array.prototype.slice.call(arguments,1))}return se(e,t)?e:t}function ue(e,t){if(arguments.length>2){t=ue.apply(undefined,Array.prototype.slice.call(arguments,1))}return se(e,t)?t:e}function ce(e,t,r){var n=se(e,t);var i=se(t,r);return n&&i}function fe(e,t){return e.getLine(t).length}function he(e){if(e.trim){return e.trim()}return e.replace(/^\s+|\s+$/g,"")}function de(e){return e.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function pe(e,t,r){var n=fe(e,t);var i=new Array(r-n+1).join(" ");e.setCursor(Bt(t,n));e.replaceRange(i,e.getCursor())}function ve(e,t){var r=[],n=e.listSelections();var i=oe(e.clipPos(t));var o=!ae(t,i);var a=e.getCursor("head");var s=me(n,a);var l=ae(n[s].head,n[s].anchor);var u=n.length-1;var c=u-s>s?u:0;var f=n[c].anchor;var h=Math.min(f.line,i.line);var d=Math.max(f.line,i.line);var p=f.ch,v=i.ch;var g=n[c].head.ch-p;var m=v-p;if(g>0&&m<=0){p++;if(!o){v--}}else if(g<0&&m>=0){p--;if(!l){v++}}else if(g<0&&m==-1){p--;v++}for(var y=h;y<=d;y++){var b={anchor:new Bt(y,p),head:new Bt(y,v)};r.push(b)}e.setSelections(r);t.ch=v;f.ch=p;return f}function ge(e,t,r){var n=[];for(var i=0;i<r;i++){var o=Q(t,i,0);n.push({anchor:o,head:o})}e.setSelections(n,0)}function me(e,t,r){for(var n=0;n<e.length;n++){var i=r!="head"&&ae(e[n].anchor,t);var o=r!="anchor"&&ae(e[n].head,t);if(i||o){return n}}return-1}function ye(p,e){var v=e.lastSelection;var t=function(){var e=p.listSelections();var t=e[0];var r=e[e.length-1];var n=se(t.anchor,t.head)?t.anchor:t.head;var i=se(r.anchor,r.head)?r.head:r.anchor;return[n,i]};var r=function(){var e=p.getCursor();var t=p.getCursor();var r=v.visualBlock;if(r){var n=r.width;var i=r.height;t=Bt(e.line+i,e.ch+n);var o=[];for(var a=e.line;a<t.line;a++){var s=Bt(a,e.ch);var l=Bt(a,t.ch);var u={anchor:s,head:l};o.push(u)}p.setSelections(o)}else{var c=v.anchorMark.find();var f=v.headMark.find();var h=f.line-c.line;var d=f.ch-c.ch;t={line:t.line+h,ch:h?t.ch:d+t.ch};if(v.visualLine){e=Bt(e.line,0);t=Bt(t.line,fe(p,t.line))}p.setSelection(e,t)}return[e,t]};if(!e.visualMode){return r()}else{return t()}}function be(e,t){var r=t.sel.anchor;var n=t.sel.head;if(t.lastPastedText){n=e.posFromIndex(e.indexFromPos(r)+t.lastPastedText.length);t.lastPastedText=null}t.lastSelection={anchorMark:e.setBookmark(r),headMark:e.setBookmark(n),anchor:oe(r),head:oe(n),visualMode:t.visualMode,visualLine:t.visualLine,visualBlock:t.visualBlock}}function we(e,t,r){var n=e.state.vim.sel;var i=n.head;var o=n.anchor;var a;if(se(r,t)){a=r;r=t;t=a}if(se(i,o)){i=le(t,i);o=ue(o,r)}else{o=le(t,o);i=ue(i,r);i=Q(i,0,-1);if(i.ch==-1&&i.line!=e.firstLine()){i=Bt(i.line-1,fe(e,i.line-1))}}return[o,i]}function ke(e,t,r){var n=e.state.vim;t=t||n.sel;var r=r||n.visualLine?"line":n.visualBlock?"block":"char";var i=Ce(e,t,r);e.setSelections(i.ranges,i.primary);At(e)}function Ce(e,t,r,n){var i=oe(t.head);var o=oe(t.anchor);if(r=="char"){var a=!n&&!se(t.head,t.anchor)?1:0;var s=se(t.head,t.anchor)?1:0;i=Q(t.head,0,a);o=Q(t.anchor,0,s);return{ranges:[{anchor:o,head:i}],primary:0}}else if(r=="line"){if(!se(t.head,t.anchor)){o.ch=0;var l=e.lastLine();if(i.line>l){i.line=l}i.ch=fe(e,i.line)}else{i.ch=0;o.ch=fe(e,o.line)}return{ranges:[{anchor:o,head:i}],primary:0}}else if(r=="block"){var u=Math.min(o.line,i.line),c=Math.min(o.ch,i.ch),f=Math.max(o.line,i.line),h=Math.max(o.ch,i.ch)+1;var d=f-u+1;var p=i.line==u?0:d-1;var v=[];for(var g=0;g<d;g++){v.push({anchor:Bt(u+g,c),head:Bt(u+g,h)})}return{ranges:v,primary:p}}}function xe(e){var t=e.getCursor("head");if(e.getSelection().length==1){t=le(t,e.getCursor("anchor"))}return t}function Se(e,t){var r=e.state.vim;if(t!==false){e.setCursor(Z(e,r.sel.head))}be(e,r);r.visualMode=false;r.visualLine=false;r.visualBlock=false;It.signal(e,"vim-mode-change",{mode:"normal"});if(r.fakeCursor){r.fakeCursor.clear()}}function Le(e,t,r){var n=e.getRange(t,r);if(/\n\s*$/.test(n)){var i=n.split("\n");i.pop();var o;for(var o=i.pop();i.length>0&&o&&x(o);o=i.pop()){r.line--;r.ch=0}if(o){r.line--;r.ch=fe(e,r.line)}else{r.ch=0}}}function Ae(e,t,r){t.ch=0;r.ch=0;r.line++}function Me(e){if(!e){return 0}var t=e.search(/\S/);return t==-1?e.length:t}function Te(e,t,r,n,i){var o=xe(e);var a=e.getLine(o.line);var s=o.ch;var l=i?v[0]:g[0];while(!l(a.charAt(s))){s++;if(s>=a.length){return null}}if(n){l=g[0]}else{l=v[0];if(!l(a.charAt(s))){l=v[1]}}var u=s,c=s;while(l(a.charAt(u))&&u<a.length){u++}while(l(a.charAt(c))&&c>=0){c--}c++;if(t){var f=u;while(/\s/.test(a.charAt(u))&&u<a.length){u++}if(f==u){var h=c;while(/\s/.test(a.charAt(c-1))&&c>0){c--}if(!c){c=h}}}return{start:Bt(o.line,c),end:Bt(o.line,u)}}function Oe(e,t,r){if(!ae(t,r)){P.jumpList.add(e,t,r)}}function Ee(e,t){P.lastCharacterSearch.increment=e;P.lastCharacterSearch.forward=t.forward;P.lastCharacterSearch.selectedCharacter=t.selectedCharacter}var Ne={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"};var Ie={bracket:{isComplete:function(e){if(e.nextCh===e.symb){e.depth++;if(e.depth>=1)return true}else if(e.nextCh===e.reverseSymb){e.depth--}return false}},section:{init:function(e){e.curMoveThrough=true;e.symb=(e.forward?"]":"[")===e.symb?"{":"}"},isComplete:function(e){return e.index===0&&e.nextCh===e.symb}},comment:{isComplete:function(e){var t=e.lastCh==="*"&&e.nextCh==="/";e.lastCh=e.nextCh;return t}},method:{init:function(e){e.symb=e.symb==="m"?"{":"}";e.reverseSymb=e.symb==="{"?"}":"{"},isComplete:function(e){if(e.nextCh===e.symb)return true;return false}},preprocess:{init:function(e){e.index=0},isComplete:function(e){if(e.nextCh==="#"){var t=e.lineText.match(/#(\w+)/)[1];if(t==="endif"){if(e.forward&&e.depth===0){return true}e.depth++}else if(t==="if"){if(!e.forward&&e.depth===0){return true}e.depth--}if(t==="else"&&e.depth===0)return true}return false}}};function Pe(e,t,r,n){var i=oe(e.getCursor());var o=r?1:-1;var a=r?e.lineCount():-1;var s=i.ch;var l=i.line;var u=e.getLine(l);var c={lineText:u,nextCh:u.charAt(s),lastCh:null,index:s,symb:n,reverseSymb:(r?{")":"(","}":"{"}:{"(":")","{":"}"})[n],forward:r,depth:0,curMoveThrough:false};var f=Ne[n];if(!f)return i;var h=Ie[f].init;var d=Ie[f].isComplete;if(h){h(c)}while(l!==a&&t){c.index+=o;c.nextCh=c.lineText.charAt(c.index);if(!c.nextCh){l+=o;c.lineText=e.getLine(l)||"";if(o>0){c.index=0}else{var p=c.lineText.length;c.index=p>0?p-1:0}c.nextCh=c.lineText.charAt(c.index)}if(d(c)){i.line=l;i.ch=c.index;t--}}if(c.nextCh||c.curMoveThrough){return Bt(l,c.index)}return i}function Re(e,t,r,n,i){var o=t.line;var a=t.ch;var s=e.getLine(o);var l=r?1:-1;var u=n?g:v;if(i&&s==""){o+=l;s=e.getLine(o);if(!y(e,o)){return null}a=r?0:s.length}while(true){if(i&&s==""){return{from:0,to:0,line:o}}var c=l>0?s.length:-1;var f=c,h=c;while(a!=c){var d=false;for(var p=0;p<u.length&&!d;++p){if(u[p](s.charAt(a))){f=a;while(a!=c&&u[p](s.charAt(a))){a+=l}h=a;d=f!=h;if(f==t.ch&&o==t.line&&h==f+l){continue}else{return{from:Math.min(f,h+1),to:Math.max(f,h),line:o}}}}if(!d){a+=l}}o+=l;if(!y(e,o)){return null}s=e.getLine(o);a=l>0?0:s.length}}function Be(e,t,r,n,i,o){var a=oe(t);var s=[];if(n&&!i||!n&&i){r++}var l=!(n&&i);for(var u=0;u<r;u++){var c=Re(e,t,n,o,l);if(!c){var f=fe(e,e.lastLine());s.push(n?{line:e.lastLine(),from:f,to:f}:{line:0,from:0,to:0});break}s.push(c);t=Bt(c.line,n?c.to-1:c.from)}var h=s.length!=r;var d=s[0];var p=s.pop();if(n&&!i){if(!h&&(d.from!=a.ch||d.line!=a.line)){p=s.pop()}return Bt(p.line,p.from)}else if(n&&i){return Bt(p.line,p.to-1)}else if(!n&&i){if(!h&&(d.to!=a.ch||d.line!=a.line)){p=s.pop()}return Bt(p.line,p.to)}else{return Bt(p.line,p.from)}}function De(e,t,r,n){var i=e.getCursor();var o=i.ch;var a;for(var s=0;s<t;s++){var l=e.getLine(i.line);a=We(o,l,n,r,true);if(a==-1){return null}o=a}return Bt(e.getCursor().line,a)}function He(e,t){var r=e.getCursor().line;return Z(e,Bt(r,t-1))}function _e(e,t,r,n){if(!S(r,p)){return}if(t.marks[r]){t.marks[r].clear()}t.marks[r]=e.setBookmark(n)}function We(e,t,r,n,i){var o;if(n){o=t.indexOf(r,e+1);if(o!=-1&&!i){o-=1}}else{o=t.lastIndexOf(r,e-1);if(o!=-1&&!i){o+=1}}return o}function Fe(t,e,r,n,i){var o=e.line;var a=t.firstLine();var s=t.lastLine();var l,u,c=o;function f(e){return!t.getLine(e)}function h(e,t,r){if(r){return f(e)!=f(e+t)}return!f(e)&&f(e+t)}if(n){while(a<=c&&c<=s&&r>0){if(h(c,n)){r--}c+=n}return new Bt(c,0)}var d=t.state.vim;if(d.visualLine&&h(o,1,true)){var p=d.sel.anchor;if(h(p.line,-1,true)){if(!i||p.line!=o){o+=1}}}var v=f(o);for(c=o;c<=s&&r;c++){if(h(c,1,true)){if(!i||f(c)!=v){r--}}}u=new Bt(c,0);if(c>s&&!v){v=true}else{i=false}for(c=o;c>a;c--){if(!i||f(c)==v||c==o){if(h(c,-1,true)){break}}}l=new Bt(c,0);return{start:l,end:u}}function ze(e,t,r,n){var i=t,o,a;var s={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/}[r];var l={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{"}[r];var u=e.getLine(i.line).charAt(i.ch);var c=u===l?1:0;o=e.scanForBracket(Bt(i.line,i.ch+c),-1,null,{bracketRegex:s});a=e.scanForBracket(Bt(i.line,i.ch+c),1,null,{bracketRegex:s});if(!o||!a){return{start:i,end:i}}o=o.pos;a=a.pos;if(o.line==a.line&&o.ch>a.ch||o.line>a.line){var f=o;o=a;a=f}if(n){a.ch+=1}else{o.ch+=1}return{start:o,end:a}}function je(e,t,r,n){var i=oe(t);var o=e.getLine(i.line);var a=o.split("");var s,l,u,c;var f=a.indexOf(r);if(i.ch<f){i.ch=f}else if(f<i.ch&&a[i.ch]==r){l=i.ch;--i.ch}if(a[i.ch]==r&&!l){s=i.ch+1}else{for(u=i.ch;u>-1&&!s;u--){if(a[u]==r){s=u+1}}}if(s&&!l){for(u=s,c=a.length;u<c&&!l;u++){if(a[u]==r){l=u}}}if(!s||!l){return{start:i,end:i}}if(n){--s;++l}return{start:Bt(i.line,s),end:Bt(i.line,l)}}A("pcre",true,"boolean");function Ke(){}Ke.prototype={getQuery:function(){return P.query},setQuery:function(e){P.query=e},getOverlay:function(){return this.searchOverlay},setOverlay:function(e){this.searchOverlay=e},isReversed:function(){return P.isReversed},setReversed:function(e){P.isReversed=e},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(e){this.annotate=e}};function Ue(e){var t=e.state.vim;return t.searchState_||(t.searchState_=new Ke)}function Ve(e,t,r,n,i){if(e.openDialog){e.openDialog(t,n,{bottom:true,value:i.value,onKeyDown:i.onKeyDown,onKeyUp:i.onKeyUp,selectValueOnOpen:false})}else{n(prompt(r,""))}}function Ge(e){var t=qe(e)||[];if(!t.length)return[];var r=[];if(t[0]!==0)return;for(var n=0;n<t.length;n++){if(typeof t[n]=="number")r.push(e.substring(t[n]+1,t[n+1]))}return r}function qe(e){var t=false;var r=[];for(var n=0;n<e.length;n++){var i=e.charAt(n);if(!t&&i=="/"){r.push(n)}t=!t&&i=="\\"}return r}function Ye(e){var t="|(){";var r="}";var n=false;var i=[];for(var o=-1;o<e.length;o++){var a=e.charAt(o)||"";var s=e.charAt(o+1)||"";var l=s&&t.indexOf(s)!=-1;if(n){if(a!=="\\"||!l){i.push(a)}n=false}else{if(a==="\\"){n=true;if(s&&r.indexOf(s)!=-1){l=true}if(!l||s==="\\"){i.push(a)}}else{i.push(a);if(l&&s!=="\\"){i.push("\\")}}}}return i.join("")}var Xe={"\\n":"\n","\\r":"\r","\\t":"\t"};function Je(e){var t=false;var r=[];for(var n=-1;n<e.length;n++){var i=e.charAt(n)||"";var o=e.charAt(n+1)||"";if(Xe[i+o]){r.push(Xe[i+o]);n++}else if(t){r.push(i);t=false}else{if(i==="\\"){t=true;if(k(o)||o==="$"){r.push("$")}else if(o!=="/"&&o!=="\\"){r.push("\\")}}else{if(i==="$"){r.push("$")}r.push(i);if(o==="/"){r.push("\\")}}}}return r.join("")}var Ze={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"\t"};function $e(e){var t=new It.StringStream(e);var r=[];while(!t.eol()){while(t.peek()&&t.peek()!="\\"){r.push(t.next())}var n=false;for(var i in Ze){if(t.match(i,true)){n=true;r.push(Ze[i]);break}}if(!n){r.push(t.next())}}return r.join("")}function Qe(e,t,r){var n=P.registerController.getRegister("/");n.setText(e);if(e instanceof RegExp){return e}var i=qe(e);var o;var a;if(!i.length){o=e}else{o=e.substring(0,i[0]);var s=e.substring(i[0]);a=s.indexOf("i")!=-1}if(!o){return null}if(!T("pcre")){o=Ye(o)}if(r){t=/^[^A-Z]*$/.test(o)}var l=new RegExp(o,t||a?"i":undefined);return l}function et(e,t){if(e.openNotification){e.openNotification('<span style="color: red">'+t+"</span>",{bottom:true,duration:5e3})}else{alert(t)}}function tt(e,t){var r='<span style="font-family: monospace; white-space: pre">'+(e||"")+'<input type="text"></span>';if(t)r+=' <span style="color: #888">'+t+"</span>";return r}var rt="(Javascript regexp)";function nt(e,t){var r=(t.prefix||"")+" "+(t.desc||"");var n=tt(t.prefix,t.desc);Ve(e,n,r,t.onClose,t)}function it(e,t){if(e instanceof RegExp&&t instanceof RegExp){var r=["global","multiline","ignoreCase","source"];for(var n=0;n<r.length;n++){var i=r[n];if(e[i]!==t[i]){return false}}return true}return false}function ot(e,t,r,n){if(!t){return}var i=Ue(e);var o=Qe(t,!!r,!!n);if(!o){return}st(e,o);if(it(o,i.getQuery())){return o}i.setQuery(o);return o}function at(r){if(r.source.charAt(0)=="^"){var n=true}return{token:function(e){if(n&&!e.sol()){e.skipToEnd();return}var t=e.match(r,false);if(t){if(t[0].length==0){e.next();return"searching"}if(!e.sol()){e.backUp(1);if(!r.exec(e.next()+t[0])){e.next();return null}}e.match(r);return"searching"}while(!e.eol()){e.next();if(e.match(r,false))break}},query:r}}function st(e,t){var r=Ue(e);var n=r.getOverlay();if(!n||t!=n.query){if(n){e.removeOverlay(n)}n=at(t);e.addOverlay(n);if(e.showMatchesOnScrollbar){if(r.getScrollbarAnnotate()){r.getScrollbarAnnotate().clear()}r.setScrollbarAnnotate(e.showMatchesOnScrollbar(t))}r.setOverlay(n)}}function lt(i,o,a,s){if(s===undefined){s=1}return i.operation(function(){var e=i.getCursor();var t=i.getSearchCursor(a,e);for(var r=0;r<s;r++){var n=t.find(o);if(r==0&&n&&ae(t.from(),e)){n=t.find(o)}if(!n){t=i.getSearchCursor(a,o?Bt(i.lastLine()):Bt(i.firstLine(),0));if(!t.find(o)){return}}}return t.from()})}function ut(e){var t=Ue(e);e.removeOverlay(Ue(e).getOverlay());t.setOverlay(null);if(t.getScrollbarAnnotate()){t.getScrollbarAnnotate().clear();t.setScrollbarAnnotate(null)}}function ct(e,t,r){if(typeof e!="number"){e=e.line}if(t instanceof Array){return S(e,t)}else{if(r){return e>=t&&e<=r}else{return e==t}}}function ft(e){var t=e.getScrollInfo();var r=6;var n=10;var i=e.coordsChar({left:0,top:r+t.top},"local");var o=t.clientHeight-n+t.top;var a=e.coordsChar({left:0,top:o},"local");return{top:i.line,bottom:a.line}}function ht(e,t,r){if(r=="'"){var n=e.doc.history.done;var i=n[n.length-2];return i&&i.ranges&&i.ranges[0].head}var o=t.marks[r];return o&&o.find()}var dt=function(){this.buildCommandMap_()};dt.prototype={processCommand:function(e,t,r){var n=this;e.operation(function(){e.curOp.isVimOp=true;n._processCommand(e,t,r)})},_processCommand:function(t,e,r){var n=t.state.vim;var i=P.registerController.getRegister(":");var o=i.toString();if(n.visualMode){Se(t)}var a=new It.StringStream(e);i.setText(e);var s=r||{};s.input=e;try{this.parseInput_(t,a,s)}catch(e){et(t,e);throw e}var l;var u;if(!s.commandName){if(s.line!==undefined){u="move"}}else{l=this.matchCommand_(s.commandName);if(l){u=l.name;if(l.excludeFromCommandHistory){i.setText(o)}this.parseCommandArgs_(a,s,l);if(l.type=="exToKey"){for(var c=0;c<l.toKeys.length;c++){It.Vim.handleKey(t,l.toKeys[c],"mapping")}return}else if(l.type=="exToEx"){this.processCommand(t,l.toInput);return}}}if(!u){et(t,'Not an editor command ":'+e+'"');return}try{pt[u](t,s);if((!l||!l.possiblyAsync)&&s.callback){s.callback()}}catch(e){et(t,e);throw e}},parseInput_:function(e,t,r){t.eatWhile(":");if(t.eat("%")){r.line=e.firstLine();r.lineEnd=e.lastLine()}else{r.line=this.parseLineSpec_(e,t);if(r.line!==undefined&&t.eat(",")){r.lineEnd=this.parseLineSpec_(e,t)}}var n=t.match(/^(\w+)/);if(n){r.commandName=n[1]}else{r.commandName=t.match(/.*/)[0]}return r},parseLineSpec_:function(e,t){var r=t.match(/^(\d+)/);if(r){return parseInt(r[1],10)-1}switch(t.next()){case".":return this.parseLineSpecOffset_(t,e.getCursor().line);case"$":return this.parseLineSpecOffset_(t,e.lastLine());case"'":var n=t.next();var i=ht(e,e.state.vim,n);if(!i)throw new Error("Mark not set");return this.parseLineSpecOffset_(t,i.line);case"-":case"+":t.backUp(1);return this.parseLineSpecOffset_(t,e.getCursor().line);default:t.backUp(1);return undefined}},parseLineSpecOffset_:function(e,t){var r=e.match(/^([+-])?(\d+)/);if(r){var n=parseInt(r[2],10);if(r[1]=="-"){t-=n}else{t+=n}}return t},parseCommandArgs_:function(e,t,r){if(e.eol()){return}t.argString=e.match(/.*/)[0];var n=r.argDelimiter||/\s+/;var i=he(t.argString).split(n);if(i.length&&i[0]){t.args=i}},matchCommand_:function(e){for(var t=e.length;t>0;t--){var r=e.substring(0,t);if(this.commandMap_[r]){var n=this.commandMap_[r];if(n.name.indexOf(e)===0){return n}}}return null},buildCommandMap_:function(){this.commandMap_={};for(var e=0;e<Rt.length;e++){var t=Rt[e];var r=t.shortName||t.name;this.commandMap_[r]=t}},map:function(e,t,r){if(e!=":"&&e.charAt(0)==":"){if(r){throw Error("Mode not supported for ex mappings")}var n=e.substring(1);if(t!=":"&&t.charAt(0)==":"){this.commandMap_[n]={name:n,type:"exToEx",toInput:t.substring(1),user:true}}else{this.commandMap_[n]={name:n,type:"exToKey",toKeys:t,user:true}}}else{if(t!=":"&&t.charAt(0)==":"){var i={keys:e,type:"keyToEx",exArgs:{input:t.substring(1)}};if(r){i.context=r}Pt.unshift(i)}else{var i={keys:e,type:"keyToKey",toKeys:t};if(r){i.context=r}Pt.unshift(i)}}},unmap:function(e,t){if(e!=":"&&e.charAt(0)==":"){if(t){throw Error("Mode not supported for ex mappings")}var r=e.substring(1);if(this.commandMap_[r]&&this.commandMap_[r].user){delete this.commandMap_[r];return}}else{var n=e;for(var i=0;i<Pt.length;i++){if(n==Pt[i].keys&&Pt[i].context===t){Pt.splice(i,1);return}}}throw Error("No such mapping.")}};var pt={colorscheme:function(e,t){if(!t.args||t.args.length<1){et(e,e.getOption("theme"));return}e.setOption("theme",t.args[0])},map:function(e,t,r){var n=t.args;if(!n||n.length<2){if(e){et(e,"Invalid mapping: "+t.input)}return}vt.map(n[0],n[1],r)},imap:function(e,t){this.map(e,t,"insert")},nmap:function(e,t){this.map(e,t,"normal")},vmap:function(e,t){this.map(e,t,"visual")},unmap:function(e,t,r){var n=t.args;if(!n||n.length<1){if(e){et(e,"No such mapping: "+t.input)}return}vt.unmap(n[0],r)},move:function(e,t){K.processCommand(e,e.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true},repeatOverride:t.line+1})},set:function(e,t){var r=t.args;var n=t.setCfg||{};if(!r||r.length<1){if(e){et(e,"Invalid mapping: "+t.input)}return}var i=r[0].split("=");var o=i[0];var a=i[1];var s=false;if(o.charAt(o.length-1)=="?"){if(a){throw Error("Trailing characters: "+t.argString)}o=o.substring(0,o.length-1);s=true}if(a===undefined&&o.substring(0,2)=="no"){o=o.substring(2);a=false}var l=L[o]&&L[o].type=="boolean";if(l&&a==undefined){a=true}if(!l&&a===undefined||s){var u=T(o,e,n);if(u instanceof Error){et(e,u.message)}else if(u===true||u===false){et(e," "+(u?"":"no")+o)}else{et(e,"  "+o+"="+u)}}else{var c=M(o,a,e,n);if(c instanceof Error){et(e,c.message)}}},setlocal:function(e,t){t.setCfg={scope:"local"};this.set(e,t)},setglobal:function(e,t){t.setCfg={scope:"global"};this.set(e,t)},registers:function(e,t){var r=t.args;var n=P.registerController.registers;var i="----------Registers----------<br><br>";if(!r){for(var o in n){var a=n[o].toString();if(a.length){i+='"'+o+"    "+a+"<br>"}}}else{var o;r=r.join("");for(var s=0;s<r.length;s++){o=r.charAt(s);if(!P.registerController.isValidRegister(o)){continue}var l=n[o]||new W;i+='"'+o+"    "+l.toString()+"<br>"}}et(e,i)},sort:function(e,o){var a,s,l,u,c;function t(){if(o.argString){var e=new It.StringStream(o.argString);if(e.eat("!")){a=true}if(e.eol()){return}if(!e.eatSpace()){return"Invalid arguments"}var t=e.match(/([dinuox]+)?\s*(\/.+\/)?\s*/);if(!t&&!e.eol()){return"Invalid arguments"}if(t[1]){s=t[1].indexOf("i")!=-1;l=t[1].indexOf("u")!=-1;var r=t[1].indexOf("d")!=-1||t[1].indexOf("n")!=-1&&1;var n=t[1].indexOf("x")!=-1&&1;var i=t[1].indexOf("o")!=-1&&1;if(r+n+i>1){return"Invalid arguments"}u=r&&"decimal"||n&&"hex"||i&&"octal"}if(t[2]){c=new RegExp(t[2].substr(1,t[2].length-2),s?"i":"")}}}var r=t();if(r){et(e,r+": "+o.argString);return}var n=o.line||e.firstLine();var i=o.lineEnd||o.line||e.lastLine();if(n==i){return}var f=Bt(n,0);var h=Bt(i,fe(e,i));var d=e.getRange(f,h).split("\n");var p=c?c:u=="decimal"?/(-?)([\d]+)/:u=="hex"?/(-?)(?:0x)?([0-9a-f]+)/i:u=="octal"?/([0-7]+)/:null;var v=u=="decimal"?10:u=="hex"?16:u=="octal"?8:null;var g=[],m=[];if(u||c){for(var y=0;y<d.length;y++){var b=c?d[y].match(c):null;if(b&&b[0]!=""){g.push(b)}else if(!c&&p.exec(d[y])){g.push(d[y])}else{m.push(d[y])}}}else{m=d}function w(e,t){if(a){var r;r=e;e=t;t=r}if(s){e=e.toLowerCase();t=t.toLowerCase()}var n=u&&p.exec(e);var i=u&&p.exec(t);if(!n){return e<t?-1:1}n=parseInt((n[1]+n[2]).toLowerCase(),v);i=parseInt((i[1]+i[2]).toLowerCase(),v);return n-i}function k(e,t){if(a){var r;r=e;e=t;t=r}if(s){e[0]=e[0].toLowerCase();t[0]=t[0].toLowerCase()}return e[0]<t[0]?-1:1}g.sort(c?k:w);if(c){for(var y=0;y<g.length;y++){g[y]=g[y].input}}else if(!u){m.sort(w)}d=!a?m.concat(g):g.concat(m);if(l){var C=d;var x;d=[];for(var y=0;y<C.length;y++){if(C[y]!=x){d.push(C[y])}x=C[y]}}e.replaceRange(d.join("\n"),f,h)},global:function(t,e){var r=e.argString;if(!r){et(t,"Regular Expression missing from global");return}var n=e.line!==undefined?e.line:t.firstLine();var i=e.lineEnd||e.line||t.lastLine();var o=Ge(r);var a=r,s;if(o.length){a=o[0];s=o.slice(1,o.length).join("/")}if(a){try{ot(t,a,true,true)}catch(e){et(t,"Invalid regex: "+a);return}}var l=Ue(t).getQuery();var u=[],c="";for(var f=n;f<=i;f++){var h=l.test(t.getLine(f));if(h){u.push(f+1);c+=t.getLine(f)+"<br>"}}if(!s){et(t,c);return}var d=0;var p=function(){if(d<u.length){var e=u[d]+s;vt.processCommand(t,e,{callback:p})}d++};p()},substitute:function(t,e){if(!t.getSearchCursor){throw new Error("Search feature not available. Requires searchcursor.js or "+"any other getSearchCursor implementation.")}var r=e.argString;var n=r?Ge(r):[];var i,o="",a,s,l;var u=false;var c=false;if(n.length){i=n[0];o=n[1];if(i&&i[i.length-1]==="$"){i=i.slice(0,i.length-1)+"\\n";o=o?o+"\n":"\n"}if(o!==undefined){if(T("pcre")){o=$e(o)}else{o=Je(o)}P.lastSubstituteReplacePart=o}a=n[2]?n[2].split(" "):[]}else{if(r&&r.length){et(t,"Substitutions should be of the form "+":s/pattern/replace/");return}}if(a){s=a[0];l=parseInt(a[1]);if(s){if(s.indexOf("c")!=-1){u=true;s.replace("c","")}if(s.indexOf("g")!=-1){c=true;s.replace("g","")}i=i+"/"+s}}if(i){try{ot(t,i,true,true)}catch(e){et(t,"Invalid regex: "+i);return}}o=o||P.lastSubstituteReplacePart;if(o===undefined){et(t,"No previous substitute regular expression");return}var f=Ue(t);var h=f.getQuery();var d=e.line!==undefined?e.line:t.getCursor().line;var p=e.lineEnd||d;if(d==t.firstLine()&&p==t.lastLine()){p=Infinity}if(l){d=p;p=d+l-1}var v=Z(t,Bt(d,0));var g=t.getSearchCursor(h,v);gt(t,u,c,d,p,g,h,o,e.callback)},redo:It.commands.redo,undo:It.commands.undo,write:function(e){if(It.commands.save){It.commands.save(e)}else if(e.save){e.save()}},nohlsearch:function(e){ut(e)},yank:function(e){var t=oe(e.getCursor());var r=t.line;var n=e.getLine(r);P.registerController.pushText("0","yank",n,true,true)},delmarks:function(e,t){if(!t.argString||!he(t.argString)){et(e,"Argument required");return}var r=e.state.vim;var n=new It.StringStream(he(t.argString));while(!n.eol()){n.eatSpace();var i=n.pos;if(!n.match(/[a-zA-Z]/,false)){et(e,"Invalid argument: "+t.argString.substring(i));return}var o=n.next();if(n.match("-",true)){if(!n.match(/[a-zA-Z]/,false)){et(e,"Invalid argument: "+t.argString.substring(i));return}var a=o;var s=n.next();if(b(a)&&b(s)||C(a)&&C(s)){var l=a.charCodeAt(0);var u=s.charCodeAt(0);if(l>=u){et(e,"Invalid argument: "+t.argString.substring(i));return}for(var c=0;c<=u-l;c++){var f=String.fromCharCode(l+c);delete r.marks[f]}}else{et(e,"Invalid argument: "+a+"-");return}}else{delete r.marks[o]}}}};var vt=new dt;function gt(o,e,t,r,n,i,a,s,l){o.state.vim.exMode=true;var u=false;var c=i.from();function f(){o.operation(function(){while(!u){h();d()}p()})}function h(){var e=o.getRange(i.from(),i.to());var t=e.replace(a,s);i.replace(t)}function d(){while(i.findNext()&&ct(i.from(),r,n)){if(!t&&c&&i.from().line==c.line){continue}o.scrollIntoView(i.from(),30);o.setSelection(i.from(),i.to());c=i.from();u=false;return}u=true}function p(e){if(e){e()}o.focus();if(c){o.setCursor(c);var t=o.state.vim;t.exMode=false;t.lastHPos=t.lastHSPos=c.ch}if(l){l()}}function v(e,t,r){It.e_stop(e);var n=It.keyName(e);switch(n){case"Y":h();d();break;case"N":d();break;case"A":var i=l;l=undefined;o.operation(f);l=i;break;case"L":h();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":p(r);break}if(u){p(r)}return true}d();if(u){et(o,"No matches for "+a.source);return}if(!e){f();if(l){l()}return}nt(o,{prefix:"replace with <strong>"+s+"</strong> (y/n/a/q/l)",onKeyDown:v})}It.keyMap.vim={attach:i,detach:e,call:t};function mt(e){var t=e.state.vim;var r=P.macroModeState;var n=P.registerController.getRegister(".");var i=r.isPlaying;var o=r.lastInsertModeChanges;var a=[];if(!i){var s=o.inVisualBlock?t.lastSelection.visualBlock.height:1;var l=o.changes;var a=[];var u=0;while(u<l.length){a.push(l[u]);if(l[u]instanceof Tt){u++}else{u+=s}}o.changes=a;e.off("change",St);It.off(e.getInputField(),"keydown",Ot)}if(!i&&t.insertModeRepeat>1){Et(e,t,t.insertModeRepeat-1,true);t.lastEditInputState.repeatOverride=t.insertModeRepeat}delete t.insertModeRepeat;t.insertMode=false;e.setCursor(e.getCursor().line,e.getCursor().ch-1);e.setOption("keyMap","vim");e.setOption("disableInput",true);e.toggleOverwrite(false);n.setText(o.changes.join(""));It.signal(e,"vim-mode-change",{mode:"normal"});if(r.isRecording){Ct(r)}}function yt(e){Pt.unshift(e)}function bt(e,t,r,n,i){var o={keys:e,type:t};o[t]=r;o[t+"Args"]=n;for(var a in i)o[a]=i[a];yt(o)}A("insertModeEscKeysTimeout",200,"number");It.keyMap["vim-insert"]={fallthrough:["default"],attach:i,detach:e,call:t};It.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:i,detach:e,call:t};function wt(e,t,r,n){var i=P.registerController.getRegister(n);if(n==":"){if(i.keyBuffer[0]){vt.processCommand(e,i.keyBuffer[0])}r.isPlaying=false;return}var o=i.keyBuffer;var a=0;r.isPlaying=true;r.replaySearchQueries=i.searchQueries.slice(0);for(var s=0;s<o.length;s++){var l=o[s];var u,c;while(l){u=/<\w+-.+?>|<\w+>|./.exec(l);c=u[0];l=l.substring(u.index+c.length);It.Vim.handleKey(e,c,"macro");if(t.insertMode){var f=i.insertModeChanges[a++].changes;P.macroModeState.lastInsertModeChanges.changes=f;Nt(e,f,1);mt(e)}}}r.isPlaying=false}function kt(e,t){if(e.isPlaying){return}var r=e.latestRegister;var n=P.registerController.getRegister(r);if(n){n.pushText(t)}}function Ct(e){if(e.isPlaying){return}var t=e.latestRegister;var r=P.registerController.getRegister(t);if(r&&r.pushInsertModeChanges){r.pushInsertModeChanges(e.lastInsertModeChanges)}}function xt(e,t){if(e.isPlaying){return}var r=e.latestRegister;var n=P.registerController.getRegister(r);if(n&&n.pushSearchQuery){n.pushSearchQuery(t)}}function St(e,t){var r=P.macroModeState;var n=r.lastInsertModeChanges;if(!r.isPlaying){while(t){n.expectCursorActivityForChange=true;if(t.origin=="+input"||t.origin=="paste"||t.origin===undefined){var i=t.text.join("\n");if(n.maybeReset){n.changes=[];n.maybeReset=false}if(e.state.overwrite&&!/\n/.test(i)){n.changes.push([i])}else{n.changes.push(i)}}t=t.next}}}function Lt(e){var t=e.state.vim;if(t.insertMode){var r=P.macroModeState;if(r.isPlaying){return}var n=r.lastInsertModeChanges;if(n.expectCursorActivityForChange){n.expectCursorActivityForChange=false}else{n.maybeReset=true}}else if(!e.curOp.isVimOp){Mt(e,t)}if(t.visualMode){At(e)}}function At(e){var t=e.state.vim;var r=Z(e,oe(t.sel.head));var n=Q(r,0,1);if(t.fakeCursor){t.fakeCursor.clear()}t.fakeCursor=e.markText(r,n,{className:"cm-animate-fat-cursor"})}function Mt(e,t){var r=e.getCursor("anchor");var n=e.getCursor("head");if(t.visualMode&&!e.somethingSelected()){Se(e,false)}else if(!t.visualMode&&!t.insertMode&&e.somethingSelected()){t.visualMode=true;t.visualLine=false;It.signal(e,"vim-mode-change",{mode:"visual"})}if(t.visualMode){var i=!se(n,r)?-1:0;var o=se(n,r)?-1:0;n=Q(n,0,i);r=Q(r,0,o);t.sel={anchor:r,head:n};_e(e,t,"<",le(n,r));_e(e,t,">",ue(n,r))}else if(!t.insertMode){t.lastHPos=e.getCursor().ch}}function Tt(e){this.keyName=e}function Ot(e){var t=P.macroModeState;var r=t.lastInsertModeChanges;var n=It.keyName(e);if(!n){return}function i(){if(r.maybeReset){r.changes=[];r.maybeReset=false}r.changes.push(new Tt(n));return true}if(n.indexOf("Delete")!=-1||n.indexOf("Backspace")!=-1){It.lookupKey(n,"vim-insert",i)}}function Et(r,n,e,t){var i=P.macroModeState;i.isPlaying=true;var o=!!n.lastEditActionCommand;var a=n.inputState;function s(){if(o){K.processAction(r,n,n.lastEditActionCommand)}else{K.evalInput(r,n)}}function l(e){if(i.lastInsertModeChanges.changes.length>0){e=!n.lastEditActionCommand?1:e;var t=i.lastInsertModeChanges;Nt(r,t.changes,e)}}n.inputState=n.lastEditInputState;if(o&&n.lastEditActionCommand.interlaceInsertRepeat){for(var u=0;u<e;u++){s();l(1)}}else{if(!t){s()}l(e)}n.inputState=a;if(n.insertMode&&!t){mt(r)}i.isPlaying=false}function Nt(t,e,r){function n(e){if(typeof e=="string"){It.commands[e](t)}else{e(t)}return true}var i=t.getCursor("head");var o=P.macroModeState.lastInsertModeChanges.inVisualBlock;if(o){var a=t.state.vim;var s=a.lastSelection;var l=ee(s.anchor,s.head);ge(t,i,l.line+1);r=t.listSelections().length;t.setCursor(i)}for(var u=0;u<r;u++){if(o){t.setCursor(Q(i,u,0))}for(var c=0;c<e.length;c++){var f=e[c];if(f instanceof Tt){It.lookupKey(f.keyName,"vim-insert",n)}else if(typeof f=="string"){var h=t.getCursor();t.replaceRange(f,h,h)}else{var d=t.getCursor();var p=Q(d,0,f[0].length);t.replaceRange(f[0],d,p)}}}if(o){t.setCursor(Q(i,0,1))}}R();return D};It.Vim=e()});(function(e){if(typeof exports=="object"&&typeof module=="object")e(require("../lib/codemirror"));else if(typeof define=="function"&&define.amd)define(["../lib/codemirror"],e);else e(CodeMirror)})(function(e){"use strict";var u=e.Pos;function l(e,t){return e.line==t.line&&e.ch==t.ch}var t=[];function o(e){t.push(e);if(t.length>50)t.shift()}function a(e){if(!t.length)return o(e);t[t.length-1]+=e}function r(e){return t[t.length-(e?Math.min(e,1):1)]||""}function n(){if(t.length>1)t.pop();return r()}var s=null;function c(e,t,r,n,i){if(i==null)i=e.getRange(t,r);if(n&&s&&s.cm==e&&l(t,s.pos)&&e.isClean(s.gen))a(i);else o(i);e.replaceRange("",t,r,"+delete");if(n)s={cm:e,pos:t,gen:e.changeGeneration()};else s=null}function i(e,t,r){return e.findPosH(t,r,"char",true)}function f(e,t,r){return e.findPosH(t,r,"word",true)}function h(e,t,r){return e.findPosV(t,r,"line",e.doc.sel.goalColumn)}function d(e,t,r){return e.findPosV(t,r,"page",e.doc.sel.goalColumn)}function p(e,t,r){var n=t.line,i=e.getLine(n);var o=/\S/.test(r<0?i.slice(0,t.ch):i.slice(t.ch));var a=e.firstLine(),s=e.lastLine();for(;;){n+=r;if(n<a||n>s)return e.clipPos(u(n-r,r<0?0:null));i=e.getLine(n);var l=/\S/.test(i);if(l)o=true;else if(o)return u(n,0)}}function v(e,t,r){var n=t.line,i=t.ch;var o=e.getLine(t.line),a=false;for(;;){var s=o.charAt(i+(r<0?-1:0));if(!s){if(n==(r<0?e.firstLine():e.lastLine()))return u(n,i);o=e.getLine(n+r);if(!/\S/.test(o))return u(n,i);n+=r;i=r<0?o.length:0;continue}if(a&&/[!?.]/.test(s))return u(n,i+(r>0?1:0));if(!a)a=/\w/.test(s);i+=r}}function g(e,t,r){var n;if(e.findMatchingBracket&&(n=e.findMatchingBracket(t,{strict:true}))&&n.match&&(n.forward?1:-1)==r)return r>0?u(n.to.line,n.to.ch+1):n.to;for(var i=true;;i=false){var o=e.getTokenAt(t);var a=u(t.line,r<0?o.start:o.end);if(i&&r>0&&o.end==t.ch||!/\w/.test(o.string)){var s=e.findPosH(a,r,"char");if(l(a,s))return t;else t=s}else{return a}}}function m(e,t){var r=e.state.emacsPrefix;if(!r)return t?null:1;A(e);return r=="-"?-1:Number(r)}function y(t){var n=typeof t=="string"?function(e){e.execCommand(t)}:t;return function(e){var t=m(e);n(e);for(var r=1;r<t;++r)n(e)}}function b(e,t,r,n){var i=m(e);if(i<0){n=-n;i=-i}for(var o=0;o<i;++o){var a=r(e,t,n);if(l(a,t))break;t=a}return t}function w(t,r){var e=function(e){e.extendSelection(b(e,e.getCursor(),t,r))};e.motion=true;return e}function k(e,t,r){var n=e.listSelections(),i;var o=n.length;while(o--){i=n[o].head;c(e,i,b(e,i,t,r),true)}}function C(e){if(e.somethingSelected()){var t=e.listSelections(),r;var n=t.length;while(n--){r=t[n];c(e,r.anchor,r.head)}return true}}function x(e,t){if(e.state.emacsPrefix){if(t!="-")e.state.emacsPrefix+=t;return}e.state.emacsPrefix=t;e.on("keyHandled",L);e.on("inputRead",M)}var S={"Alt-G":true,"Ctrl-X":true,"Ctrl-Q":true,"Ctrl-U":true};function L(e,t){if(!e.state.emacsPrefixMap&&!S.hasOwnProperty(t))A(e)}function A(e){e.state.emacsPrefix=null;e.off("keyHandled",L);e.off("inputRead",M)}function M(e,t){var r=m(e);if(r>1&&t.origin=="+input"){var n=t.text.join("\n"),i="";for(var o=1;o<r;++o)i+=n;e.replaceSelection(i)}}function T(e){e.state.emacsPrefixMap=true;e.addKeyMap(H);e.on("keyHandled",O);e.on("inputRead",O)}function O(e,t){if(typeof t=="string"&&(/^\d$/.test(t)||t=="Ctrl-U"))return;e.removeKeyMap(H);e.state.emacsPrefixMap=false;e.off("keyHandled",O);e.off("inputRead",O)}function E(e){e.setCursor(e.getCursor());e.setExtending(!e.getExtending());e.on("change",function(){e.setExtending(false)})}function N(e){e.setExtending(false);e.setCursor(e.getCursor())}function I(e,t,r){if(e.openDialog)e.openDialog(t+': <input type="text" style="width: 10em"/>',r,{bottom:true});else r(prompt(t,""))}function P(e,t){var r=e.getCursor(),n=e.findPosH(r,1,"word");e.replaceRange(t(e.getRange(r,n)),r,n);e.setCursor(n)}function R(e){var t=e.getCursor(),r=t.line,n=t.ch;var i=[];while(r>=e.firstLine()){var o=e.getLine(r);for(var a=n==null?o.length:n;a>0;){var n=o.charAt(--a);if(n==")")i.push("(");else if(n=="]")i.push("[");else if(n=="}")i.push("{");else if(/[\(\{\[]/.test(n)&&(!i.length||i.pop()!=n))return e.extendSelection(u(r,a))}--r;n=null}}function B(e){e.execCommand("clearSearch");N(e)}e.emacs={kill:c,killRegion:C,repeated:y};var D=e.keyMap.emacs=e.normalizeKeyMap({"Ctrl-W":function(e){c(e,e.getCursor("start"),e.getCursor("end"))},"Ctrl-K":y(function(e){var t=e.getCursor(),r=e.clipPos(u(t.line));var n=e.getRange(t,r);if(!/\S/.test(n)){n+="\n";r=u(t.line+1,0)}c(e,t,r,true,n)}),"Alt-W":function(e){o(e.getSelection());N(e)},"Ctrl-Y":function(e){var t=e.getCursor();e.replaceRange(r(m(e)),t,t,"paste");e.setSelection(t,e.getCursor())},"Alt-Y":function(e){e.replaceSelection(n(),"around","paste")},"Ctrl-Space":E,"Ctrl-Shift-2":E,"Ctrl-F":w(i,1),"Ctrl-B":w(i,-1),Right:w(i,1),Left:w(i,-1),"Ctrl-D":function(e){k(e,i,1)},Delete:function(e){C(e)||k(e,i,1)},"Ctrl-H":function(e){k(e,i,-1)},Backspace:function(e){C(e)||k(e,i,-1)},"Alt-F":w(f,1),"Alt-B":w(f,-1),"Alt-D":function(e){k(e,f,1)},"Alt-Backspace":function(e){k(e,f,-1)},"Ctrl-N":w(h,1),"Ctrl-P":w(h,-1),Down:w(h,1),Up:w(h,-1),"Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":w(d,-1),"Ctrl-V":w(d,1),PageUp:w(d,-1),PageDown:w(d,1),"Ctrl-Up":w(p,-1),"Ctrl-Down":w(p,1),"Alt-A":w(v,-1),"Alt-E":w(v,1),"Alt-K":function(e){k(e,v,1)},"Ctrl-Alt-K":function(e){k(e,g,1)},"Ctrl-Alt-Backspace":function(e){k(e,g,-1)},"Ctrl-Alt-F":w(g,1),"Ctrl-Alt-B":w(g,-1),"Shift-Ctrl-Alt-2":function(e){var t=e.getCursor();e.setSelection(b(e,t,g,1),t)},"Ctrl-Alt-T":function(e){var t=g(e,e.getCursor(),-1),r=g(e,t,1);var n=g(e,r,1),i=g(e,n,-1);e.replaceRange(e.getRange(i,n)+e.getRange(r,i)+e.getRange(t,r),t,n)},"Ctrl-Alt-U":y(R),"Alt-Space":function(e){var t=e.getCursor(),r=t.ch,n=t.ch,i=e.getLine(t.line);while(r&&/\s/.test(i.charAt(r-1)))--r;while(n<i.length&&/\s/.test(i.charAt(n)))++n;e.replaceRange(" ",u(t.line,r),u(t.line,n))},"Ctrl-O":y(function(e){e.replaceSelection("\n","start")}),"Ctrl-T":y(function(e){e.execCommand("transposeChars")}),"Alt-C":y(function(e){P(e,function(e){var t=e.search(/\w/);if(t==-1)return e;return e.slice(0,t)+e.charAt(t).toUpperCase()+e.slice(t+1).toLowerCase()})}),"Alt-U":y(function(e){P(e,function(e){return e.toUpperCase()})}),"Alt-L":y(function(e){P(e,function(e){return e.toLowerCase()})}),"Alt-;":"toggleComment","Ctrl-/":y("undo"),"Shift-Ctrl--":y("undo"),"Ctrl-Z":y("undo"),"Cmd-Z":y("undo"),"Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findPersistentNext","Ctrl-R":"findPersistentPrev","Ctrl-G":B,"Shift-Alt-5":"replace","Alt-/":"autocomplete",Enter:"newlineAndIndent","Ctrl-J":y(function(e){e.replaceSelection("\n","end")}),Tab:"indentAuto","Alt-G G":function(r){var e=m(r,true);if(e!=null&&e>0)return r.setCursor(e-1);I(r,"Goto line",function(e){var t;if(e&&!isNaN(t=Number(e))&&t==(t|0)&&t>0)r.setCursor(t-1)})},"Ctrl-X Tab":function(e){e.indentSelection(m(e,true)||e.getOption("indentUnit"))},"Ctrl-X Ctrl-X":function(e){e.setSelection(e.getCursor("head"),e.getCursor("anchor"))},"Ctrl-X Ctrl-S":"save","Ctrl-X Ctrl-W":"save","Ctrl-X S":"saveAll","Ctrl-X F":"open","Ctrl-X U":y("undo"),"Ctrl-X K":"close","Ctrl-X Delete":function(e){c(e,e.getCursor(),v(e,e.getCursor(),1),true)},"Ctrl-X H":"selectAll","Ctrl-Q Tab":y("insertTab"),"Ctrl-U":T});var H={"Ctrl-G":A};function _(t){H[t]=function(e){x(e,t)};D["Ctrl-"+t]=function(e){x(e,t)};S["Ctrl-"+t]=true}for(var W=0;W<10;++W)_(String(W));_("-")});function assert(e,t){if(!e){throw new Error("Assertion failed: "+(t||""))}}function $(e){return[].slice.apply(document.querySelectorAll(e))}var replaceChildren=function(t,e){t.innerHTML="";e=e instanceof Array?e:[e];e.forEach(function(e){t.appendChild(e)})};var sum=function(e){return e.reduce(function(e,t){return e+t},0)};var setClassBool=function(e,t,r){if(r){e.classList.add(t)}else{e.classList.remove(t)}};var ko=function(){"use strict";function l(e){if(!t(e))throw"Not a function: "+e}function t(e){return typeof e==="function"&&!(e instanceof n)}function e(e){return e instanceof n}function r(e){return e instanceof n&&!e.assign}var u;var a;var n=function(e){this._id=n.highestId++;this._value=e;this._subscribers=[];this._listeners={};this._dependencies=[];this._isChanging=false;var t=function(){if(arguments.length)throw"No arguments allowed! Did you mean .assign()";if(u)u(t);return t.peek()};t.__proto__=this;var r=t;t.assign=function(e){if(r._value===e)return;var t=r._value;r._value=e;if(r._isChanging)return;r._isChanging=true;r.emit("assign",e,t);r._isChanging=false};return t};n.highestId=0;n.prototype.peek=function(){return this._value};n.prototype.emit=function(e){var t=this;var r=[].slice.call(arguments,1);var n=this._listeners[e]||[];for(var i=0;i<n.length;i++){var o=n[i];o.apply(t,r)}this._changed(this._value);if(a)a(this,e,r)};n.prototype._changed=function(e){var t=u;u=null;var r=this._subscribers.slice();for(var n=0;n<r.length;n++){var i=r[n];var o=i._notify||i;o.call(undefined,e)}u=t};n.prototype.subscribe=function(e,t){if(e===undefined)throw"undefined subscriber";var t=t===undefined?true:!!t;var r;if(typeof e==="object"){for(var n in e){l(e[n]);this._listeners[n]=this._listeners[n]||[];this._listeners[n].push(e[n])}r=e.assign}else{r=e._notify||e;l(r);this._subscribers.push(e)}if(t&&r){var i=u;u=null;r.call(undefined,this._value);u=i}};n.prototype.unsubscribe=function(e){var t=this._subscribers.indexOf(e);this._subscribers.splice(t,1)};n.prototype.destroy=function(e){var t=this;this._subscribers=[];this._dependencies.forEach(function(e){e.unsubscribe(t)});this._dependencies=[]};n.prototype.compute=function(e){l(e);var t=this;return s(function(){return e(t())})};var i=function(e){if(e instanceof n)return e;return new n(e)};var o=i();if(!o.emit)throw"koel not supported";var s=function(o){l(o);var a=[].slice.call(arguments,1);var s;function e(){var t=[];var e=u;u=function(e){if(t.indexOf(e)!==-1)return;t.push(e)};var r;try{r=o.apply(undefined,a)}finally{u=e}if(s){var n=s._dependencies;for(var i=0;i<n.length;i++){n[i].unsubscribe(s)}}if(!s){s=f(r);s._isComputed=true;s._notify=function(){assert(false)}}for(var i=0;i<t.length;i++){t[i].subscribe(s,false)}s._dependencies=t;return r}e();var t=s.assign;delete s.assign;assert(!s.assign);s._isComputing=false;s._notify=function(){if(this._isComputing)return;t(e())}.bind(s);return s};var c=function(e){return typeof e==="function"?s(e):i(e)};var f=function(e){if(e instanceof n)return e;return c(e)};f.Observable=n;f.observable=i;f.computed=s;f.subscribe=function(e,t){if(e instanceof n){e.subscribe(t)}else{if(typeof t==="function"){t(e)}else{t.assign(e)}}};f.isObservable=e;f.isFunction=t;f.isComputed=r;f.plugin=function(t){var r=c;c=function(e){return t(e,r)}};f.watch=function(e,t){var r=a;a=t;e();a=r};return f}();ko.plugin(function(e,t){var r=t(e);if(typeof e==="boolean"){r.negate=function(){return this.compute(function(e){return!e})}.bind(r);r.toggle=function(){this.assign(!this())}.bind(r)}return r});ko.plugin(function(e,t){var h=ko.computed;var o={insert:function(e,t){this.splice(e,0,t)},replace:function(e,t){if(this[e]===t)return;return this.splice(e,1,t)[0]},remove:function(e){assert(0<=e&&e<this.length);return this.splice(e,1)[0]}};var r={push:function(e){return this.insert(this().length,e)},pop:function(){return this.remove(this().length-1)},shift:function(){return this.remove(0)}};var n={map:function(i){var o=[];function t(e){o=e.map(function(e){var t=h(i,e);s(t);return t});return o.map(function(e){return e()})}var a=d();function s(r){r.subscribe(function(e){var t=o.indexOf(r);a._replace(t,e)},false)}this.subscribe({assign:function(e){o.forEach(function(e){e.destroy()});a._assign(t(e))},replace:function(e,t){o[e].destroy();var r=h(i,t);o[e]=r;var n=r();a._replace(e,n);s(r)},insert:function(e,t){var r=h(i,t);o.splice(e,0,r);s(r);var n=r();a._insert(e,n)},remove:function(e){o[e].destroy();o.splice(e,1);a._remove(e)}});a.destroy=function(){o.forEach(function(e){e.destroy()});ko.g};return a},filter:function(a){var s=[];function t(e){s=e.map(function(e){var t=h(a,e);u(t);return t});return e.filter(function(e,t){var r=s[t];return r()})}var o=d();this.subscribe({assign:function(e){s.forEach(function(e){e.destroy()});o.assign(t(e))},replace:function(e,t){var r=s[e];var n=r();r.destroy();var i=h(a,t);s[e]=i;var o=i();c(n,o,e,t);u(i)},insert:function(e,t){var r=h(a,t);s.splice(e,0,r);u(r);var n=r();if(n){var i=f(e);o._insert(i,t)}},remove:function(e){var t=s[e];var r=t();t.destroy();s.splice(e,1);if(r){var n=f(e);o._remove(n)}}});var l=this;function u(i){i.subscribe(function(e){var t=s.indexOf(i);var r=l();var n=r[t];c(!e,e,t,n)},false)}function c(e,t,r,n){var i=f(r);if(t&&e){o._replace(i,n)}else if(t&&!e){o._insert(i,n)}else if(!t&&e){o._remove(i)}}function f(e){return s.slice(0,e).filter(function(e){return e()}).length}o.destroy=function(){s.forEach(function(e){e.destroy()})};return o}};function d(){var e=ko([]);for(key in o){e["_"+key]=e[key];delete e[key]}for(key in r){delete e[key]}e._assign=e.assign;delete e.assign;return e}function i(t){delete t.length;t.length=h(function(){return this().length}.bind(t));Object.keys(o).forEach(function(i){t[i]=function(){var e=o[i];var t=this();var r=[].slice.call(arguments);var n=e.apply(t,r);r.push(n);this.emit.apply(this,[i].concat(r));return n}.bind(t)});Object.keys(r).forEach(function(e){t[e]=r[e].bind(t)});Object.keys(n).forEach(function(e){t[e]=n[e].bind(t)})}var a=t(e);if(e instanceof Array){i(a)}return a});var el=function(){var i={defaultValue:"defaultValue",for:"htmlFor",html:"innerHTML",text:"textContent",unselectable:"unselectable",value:"value"};var o={autofocus:1,checked:1,defaultChecked:1,disabled:1,hidden:1,multiple:1,readOnly:1,required:1,selected:1};var a={value:1,selected:1,checked:1};function f(t,e,r){ko.subscribe(e,function(e){if(typeof e==="string")e=e.split(/ +/g);t.removeAttribute("class");r.concat(e||[]).forEach(function(e){if(!e)return;t.classList.add(e)})})}function s(e,t,r){var n=i[t];if(n){e[n]=r==null?"":""+r}else if(o[t]){e[t]=!!r}else if(r==null){e.removeAttribute(t)}else{e.setAttribute(t,""+r)}}function l(e,t){var r=i[t];if(r){return e[r]}else if(o[t]){return!!e[t]}else{return e.getAttribute(t)}}function h(t,r,e){if(e===undefined)throw"undefined value";if(/^on_/.test(r)){r=r.slice("on_".length);t.addEventListener(r,e);return}if(/^bind_/.test(r)){r=r.slice("bind_".length);if(!ko.isObservable(e)){throw"Can only bind observable"}else if(!e.assign){throw"This observable can't be assigned"}else if(!a[r]){throw"Can't bind property: "+r}else{function n(){e._value=l(t,r);e.emit("changed")}t.addEventListener("input",n);t.addEventListener("change",n)}}ko.subscribe(e,{assign:function(e){s(t,r,e)}})}var e;return e=function(e,t){if(arguments.length>2)throw"too many arguments";if(e===undefined)throw"undefined selectors";var r,s;if(ko.isObservable(t)||t instanceof Array||typeof t==="string"||t&&t.appendChild){r=t;s={}}else{s=t||{};r=null;if(s.children){r=s.children||[];delete s.children}}var l=[];var u;var c;e.split(/ +/g).forEach(function(e){var t=e.split(/([#.])/g);var r=t[0]||"div";var n=document.createElement(r);for(var i=1,o=2;o<t.length;i+=2,o+=2){var a=t[o];if(t[i]=="#"){if(s.id)throw"Can't specify id twice";n.id=a}else if(t[i]=="."){l.push(a)}}if(!u)u=n;if(c)c.appendChild(n);c=n});var n=s.class;delete s.class;if(s.className){if(n)throw"Can't set class twice";n=s.className;delete s.className}if(s.classList){throw"Use .class instead"}f(c,n,l);for(key in s){h(c,key,s[key])}if(!r){return u}if(!ko.isObservable(r)){if(r===undefined)throw"undefined children";r=r||[];o(r);return u}function i(e){if(e===undefined)throw"undefined child";return e&&e.appendChild?e:document.createTextNode(e)}function o(e){if(!(e instanceof Array)){e=[e]}while(c.firstChild){c.removeChild(c.lastChild)}for(var t=0;t<e.length;t++){var r=e[t];c.appendChild(i(r))}}r.subscribe({assign:o,insert:function(e,t){c.insertBefore(i(t),c.children[e])},remove:function(e){c.removeChild(c.children[e])},replace:function(e,t){var r=c.children[e];c.insertBefore(i(t),r);c.removeChild(r)}});return u}}();var Oops=function(){var i={assign:function(e,t){this.assign(t)},changed:function(e,t){this.assign(t)},remove:function(e,t){if(!this.insert)return;this.insert(e,t)},insert:function(e,t){if(!this.remove)return;this.remove(e)}};var o=function(e,t){this.events=e;this.after=t};o.prototype.undoAndReverse=function(){var n=this.events.slice();n.reverse();var e=a._watch(function(){a.undoing=true;for(var e=0;e<n.length;e++){var t=n[e];var r=i[t.name];if(!r)throw t;r.apply(t.target,t.args)}a.undoing=false});if(this.after)this.after();e.after=this.after;return e};var e=function(e,t){this.undo=e;this.redo=t};e.prototype.reverse=function(){return new e(this.redo,this.undo)};e.prototype.undoAndReverse=function(){this.undo();return this.reverse()};var a=function(e){var t=a._watch(e);a.insert(t)};a.undoing=false;a._watch=function(e){assert(!a.undoing);var t=App.active();var r=App.tab();var n=function(){App.active.assign(t);App.tab.assign(r)};var i=[];ko.watch(e,function(e,t,r){if(ko.isComputed(e))return;if(e===App.active||e===App.tab){n=null}i.push({target:e,name:t,args:r.map(s)})});if(!i.length)return;return new o(i,n)};a.undoStack=[];a.redoStack=[];function s(e){if(ko.isObservable(e))e=e();if(e&&e.constructor===Array)e=e.slice();return e}a._reverse=function(e){var t=a._watch(o.undo);return t};a.undo=function(){if(!a.undoStack.length)return;var e=a.undoStack.pop();var t=e.undoAndReverse();a.redoStack.push(t);Host.onOops()};a.redo=function(){if(!a.redoStack.length)return;var e=a.redoStack.pop();var t=e.undoAndReverse();a.undoStack.push(t);Host.onOops()};a.insert=function(e){if(!e)return;a.undoStack.push(e);a.redoStack=[];Host.onOops()};a.canUndo=function(){return a.undoStack.length};a.canRedo=function(){return a.redoStack.length};a.reset=function(){a.undoStack=[];a.redoStack=[];Host.onOops()};a.CustomOperation=e;return a}();var Scratch=function(){var e=[["move %n steps"," ",1,"forward:",10],["turn @turnRight %n degrees"," ",1,"turnRight:",15],["turn @turnLeft %n degrees"," ",1,"turnLeft:",15],["point in direction %d.direction"," ",1,"heading:",90],["point towards %m.spriteOrMouse"," ",1,"pointTowards:",""],["go to x:%n y:%n"," ",1,"gotoX:y:"],["go to %m.location"," ",1,"gotoSpriteOrMouse:","mouse-pointer"],["glide %n secs to x:%n y:%n"," ",1,"glideSecs:toX:y:elapsed:from:"],["change x by %n"," ",1,"changeXposBy:",10],["set x to %n"," ",1,"xpos:",0],["change y by %n"," ",1,"changeYposBy:",10],["set y to %n"," ",1,"ypos:",0],["set rotation style %m.rotationStyle"," ",1,"setRotationStyle","left-right"],["say %s for %n secs"," ",2,"say:duration:elapsed:from:","Hello!",2],["say %s"," ",2,"say:","Hello!"],["think %s for %n secs"," ",2,"think:duration:elapsed:from:","Hmm...",2],["think %s"," ",2,"think:","Hmm..."],["show"," ",2,"show"],["hide"," ",2,"hide"],["switch costume to %m.costume"," ",2,"lookLike:","costume1"],["next costume"," ",2,"nextCostume"],["next backdrop"," ",102,"nextScene"],["switch backdrop to %m.backdrop"," ",2,"startScene","backdrop1"],["switch backdrop to %m.backdrop and wait"," ",102,"startSceneAndWait","backdrop1"],["change %m.effect effect by %n"," ",2,"changeGraphicEffect:by:","color",25],["set %m.effect effect to %n"," ",2,"setGraphicEffect:to:","color",0],["clear graphic effects"," ",2,"filterReset"],["change size by %n"," ",2,"changeSizeBy:",10],["set size to %n%"," ",2,"setSizeTo:",100],["go to front"," ",2,"comeToFront"],["go back %n layers"," ",2,"goBackByLayers:",1],["play sound %m.sound"," ",3,"playSound:","pop"],["play sound %m.sound until done"," ",3,"doPlaySoundAndWait","pop"],["stop all sounds"," ",3,"stopAllSounds"],["play drum %d.drum for %n beats"," ",3,"playDrum",1,.25],["rest for %n beats"," ",3,"rest:elapsed:from:",.25],["play note %d.note for %n beats"," ",3,"noteOn:duration:elapsed:from:",60,.5],["set instrument to %d.instrument"," ",3,"instrument:",1],["change volume by %n"," ",3,"changeVolumeBy:",-10],["set volume to %n%"," ",3,"setVolumeTo:",100],["change tempo by %n"," ",3,"changeTempoBy:",20],["set tempo to %n bpm"," ",3,"setTempoTo:",60],["clear"," ",4,"clearPenTrails"],["stamp"," ",4,"stampCostume"],["pen down"," ",4,"putPenDown"],["pen up"," ",4,"putPenUp"],["set pen color to %c"," ",4,"penColor:"],["change pen color by %n"," ",4,"changePenHueBy:"],["set pen color to %n"," ",4,"setPenHueTo:",0],["change pen shade by %n"," ",4,"changePenShadeBy:"],["set pen shade to %n"," ",4,"setPenShadeTo:",50],["change pen size by %n"," ",4,"changePenSizeBy:",1],["set pen size to %n"," ",4,"penSize:",1],["when @greenFlag clicked","h",5,"whenGreenFlag"],["when %m.key key pressed","h",5,"whenKeyPressed","space"],["when this sprite clicked","h",5,"whenClicked"],["when backdrop switches to %m.backdrop","h",5,"whenSceneStarts","backdrop1"],["when %m.triggerSensor > %n","h",5,"whenSensorGreaterThan","loudness",10],["when I receive %m.broadcast","h",5,"whenIReceive",""],["broadcast %m.broadcast"," ",5,"broadcast:",""],["broadcast %m.broadcast and wait"," ",5,"doBroadcastAndWait",""],["wait %n secs"," ",6,"wait:elapsed:from:",1],["repeat %n","c",6,"doRepeat",10],["forever","cf",6,"doForever"],["if %b then","c",6,"doIf"],["if %b then","e",6,"doIfElse"],["wait until %b"," ",6,"doWaitUntil"],["repeat until %b","c",6,"doUntil"],["stop %m.stop","f",6,"stopScripts","all"],["when I start as a clone","h",6,"whenCloned"],["create clone of %m.spriteOnly"," ",6,"createCloneOf"],["delete this clone","f",6,"deleteClone"],["ask %s and wait"," ",7,"doAsk","What's your name?"],["turn video %m.videoState"," ",7,"setVideoState","on"],["set video transparency to %n%"," ",7,"setVideoTransparency",50],["reset timer"," ",7,"timerReset"],["set %m.var to %s"," ",9,"setVar:to:"],["change %m.var by %n"," ",9,"changeVar:by:"],["show variable %m.var"," ",9,"showVariable:"],["hide variable %m.var"," ",9,"hideVariable:"],["add %s to %m.list"," ",12,"append:toList:"],["delete %d.listDeleteItem of %m.list"," ",12,"deleteLine:ofList:"],["if on edge, bounce"," ",1,"bounceOffEdge"],["insert %s at %d.listItem of %m.list"," ",12,"insert:at:ofList:"],["replace item %d.listItem of %m.list with %s"," ",12,"setLine:ofList:to:"],["show list %m.list"," ",12,"showList:"],["hide list %m.list"," ",12,"hideList:"],["x position","r",1,"xpos"],["y position","r",1,"ypos"],["direction","r",1,"heading"],["costume #","r",2,"costumeIndex"],["size","r",2,"scale"],["backdrop name","r",102,"sceneName"],["backdrop #","r",102,"backgroundIndex"],["volume","r",3,"volume"],["tempo","r",3,"tempo"],["touching %m.touching?","b",7,"touching:",""],["touching color %c?","b",7,"touchingColor:"],["color %c is touching %c?","b",7,"color:sees:"],["distance to %m.spriteOrMouse","r",7,"distanceTo:",""],["answer","r",7,"answer"],["key %m.key pressed?","b",7,"keyPressed:","space"],["mouse down?","b",7,"mousePressed"],["mouse x","r",7,"mouseX"],["mouse y","r",7,"mouseY"],["loudness","r",7,"soundLevel"],["video %m.videoMotionType on %m.stageOrThis","r",7,"senseVideoMotion","motion"],["timer","r",7,"timer"],["%m.attribute of %m.spriteOrStage","r",7,"getAttribute:of:"],["current %m.timeAndDate","r",7,"timeAndDate","minute"],["days since 2000","r",7,"timestamp"],["username","r",7,"getUserName"],["%n + %n","r",8,"+","",""],["%n - %n","r",8,"-","",""],["%n * %n","r",8,"*","",""],["%n / %n","r",8,"/","",""],["pick random %n to %n","r",8,"randomFrom:to:",1,10],["%s < %s","b",8,"<","",""],["%s = %s","b",8,"=","",""],["%s > %s","b",8,">","",""],["%b and %b","b",8,"&"],["%b or %b","b",8,"|"],["not %b","b",8,"not"],["join %s %s","r",8,"concatenate:with:","hello ","world"],["letter %n of %s","r",8,"letter:of:",1,"world"],["length of %s","r",8,"stringLength:","world"],["%n mod %n","r",8,"%","",""],["round %n","r",8,"rounded",""],["%m.mathOp of %n","r",8,"computeFunction:of:","sqrt",9],["item %d.listItem of %m.list","r",12,"getLine:ofList:"],["length of %m.list","r",12,"lineCountOfList:"],["%m.list contains %s?","b",12,"list:contains:"]];var n={1:"motion",2:"looks",3:"sound",4:"pen",5:"events",6:"control",7:"sensing",8:"operators",9:"variable",10:"custom",11:"parameter",12:"list",20:"extension",42:"grey"};var i=[];var o={};var a=/(%[a-zA-Z](?:\.[a-zA-Z]+)?)/g;e.push(["%m.var","r",9,"readVariable"]);e.push(["%m.list","r",12,"contentsOfList:"]);e.push(["%m.param","r",11,"getParam"]);e.push(["%m.param","b",11,"getParam"]);e.push(["else","else",6,"else"]);e.push(["end","end",6,"end"]);e.push(["...","ellips",42,"ellips"]);var s={" ":"stack",b:"predicate",c:"c-block",e:"if-block",f:"cap",h:"hat",r:"reporter",cf:"c-block cap",else:"else",end:"end",ellips:"ellips"};e.forEach(function(e){var t=e[0];if(t==="set pen color to %n"){t="set pen hue to %n"}else if(t==="change pen color by %n"){t="change pen hue by %n"}var r={spec:t,parts:t.split(a),shape:s[e[1]],category:n[e[2]%100],selector:e[3],defaults:e.slice(4)};r.inputs=r.parts.filter(function(e){return a.test(e)});i.push(r);if(r.selector!=="getParam")assert(!o[r.selector],r.selector);o[r.selector]=r});var r={"%b":"boolean","%c":"color","%d":"number-menu","%m":"readonly-menu","%n":"number","%s":"string"};var t=function(e){var t=e.slice(0,2);return r[t]};var l={category:"control",defaults:["all"],inputs:["%m.stop"],parts:["stop","%m.stop",""],selector:"stopScripts",shape:"stack",spec:"stop %m.stop"};return{blocks:i,blocksBySelector:o,inputPat:a,getInputShape:t,stopOtherScripts:l}}();var Earley=function(){"use strict";function m(e){var t=e.toString?e.toString():e;return JSON.stringify(t||e)}var n=function(t,e,r){if(typeof r!=="function"){throw new Error("Rule for "+JSON.stringify(t)+" has no process function")}e.forEach(function(e){if(e===undefined){throw new Error("Rule for "+JSON.stringify(t)+" has invalid symbol: "+JSON.stringify(e))}});this.name=t;this.symbols=e;this.process=r};n.prototype.toString=function(e){var t=this.name+" →";for(var r=0;r<this.symbols.length;r++){if(r===e)t+=" •";var n=this.symbols[r];t+=" "+(typeof n==="string"?n:m(n))}if(r===e)t+=" •";return t};var u=function(e,t,r,n,i,o){this.rule=e;this.origin=t;this.position=r||0;this.isFinished=this.position===this.rule.symbols.length;if(!this.isFinished)this.expect=this.rule.symbols[this.position];this.node=n||[];this.predictedBy=i||[];this.edits=o||0};u.prototype.toString=function(){return this.rule.toString(this.position)};u.prototype.next=function(e){return new u(this.rule,this.origin,this.position+1,this.node.concat([e]),this.predictedBy,this.edits)};var i=function(e,t){this.toplevel=e.length?e[0].name:undefined;this.rules=[];this.rulesByName={};this.undefinedRulesSet={};var r=this;(e||[]).forEach(function(e){r.addRule(e)});(t||[]).forEach(function(e){r.undefinedRulesSet[e]=true})};i.prototype.addRule=function(e){if(!this.rulesByName.hasOwnProperty(e.name)){this.rulesByName[e.name]=[]}this.rulesByName[e.name].push(e);this.rules.push(e)};i.prototype.copy=function(){var t=new i([],Object.keys(this.undefinedRulesSet));t.toplevel=this.toplevel;t.rules=this.rules.slice();var r=this;Object.keys(this.rulesByName).forEach(function(e){t.rulesByName[e]=r.rulesByName[e].slice()});return t};i.prototype.reverse=function(){if(!this._reversed){var e=this.rules.map(function(e){var t=e.symbols.slice();t.reverse();var r=new n(e.name,t,e.process);r._original=e;return r});var t=Object.keys(this.undefinedRulesSet);this._reversed=new i(e,t)}return this._reversed};var r=function(e){this.grammar=e;this.tokens=[];this.table=[]};r.prototype._predict=function(e,t,r,n){var i=this.grammar.rulesByName[e];if(!i){if(!this.grammar.undefinedRulesSet[e]){var o="No rule named "+JSON.stringify(e)+" required by "+JSON.stringify(r.rule.name);var a=new Error(o);a.rule=r.rule;throw a}return[]}var s=[];for(var l=0;l<i.length;l++){s.push(new u(i[l],t))}return s};r.prototype._complete=function(e){var t=[];for(var r=0;r<e.predictedBy.length;r++){t.push(e.predictedBy[r].next(e))}return t};r.prototype.parse=function(t){var e=this.table;var r=null;if(e.length){assert(this.table.length<=this.tokens.length+1,"argh");var n=Math.min(t.length,this.table.length-1);for(r=0;r<n;r++){if(!this.tokens[r].isEqual(t[r])){break}}this.table.splice(r+1)}this.tokens=t.slice();var i=this.grammar;var o;if(r===null){assert(!e.length);o=this._predict(this.grammar.toplevel,0,null);e.push(o)}else if(r<t.length){this.index=r;var a=t[r];o=e[r];var s=[];for(var l=0;l<o.length;l++){var u=o[l];if(!u.isFinished){if(typeof u.expect!=="string"){if(u.expect.match(a)){s.push(u.next(r))}}}}if(!s.length){var c=this._makeError(a.value);c.index=f;c.found=t[r];throw c}e.push(s);o=s;r++}else{o=e[e.length-1];r++}for(var f=r||0;f<=t.length;f++){this.index=f;var a=t[f];var s=[];var h={};for(var l=0;l<o.length;l++){var u=o[l];if(!u.isFinished){if(typeof u.expect==="string"){if(!h[u.expect]){var d=this._predict(u.expect,f,u);[].push.apply(o,d);h[u.expect]=d}else{d=h[u.expect]}for(var p=0;p<d.length;p++){d[p].predictedBy.push(u)}}else if(f<t.length){if(u.expect.match(a)){s.push(u.next(f))}}}else{[].push.apply(o,this._complete(u))}}if(f<t.length){if(!s.length){var c=this._makeError(a.value);c.index=f;c.found=t[f];throw c}e.push(s);o=s}}var v=o.filter(function(e){return e.origin===0&&e.isFinished&&e.rule.name==this.grammar.toplevel},this);if(!v.length){throw this._makeError("Incomplete line")}return v.map(function(e){return new g(e,t)})};r.prototype._makeError=function(e){var t=this.table[this.index];var r=[];var s=[];(t||[]).forEach(function(e){if(e.isFinished)return;if(!(typeof e.expect==="string")){r.push(m(e.expect))}else{if(s.indexOf(e.expect)===-1)s.push(e.expect)}},this);s=s.filter(function(e){for(var t=0;t<s.length;t++){var r=s[t];var n=this.grammar.rulesByName[r]||[];for(var i=0;i<n.length;i++){var o=n[i];if(o.symbols.length!==1)continue;var a=o.symbols[0];if(typeof a!=="string")continue;if(a==e)return false}}return true},this);r=r.concat(s);var n=new Error(e);n.expected=r;n._table=this.table;return n};var g=function(e,t){this.item=e;this.tokens=t};g.prototype.process=function(){var i=this.tokens;function o(e){var t=[];for(var r=0;r<e.node.length;r++){var n=e.node[r];if(n.node){n=o(n)}else{n=i[n]}t.push(n)}return e.rule.process.apply(e.rule,t)}if(!this._ast){this._ast=o(this.item)}return this._ast};g.prototype.pretty=function(){var o=this.tokens;function a(e){var t=[e.rule.name];var r=e.rule.process._info;if(r)t.push(JSON.stringify(r.selector));for(var n=0;n<e.node.length;n++){var i=e.node[n];if(i.node){i=a(i)}else{i=JSON.stringify(o[i].value)}t.push(i)}return"("+t.join(" ")+")"}return a(this.item)};var y=function(e,t){this.leftParser=new r(e,t);this.rightParser=new r(e.reverse(),t)};y.cursorToken={kind:"cursor",value:"_CURSOR_",isEqual:function(e){return e===this}};y.prototype.parse=function(e){return this.leftParser.parse(e)};y.prototype.complete=function(t,e){var r=t.slice(0,e);r.push(y.cursorToken);var n=t.slice(e);n.reverse();n.push(y.cursorToken);var i;var o;try{this.leftParser.parse(r);assert(false)}catch(e){if(e.found!==y.cursorToken){return}i=e._table[e._table.length-1]}try{this.rightParser.parse(n);assert(false)}catch(e){if(e.found!==y.cursorToken){return}o=e._table[e._table.length-1]}var a=[];for(var s=0;s<i.length;s++){for(var l=0;l<o.length;l++){var u=i[s];var c=o[l];if(u.rule===c.rule._original){var f=u.rule.symbols;var h=u.position,d=f.length-c.position;var p=f.slice(h,d);var v=[p];v.forEach(function(e){a.push({start:u.origin,pre:f.slice(0,h),completion:e,post:f.slice(d),end:t.length-c.origin,rule:u.rule,item:u})})}}}function g(e){return typeof e==="string"?e:m(e)}return a};return{Rule:n,Grammar:i,Parser:r,Completer:y}}();function tc(e){var t=e.indexOf("|");if(t===-1)t=e.length;var r=Language.tokenize(e.slice(0,t));var n=Language.tokenize(e.slice(t+1));var i=r.concat(n);var o=new Earley.Completer(Language.grammar);return o.complete(i,r.length)}var Language=function(i){var p=function(e,t,r){this.kind=e;this.text=t;this.value=r};p.prototype.toString=function(){var e=[this.kind,this.text,this.value];return"Token("+e.map(JSON.stringify).join(", ")+")"};p.prototype.isEqual=function(e){return this.kind===e.kind&&this.value===e.value};function h(e){return e.value}var v=[["ellips",/\.{3}/],["comment",/\/{2}(.*)$/],["false",/\<\>/],["zero",/\(\)/],["empty",/_( |$)/],["number",/([0-9]+(\.[0-9]+)?e-?[0-9]+)/],["number",/((0|[1-9][0-9]*)?\.[0-9]+)/],["number",/((0|[1-9][0-9]*)\.[0-9]*)/],["number",/(0|[1-9][0-9]*)/],["color",/#([A-Fa-f0-9]{3}(?:[A-Fa-f0-9]{3})?)/],["string",/"((\\["\\]|[^"\\])*)"/],["string",/'((\\['\\]|[^'\\])*)'/],["lparen",/\(/],["rparen",/\)/],["langle",/\</],["rangle",/\>/],["lsquare",/\[/],["rsquare",/\]/],["cloud",/[☁]/],["input",/%[a-z](?:\.[a-zA-Z]+)?/],["symbol",/[-%#+*/=^,?]/],["symbol",/[_A-Za-z][-_A-Za-z0-9:',.]*/],["iden",/[^ \t"'()<>=*\/+-]+/]];var l=/(\\['\\])/g;var u=/(\\["\\])/g;var g=/^(?:[ \t]+|$)/;var e=/(.*)[ \t]*/;var c=function(e){var t=e;var r="";var n=g.exec(e);if(n){r=n[0];t=t.slice(n[0].length)}var i=[];var o=true;var a=false;while(t){var s=null;for(var l=0;l<v.length;l++){var u=v[l],s=u[0],c=u[1];var n=c.exec(t);if(n&&n.index==0){var f=n[0];var h=n[1]===undefined?n[0]:n[1];break}}if(l===v.length){i.push(new p("error",t,"Unknown token"));return i}if(a&&f.length>1){if(!o){i.push(new p("error",t,"Expected whitespace"));return i}}t=t.slice(f.length);var n=g.exec(t);o=Boolean(n);if(n){t=t.slice(n[0].length);f+=n[0]}if(s==="empty")o=true;if(s==="iden"&&i.length){var d=i[i.length-1];if(d.kind==="symbol"&&!/[ \t]$/.test(d.text)){d.text+=f;d.value+=h;d.kind="iden";a=true;continue}}if(i.length===0){f=r+f}i.push(new p(s,f,h));a=f.length>1}return i};function t(e){var t=e.text.trim()[0];var r=t==='"'?u:l;var n=e.text.split(r);assert(e.kind==="string","Want string token, not "+e);var i=[];for(var o=0;o<n.length;o++){var a=n[o];if(!a)continue;if(a==="\\\\"){i.push(new p("escape","\\","\\"));i.push(new p("string","\\","\\"))}else if(a==="\\"+t){i.push(new p("escape","\\","\\"));i.push(new p("string",t,t))}else{var s=g.exec(a);if(s&&s[0]){assert(i.length);i[i.length-1].text+=s[0];a=a.slice(s[0].length)}i.push(new p("string",a,a))}}return i}var f=function(e,t){this.kind=e;this.value=t};f.prototype.match=function(e){if(this.kind===e.kind){if(this.value===undefined){return true}else{return this.value===e.value}}else{return false}};f.prototype.generate=function(){var e=this.kind+" ";return new p(this.kind,e,this.value||this.toString())};f.prototype.toString=function(){switch(this.kind){case"symbol":return this.value;case"lparen":return"(";case"rparen":return")";case"langle":return"<";case"rangle":return">";case"false":return"<>";case"comment":return"// …"}};var r=i.Grammar;var d=function(e,t,r){var n=t.map(function(e){if(e instanceof Array){assert(e.length===1);e={kind:"symbol",value:e[0]}}if(typeof e==="object"){e=new f(e.kind,e.value)}return e});return new i.Rule(e,n,r)};function o(e){assert(arguments.length==1);return e}function a(e){return[e]}function s(n){return n.split(" ").map(a).map(function(e){var t=c(e[0]);assert(t.length===1,n+": "+t);var r=t[0];if(r.kind!=="symbol"){assert(r.kind!=="error",n);return new f(r.kind,r.value)}return e})}function m(e){assert(arguments.length===1);return e.value}function n(e,t,r){if(e.kind=="langle")e.display="‹";if(r.kind=="rangle")r.display="›";return new B(t.info,t.args,[e].concat(t.tokens).concat([r]))}function y(e){return function(){return e}}function b(e){return e}function w(e,t){return t}function k(){return{embed:[].slice.apply(arguments)}}function C(e){return function(){return{constant:e,embed:[].slice.apply(arguments)}}}function x(e){return parseFloat(m(e))}function S(e,t){e=e.slice();e.push(t);return e}function L(e,t,r){e=e.slice();e.push(r);return e}function A(t){return function(e){assert(arguments.length==1);e.category=t;return e.value}}function M(t){return function(){var e=[].slice.apply(arguments);return e.map(function(e){e.category=t;return e.value}).join(" ")}}function T(t){return function(){var e=[].slice.apply(arguments);e.forEach(function(e){e.category=t});return e}}function O(t){return function(e){return e.map(function(e){e.category=t;return e.value}).join(" ")}}function E(e,t,r){e.category=r.category="parameter";switch(e.kind){case"lparen":return{arg:"n",name:t};case"langle":return{arg:"b",name:t};case"lsquare":return{arg:"s",name:t}}}function N(e,t,r,n){e.category=t.category=n.category="parameter";return{arg:e.value.slice(1),name:r}}function I(e,t,r){e.category=r.category="list";return t}function P(e,t){var r=e==="define-atomic";var n=[];var i=[];var o=t.map(function(e){if(typeof e==="string"){return e}else{n.push(e.name);switch(e.arg){case"n":i.push(0);return"%n";case"b":i.push(false);return"%b";case"s":i.push("");return"%s";default:i.push("");return"%"+e.arg}}});var a=o.join(" ");var s=[a,n,i,r];var l={info:{shape:"hat",selector:"procDef"},args:s,_parts:t};return l}var R=new r([d("line",["define","spec-seq"],P),d("define",[["define"]],A("custom")),d("define",[["define-atomic"]],A("custom")),d("spec-seq",["spec-seq","spec"],S),d("spec-seq",["spec"],a),d("spec",[{kind:"symbol"}],A("custom")),d("spec",[{kind:"iden"}],A("custom")),d("spec",[{kind:"number"}],A("custom")),d("spec",[{kind:"lparen"},"arg-words",{kind:"rparen"}],E),d("spec",[{kind:"langle"},"arg-words",{kind:"rangle"}],E),d("spec",[{kind:"lsquare"},"arg-words",{kind:"rsquare"}],E),d("spec",[{kind:"input"},{kind:"lsquare"},"arg-words",{kind:"rsquare"}],N),d("arg-words",["word-seq"],O("parameter")),d("word-seq",["word-seq","word"],S),d("word-seq",["word"],a),d("word",[{kind:"symbol"}],o),d("word",[{kind:"iden"}],o),d("word",[{kind:"number"}],o)]);var B=function(e,t,r){this.info=e;this.args=t;this.tokens=r};function D(e){var t=[].slice.apply(arguments,[1]);var r=Scratch.blocksBySelector[e];assert(r);return H.apply(null,[r].concat(t))}function H(a){var s=[].slice.apply(arguments,[1]);var e=function(){var r=[].slice.apply(arguments);var e=s.map(function(e){var t=r[e];if(t.constant){t=t.constant}else if(t.embed){t=t.embed.map(function(e){return e.value}).join(" ")}t=t.value||t;return t});var t=[];r.forEach(function(e){if(e&&e.embed){t=t.concat(e.embed)}else if(e&&e.constant){}else{if(e.kind==="symbol"&&a.display){e.display=a.display}t.push(e)}});var n=a;if(a.selector==="stopScripts"){var i=e[0];if(["all","this script"].indexOf(i)===-1){n=Scratch.stopOtherScripts}}for(var o=0;o<e.length;o++){e[o]=_(e[o],a.inputs[o])}return new B(n,e,t)};e._info=a;return e}function _(e,t){if(typeof e==="object")return e;if(t==="%n"){return Number(e)||0}if(t==="%s"){return e+""}return e}function W(e){return H(Scratch.blocksBySelector[e],0,2)}function F(e){assert(arguments.length===1);var t=e.text.trim()[0];var r=t==='"'?u:l;var n=e.value.split(r);return n.map(function(e){if(e==="\\\\")return"\\";if(e==="\\"+t)return t;return e}).join("")}var z={red:"#e50000",orange:"#f97306",yellow:"#ffff14",green:"#15b01a",blue:"#0343df",purple:"#7e1e9c",black:"#000",white:"#fff",pink:"#ff81c0",brown:"#653700"};function j(e){var t=z[e.value];if(t!=="#fff")e.color=t;e.kind="color";return t}function K(e){var t=e.value;if(t.length===3)t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2];return parseInt(t,16)}function U(e,t){e.category="number";return-x(t)}var V=new r([d("line",["thing"],o),d("thing",["block"],o),d("thing",["r-parens"],o),d("thing",["b-parens"],o),d("n",["n4"],o),d("sb",["join"],o),d("sb",["n4"],o),d("sb",["s0"],o),d("b",["b8"],o),d("c",["r-parens"],o),d("c",["c0"],o),d("r-parens",[{kind:"lparen"},"r-value",{kind:"rparen"}],n),d("r-value",["join"],o),d("r-value",["n4"],o),d("b-parens",[{kind:"langle"},"b8",{kind:"rangle"}],n),d("predicate",["simple-predicate"],o),d("join",[["join"],"jpart","jpart"],D("concatenate:with:",1,2)),d("jpart",["s0"],o),d("jpart",[{kind:"empty"}],y("")),d("jpart",["join"],o),d("jpart",["r-parens"],o),d("jpart",["b-parens"],o),d("predicate",[["touching"],["color"],"c",["?"]],D("touchingColor:",2)),d("predicate",[["color"],"c",["is"],["touching"],"c",["?"]],D("color:sees:",1,4)),d("b8",["b-and"],o),d("b8",["b-or"],o),d("b8",["b7"],o),d("b-and",["b-and",["and"],"b7"],W("&")),d("b-and",["b7",["and"],"b7"],W("&")),d("b-or",["b-or",["or"],"b7"],W("|")),d("b-or",["b7",["or"],"b7"],W("|")),d("b7",[["not"],"b7"],D("not",1)),d("b7",["b6"],o),d("b6",["sb",{kind:"langle"},"sb"],W("<")),d("b6",["sb",{kind:"rangle"},"sb"],W(">")),d("b6",["sb",["="],"sb"],W("=")),d("b6",["m_list",["contains"],"sb",["?"]],W("list:contains:")),d("b6",["predicate"],o),d("b6",["b2"],o),d("b2",["b-parens"],o),d("b2",["b0"],o),d("n4",["n4",["+"],"n3"],W("+")),d("n4",["n4",["-"],"n3"],W("-")),d("n4",["n3"],o),d("n3",["n3",["*"],"n2"],W("*")),d("n3",["n3",["/"],"n2"],W("/")),d("n3",["n3",["mod"],"n2"],W("%")),d("n3",["n2"],o),d("n2",[["round"],"n2"],D("rounded",1)),d("n2",["m_mathOp",["of"],"n2"],W("computeFunction:of:")),d("n2",[["pick"],["random"],"n4",["to"],"n2"],D("randomFrom:to:",2,4)),d("n2",["m_attribute",["of"],"m_spriteOrStage"],D("getAttribute:of:",0,2)),d("n2",[["distance"],["to"],"m_spriteOrMouse"],D("distanceTo:",2)),d("n2",[["length"],["of"],"s2"],D("stringLength:",2)),d("n2",[["letter"],"n",["of"],"s2"],D("letter:of:",1,3)),d("n2",["n1"],o),d("n1",["simple-reporter"],o),d("n1",["r-parens"],o),d("n1",["b-parens"],o),d("n1",["n0"],o),d("s2",["s0"],o),d("s2",["n1"],o),d("n0",[["-"],{kind:"number"}],U),d("n0",[{kind:"number"}],x),d("n0",[{kind:"empty"}],y("")),d("s0",[{kind:"string"}],F),d("b0",[{kind:"false"}],y(false)),d("c0",[{kind:"color"}],K),d("@greenFlag",[["flag"]],T("green")),d("@greenFlag",[["green"],["flag"]],T("green")),d("@turnLeft",[["ccw"]],o),d("@turnLeft",[["left"]],o),d("@turnRight",[["cw"]],o),d("@turnRight",[["right"]],o)],["VariableName","ListName","AttributeVariable","ReporterParam","BooleanParam"]);var G=V.copy();Object.keys(z).forEach(function(e){V.addRule(d("c0",[{kind:"symbol",value:e}],j))});var q=["attribute","backdrop","broadcast","costume","effect","key","list","location","mathOp","rotationStyle","scene","sound","spriteOnly","spriteOrMouse","spriteOrStage","stageOrThis","stop","timeAndDate","touching","triggerSensor","var","varName","videoMotionType","videoState"];var Y=["direction","drum","instrument","listDeleteItem","listItem","note"];var X=["broadcast","costume","backdrop","location","scene","sound","spriteOnly","spriteOrMouse","spriteOrStage","touching"];var J={attribute:["x position","y position","direction","costume #","costume name","backdrop #","backdrop name","size","volume"],backdrop:[],booleanSensor:["button pressed","A connected","B connected","C connected","D connected"],broadcast:[],costume:[],effect:["color","fisheye","whirl","pixelate","mosaic","brightness","ghost"],key:["space","up arrow","down arrow","right arrow","left arrow","any","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z",0,1,2,3,4,5,6,7,8,9],list:[],listDeleteItem:["last","all"],listItem:["last","random"],location:["mouse-pointer","random position"],mathOp:["abs","floor","ceiling","sqrt","sin","cos","tan","asin","acos","atan","ln","log","e ^","10 ^"],motorDirection:["this way","that way","reverse"],rotationStyle:["left-right","don't rotate","all around"],sensor:["slider","light","sound","resistance-A","resistance-B","resistance-C","resistance-D"],sound:[],spriteOnly:["myself"],spriteOrMouse:["mouse-pointer"],spriteOrStage:["Stage"],stageOrThis:["Stage","this sprite"],stop:["all","this script","other scripts in sprite"],timeAndDate:["year","month","date","day of week","hour","minute","second"],touching:["mouse-pointer","edge"],triggerSensor:["loudness","timer","video motion"],var:[],videoMotionType:["motion","direction"],videoState:["off","on","on-flipped"]};var Z=["setVar:to:","<",">","="];var $={"mouse-pointer":"_mouse_",myself:"_myself_",Stage:"_stage_",edge:"_edge_","random position":"_random_"};q.forEach(function(n){if(X.indexOf(n)>-1){V.addRule(d("m_"+n,["jpart"],o))}var e=J[n];if(e&&e.length){e.forEach(function(e){var t;if(typeof e==="number"){t=[{kind:"number",value:String(e)}]}else{t=s(e)}process=k;var r;if(n!=="stageOrThis")r=$[e];if(r){process=C(r)}V.addRule(d("m_"+n,t,process))})}V.addRule(d("m_"+n,[{kind:"empty"}],m))});Y.forEach(function(t){var e=J[t];if(e&&e.length){e.forEach(function(e){V.addRule(d("d_"+t,s(e),o))})}V.addRule(d("d_"+t,["n"],o))});V.addRule(d("m_attribute",["jpart"],o));V.addRule(d("m_var",["VariableName"],o));V.addRule(d("m_varName",["VariableName"],o));V.addRule(d("m_list",["ListName"],o));var Q=[[],["*","/","%"],["+","-"],["=","<",">","list:contains:"],["not"],["&"],["|"]];var ee={};Q.forEach(function(e,t){e.forEach(function(e){ee[e]=t})});ee["concatenate:with:"]=-1;var te=["letter:of:","concatenate:with:","&","|","not","=","<",">","list:contains:","randomFrom:to:","stringLength:","rounded","computeFunction:of:","getAttribute:of:","distanceTo:","*","/","%","+","-","doIf","touchingColor:","color:sees:"];var re={};Scratch.blocks.forEach(function(i){if(te.indexOf(i.selector)>-1)return;if(re[i.spec]&&i.selector!=="getParam"){return}re[i.spec]=true;var o=[];var a=[];i.parts.forEach(function(e,t){var r=Scratch.inputPat.exec(e);if(!r){e.split(/(\?)|[ ]+/g).forEach(function(e){if(!e)return;if(/^@/.test(e)){o.push(e)}else{var t=s(e);assert(t.length===1);o.push(t[0])}})}else{var n=r[1].slice(1).replace(".","_");if(!/^[mdc]/.test(n)){assert(!(i.shape==="reporter"||i.shape==="predicate"),i.selector+" "+i.spec)}if(n==="s")n="sb";a.push(o.length);o.push(n)}});var e=i.shape==="reporter"?"simple-reporter":i.shape==="predicate"?"simple-predicate":"block";if(i.selector==="readVariable"){o=["VariableName"]}else if(i.selector==="contentsOfList:"){o=["ListName"];e="r-value"}else if(i.selector==="getParam"){o=[i.shape==="reporter"?"ReporterParam":"BooleanParam"]}assert(o.length);V.addRule(d(e,o,H.apply(null,[i].concat(a))))});R.rules.forEach(V.addRule.bind(V));function ne(t){return function(){var e=[].slice.apply(arguments);e.forEach(function(e){e.category=t});return e.map(function(e){return e.value}).join(" ")}}function ie(e,t){var r=se(t.name);var n=t.value instanceof Array?"ListName":"VariableName";e.addRule(new d(n,r,k))}function oe(e,t){var r=t.args[3];var n=t._parts;var i=[];n.forEach(function(e,t){if(e.arg){i.push("%"+e.arg)}else{i.push(e)}});var o=i.join(" ");var a=[];var i=o.split(Scratch.inputPat);var s=[];i.forEach(function(e){if(!e)return;if(Scratch.inputPat.test(e)){var t=e.slice(1).replace(".","_");if(t==="s")t="sb";s.push(a.length);a.push(t)}else{var r=c(e);r.forEach(function(e){a.push(new f(e.kind,e.value))})}});var l={isCustom:true,spec:o,parts:i,category:"custom",shape:"stack"};l.inputs=l.parts.filter(function(e){return Scratch.inputPat.test(e)});e.addRule(new d("block",a,H.apply(null,[l].concat(s))));return l}function ae(n,e){var t=e.args[3];var r=e._parts;r.forEach(function(e,t){if(e.arg){var r=e.arg==="b"?"BooleanParam":"ReporterParam";n.addRule(new d(r,se(e.name),M("parameter")))}})}function se(t){var e=c(t);return e.map(function(e){assert(e.kind!=="error",t);return new f(e.kind,e.value)})}var le=["x","y","z","pen color","pen shade","pen size","video transparency","instrument","color effect","whirl effect","pixelate effect","mosaic effect","brightness effect","ghost effect","fisheye effect","costume name","x position","y position","direction","costume #","size","backdrop name","backdrop #","volume","tempo","answer","mouse x","mouse y","loudness","timer","current year","current month","current date","current day of week","current hour","current minute","current second","days since 2000","username","mouse-pointer","Stage","edge","all","last","random"];var ue=["to","on","of","for","with"];function ce(r,e,t,n){var i=e;var o;while(true){var a=Language.tokenize(e);if(!a.length)break;var o=a[a.length-1];var s="";if(o.kind!=="error")break;if(o.value==="Expected whitespace"){s=" "+o.text}else{s=o.text.slice(1)}a.pop();var e=a.map(h).join(" ");e+=s}a.forEach(function(e,t){if(e.kind==="lparen"||e.kind==="langle"){var r=a[t+1];if(r&&(r.kind==="iden"||r.kind==="symbol")){r.value="_"+r.value;r.kind="iden"}}if(e.kind==="rparen"||e.kind==="rangle"){var r=a[t-1];if(r&&(r.kind==="iden"||r.kind==="symbol")){r.value=r.value+"_";r.kind="iden"}}});a=a.filter(function(e,t){return(e.kind==="symbol"&&!/^[=*\/+-]$/.test(e.value)||e.kind==="iden"||e.kind==="number"||e.kind==="cloud"&&t===0||e.kind==="input"&&r==="custom")&&ue.indexOf(e.value)===-1&&(e.value!=="y:"||r==="custom")});e=a.map(h).join(" ");e=e.replace(/ \?( |$)/g,"?");var l=r==="variable"?"var":r==="parameter"?"arg":r;if(!e){e=/^[^a-zA-Z]$/.test(i)?"_":l}se(e);var u=le.indexOf(e)>-1||/^[0-9]+(\.[0-9]+)?$/.test(e);if(e!=="_"&&(u||(n.hasOwnProperty(e)||t.hasOwnProperty(e))&&r==="parameter")){if(e)e+=" ";e+=l}var c=1;var f=e;while(e==="_"||e===l||n.hasOwnProperty(e)||t.hasOwnProperty(e)){e=f+c;c++}return e}var fe=function(e){this.obj=e};fe.prototype.match=function(e){var t=Object.keys(this.obj);for(var r=0;r<t.length;r++){var n=t[r];if(e.info[n]!==this.obj[n])return false}return true};var he=function(e){return d(e,[new fe({shape:e})],o)};function de(e,t){t=t.slice();t.splice(0,0,e);return t}function pe(e,t,r){t=t.slice();t.splice(0,0,e);t.push(r);return t}blockGrammar=new r([d("script-list",["script"],a),d("script-list",["script-list","blank-line","script"],L),d("script",["lines"],o),d("lines",["stack"],a),d("lines",["lines","stack"],S),he("hat"),he("stack"),he("cap"),d("blank-line",[new fe({blank:true})],y(null))]);function ve(e){return/^define(-atomic)? /.test(e)}function ge(e){var r=V.copy();e.variables.forEach(function(e){var t=e._name();Language.addDefinition(r,{name:t})});e.lists.forEach(function(e){var t=e._name();Language.addDefinition(r,{name:t,value:[]})});e.definitions.forEach(function(e){Language.addCustomBlock(r,e)});return r}var me=["BooleanParam","color:sees:","touching:","touchingColor:","mousePressed","keyPressed:","list:contains:","not","ReporterParam","VariableName","+","-","*","/","%","stringLength:","letter:of:","lineCountOfList:","timer","rounded","computeFunction:of:","heading","distanceTo:","costumeIndex","backgroundIndex","sceneName","randomFrom:to:","timeAndDate","mouseX","mouseY","getUserName","tempo","volume","soundLevel","getLine:ofList","getAttribute:of:","senseVideoMotion","append:toList:","doAsk","broadcast:","doBroadcastAndWait",,"changeXposBy:","changeYposBy:","changeGraphicEffect:by:","changeSizeBy:","changePenSizeBy:","changePenHueBy:","changePenShadeBy:","changeVolumeBy:","changeTempoBy:","changeVar:by:","clearPenTrails","filterReset","createCloneOf","deleteClone","deleteLine:ofList:","doForever","gotoX:y:","gotoSpriteOrMouse:","comeToFront","goBackByLayers:","glideSecs:toX:y:elapsed:from:","hide","hideVariable:","hideList:","doIf","doIfElse","insert:at:ofList:","bounceOffEdge","nextCostume","nextScene","heading:","pointTowards:","putPenDown","putPenUp","playSound:","doPlaySoundAndWait","noteOn:duration:elapsed:from:","playDrum","doRepeat","doUntil","setLine:ofList:to:","timerReset","rest:elapsed:from:","say:","say:duration:elapsed:from:","setVar:to:","xpos:","ypos:","setGraphicEffect:to:","setSizeTo:","penSize:","penColor:","setPenHueTo:","setPenShadeTo:","setVolumeTo:","setRotationStyle","instrument:","setTempoTo:","setVideoTransparency","show","showVariable:","showList:","stopScripts","stopAllSounds","stampCostume","lookLike:","startScene","startSceneAndWait","turnRight:","turnLeft:","think:","think:duration:elapsed:from:","setVideoState","whenGreenFlag","wait:elapsed:from:","doWaitUntil","whenKeyPressed","whenCloned","whenIReceive","whenClicked","keyPressed:","whenSceneStarts","end","else"];return{tokenize:c,defineGrammar:R,grammar:V,_coreGrammar:G,blockGrammar:blockGrammar,whitespacePat:g,eolPat:e,addDefinition:ie,addCustomBlock:oe,splitStringToken:t,addParameters:ae,precedence:ee,menusThatAcceptReporters:X,menuOptions:J,blocksWithNumberLiterals:Z,cleanName:ce,isDefinitionLine:ve,modeGrammar:ge,preferSelectors:me}}(Earley);CodeMirror.defineMode("tosh",function(n,t){function e(e){return JSON.parse(JSON.stringify(e))}var r=function(){this.lineTokens=[];this.indent=[];this.lastLine=null;var e=Language.modeGrammar(t);this.startGrammar=e;this.startCompleter=new Earley.Completer(e);this.completer=this.startCompleter};r.prototype.copy=function(){var e=new r;e.lineTokens=this.lineTokens.slice();e.indent=this.indent.slice();e.startGrammar=this.startGrammar;e.startCompleter=this.startCompleter;e.completer=this.completer;return e};r.prototype.parseAndPaint=function(t){this.lastLine=null;if(!t.length){this.completer=this.startCompleter;this.indent=[];return}var e;try{results=this.completer.parse(t)}catch(e){t.forEach(function(e){e.category="error"});return}if(results.length>1){console.log("AMBIGUOUS: "+results.length+" results");results.forEach(function(e){console.log(e.pretty())})}var e=results[0];e=e.process();switch(e?e.info.shape:null){case"c-block":case"c-block cap":this.indent.push("c");break;case"if-block":this.indent.push("if");break;case"end":this.indent.pop();break;case"else":this.indent[this.indent.length-1]="else";break}if(e&&e.info.selector==="procDef"){var r=this.startGrammar.copy();Language.addParameters(r,e);this.completer=new Earley.Completer(r);return}i(e);this.lastLine=e;return e};function i(t){if(!t)return;t.tokens.forEach(function(e){if(e.info){i(e)}else{e.category=t.info.category}})}function o(e){if(!e)return e;if(e.value)return e.value;if(!e.info)return e;switch(e.info.selector){case"+":case"-":case"*":case"/":case"%":case"&":case"|":return[o(e.args[0]),e.info.selector,o(e.args[1])];default:return[e.info.selector||e.info.spec].concat(e.args.map(o))}}return{startState:function(){return new r},copyState:function(e){return e.copy()},token:function(e,r){if(r.lineTokens.length===0){e.match(Language.whitespacePat);var t=e.match(Language.eolPat,false);var n=t[0];var i=Language.tokenize(n);r.parseAndPaint(i);r.lineTokens=[];i.forEach(function(e){if(e.kind==="string"){var t=Language.splitStringToken(e);r.lineTokens=r.lineTokens.concat(t)}else{r.lineTokens.push(e)}})}if(!r.lineTokens.length){e.match(/[ \t]*$/);return}var o=r.lineTokens.shift();assert(e.match(o.text),"Does not match stream: "+o);e.match(Language.whitespacePat);if(o.kind==="error"&&/^['"]/.test(o.text)){return"string"}else if(o.category){return"s-"+o.category}else if(o.kind==="string"){return"string"}else if(["number","color","empty","zero","false","comment","ellips"].indexOf(o.kind)!==-1){return"s-"+o.kind}},blankLine:function(e){e.parseAndPaint([])},indent:function(e,t){var r=e.indent.length;switch(t.trim()){case"end":case"else":r--}return r*n.indentUnit},lineComment:"//",electricInput:/([ \t]|else|end)$/,closeBrackets:"()[]''\"\""}});CodeMirror.defineMode("text/x-tosh","tosh");var Compiler=function(){function i(e,t){if(!e)throw new Error(t||"There's a problem here")}function r(e){return e.reduce(function(e,t){return e+t},0)}function e(e,t){var r=Earley.Parser;var n=Language.modeGrammar(t);var i=n;var o=new r(i);var a=[];e(function(e){var e=e.text;var t=s(e,o);a.push(t);if(t.info.selector==="procDef"){i=n.copy();Language.addParameters(i,t);o=new r(i)}if(t.info.shape==="blank"){i=n;o=new r(i)}});return a}function s(e,t){var r=Language.tokenize(e);if(!r.length){return{info:{shape:"blank"}}}try{results=t.parse(r)}catch(e){return{info:{shape:"error",error:e.message}}}var n=results[0];n=n.process();return n}function t(e){e.push({info:{shape:"eof"}});var t=new o(e);var r=a(t);var i=10;var n=r.map(function(e,t){var r=[10,i,e];var n=C(e);i+=n+10;return r});return n}function o(e){this.lines=e}o.prototype.peek=function(){var e=this.lines[0];i(e);return e};o.prototype.shift=function(){var e=this.lines.shift();while(this.lines.length&&!this.lines[0]){this.lines.shift()}return e};function a(e){var t=[];while(true){switch(e.peek().info.shape){case"blank":e.shift();break;case"eof":return t;default:t.push(l(e));switch(e.peek().info.shape){case"blank":break;case"eof":return t;case"error":var r=e.peek().info;throw new Error(r.error);default:i(false,"Expected a blank line")}}}}function n(e,t){if(t){i(e.peek().info.shape==="blank","Expected a blank line");e.shift()}while(true){if(e.peek().info.shape==="blank"){e.shift()}else{return}}}function l(e){switch(e.peek().info.shape){case"reporter":case"predicate":var t=f(e.shift());return[t];default:var r=c(e,true);var n=u(e);n.splice(0,0,r);return n}}function u(e){var t=[];if(e.peek().info.shape==="ellips"){e.shift();return[]}while(true){switch(e.peek().info.shape){case"cap":case"c-block cap":var r=c(e);if(r)t.push(r);return t;default:var r=c(e);if(r){t.push(r)}else{return t}}}}function c(e,t){var r;var n;switch(e.peek().info.shape){case"c-block":case"c-block cap":block=e.shift();r=block.info.selector;n=block.args.map(f);n.push(u(e));i(e.peek().info.shape==="end",'Expected "end"');e.shift();break;case"if-block":block=e.shift();n=block.args.map(f);n.push(u(e));r="doIf";switch(e.peek().info.shape){case"else":r="doIfElse";e.shift();n.push(u(e));case"end":i(e.peek().info.shape==="end",'Expected "end"');e.shift();break;default:i(false,'Expected "else" or "end"')}break;case"cap":case"stack":block=e.shift();r=block.info.selector;n=block.args.map(f);if(block.info.isCustom){return["call",block.info.spec].concat(n)}break;case"hat":if(t){block=e.shift();r=block.info.selector;n=r==="procDef"?block.args.slice():block.args.map(f);break}default:return}return[r].concat(n)}function f(e){if(e.info){var t=e.args.map(f);if(e.info.selector==="getParam"){t.push(e.info.shape==="predicate"?"b":"r")}return[e.info.selector].concat(t)}else if(e.value){return e.value}else{return e}}var y=function(e){};function b(e){var t=e.shape;switch(t){case"if-block":return 36;case"c-block cap":return 34;case"cap":return 8;case"c-block":return 21;case"stack":return 9;case"hat":return e.selector==="whenGreenFlag"?25:18;case"predicate":return 5;case"reporter":return 4}throw"internalHeight can't do "+e.selector}function w(e){var t=e.shape;switch(t){case"stack":return 16;case"cap":case"c-block cap":return 16;case"predicate":return 16;case"reporter":return 16;case"hat":return k("readonly-menu")}throw"noInputs can't do "+e.selector}function k(e){switch(e){case"list":return 12;case"number":return 16;case"string":return 16;case"boolean":return 16;case"readonly-menu":return 16;case"number-menu":return 16;case"color":return 16}throw"emptySlot can't do "+e}function C(e,t){if(t)y=t;return r(e.map(S))-3*(e.length-1)}function x(e){var t=e[0],r=e.slice(1),n;switch(t){case"call":spec=r.shift();n={spec:spec,parts:spec.split(Scratch.inputPat),shape:"stack",category:"custom",selector:null,defaults:[]};n.inputs=n.parts.filter(function(e){return Scratch.inputPat.test(e)});return n;default:n=Scratch.blocksBySelector[t];if(!n)throw"unknown selector: "+t;return n}}function S(e){var t=e[0],r=e.slice(1);if(t==="procDef"){var n=false,i=false;var o=r[0];o.split(Scratch.inputPat).forEach(function(e){if(Scratch.inputPat.test(e)){n=true;if(e==="%b")i=true}});return i?65:n?64:60}var a=x(e);if(t==="call"){r.shift()}var s=b(a);y(s,"internalHeight",a.selector);if(t==="stopScripts"&&["all","this script"].indexOf(r[0])===-1){s+=1}var l=0;var u=0;var n=a.inputs.length||/c-block|if-block/.test(a.shape);if(!n){l=w(a);y(l,"noInputs",a.shape)}else{for(var c=0;c<r.length;c++){var f=r[c];var h=a.inputs[c]?Scratch.getInputShape(a.inputs[c]):"list";var d=f instanceof Array&&f.length;var p;if(!d){p=k(h);y(p,"emptySlot",h)}if(h==="list"){if(d){p=C(f);var v=f.slice().pop();if(v){var g=x(v);if(/cap/.test(g.shape)){p+=3}}}u+=p}else{if(d){p=S(f)}l=Math.max(l,p)}}}var m=s+l+u;y(m,e);return m}var h={"@greenFlag":"flag","@turnLeft":"ccw","@turnRight":"cw"};function d(e){var t=[];for(var r=0;r<e.length;r++){var n=e[r][2];if(n.length===1){if(p(n[0]))continue}t.push(v(n).join("\n"))}var i=t.join("\n\n");if(i&&i[i.length-1]!=="\n")i+="\n";return i}function p(e){if(e[0]==="getParam")return true;for(var t=1;t<e.length;t++){var r=e[t];if(r.constructor===Array&&p(r)){return true}}return false}function v(e){var t=[];e.forEach(function(e){t=t.concat(g(e))});return t}function g(e){var t=e[0],r=e.slice(1),n=Scratch.blocksBySelector[t];if(t==="call"){var i=t=r.shift();n={spec:i,parts:i.split(Scratch.inputPat),shape:"stack",category:"custom",selector:null,defaults:[],_isCustom:true};n.inputs=n.parts.filter(function(e){return Scratch.inputPat.test(e)})}else if(t==="procDef"){var i=e[1],o=e[2].slice(),a=e[3].slice(),s=e[4];var l=s?"define-atomic ":"define ";return l+i.split(Scratch.inputPat).map(function(e){var t=Scratch.inputPat.exec(e);if(t){var r=Scratch.getInputShape(e);var n=o.shift();n=n.replace(/ \?$/,"?");switch(r){case"number":return"("+n+")";case"string":return"["+n+"]";case"boolean":return"<"+n+">";default:return e+"["+n+"]"}}else{return e.split(/ +/g).map(function(e){if(e==="\\%")return"%";return e}).join(" ")}}).join("")}if(n.shape==="reporter"||n.shape==="predicate"){return L(e,null,-Infinity)}var u=+Infinity;if(n._isCustom)u=-2;var l=A(n,r,u);switch(n.shape){case"if-block":var c=[l];c=c.concat(m(r.shift()));if(r.length){c.push("else");c=c.concat(m(r.shift()))}c.push("end");return c;case"c-block":case"c-block cap":var c=[l];c=c.concat(m(r.shift()));c.push("end");return c;default:return[l]}}function m(e){var t=v(e||[]);if(!t.length)t=["..."];return I(t)}function L(e,t,r,n){var i=e[0],o=e.slice(1),a=Scratch.blocksBySelector[i];if(i==="getParam"){a={shape:o.pop()==="b"?"predicate":"reporter",parts:a.parts}}var s=Language.precedence[i]||0;var l=A(a,o,s);var u=s>r||i==="|"&&r===Language.precedence["&"]||i==="&"&&r===Language.precedence["|"]||t==="color"||t!=="boolean"&&a.shape==="predicate"||s===r&&["-","/","%"].indexOf(i)>-1&&n===1||t==="readonly-menu"||i==="contentsOfList:"||s===-1&&r>0;if(u){switch(a.shape){case"predicate":l="<"+l+">";break;default:l="("+l+")";break}}return l}function A(e,t,r){var n=0;var i=[];for(var o=0;o<e.parts.length;o++){var a=e.parts[o];var s=Scratch.inputPat.exec(a);if(s){var l=Scratch.getInputShape(a);var u=t.shift();var c=a.split(".").pop();if(u instanceof Array){a=L(u,l,r,n)}else if(a==="%s"&&Language.blocksWithNumberLiterals.indexOf(e.selector)>-1){var f=/^-?(0|[1-9][0-9]*)(\.[0-9]*)?$/.test(u);a=f?""+u:E(u)}else{a=M(u,l,c,r)}n+=1}else{a=a.split(/( +)/g).map(function(e){if(/[:]$/.test(e))e+=" ";return h[e]||e||""}).join("")}i.push(a)}return i.join("").replace(/ +/," ")}function M(e,t,r,n){switch(t){case"color":return N(parseInt(e));case"boolean":if(!e)return"<>";assert(false,"literal non-false booleans not allowed: "+e);case"readonly-menu":return T(e,r);case"string":return E(e);case"number":var i=Number(e);return Number(e)||0;default:return e}}function T(e,t){switch(e){case"_mouse_":return"mouse-pointer";case"_myself_":return"myself";case"_stage_":return"Stage";case"_edge_":return"edge";case"_random_":return"random position"}if(O(t,e)){return E(e)}else{if(t==="param"){e=e.replace(/ \?$/,"?")}return e}}function O(e,t){if(Language.menusThatAcceptReporters.indexOf(e)>-1){return true}if(e==="attribute"&&Language.menuOptions.attribute.indexOf(t)===-1){return true}return false}function E(e){var e=e===undefined?"":""+e;return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function N(e){if(e<0)e=4294967295+e+1;var t=e.toString(16);t=t.slice(Math.max(0,t.length-6));while(t.length<6)t="0"+t;if(t[0]===t[1]&&t[2]===t[3]&&t[4]===t[5]){t=t[0]+t[2]+t[4]}return"#"+t}function I(e){return e.map(function(e){return"\t"+e})}function P(e,t){var r=t[0],n=t[1],i=t[2];return[r,n,R(e,i)]}function R(e,t){if(!t)return[];return t.map(B.bind(this,e))}function B(e,t){var r=t[0];var n=Scratch.blocksBySelector[r];var i=n?n.shape:null;var o=[];if(/if-block/.test(i)||r==="doIfElse"){if(t.length>3){return[r,D(e,t[1]),R(e,t[2]),R(e,t[3])]}else{return[r,D(e,t[1]),R(e,t[2])]}}else if(/c-block/.test(i)){if(t.length===3){return[r,D(e,t[1]),R(e,t[2])]}else{return[r,R(e,t[1])]}}var a=[r];var s=1;if(r==="call"){a.push(t[1]);s=2}for(;s<t.length;s++){a.push(D(e,t[s]))}var l=H(e,r,a);if(l){assert(l.length===t.length-1);a=[r].concat(l)}return a}function D(e,t){if(t.constructor===Array){t=B(e,t)}return t}function H(t,e,r){var n=r[1],i=r[2],o=r[3];switch(e){case"readVariable":case"showVariable:":case"hideVariable:":return[t("variable",n)];case"setVar:to:":case"changeVar:by:":return[t("variable",n),i];case"getAttribute:of:":if(i instanceof Array||n instanceof Array||Language.menuOptions.attribute.indexOf(n)>-1){return[n,i]}return[t("variable",n,i),i];case"contentsOfList:":case"showList:":case"hideList:":case"lineCountOfList:":return[t("list",n)];case"append:toList:":case"deleteLine:ofList:":case"getLine:ofList:":return[n,t("list",i)];case"insert:at:ofList:":return[n,i,t("list",o)];case"setLine:ofList:to:":return[n,t("list",i),o];case"list:contains:":return[t("list",n),i];case"getParam":return[t("parameter",n),i];case"procDef":var a=n,s=i,l=o.slice(),u=r[4];var c=s.map(function(e){return t("parameter",e)});return[t("custom",a),c,l,u];case"call":return[t("custom",n)].concat(r.slice(2))}}return{generate:d,parseLines:e,compile:t,renameInScript:P,_measure:C}}();var Format=function(){function t(e){return e.reduce(function(e,t){return e+t},0)}function o(e){var t="";var r=new Uint8Array(e);var n=r.byteLength;for(var i=0;i<n;i++){t+=String.fromCharCode(r[i])}return t}function e(e){var t=e.length;var r=new Uint8Array(t);for(var n=0;n<t;n++){var i=e.charCodeAt(n);r[n]=i}return r.buffer}function v(e,t){var r=new Image;var n=ko(null);var i=ko(null);if(e==="jpg")e="jpeg";if(e==="svg"){var o=el("canvas");canvg(o,t,{renderCallback:function(){n.assign(o.toDataURL("image/png"))}})}else{n.assign("data:image/"+e+";base64,"+btoa(t))}function a(e){return{width:e.naturalWidth,height:e.naturalHeight}}n.subscribe(function(e){r.src=e;l();r.addEventListener("load",l)});var s;function l(){if(r.naturalWidth){i.assign(a(r));clearTimeout(s);return}s=setTimeout(l,100)}return{src:n,size:i}}function g(e,t){assert(e==="wav");var r=new Audio;r.src="data:audio/"+e+";base64,"+btoa(t);r.controls=true;return r}function r(e){return e.objName()}var n=function(){return{name:ko("backdrop1"),ext:"svg",file:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='480px' height='360px'><path fill='#ffffff' d='M 0 0 L 480 0 L 480 360 L 0 360 Z' /></svg>",bitmapResolution:1,rotationCenterX:240,rotationCenterY:180,_src:ko("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAA6ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iPgogICAgICAgICA8eG1wOk1vZGlmeURhdGU+MjAxNi0wMS0yNVQyMTowMToyMjwveG1wOk1vZGlmeURhdGU+CiAgICAgICAgIDx4bXA6Q3JlYXRvclRvb2w+UGl4ZWxtYXRvciAzLjQuMjwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpDb21wcmVzc2lvbj41PC90aWZmOkNvbXByZXNzaW9uPgogICAgICAgICA8dGlmZjpSZXNvbHV0aW9uVW5pdD4yPC90aWZmOlJlc29sdXRpb25Vbml0PgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj43MjwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6WFJlc29sdXRpb24+NzI8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj40PC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT4xPC9leGlmOkNvbG9yU3BhY2U+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj4zPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Ci3MB8YAAAAVSURBVAgdY/z//z8DDDDBGCAahQMAby0DAwzQlZYAAAAASUVORK5CYII="),_size:ko({width:480,height:360})}};var i=function(){return{name:ko("turtle"),ext:"svg",file:"<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='25px' height='20px'><path style='fill:#007de0;stroke:#033042;stroke-width:1;stroke-linejoin:round;' d='M 0,0 20,8 0,16 6,8 Z' /></svg>",bitmapResolution:1,rotationCenterX:8,rotationCenterY:8,_src:ko("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAUCAYAAAB4d5a9AAABTElEQVQ4T2NkMnT5xcDI/JWBmWXmvy+fJjJcP/ycgcqAkckiIPM/n3wbg4AiB+P9Pf8ZGRhP//31uZvh4oEt1LKLEWQQo0XQRga1ANf/8nacDC8vMjDd3fmR4f3d/9TyHdgSEGAy8Xr9z75JhIFLBCLw4wMD48MDP6jhO7glDIZO8kysvFf+uU/kwQgmCn2HsATkG1D8CKq2/DfJFsIaH2T6DsUSjPjBF/Mk+A7DEqzxg88yJN/9//fn3v+zO3TQlVPHkgf7fzI+2PuP4d/fe//ObidsCTg5qwe4/Jez48KbTyDB9Ynhw91/DEz4MzJmxAuotvw3xRPxUFeTkmlJScJEuRqb7/FnRjJcjdMSlHggIayJLdsgBSQvqIBU4ASlEFLCmnhLQEU9E/NXQimEWAOxB5e+gw81i3W8EU+JSwnpxZrjCWkiVZ4ulgAAfsb6FdvZrw8AAAAASUVORK5CYII="),_size:ko({width:25,height:20})}};var m={};m.new=function(){var e=m.newSprite();var t={objName:ko("Stage"),_isStage:true,_hasErrors:ko(false),_fileName:"",children:ko([e]),sprites:ko([e]),scripts:[],scriptComments:[],variables:ko([]),lists:ko([]),costumes:ko([n()]),currentCostumeIndex:ko(0),sounds:ko([]),penLayerMD5:"5c81a336fab8be57adc039a8a2b33ca9.png",penLayerID:0,tempoBPM:60,videoAlpha:.5,info:{videoOn:false,spriteCount:1,scriptCount:0}};t._spriteNames=t.sprites.map(r);return t};m.newSprite=function(){var e={objName:ko("turtle"),indexInLibrary:1,_hasErrors:ko(false),_editingName:ko(false),scripts:[],scriptComments:[],variables:ko([]),lists:ko([]),costumes:ko([i()]),currentCostumeIndex:ko(0),sounds:ko([]),scratchX:0,scratchY:0,scale:1,direction:90,rotationStyle:"normal",isDraggable:false,visible:true,spriteInfo:{}};return e};m.newVariable=function(e){var e=ko(e||"");return{name:e,_name:e,value:0,isPersistent:false,_isEditing:ko(false)}};m.newList=function(e){var e=ko(e||"");return{listName:e,_name:e,contents:[],isPersistent:false,x:5,y:5,width:102,height:202,visible:false,_isEditing:ko(false)}};m.newCostume=function(e,t,r){var n=v(t,o(r));var i={name:ko(e),ext:t,file:r,bitmapResolution:1,rotationCenterX:0,rotationCenterY:0,_src:n.src,_size:n.size};n.size.subscribe(function(e){if(!e)return;i.rotationCenterX=e.width/2;i.rotationCenterY=e.height/2});return i};m.newSound=function(e,t,r){var n=g(t,o(r));return{name:ko(e),ext:t,file:r,_$audio:$audio}};m.load=function(u){var f=P.IO.parseJSONish(u.file("project.json").asText());f.sprites=f.children.filter(function(e){return!!e.objName});f.sprites.sort(function(e,t){return e.indexInLibrary<t.indexInLibrary?-1:e.indexInLibrary>t.indexInLibrary?+1:0});f.sprites.forEach(function(e){e.objName=ko(e.objName)});f.sprites=ko(f.sprites);f.children=ko(f.children);f._spriteNames=f.sprites.map(r);f._isStage=true;var e=0;var h={};var c={};var d={};var p={};[f].concat(f.sprites()).forEach(function(o){o.scripts=o.scripts||[];o.scriptComments=o.scriptComments||[];o.variables=ko(o.variables||[]);o.lists=ko(o.lists||[]);o._hasErrors=ko(false);o._editingName=ko(false);o.objName=ko(o.objName);var e=o.currentCostumeIndex;if(!e||e<0||e>=o.costumes.length){e=0}o.currentCostumeIndex=ko(e);o.scripts.sort(function(e,t){var r=e[0],n=e[1],i=t[0],o=t[1];return n>o?+1:n<o?-1:r>i?+1:r<i?-1:0});o.variables().forEach(function(e){e._name=e.name=ko(e.name);e._isEditing=ko(false)});var t={};o.lists().forEach(function(e){e._name=e.listName=ko(e.listName);e._isEditing=ko(false)});var a={};var s={};if(o===f){c=a;d=s}o.variables().forEach(function(e){a[e._name()]=true});o.lists().forEach(function(e){s[e._name()]=true});var l=o._customBlocks={};o.scripts.forEach(function(e){function t(e,t,r){if(r)return;if(e==="parameter")return;if(t.constructor===Array)return;if(e==="variable"){if(!a.hasOwnProperty(t)&&!c.hasOwnProperty(t)){var n=m.newVariable();n._name.assign(t);o.variables.push(n);a[t]=n}}else if(e==="list"){if(!s.hasOwnProperty(t)&&!d.hasOwnProperty(t)){var i=m.newList();i._name.assign(t);o.lists.push(i);s[t]=i}}else if(e==="custom"){l[t]=Language.cleanName("custom",t,{},{})}}Compiler.renameInScript(t,e)});var n={variable:{},list:{},definitions:{}};var r=o.objName();var i={};o._seen=i;if(o===f){r="_stage_";p=i}o.variables().forEach(function(e){var t=e._name();var r=Language.cleanName("variable",t,i,p);i[r]=true;n.variable[t]=r;e._name.assign(r)});o.lists().forEach(function(e){var t=e._name();var r=Language.cleanName("list",t,i,p);i[r]=true;n.list[t]=r;e._name.assign(r)});h[r]=n;o.costumes=ko(o.costumes||[]);o.costumes().forEach(function(e){var t=e.baseLayerMD5.split(".").pop(),r=e.baseLayerID+".";var n=u.file(r+t);if(!n){t="png";n=u.file(r+t)}if(!n){t="jpg";n=u.file(r+t)}if(!n){t="svg";n=u.file(r+t)}assert(n,"Couldn't find image: "+r+t);e.file=n.asArrayBuffer();e.ext=t;delete e.baseLayerID;var i=v(t,n.asBinary());e._src=i.src;e._size=i.size;if(e.textLayerID){if(e.textLayerID!==-1){r=e.textLayerID+".";n=u.file(r+t);if(!n){t="png";n=u.file(r+t)}assert(n,"Couldn't find text layer: "+r+t);e.textFile=n.asArrayBuffer();e.textExt=t}delete e.textLayerID}e.name=ko(e.costumeName);delete e.costumeName});o.sounds=ko(o.sounds||[]);o.sounds().forEach(function(e){var t=e.md5.split(".").pop()||"wav",r=e.soundID+"."+t;var n=u.file(r);e.file=n.asArrayBuffer();e.ext=t;e._$audio=g(t,n.asBinary());e.name=ko(e.soundName);delete e.soundID;delete e.md5})});[f].concat(f.sprites()).forEach(function(e){var s=e===f?"_stage_":e.objName();var l=e._seen;var u=e._customBlocks;var c=function(e,t,r,n){var n=n||s;var i=h[n];if(!i)return r;var o=i[t];var a;if(t==="parameter"){o=o[e];if(!o)return;a=o[r]}else if(t==="custom"){return u[r]}else{if(!o[r]){i=h["_stage_"];o=i[t]}a=o[r]}if(!a)return r;return a};e.scripts=e.scripts.map(function(e){var t=e[2];var r=t[0];var n=null;var i={};if(r[0]==="procDef"){n=r[1];var o=r[2];o.forEach(function(e){var t=Language.cleanName("parameter",e,l,p);i[e]=t})}var a=function(e,t,r){if(e==="parameter"){return i[t]||t}return c(n,e,t,r)};return Compiler.renameInScript(a,e)});delete e._seen;delete e._customBlocks});f.children().forEach(function(e){if(e.objName)return;var t=e.target;if(!t)return;t=t==="Stage"?"_stage_":t;if(e.cmd==="getVar:"){var r=h[t];if(!r)return;var n=r.variable;var i=e.param;i=n[i]||i;e.param=i;e.label=t==="_stage_"?i:t+": "+i}});return f};m.copyForSave=function(e){function n(t){if(!t)return t;if(ko.isObservable(t)){t=t()}if(t&&t.constructor===Array){return t.map(n)}else if(t.constructor===Object){var r={};Object.keys(t).forEach(function(e){if(/^_/.test(e))return;r[e]=n(t[e])});return r}return t}return n(e)};m.save=function(e){e.sprites().forEach(function(e,t){e.indexInLibrary=t+1});e.info.spriteCount=e.sprites().length;e.info.scriptCount=t([e].concat(e.sprites()).map(function(e){return e.scripts.length}));var e=m.copyForSave(e);var r=new JSZip;delete e.sprites;var n=0;var i=0;[e].concat(e.children).forEach(function(e){if(!e.objName)return;e.costumes.forEach(function(e){e.costumeName=e.name;delete e.name;e.baseLayerID=n++;e.baseLayerMD5=e.baseLayerMD5||"";var t=e.baseLayerID+"."+e.ext;r.file(t,e.file);delete e.ext;delete e.file;if(e.textFile){e.textLayerID=n++;var t=e.textLayerID+"."+e.textExt;r.file(t,e.textFile);delete e.textFile;delete e.textExt}});e.sounds.forEach(function(e){e.soundName=e.name;delete e.name;e.soundID=i++;e.md5="";var t=e.soundID+"."+e.ext;r.file(t,e.file);delete e.ext;delete e.file});e.variables=a(e.variables);e.lists=a(e.lists)});r.file("project.json",JSON.stringify(e));return r};function a(e){var t={};var r=[];for(var n=0;n<e.length;n++){var i=e[n];var o=i.name||i.listName;if(!o)continue;if(t.hasOwnProperty(o))continue;r.push(i);t[o]=true}return r}return{Project:m,binaryToArrayBuffer:e}}();var Host={};Host.isApp=!!document.querySelector("#wrap");Host.isMac=/Mac/i.test(navigator.userAgent);var Indicator=function(e){var t=el(".shade",el(".massive",e));document.body.appendChild(t);document.querySelector("#menu").classList.add("shaded");document.querySelector("#wrap").classList.add("shaded");return{clear:function(){document.querySelector("#menu").classList.remove("shaded");document.querySelector("#wrap").classList.remove("shaded");t.classList.add("shade-fade");setTimeout(function(){document.body.removeChild(t)},1e3)}}};Host.save=function(){var t=Indicator("Saving");try{var e=App.save();if(!e)throw new Error("Couldn't compile project")}catch(e){alert("Error saving project: "+e.message||e);t.clear();return}var r=e.generate({type:"blob"});var n=(App.project()._fileName||"tosh")+".sb2";if(!isSafari){saveAs(r,n,true)}else{var i="data:application/zip;base64,"+e.generate({type:"base64"});location.href=i}t.clear()};if(Host.isApp)document.querySelector("#button-save").addEventListener("click",Host.save);var isSafari=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent);if(isSafari){if(!localStorage.hasSeenSaveAlert){alert("Saving projects may not be supported by Safari. Please be careful!")}localStorage.hasSeenSaveAlert="yes"}function loadFile(e,n){assert(n);var t=e.name.split(".");var r=t.pop();var i=t.join(".");if(r==="sb2"||r==="zip"){var o=new FileReader;o.onloadend=function(){var e=o.result;var t=new JSZip(e);try{var r=Project.load(t)}catch(e){alert("Problem loading file: "+(e.message||e));n.clear();return}r._fileName=i;App.loadProject(r);n.clear()};o.readAsArrayBuffer(e);return true}if(r==="sb"){n.clear();alert("Scratch 1.4 files can't be opened. Use the Scratch website to convert it.");return true}}function loadFiles(e,t){var t=t||new Indicator("Loading");if(e.length===1){var r=e[0];if(!r)return;if(loadFile(r,t))return}t.clear();App.filesDropped(e)}if(Host.isApp){var loadBtn=document.querySelector("#button-load");var fileInput=el("input",{type:"file"});loadBtn.appendChild(fileInput);function handleFileSelect(e){var t=Indicator("Loading");loadFiles(e.target.files,t)}fileInput.addEventListener("change",handleFileSelect,false);var menu=document.querySelector("#menu");var canUndo=ko(false);var canRedo=ko(false);Host.onOops=function(){canUndo.assign(Oops.canUndo());canRedo.assign(Oops.canRedo());App.onOops()};var undoBtn=el(".menu-button",{class:ko(function(){return canUndo()?"":"hidden"}),on_click:Oops.undo,text:"↺"});var redoBtn=el(".menu-button",{class:ko(function(){return canRedo()?"":"hidden"}),on_click:Oops.redo,text:"↻"});var helpBtn=document.querySelector("#button-help");menu.insertBefore(undoBtn,helpBtn);menu.insertBefore(redoBtn,helpBtn)}var originalTitle=document.title;Host.onAppLoad=function(){if(!Host.isApp)return;var e=el(".menu-title",ko(function(){return App.project()._fileName}));menu.insertBefore(e,helpBtn);App.project.subscribe(function(e){var t=e._fileName||"tosh";document.title=originalTitle.replace(/tosh/,t)});doNext(function(){App.active()._scriptable.scriptsEditor.cm.focus()})};function cancel(e){e.preventDefault();e.dataTransfer.dropEffect="copy"}document.body.addEventListener("dragover",cancel);document.body.addEventListener("dragenter",cancel);document.body.addEventListener("drop",function(e){if(!Host.isApp)return;e.preventDefault();loadFiles(e.dataTransfer.files)});window.onbeforeunload=function(e){if(!Host.isApp)return;if(App.needsSave()){return"You have unsaved changes!"}};Host.handleUndoKeys=function(e){if(!Host.isApp)return;if(e.metaKey&&e.ctrlKey)return;if(e.altKey)return;if(Host.isMac?e.metaKey:e.ctrlKey){switch(e.keyCode){case 89:Oops.redo();break;case 90:if(e.shiftKey){if(!Host.isMac)return;Oops.redo()}else{Oops.undo()}break;default:return}}else{return}e.preventDefault();e.stopPropagation();return true};document.addEventListener("keydown",function(e){if(!Host.isApp)return;if(e.metaKey&&e.ctrlKey)return;if(e.altKey)return;if(Host.handleUndoKeys(e))return;if(Host.isMac?e.metaKey:e.ctrlKey){switch(e.keyCode){case 13:App.runProject();e.stopPropagation();break;case 83:e.preventDefault();Host.save();break;default:return}}else{if(e.target!==document.body)return;if(e.metaKey||e.ctrlKey)return;switch(e.keyCode){case 8:break;default:return}}e.preventDefault()},true);document.addEventListener("keydown",function(e){if(!Host.isApp)return;if(Host.isMac?e.metaKey:e.ctrlKey){switch(e.keyCode){case 70:case 71:e.preventDefault();return}}},false);if(Host.isApp)document.querySelector(".player").addEventListener("keydown",function(e){if(!App.stage)return;if(/INPUT/i.test(e.target.tagName))return;switch(e.keyCode){case 27:player.pauseClick({preventDefault:function(){}});App.active()._scriptable.focus();break;default:return}e.preventDefault()},true);Player=function(){"use strict";var n;var i=false;var o=document.querySelector(".player");if(!o)return{loadProject:function(){}};var a=document.querySelector(".controls");var t=document.querySelector(".flag");var e=document.querySelector(".turbo");var s=document.querySelector(".pause");var r=document.querySelector(".stop");var l=document.querySelector(".full-screen");var u=document.querySelector(".internal-error");var c=document.querySelector("#error-bug-link");var f;function h(){f=setTimeout(function(){d();f=true},500)}function d(){n.isTurbo=!n.isTurbo;t.title=n.isTurbo?"Turbo mode enabled. Shift+click to disable.":"Shift+click to enable turbo mode.";e.style.display=n.isTurbo?"block":"none"}function p(e){if(window.App.preFlagClick())return;if(!n)return;if(f===true)return;if(f){clearTimeout(f)}if(e.shiftKey){d()}else{n.start();s.className="pause";n.stopAll();n.triggerGreenFlag()}n.focus();e.preventDefault()}function v(e){if(!n)return;if(n.isRunning){n.pause();s.className="play"}else{n.start();s.className="pause"}n.focus();e.preventDefault()}function g(e){if(!n)return;n.start();s.className="pause";n.stopAll();n.focus();e.preventDefault()}function m(e){if(e)e.preventDefault();if(!n)return;document.documentElement.classList.toggle("fs");i=!i;if(!e||!e.shiftKey){if(i){var t=document.documentElement;if(t.requestFullScreenWithKeys){t.requestFullScreenWithKeys()}else if(t.webkitRequestFullScreen){t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}}else{if(document.exitFullscreen){document.exitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}}if(!i){document.body.style.width=document.body.style.height=document.body.style.marginLeft=document.body.style.marginTop=""}App.isFullScreen.assign(document.documentElement.classList.contains("fs"));b();if(!n.isRunning){n.draw()}n.focus()}function y(e){if(i&&e.keyCode===27){m(e)}}function b(){if(!n)return;if(i){window.scrollTo(0,0);var e=8;var t=window.innerWidth-e*2;var r=window.innerHeight-e-a.offsetHeight;t=Math.min(t,r/.75);r=t*.75+a.offsetHeight;document.body.style.width=t+"px";document.body.style.height=r+"px";document.body.style.marginLeft=(window.innerWidth-t)/2+"px";document.body.style.marginTop=(window.innerHeight-r-e)/2+"px";n.setZoom(t/480)}else{n.setZoom(App.smallStage()?.5:1);if(!n.isRunning){n.draw()}}}function w(e){e.preventDefault()}window.addEventListener("resize",b);t.addEventListener("click",p);s.addEventListener("click",v);r.addEventListener("click",g);l.addEventListener("click",m);document.addEventListener("fullscreenchange",function(){if(i!==document.fullscreen)m()});document.addEventListener("mozfullscreenchange",function(){if(i!==document.mozFullScreen)m()});document.addEventListener("webkitfullscreenchange",function(){if(i!==document.webkitIsFullScreen)m()});function k(e,r){if(n){n.stopAll();n.pause()}while(o.firstChild)o.removeChild(o.lastChild);s.className="pause";e.onload=function(e){var t=n?n.isTurbo:false;window.stage=n=e;n.start();n.isTurbo=t;b();n.root.addEventListener("keydown",y);o.appendChild(n.root);if(r){r(n);r=null}};e.onerror=function(e){console.error(e.stack)};if(e.isDone){if(e.isError){console.error(e.result);return}e.onload(e.result)}}var C=document.querySelector(".small-stage");C.addEventListener("click",App.smallStage.toggle);var x=1e3;var S=508;var L=windowSize.compute(function(e){return e.width<x||e.height<S});L.subscribe(function(e){if(e)App.smallStage.assign(true);if(e){C.classList.add("disabled")}else{C.classList.remove("disabled")}});function A(){document.body.classList.add("no-transition");doNext(function(){document.body.classList.remove("no-transition");wrap.classList.add("visible")})}A();App.smallStage.subscribe(function(e){if(!e&&L()){App.smallStage.assign(true);return}if(e){document.body.classList.add("ss")}else{document.body.classList.remove("ss")}});App.smallStage.subscribe(b);App.isFullScreen.subscribe(b);App.isFullScreen.subscribe(A);App.needsPreview.subscribe(function(e){t.classList[e?"add":"remove"]("needs-preview")});App.hasErrors.subscribe(function(e){t.classList[e?"add":"remove"]("has-errors")});return{loadProject:k,flagClick:p,pauseClick:v}};var Pos=CodeMirror.Pos;var Project=Format.Project;function getEl(e){return e.el}function doNext(e){setTimeout(function(){e()},0)}function windowTop(e){var t=0;do{t+=e.offsetTop||0;e=e.parentNode}while(e);return t}function copyKeyMap(e){return JSON.parse(JSON.stringify(e))}var windowSize=ko();var onResize=function(){windowSize.assign({width:window.innerWidth,height:window.innerHeight})};window.addEventListener("resize",onResize);window.addEventListener("orientationchange",onResize);onResize();var Scriptable=function(r,e){this.sprite=r;this.project=e;this.scriptsEditor=new ScriptsEditor(r,e);r._scriptsEditor=this.scriptsEditor;function t(e,t){return el(".pane.pane-"+e,{class:ko(function(){if(App.tab()===e)return"pane-active"}),children:t})}this.el=el(".scriptable",{class:ko(function(){return App.active()===r?"scriptable-active":""}),children:[el(".tabs",["data","costumes","sounds"].map(function(t){var e=t;if(t==="costumes"&&r._isStage)e="backdrops";return el("li.tab",{class:ko(function(){if(App.tab()===t)return"tab-active"}),on_click:function(e){App.tab.assign(t)},children:el("span",e)})})),t("data",r._isStage?[el("h2","Variable names"),new NamesEditor(r,"variable").el,el("hr"),el("h2","List names"),new NamesEditor(r,"list").el]:[el("h2","Variable names"),new NamesEditor(e,"variable").el,new NamesEditor(r,"variable").el,el("hr"),el("h2","List names"),new NamesEditor(e,"list").el,new NamesEditor(r,"list").el]),t("costumes",new ListEditor(r,"costume").el),t("sounds",new ListEditor(r,"sound").el),r._scriptsEditor.el]})};Scriptable.prototype.activated=function(){this.scriptsEditor.activated()};Scriptable.prototype.focus=function(){this.scriptsEditor.focus()};Scriptable.prototype.deactivated=function(){this.scriptsEditor.repaint()};function uniqueName(e,t){var r=seenNames(t);var n=/^(.*)([0-9]+)$/.exec(e);var i=n?+n[2]:2;var o=(n?n[1]:e)||"costume";while(r.hasOwnProperty(e)){e=o+i++}return e}function costumeSize(i){var o=ko("..x..");i._size.subscribe(function(e){if(!e)return;var t=e.width/(i.bitmapResolution||1);var r=e.height/(i.bitmapResolution||1);var n=t+"x"+r;if(n==="0x0")n="";o.assign(n)});return o}function costumeThumbnail(e){var t=el(".thumb");ko.subscribe(e,function(e){if(!e)return;e._src.subscribe(function(e){t.style.backgroundImage="url("+e+")"})});return t}var renderItem={sprite:function(r,e,t){var n=ko(function(){var e=r.currentCostumeIndex();var t=r.costumes()[e||0]||r.costumes()[0];return t});return el(".details",[costumeThumbnail(n),el(".name-wrap",el("input.name",{value:r.objName,readOnly:r._isStage||r._editingName.negate(),on_blur:t,class:ko(function(){if(!r._isStage&&r._editingName())return"name-editing"}),on_keydown:function(e){if(e.keyCode===13){this.blur()}else if(e.keyCode===27){this.value=r.objName();this.blur()}}}))])},costume:function(e,t,r){var n=e._size;return el(".details",[costumeThumbnail(e),el("input.name",{value:e.name,on_blur:r}),el(".media-number",ko(function(){return"#"+(t.costumes().indexOf(e)+1)})),el(".media-stats",costumeSize(e))])},sound:function(e,t,r){return el(".details",[el("input.name",{value:e.name,on_blur:r}),el(".media-number",ko(function(){return"#"+(t.sounds().indexOf(e)+1)}))])}};var newItem={sprite:Project.newSprite,costume:Project.newCostume,sound:Project.newSound};var ListEditor=function(l,e,t){this.kind=e;this.obj=l;this.active=t;var r=this.items=l[e+"s"];if(e==="sprite"){this.displayItems=r.compute(function(e){return[l].concat(e)})}else{this.displayItems=r}var n=this.displayItems.map(function(e){return new ListEditorItem(e,this).el}.bind(this));var i;if(e==="sprite"){i=el(".sprite.sprite-new",{text:"＋ new sprite",on_click:function(){var e=Project.newSprite();var t="turtle";var r=2;var n=App.project();while(n._spriteNames().indexOf(t)!==-1){t="turtle"+r++}e.objName.assign(t);Oops(function(){App.project().sprites.push(e);App.project().children.push(e)});App.active.assign(e)}})}else if(e==="costume"&&l._isStage){var u;i=el(".costume.costume-new",{on_click:function(e){if(e.target===u)return;var t=u.value.slice(1);var r=el("canvas",{width:480,height:360});var n=r.getContext("2d");n.fillStyle=u.value;n.fillRect(0,0,480,360);var i=r.toDataURL("image/png").split(",")[1];var o=atob(i);var a=Format.binaryToArrayBuffer(o);var s=Project.newCostume(t,"png",a);Oops(function(){l.costumes.push(s);l.currentCostumeIndex.assign(l.costumes().indexOf(s))})},children:[el("span","＋ new backdrop"),u=el("input",{type:"color",value:"#FBF0E3"})]})}else{i=el("."+e+".drag-here","drag here to import")}if(e!=="sound"){n=n.compute(function(e){return e.concat([i])})}else{n=n.compute(function(e){return e.length?e.slice():[el(".sound.drag-here","no sounds here")]})}this.dragging=null;this.itemHeight=ListEditor.itemHeights[e];window.addEventListener("mousemove",this.pointerMove.bind(this));window.addEventListener("mouseup",this.drop.bind(this));doNext(function(){this.el.parentNode.addEventListener("wheel",this.pointerMove.bind(this))}.bind(this));r.subscribe({insert:function(e,t){if(t._el)t._el.scrollIntoView();doNext(function(){t._el.scrollIntoView()})}});this.el=el("ul.items",{class:"items-"+e+"s",children:n})};ListEditor.itemHeights={sprite:25,costume:83,sound:64};ListEditor.prototype.pointerMove=function(e){if(!this.dragging)return;if(this.kind!=="sprite"&&App.active()!==this.obj)return;var t=e.clientY||this.dragging.lastClientY;this.dragging.lastClientY=t;var r=t-windowTop(this.el)+this.el.parentNode.scrollTop;if(r===this.dragging.lastMouseY)return;this.dragging.lastMouseY=r;var n=r+this.dragging.offsetY;n=Math.max(0,n);this.dragging.el.style.top=n+"px";n-=4;var i=n/this.itemHeight;i=Math.round(i);i=Math.min(i,this.displayItems().length-1);if(this.kind==="sprite"&&i<1)i=1;if(i!==this.dragging.index){var o=this.dragging.placeholder;this.el.removeChild(o);var a=this.el.children[i];if(a){this.el.insertBefore(o,a)}else{this.el.appendChild(o)}this.dragging.index=i}};ListEditor.prototype.dragTick=function(){if(!this.dragging)return;if(!this.dragging.lastMouseY)return;var e=.08;var t=this.dragging.lastClientY-windowTop(this.el);this.dragging.scrollSpeed*=.8;if(t<0){this.dragging.scrollSpeed-=e}else if(t>this.el.parentNode.offsetHeight){this.dragging.scrollSpeed+=e}else{this.dragging.scrollSpeed*=.1}this.el.parentNode.scrollTop+=this.dragging.scrollSpeed*this.itemHeight};ListEditor.prototype.drop=function(){if(!this.dragging)return;var e=this.dragging.item;var t=this.items().indexOf(e);var r=this.kind==="sprite"?this.dragging.index-1:this.dragging.index;var n=this.items().slice();n.splice(t,1);n.splice(r,0,e);this.dragging.resetIndex=this.dragging.index;this.stopDragging();Oops(function(){this.items.assign(n)}.bind(this))};ListEditor.prototype.stopDragging=function(){if(!this.dragging)return;this.el.removeChild(this.dragging.placeholder);this.el.removeChild(this.dragging.el);this.el.insertBefore(this.dragging.el,this.el.children[this.dragging.resetIndex]);this.dragging.el.classList.remove("dragging");this.dragging.el.style.top="";clearInterval(this.dragging.interval);this.dragging=null};ListEditor.prototype.pointerDown=function(e,t){if(this.dragging){this.stopDragging();return}var r=el("li."+this.kind+".drag-placeholder"," ");var n=this.displayItems().indexOf(t);var i=this.el.children[n];this.el.insertBefore(r,i);var o=e.clientY-windowTop(this.el)+this.el.parentNode.scrollTop;var a=i.offsetTop-this.itemHeight;assert(a>-2);this.dragging={item:t,el:i,placeholder:r,offsetY:a-o,index:n,resetIndex:n,lastClientY:e.clientY,lastMouseY:null,interval:setInterval(this.dragTick.bind(this),20),scrollSpeed:0};i.classList.add("dragging");i.style.top=a+"px";this.el.removeChild(i);this.el.appendChild(i)};var ListEditorItem=function(i,e){this.item=i;this.editor=e;var o=e.kind;var a=e.items;var t=e.obj;var r=e.active;i._name=i.objName;var n={};var s=[];if(o==="sprite"){n.class=r.compute(function(e){var t=[];if(e===i)t.push("sprite-active");if(i._hasErrors())t.push("has-errors");return t});n.on_click=function(e){if(e.target.classList.contains("button"))return;r.assign(i)};if(!i._isStage){s.push(el(".button.button-edit",{on_click:function(e){i._editingName.toggle();if(i._editingName()){i._el.querySelector("input.name").focus()}}}))}}this.dragHandle=null;if(!i._isStage){s.push(el(".button.button-remove",{on_click:l,disabled:ko(function(){return o==="costume"&&a().length===1})}));s.push(this.dragHandle=el(".button.button-handle",{on_mousedown:this.pointerDown.bind(this)}))}function l(){if(this.disabled)return;Oops(function(){var e=a().indexOf(i);assert(e!==-1);if(o==="costume"){if(t.currentCostumeIndex()>=e){t.currentCostumeIndex.assign(Math.max(0,e-1))}}a.remove(e);if(o==="sprite"){t.children.remove(t.children().indexOf(i));if(App.active()===i){App.active.assign(a()[e]||a()[e-1]||App.project())}}})}function u(e,t){var t=t||this.value;var r=i.name||i._name;if(o==="sprite"&&!i._isStage){i._editingName.assign(false)}if(!t)t=r();var n=a().slice();n.splice(n.indexOf(i),1);t=uniqueName(t,n);this.value=t;Oops(function(){r.assign(t)})}var c=renderItem[o];n.children=[c(i,t,u),el(".buttons",s)];if(o==="sprite"){n.children.push(el(".icon-error",{text:"•"}))}this.el=i._el=el("li."+o,n)};ListEditorItem.prototype.pointerDown=function(e){if(e.target===this.dragHandle){this.editor.pointerDown(e,this.item)}};function allVariables(e){var t=[];e.forEach(function(e){t=t.concat(e.variables()).concat(e.lists())});return t}function seenNames(e){var r={};e.forEach(function(e){var t=(e._name||e.name)();r[t]=true});return r}var NamesEditor=function(e,t){var r=e._isStage?"＋ for all sprites":"＋ for this sprite";this.factory=t==="variable"?Project.newVariable:Project.newList;this.names=e[t+"s"];this.sprite=e;this.kind=t;this.el=el("",[el("ul.reporters",{class:t,children:this.names.map(function(e){return new NamesEditorItem(e,this).el}.bind(this))}),el("p.new a.new-variable",{text:r,on_click:function(){Oops(function(){var e=this.factory("");this.names.push(e);e._isEditing.assign(true)}.bind(this))}.bind(this)})])};var NamesEditorItem=function(e,t){this.item=e;this.factory=t.factory;this.kind=t.kind;this.names=t.names;this.sprite=t.sprite;this.hasErrors=ko.computed(this.computeHasErrors.bind(this));this.changeTimeout=null;this.input=el("input",{placeholder:"my "+t.kind,value:e._name,on_input:this.onNameChange.bind(this),on_focus:function(){e._isEditing.assign(true)},on_blur:function(){e._isEditing.assign(false);this.onNameBlur()}.bind(this),on_keydown:this.onKeydown.bind(this)});this.el=el("li",el("p.cm-s-"+t.kind,{class:ko(function(){if(this.hasErrors())return"cm-s-error has-errors"}.bind(this)),children:[this.input,el(".icon-error",{text:"•"})]}));e._flush=this.onNameBlur.bind(this);e._isEditing.subscribe(function(e){if(e){this.input.focus()}else{this.input.blur()}}.bind(this),false)};NamesEditorItem.prototype.computeHasErrors=function(){var e=this.item._name();var t=App.project();var r=App.active()._isStage?t.sprites().concat([t]):[t,App.active()];var n=allVariables(r);var i=n.indexOf(this.item);if(!e||i===-1)return false;n=n.slice(0,i);var o=seenNames(n);var a=Language.cleanName(this.kind,e,o,{});return e!==a};NamesEditorItem.prototype.onNameChange=function(e){clearTimeout(this.changeTimeout);this.changeTimeout=setTimeout(this.onNameBlur.bind(this),1e3);App.active()._scriptable.scriptsEditor.varsChanged()};NamesEditorItem.prototype.onNameBlur=function(){clearTimeout(this.changeTimeout);var e=this.input.value;if(!e){var t=this.names().indexOf(this.item);if(t!==-1){Oops(function(){this.names.remove(t)}.bind(this));return}}Oops(function(){this.item._name.assign(e)}.bind(this))};NamesEditorItem.prototype.onKeydown=function(l){if(Host.handleUndoKeys(l))return;if(l.metaKey||l.ctrlKey||l.altKey)return;var u=this.input;var c=this.names;var f=this.item;var h=this.factory;Oops(function(){var e=u.selectionStart,t=u.selectionEnd,r=u.value.slice(0,e),n=u.value.slice(e,t),i=u.value.slice(t);switch(l.keyCode){case 13:f._name.assign(r.trim());var o=c().indexOf(f);var a;if(n){a=h(i.trim());c.insert(o+1,a);a=h(n.trim());c.insert(o+1,a);a._isEditing.assign(true)}else{a=h(i.trim());c.insert(o+1,a);a._isEditing.assign(true)}break;case 8:if(u.value){return}var o=c().indexOf(f);c.remove(o);if(c().length){var s=o>0?o-1:0;c()[s]._isEditing.assign(true)}break;case 46:if(u.value){return}var o=c().indexOf(f);c.remove(o);if(c().length){var s=Math.min(o,c().length-1);c()[o]._isEditing.assign(true)}break;case 38:var o=c().indexOf(f);if(o-1>=0){c()[o-1]._isEditing.assign(true)}break;case 40:var o=c().indexOf(f);if(o+1<c().length){c()[o+1]._isEditing.assign(true)}break;case 27:f._isEditing.assign(false);break;default:return}l.preventDefault()}.bind(this))};var extraKeys={"Ctrl-Space":function(e){if(e.somethingSelected()){e.replaceSelection("")}requestHint(e,true)},Tab:function(e){if(inputSeek(e,+1))return;if(e.somethingSelected()){e.indentSelection("smart")}},"Shift-Tab":function(e){if(inputSeek(e,-1))return}};extraKeys[Host.isMac?"Cmd-F":"Ctrl-F"]="findPersistent";function removeUndoKeys(e){var e=copyKeyMap(e);delete e["Cmd-Y"];delete e["Cmd-Z"];delete e["Shift-Cmd-Z"];delete e["Ctrl-Y"];delete e["Ctrl-Z"];delete e["Shift-Ctrl-Z"];return e}var cmOptions={value:"",mode:"",indentUnit:3,smartIndent:true,tabSize:3,indentWithTabs:true,lineWrapping:true,dragDrop:false,cursorScrollMargin:80,lineNumbers:true,cursorHeight:1,undoDepth:NaN,extraKeys:extraKeys,autoCloseBrackets:true,matchBrackets:"()<>[]''\"\"",scrollbarStyle:"simple"};var ScriptsEditor=function(e,t){this.sprite=e;this.project=t;this.el=el(".editor");this.cm=CodeMirror(this.el,cmOptions);var r=Compiler.generate(e.scripts);this.hasChangedEver=false;this.cm.setValue(r);this.needsCompile=ko(true);this.hasErrors=e._hasErrors;assert(ko.isObservable(e._hasErrors));this.widgets=[];this.cm.clearHistory();assert(this.cm.getHistory().done.length===0);this.cmUndoSize=0;this.undoing=false;this.checkDefinitions();this.repaint();this.annotate=this.cm.annotateScrollbar("error-annotation");this.bindNames(e.variables);this.bindNames(e.lists);this.bindNames(t.variables);this.bindNames(t.lists);App.needsCompile.assign(true);this.compile();App.needsPreview.assign(true);this.cm.on("change",this.onChange.bind(this));App.settings.keyMap.subscribe(function(e){if(e==="default"){e=removeUndoKeys(CodeMirror.keyMap.default)}this.cm.setOption("keyMap",e)}.bind(this));this.cm.save=App.preview.bind(App,true);this.cmUndo=this.cm.undo.bind(this.cm);this.cmRedo=this.cm.redo.bind(this.cm);this.cm.undo=Oops.undo;this.cm.redo=Oops.redo};ScriptsEditor.prototype.bindNames=function(e){e.map(function(e){e._name.subscribe(function(){this.debounceRepaint()}.bind(this),false)}.bind(this))};ScriptsEditor.prototype.fixLayout=function(e){this.cm.setSize(NaN,this.el.clientHeight);this.cm.setOption("scrollbarStyle","native");this.cm.setOption("scrollbarStyle",cmOptions.scrollbarStyle)};ScriptsEditor.prototype.compile=function(){if(!this.needsCompile())return this.hasErrors();this.widgets.forEach(function(e){e.clear()});this.widgets=[];var e=this.sprite.variables().concat(this.sprite.lists());e.forEach(function(e){if(e._isEditing()){e._flush()}});var t=this.getModeCfg();var r=this.cm.doc.iter.bind(this.cm.doc);var n=Compiler.parseLines(r,t);var i=n.slice();var o=[];i.forEach(function(e,t){if(e.info.shape==="error"){var r=t;o.push({from:Pos(r,0),to:Pos(r+1,0)})}});try{var a=Compiler.compile(i)}catch(e){var s=n.length-(i.length-1);s=Math.min(s,n.length-1);var l=n[s].info;var u=l.shape==="error"?l.error:e.message;var c=el(".error-widget",u);var f=this.cm.addLineWidget(s,c,{});this.widgets.push(f);o.push({from:Pos(s,0),to:Pos(s,0)});this.annotate.update(o);this.needsCompile.assign(false);this.hasErrors.assign(true);return true}this.needsCompile.assign(false);this.hasErrors.assign(false);this.sprite.scripts=a;return false};ScriptsEditor.prototype.makeDirty=function(){this.needsCompile.assign(true);App.needsCompile.assign(true);App.needsPreview.assign(true);if(this.hasChangedEver)App.needsSave.assign(true)};ScriptsEditor.prototype.getModeCfg=function(){var a=this;function e(i){var e=a.project;var t=a.sprite._isStage?e.sprites().concat([e]):[e,App.active()];var o=allVariables(t);var r=a.sprite[i]();if(!a.sprite._isStage){r=r.concat(e[i]())}var n={};return r.filter(function(e){var t=e._name();var r=o.indexOf(e);var n=seenNames(o.slice(0,r));return t&&t===Language.cleanName(i,t,n,{})})}return{name:"tosh",variables:e("variables"),lists:e("lists"),definitions:this.definitions}};ScriptsEditor.prototype.repaint=function(){var e=this.getModeCfg();this.cm.setOption("mode",e);clearTimeout(this.repaintTimeout);this.repaintTimeout=null};ScriptsEditor.prototype.debounceRepaint=function(){this.makeDirty();if(this.repaintTimeout){clearTimeout(this.repaintTimeout)}this.repaintTimeout=setTimeout(this.repaint.bind(this),500)};ScriptsEditor.prototype.checkDefinitions=function(){var i=new Earley.Parser(Language.defineGrammar);var o=[];this.cm.doc.iter(function(e){var e=e.text;if(!Language.isDefinitionLine(e))return;var t=Language.tokenize(e);var r;try{r=i.parse(t)}catch(e){return}if(r.length>1)throw"ambiguous define. count: "+r.length;var n=r[0].process();o.push(n)});var e=this.definitions;if(JSON.stringify(e)!==JSON.stringify(o)){this.definitions=o;return true}};ScriptsEditor.prototype.activated=function(){doNext(function(){this.fixLayout();this.cm.focus();this.cm.refresh();this.debounceRepaint()}.bind(this))};ScriptsEditor.prototype.focus=function(){this.cm.focus()};ScriptsEditor.prototype.undo=function(){this.undoing=true;this.cmUndo();this.undoing=false;this.cmUndoSize=this.cm.historySize().undo;App.active.assign(this.sprite)};ScriptsEditor.prototype.redo=function(){this.undoing=true;this.cmRedo();this.undoing=false;this.cmUndoSize=this.cm.historySize().undo;App.active.assign(this.sprite)};ScriptsEditor.prototype.varsChanged=function(){this.hasChangedEver=true;this.makeDirty()};ScriptsEditor.prototype.onChange=function(e,t){this.hasChangedEver=true;this.makeDirty();var r=[];var n=[];for(var i=t.from.line;i<=t.to.line;i++){r.push(i);n.push(this.cm.getLine(i))}n=n.concat(t.removed);n=n.concat(t.text);this.linesChanged(n);for(var i=0;i<this.widgets.length;i++){var o=this.widgets[i];if(r.indexOf(o.line.lineNo())>-1){o.clear();this.widgets.splice(i,1);break}}if(!this.undoing){var a=this.cm.historySize();if(a.undo!==this.cmUndoSize){assert(a.undo===this.cmUndoSize+1);var s=new Oops.CustomOperation(this.undo.bind(this),this.redo.bind(this));Oops.insert(s);this.cmUndoSize++}assert(this.cmUndoSize===a.undo)}requestHint(this.cm);this.annotate.update([])};ScriptsEditor.prototype.linesChanged=function(e){for(var t=0;t<e.length;t++){var r=e[t];if(Language.isDefinitionLine(r)){if(this.checkDefinitions()){this.debounceRepaint()}return}}};function inputSeek(e,t){var r=tokenizeAtCursor(e,{splitSelection:false});if(!r)return false;if(r.selection.indexOf("\n")>-1)return false;var n=r.cursor+t;if(t>0&&r.tokens[r.cursor]&&r.tokens[r.cursor].text==="-")n+=1;for(var i=n;t>0?i<r.tokens.length:i>=0;i+=t){var o=r.tokens[i];if(["symbol","lparen","rparen","langle","rangle","lsquare","rsquare"].indexOf(o.kind)===-1){var a=r.start.ch+measureTokens(r.tokens.slice(0,i));end=a+o.text.replace(/ *$/,"").length;var s=r.from.line;if(o.kind==="number"&&r.tokens[i-1].text==="-")a--;if(o.kind==="string"){a++;end--}var l={line:s,ch:a};var u={line:s,ch:end};if(r.cursor.ch===l.ch&&r.cursor.ch+r.selection.length===u.ch){continue}e.setSelection(l,u);return true}}c=t>0?r.end:r.start;if(c.ch===r.cursor.ch)return false;e.setCursor(c);return true}function tabify(e,t){var r="\t";var e=e||"";var n="";for(var i=0;i<t;i++)n+=r;var o=e.split("\n");for(var a=1;a<o.length;a++){o[a]=n+o[a]}return o.join("\n")}function measureTokens(e){var t=0;for(var r=0;r<e.length;r++){t+=e[r].text.length}return t}function tokenizeAtCursor(e,t){var r=e.getSelection();var n=e.getCursor("from");var i=e.doc.getLine(n.line);var o=/^\t*/.exec(i)[0].length;var a=i.slice(o,n.ch);var s=i.slice(n.ch);var l=!/ $/.test(a);var u=/^[ ?]/.test(s);var c,f;if(t.splitSelection){var h=Language.tokenize(a);var d=Language.tokenize(s);c=h.concat(d);f=h.length}else{var c=Language.tokenize(a+s);var p=o;for(var v=0;v<c.length;v++){p+=c[v].text.length;if(p>n.ch){break}}f=v}var g=measureTokens(c.slice(0,f));var m;if(l){m=measureTokens(c.slice(0,f-1))}else{m=g}return{from:{line:n.line,ch:o+m},to:{line:n.line,ch:o+g},end:{line:n.line,ch:i.length},start:{line:n.line,ch:o},selection:r,state:e.getStateAfter(n.line),cursor:f,tokens:c,isPartial:l,hasPadding:u}}function requestHint(e,t){e.showHint({hint:t?computeHintPlease:computeHintMaybe,completeSingle:false,alignWithWord:true,customKeys:{Up:function(e,t){t.moveFocus(-1)},Down:function(e,t){t.moveFocus(1)},Home:function(e,t){t.setFocus(0)},End:function(e,t){t.setFocus(t.length-1)},Tab:function(e,t){t.pick()},Esc:function(e,t){t.close()}}})}function expandCompletions(e,t){function o(e){if(["VariableName","ListName","ReporterParam"].indexOf(e)>-1)return[];if(typeof e!=="string"){return[[e]]}if(/^@/.test(e)){return[t.rulesByName[e][0].symbols]}if(/^[md]_/.test(e)||/^[A-Z]/.test(e)){return(t.rulesByName[e]||[]).map(function(e){return e.symbols})}return[[e]]}var a=[];e.forEach(function(t){var e=t.completion;if(!e.length)return;var r=e[0],n=e.slice(1);var i=o(r).map(function(e){return{completion:e.concat(n),via:t}});a=a.concat(i)});return a}function computeHintPlease(e){return computeHint(e,true)}function computeHintMaybe(e){return computeHint(e,false)}function computeHint(e,t){var v=tokenizeAtCursor(e,{splitSelection:true});if(!v)return false;if(v.cursor===0){return false}var g=v.state;var r=g.completer;var m=r.leftParser.grammar;var n=v.tokens.slice();var i=v.cursor;var y;try{r.parse(n);y=true}catch(e){y=false}var b;if(v.isPartial){b=n[i-1];n.splice(i-1,1);i--;if(y&&!v.selection&&!t)return}var o=r.complete(n,i);if(!o){return false}if(!n.length){["define-atomic","define"].forEach(function(e){o.splice(0,0,{start:0,end:0,pre:[],post:[],rule:{process:{_info:{category:"custom"}}},item:null,completion:[{kind:"symbol",value:e},"block"]})})}o=o.filter(function(e){if(e.pre.length===1&&typeof e.pre[0]==="string")return;if(e.pre[0]==="block")return;if(e.rule.process.name==="unaryMinus")return;if(e.rule.process._info===undefined&&e.rule.symbols[0].value===undefined)return;return true});var a=expandCompletions(o,m);a.forEach(function(e){e.length=e.via.end-e.via.start});if(v.isPartial){a=a.filter(function(e){var t=e.completion[0];return t.kind==="symbol"&&b.kind==="symbol"&&t.value&&t.value.indexOf(b.value)===0})}else{a=a.filter(function(e){var t=e.completion[0];return!(t.kind==="symbol"&&/^[a-z0-9]$/.test(t.value))});if(i===n.length){a=a.filter(function(e){return e.via.pre.length||e.via.post.length})}}a.sort(function(e,t){var r=e.via.rule.process._info;var n=t.via.rule.process._info;var i=r?r.selector:e.via.rule.name;var o=n?n.selector:t.via.rule.name;var a=Language.preferSelectors.indexOf(i);var s=Language.preferSelectors.indexOf(o);if(a>-1&&s>-1){if(a!==s)return a-s}else if(a>-1){return+1}var l=e.completion.join(" ");var u=t.completion.join(" ");return l<u?-1:l>u?+1:0});var w={VariableName:"variable",ListName:"list"};var k=[];a.forEach(function(e){var t=e.completion.slice();var r=e.via;assert(t.length);var n;var i="";var o="";for(var a=0;a<t.length;a++){var s=t[a];var l=undefined;if(a>0&&s.value!=="?"){o+=" ";i+=" "}if(typeof s==="string"){var u=t[a];if(u[0]==="@"){s=m.rulesByName[u][0].symbols[0].value}else{if(/^b[0-9]?$/.test(u)){s="<>"}else{s="_"}if(b&&a===0){l=s;s=b.value;if(!n)n={ch:i.length+s.length,size:0}}else{if(!n)n={ch:i.length,size:s.length}}}}else if(s&&s.kind==="symbol"){s=s.value}else{return}i+=s;o+=l===undefined?s:l}if(o==="<>"||o==="_")return;assert(i);var c=g.indent;if(i==="else"&&c.slice().pop()!=="if")return;if(i==="end"&&!c.length)return;i=i.replace(/ \?$/,"?");if(!v.hasPadding&&!y&&b&&b.text===i){i+=" "}var f={};if(r.rule.process._info){f=r.rule.process._info}else{r.item.predictedBy.forEach(function(e){f=e.rule.process._info||{}})}switch(f.shape){case"c-block":case"c-block cap":case"if-block":var h="\nend";if(!n){n={ch:i.length,size:0}}i+=tabify(h,c.length);break}var d={displayText:o,text:i,hint:C,selection:n,category:f.category||w[r.rule.name],render:p,_name:r.rule.name};function p(e,t,r){var n="";if(r.category)n=".cm-s-"+r.category;e.appendChild(el(n,r.displayText))}k.push(d)});var s={list:k,from:v.from,to:v.to};function C(e,t,r){var n=r.text;e.replaceRange(n,r.from||t.from,r.to||t.to,"complete");if(r.selection){var i=s.from.line;var o=s.from.ch+r.selection.ch;var a=o+(r.selection.size||0);e.setSelection({line:i,ch:o},{line:i,ch:a})}e.indentLine(v.start.line)}return s}var Settings=function(e){this.key="toshSettings";this.settings={};this._autoSave=false;this.update(e);this.update(this.load());this._autoSave=true};Settings.prototype.get=function(e,t){if(!this.settings.hasOwnProperty(e)){var r=ko(t);r.subscribe(this.save.bind(this),this._autoSave);this.settings[e]=r}this[e]=this.settings[e];return this.settings[e]};Settings.prototype.save=function(){var e=Project.copyForSave(this.settings);window.localStorage[this.key]=JSON.stringify(e)};Settings.prototype.load=function(){var e=window.localStorage[this.key]||"";if(!e)return;try{var t=JSON.parse(e)}catch(e){console.log("Couldn't parse settings",e);return}if(!t)return;if(typeof t!=="object")return;return t};Settings.prototype.update=function(r){r=r||{};Object.keys(r).forEach(function(e){var t=r[e];this.get(e,t).assign(t)},this)};var Container=function(e,t){t.assign(e.sprites()[0]||e);this.project=e;this.active=t;this.activeScriptable=ko();this.onSwitchSprite=this.switchSprite.bind(this);this.active.subscribe(this.onSwitchSprite);this.el=el(".container",[el(".switcher",new ListEditor(e,"sprite",t).el),el(".active",this.activeScriptable.compute(function(e){return e?e.el:""}))]);e.sprites.subscribe(function(){doNext(function(){App.preview(false)})},false)};Container.prototype.switchSprite=function(e){assert(this.project===App.project());var t=e._scriptable=e._scriptable||new Scriptable(e,this.project);if(this.activeScriptable())this.activeScriptable().deactivated();this.activeScriptable.assign(t);t.activated()};Container.prototype.destroy=function(){this.active.unsubscribe(this.onSwitchSprite)};var App=new function(){this.tab=ko("data");this.project=ko(Project.new());this.active=ko();this.isBlank=ko(true);this.needsSave=ko(false);this.needsCompile=ko(false);this.hasErrors=ko(false);this.stage=null;this.needsPreview=ko(false);this.settings=new Settings({smallStage:false,keyMap:"default",enableContextMenu:false});this.smallStage=this.settings.smallStage;this.isFullScreen=ko(false)};App.onOops=function(){App.needsSave.assign(true);App.needsPreview.assign(true)};App.project.subscribe(function(e){App.isBlank.assign(false)},false);App.loadProject=function(e){if(App.isBlank()&&!Oops.canUndo()){App.project.assign(e);Oops.reset()}else{Oops(function(){App.project.assign(e)})}};App.save=function(){if(App.compile())return;var e=Project.save(App.project());App.needsSave.assign(false);return e};App.compile=function(){var e=App.project();var t=[e].concat(e.sprites());var r=false;t.forEach(function(e){if(e._scriptable){r=r||e._scriptable.scriptsEditor.compile()}});App.needsCompile.assign(false);if(r){App.hasErrors.assign(true);return true}App.hasErrors.assign(false);App.sync();return false};App.sync=function(){var e=App.stage;if(!e)return;[e].concat(e.children).forEach(function(r){if(r.isStage||r.isSprite){if(r.isClone)return;var e=r._tosh;e.variables().forEach(function(e){var t=e._name();e.value=r.vars[t]||0});e.lists().forEach(function(e){var t=e._name();e.contents=r.lists[t]||[]});e.currentCostumeIndex.assign(r.currentCostumeIndex);if(r.isStage){e.tempoBPM=r.tempoBPM}else{e.scratchX=r.scratchX;e.scratchY=r.scratchY;e.direction=r.direction;e.rotationStyle=r.rotationStyle;e.visible=r.visible}}else if(r.target){}})};App.preview=function(n){if(App.compile())return;if(App.stage){App.stage.pause();App.stage.stopAll();window.oldStages=(window.oldStages||[]).concat([App.stage]);App.stage=null}var i=App.project();var e=Project.save(i);var t=P.IO.loadSB2Project(e);if(t.isError){console.error(t.result);return}var o=i.children().slice();player.loadProject(t,function(e){App.stage=e;e.handleError=function(e){console.error(e.stack||e)};e._tosh=i;assert(e._tosh);o=o.filter(function(e){return!!e.objName});assert(e.children.length===o.length);for(var t=0;t<e.children.length;t++){var r=e.children[t];if(r.isSprite){r._tosh=o[t]}}if(n){e.focus();e.triggerGreenFlag()}});App.needsPreview.assign(false)};App.preFlagClick=function(){if(App.needsPreview()){App.preview(true);return true}};App.runProject=function(){player.flagClick({shiftKey:false,preventDefault:function(){}})};App.filesDropped=function(e){[].slice.apply(e).forEach(App.fileDropped)};App.fileDropped=function(e){var t=e.name.split(".");var r=t.pop().toLowerCase();var n=t.join(".");if(r==="png"||r==="jpg"||r=="jpeg"||r==="svg"){if(r==="jpeg")r="jpg";var i=new FileReader;i.onloadend=function(){var e=i.result;var t=Project.newCostume(n,r,e);t.name.assign(uniqueName(t.name(),App.active().costumes()));Oops(function(){App.active().costumes.push(t)});App.tab.assign("costumes")};i.readAsArrayBuffer(e)}};var wrap=document.querySelector("#wrap");var container=null;App.project.subscribe(function(e){if(container){wrap.removeChild(container.el);container.destroy()}container=new Container(e,App.active);if(Host.isApp)wrap.appendChild(container.el)});var player=Player();App.project.subscribe(function(e){App.preview(false)});function fixActiveScriptsEditor(){if(App.isFullScreen())return;App.active()._scriptable.scriptsEditor.fixLayout()}windowSize.subscribe(fixActiveScriptsEditor);App.isFullScreen.subscribe(fixActiveScriptsEditor);Host.onAppLoad();
